[pytest]
addopts=
    --verbose
    --tb=short

filterwarnings=
    # Mark warnings as errors
    error

    # -------------- Temporary ignored warnings due to SLQAlchemy bump to 1.4 -------------- #
    # FIXME (lixxday, 2022/06/09)
    # Warning on relationships. Fix with backrefs: https://docs.sqlalchemy.org/en/14/errors.html#error-qzyx
    ignore:relationship '(User.UserOfferers|User.offerers|Offerer.UserOfferers|UserOfferer.*)' will copy column .* to column .*, which conflicts with relationship:sqlalchemy.exc.SAWarning
    # Warning on deprecated sqla function as_scalar()
    ignore:The Query.as_scalar\(\) method is deprecated and will be removed in a future release:sqlalchemy.exc.SADeprecationWarning
    # Warning cartesian product in SELECT statement. Apply join conditions between each element to resolve.
    ignore:SELECT statement has a cartesian product between FROM element\(s\) (\"(stock|offer)\" and FROM element \"(stock|offer)\"|\"(user_offerer|offerer)\" and FROM element \"(offerer|user_offerer)\"):sqlalchemy.exc.SAWarning
    # Warning on SELECT with IN. Fix: pass a select() construct explicitly
    ignore:Coercing Subquery object into a select\(\) for use in IN\(\):sqlalchemy.exc.SAWarning
    # Warnings (2 different warnings) with potential performance issues. Background on this error at: https://sqlalche.me/e/14/cprf
    ignore:Class unaccent will not make use of SQL compilation caching as it does not set the 'inherit_cache' attribute:sqlalchemy.exc.SAWarning
    ignore:TypeDecorator MagicEnum\(\) will not produce a cache key:sqlalchemy.exc.SAWarning
    # ---------------------------- #

    # FIXME (jsdupuis, 2022-04-14): can be removed when we use flask-sqlalchemy >=2.5
    # (https://github.com/pallets-eco/flask-sqlalchemy/commit/3565f0587519168c5ea4301f6e4bfba8c2ac4dee)
    ignore:'__ident_func__' is deprecated and will be removed in Werkzeug 2.1.:DeprecationWarning
    # FIXME (rpaoloni, 2022-04-19): some of our dependencies (swift and rq) use `distutils.version.StrictVersion`,
    # which emits a deprecation warnings with setuptools >=59.6.0. Remove this when we update or remove those
    # dependencies.
    ignore:distutils Version classes are deprecated. Use packaging.version instead.:DeprecationWarning
    # FIXME (jsdupuis, 2022-04-25): flask_admin validators uses tuples for flags (eg. field_flags = ('unique', )),
    # which emits deprecation warnings in wtforms >=3.0.0a1.
    # Remove this when we remove flask_admin
    ignore:Flags should be stored in dicts and not in tuples. The next version of WTForms will abandon support for flags in tuples.:DeprecationWarning
    # FIXME (askorski, 2022-05-02): algoliasearch uses deprecated @coroutine decorator
    # Remove this when alogliasearch no more uses @coroutine
    ignore:\"@coroutine\" decorator is deprecated since Python 3.8, use \"async def\" instead:DeprecationWarning
testpaths=tests
norecursedirs=.git venv/ .pytest_cache/
# Synchronize these globs with `TEST_FILES` in CircleCI configuration
python_files=*_test.py test_*.py tests.py
python_classes=*Test
python_functions=test_* when_* expect_* should_*
env_files=local_test_env_file
mocked-sessions=pcapi.models.db.session
junit_family=xunit1
