"""Add apiUrl to Providers

Revision ID: ee190d0fbe21
Revises: bcb0407d88ea
Create Date: 2021-03-10 10:22:41.026369

"""
from alembic import op
import sqlalchemy as sa
from sqlalchemy.dialects import postgresql


# revision identifiers, used by Alembic.
revision = "ee190d0fbe21"
down_revision = "bcb0407d88ea"
branch_labels = None
depends_on = None


def upgrade():
    op.drop_constraint("check_provider_has_localclass_or_apikey", "provider")

    # ### commands auto generated by Alembic ###
    op.drop_column("provider", "apiKeyGenerationDate")
    op.drop_column("provider", "apiKey")
    # ### end Alembic commands ###


def downgrade():
    # ### commands auto generated by Alembic ###
    op.add_column("provider", sa.Column("apiKey", sa.CHAR(length=32), autoincrement=False, nullable=True))
    op.add_column(
        "provider", sa.Column("apiKeyGenerationDate", postgresql.TIMESTAMP(), autoincrement=False, nullable=True)
    )
    # ### end Alembic commands ###

    op.create_check_constraint(
        "check_provider_has_localclass_or_apikey",
        "provider",
        '("localClass" IS NOT NULL AND "apiKey" IS NULL) OR ("localClass" IS NULL AND "apiKey" IS NOT NULL)',
    )
