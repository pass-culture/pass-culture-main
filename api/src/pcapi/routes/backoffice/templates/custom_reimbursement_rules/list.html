{% extends "layouts/list.html" %}
{% from "components/forms.html" import build_filters_form_ng with context %}
{% from "components/dynamic/modal.html" import build_dynamic_modal with context %}
{% from "components/dynamic/element.html" import dynamic_element with context %}
{% from "components/turbo/spinner.html" import build_loading_spinner with context %}
{% block title %}
  Tarifs dérogatoires
{% endblock title %}
{% set rows_count = rows|length %}
{% block search_block %}{{ build_filters_form_ng(form, dst) }}{% endblock %}
{% block before_table %}
  <div class="col-md-12 mt-4">
    {{ dynamic_element(url=url_for('backoffice_web.reimbursement_rules.get_stats') , div_id="reimbursement_stats") }}
  </div>
  {% if has_permission("CREATE_REIMBURSEMENT_RULES") %}
    <button class="btn btn-outline-primary-subtle-bg col-2"
            data-bs-toggle="modal"
            data-bs-target="#create-custom-reimbursement-rule"
            type="button">Créer un tarif dérogatoire</button>
    {{ build_dynamic_modal(url_for("backoffice_web.reimbursement_rules.get_create_custom_reimbursement_rule_form") , "create-custom-reimbursement-rule") }}
  {% endif %}
{% endblock before_table %}
{% block table_header %}
  <th>Actions</th>
  <th>ID règle</th>
  <th>Entité juridique</th>
  <th>SIREN</th>
  <th>Partenaire culturel</th>
  <th>Offre</th>
  <th>Taux de remboursement</th>
  <th>Montant remboursé</th>
  <th>Sous-catégories</th>
  <th>Date d'application</th>
{% endblock table_header %}
{% block table_body %}
  {% include "custom_reimbursement_rules/list/rows.html" %}
{% endblock table_body %}
{% block after_table %}
  {% for reimbursement_rule in rows %}
    {% if not reimbursement_rule.timespan.upper %}
      {{ build_dynamic_modal(url_for("backoffice_web.reimbursement_rules.get_edit_custom_reimbursement_rule_form", reimbursement_rule_id=reimbursement_rule.id) ,
      "edit-custom-reimbursement-rule-" + reimbursement_rule.id|string) }}
    {% endif %}
  {% endfor %}
{% endblock %}
