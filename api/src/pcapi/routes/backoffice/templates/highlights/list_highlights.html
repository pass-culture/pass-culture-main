{% extends "layouts/list.html" %}
{% from "components/forms.html" import build_filters_form_ng with context %}
{% from "components/dynamic/modal.html" import build_dynamic_modal with context %}
{% from "components/turbo/spinner.html" import build_loading_spinner with context %}
{% import "components/links.html" as links with context %}
{% set rows_count = rows.total %}
{% set pagination = True %}
{% block title %}Valorisations thématiques{% endblock %}
{% block search_block %}{{ build_filters_form_ng(form, dst) }}{% endblock %}
{% block before_table %}
  {% if has_permission("MANAGE_HIGHLIGHT") %}
    <div class="mt-4">
      <button class="btn btn-outline-primary-subtle-bg mt-2"
              data-bs-toggle="modal"
              data-bs-target="#create-highlight"
              type="button">Créer une valorisation</button>
      {{ build_dynamic_modal(url_for("backoffice_web.highlights.get_create_highlight_form") , "create-highlight") }}
    </div>
  {% endif %}
{% endblock %}
{% block table_header %}
  <th>Actions</th>
  <th>ID</th>
  <th>Nom</th>
  <th>Description</th>
  <th>Diffusion espace partenaire</th>
  <th>Date(s) d'évènement</th>
  <th>Image</th>
{% endblock table_header %}
{% block table_body %}
  {% for highlight in rows.items %}
    <tr>
      <td class="text-center">
        <div class="dropdown">
          <button type="button"
                  data-bs-toggle="dropdown"
                  aria-expanded="false"
                  class="btn p-0 btn-outline-primary-subtle-bg border-0 px-2 py-1">
            <i class="bi bi-three-dots-vertical"></i>
          </button>
          <ul class="dropdown-menu">
            <li class="dropdown-item">
              <a class="btn btn-sm d-block w-100 text-start px-3"
                 href="{{ url_for("backoffice_web.offer.list_offers") }}?search-0-search_field=HIGHLIGHT_REQUEST&search-0-operator=IN&search-0-highlight={{ highlight.id }}">Voir les offres candidates</a>
            </li>
            <li class="dropdown-item">
              <a class="btn btn-sm d-block w-100 text-start px-3"
                 data-bs-toggle="modal"
                 data-bs-target="#update-highlight-{{ highlight.id }}">Modifier la valorisation</a>
            </li>
          </ul>
        </div>
      </td>
      <td>{{ highlight.id }}</td>
      <td>{{ highlight.name }}</td>
      <td>{{ highlight.description | nl2br }}</td>
      <td>{{ highlight.availability_timespan | format_timespan }}</td>
      <td>{{ highlight.highlight_timespan | format_timespan }}</td>
      <td class="px-2 py-3">
        {% if highlight.mediation_url %}
          <div class="rounded pc-offer-table-image pc-offer-table-image-container"
               style="background-image: url('{{ highlight.mediation_url }}')"></div>
        {% else %}
          <div class="rounded pc-offer-table-no-image pc-offer-table-image-container">
            <i class="bi bi-file-image"></i>
          </div>
        {% endif %}
      </td>
    </tr>
  {% endfor %}
{% endblock table_body %}
{% block after_table %}
  {% for highlight in rows.items %}
    {{ build_dynamic_modal(url_for('backoffice_web.highlights.get_update_highlight_form', highlight_id=highlight.id) , "update-highlight-" + highlight.id|string) }}
  {% endfor %}
{% endblock after_table %}
