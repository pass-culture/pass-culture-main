{% extends "layouts/list.html" %}
{% from "components/forms.html" import build_filters_form_ng with context %}
{% from "components/dynamic/modal.html" import build_dynamic_modal with context %}
{% set procedure_id = get_setting("DS_USER_ACCOUNT_UPDATE_PROCEDURE_ID") %}
{% set link = "https://demarche.numerique.gouv.fr/procedures/" + procedure_id|string %}
{% set pagination = True %}
{% set rows_count = rows.total %}
{% set page_title = "Demandes de modifications – démarche "~procedure_id~"" %}
{% block title %}
  Demandes de modifications – démarche <a href="{{ link }}"
    class="link-primary"
    target="_blank"
    rel="noreferrer noopener"
    title="Ouvrir la Démarche Numérique">{{ procedure_id }}
  <i class="bi bi-box-arrow-up-right">
  </i>
</a>
{% endblock title %}
{% block search_block %}
  {{ build_filters_form_ng(form, dst) }}
{% endblock search_block %}
{% block table_header %}
  {% if is_instructor %}<th>Actions</th>{% endif %}
  <th>Dossier</th>
  <th>État</th>
  <th>
    {% if date_last_update_sort_url %}
      <a href="{{ date_last_update_sort_url }}"
         class="text-decoration-none"
         title="Changer pour un tri {{ 'décroissant' if request.args.get("order") == 'asc' else 'croissant' }}">
        Date de dernière MàJ
        <i class="bi bi-sort-{{ 'up' if request.args.get("order") == 'asc' else 'down' }}-alt"></i>
      </a>
    {% else %}
      Date de dernière MàJ
    {% endif %}
  </th>
  <th>Date des derniers messages</th>
  <th>Demandeur</th>
  <th>Jeune</th>
  <th>Modification</th>
  <th>Instructeur</th>
{% endblock table_header %}
{% block table_body %}
  {% with update_requests = rows.items %}
    {% include "accounts/update_requests_list_rows.html" %}
  {% endwith %}
{% endblock table_body %}
{% block after_table %}
  {% for update_request in rows.items %}
    {{ build_dynamic_modal(url_for("backoffice_web.account_update.get_accept_form", ds_application_id=update_request.dsApplicationId) , "accept-" + update_request.dsApplicationId|string, "xl") }}
    {{ build_dynamic_modal(url_for("backoffice_web.account_update.get_ask_for_correction_form", ds_application_id=update_request.dsApplicationId, correction_reason="unreadable-photo") , "ask-for-correction-unreadable-photo-" + update_request.dsApplicationId|string, "xl") }}
    {{ build_dynamic_modal(url_for("backoffice_web.account_update.get_ask_for_correction_form", ds_application_id=update_request.dsApplicationId, correction_reason="missing-file") , "ask-for-correction-missing-file-" + update_request.dsApplicationId|string, "xl") }}
    {{ build_dynamic_modal(url_for("backoffice_web.account_update.get_ask_for_correction_form", ds_application_id=update_request.dsApplicationId, correction_reason="refused-file") , "ask-for-correction-refused-file-" + update_request.dsApplicationId|string, "xl") }}
    {{ build_dynamic_modal(url_for("backoffice_web.account_update.get_identity_theft_form", ds_application_id=update_request.dsApplicationId) , "identity-theft-" + update_request.dsApplicationId|string, "xl") }}
    {{ build_dynamic_modal(url_for("backoffice_web.account_update.get_select_user_form", ds_application_id=update_request.dsApplicationId) , "select-user-" + update_request.dsApplicationId|string, "xl") }}
  {% endfor %}
{% endblock after_table %}
