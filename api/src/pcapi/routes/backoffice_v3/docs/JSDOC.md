<!-- Generated by documentation.js. Update this documentation by updating the source code. -->

### Table of Contents

*   [PcBackofficeApp][1]
    *   [Parameters][2]
    *   [Examples][3]
    *   [addons][4]
    *   [appState][5]
    *   [bindEvents][6]
        *   [Examples][7]
    *   [bindTurboFrameEvents][8]
    *   [initialize][9]
        *   [Examples][10]
    *   [onTurboFrameMissing][11]
        *   [Parameters][12]
        *   [Examples][13]
    *   [unbindEvents][14]
        *   [Examples][15]
    *   [LOCALSTORAGE\_KEY][16]
*   [Core features][17]
*   [PcUtils][18]
    *   [addLoadEvent][19]
        *   [Parameters][20]
    *   [debounce][21]
        *   [Parameters][22]
*   [KeyboardKeyCode][23]
    *   [Examples][24]
*   [NonConstructableUtils][25]
    *   [Examples][26]
*   [PcEventHandler][27]
    *   [Examples][28]
    *   [off][29]
        *   [Parameters][30]
        *   [Examples][31]
    *   [on][32]
        *   [Parameters][33]
        *   [Examples][34]
    *   [one][35]
        *   [Parameters][36]
        *   [Examples][37]
    *   [trigger][38]
        *   [Parameters][39]
        *   [Examples][40]
*   [PcAddOn][41]
    *   [Parameters][42]
    *   [Examples][43]
    *   [\_preventDefault][44]
        *   [Parameters][45]
    *   [bindEvents][46]
        *   [Examples][47]
    *   [initialize][48]
    *   [saveState][49]
        *   [Parameters][50]
        *   [Examples][51]
    *   [unbindEvents][52]
        *   [Examples][53]
*   [Add Ons features][54]
*   [BsTooltips][55]
*   [PcBatchActionForm][56]
    *   [Examples][57]
*   [PcFormsCheckValidity][58]
*   [PcOverrideCustomTextareaEnter][59]
    *   [Examples][60]
*   [PcPostalAddressAutocomplete][61]
    *   [Examples][62]
*   [PcSelectMultipleField][63]
    *   [Examples][64]
*   [PcTableMultiSelect][65]
    *   [Examples][66]
*   [PcValidationFilters][67]
    *   [Examples][68]

## PcBackofficeApp

Creates an instance for your application entrypoint that initializes the Backoffice application.

This documentation was generated by documentation js.
See below for how to regenerate the documentation or initialize the application.

### Parameters

*   `config` **{addOns: [Array][69]<[PcAddOn][41]>}** the application configuration.

    *   `config.addOns` &#x20;

### Examples

```javascript
// Re-generate this documentation (nodejs 6+ required)
npx documentation build src/pcapi/static/backofficev3/js/** \
  --config src/pcapi/routes/backoffice_v3/docs/jsdoc-config.yml \
  --format md \
  --sort-order alpha > src/pcapi/routes/backoffice_v3/docs/JSDOC.md
```

```javascript
// To initialize the application, within the `<head>` of the HTML document:
const app = new BackofficeApp({
  csrfToken: '{{ csrf_token }}', // This value is passed by jinja and contains the csrf token input as a string
  addOns: [
    // add custom JavaScript addons here
  ],
})
```

### addons

Each application's addons instance is available from within the `app` instance through `app.addons[name]`.

### appState

This is the JS application state. It is used by PcAddOn and allow partial persistence of any addon state using `addon.saveState(state)`

### bindEvents

This method is automatically called on window `load` event and will run each addon's bindEvents method.
When using XHR, it can be useful to rerun the bindEvents method on XHR response after DOM modification.

#### Examples

```javascript
// To manually bind all addons
app.bindEvents()
```

```javascript
// To manually bind a specific addon
app.addons.bsTooltips.unbindEvents()
```

### bindTurboFrameEvents

This method is automatically called on window `load` event and will bind turbo frame events.
We have 3 turbo events binding at the moments:

1.  `turbo:before-frame-render`: trigger `app.unbindEvents` on XHR response right before frame render,
2.  `turbo:frame-render`: trigger `app.bindEvents` on XHR response right after frame render,
3.  `turbo:frame-missing`: trigger `app.onTurboFrameMissing` on XHR response if the `id` of the turbo frame doesn't exist.

Read more: [https://turbo.hotwired.dev/reference/events][70]

### initialize

This method is automatically called on window `load` event and will run each addon's initialize method.
When using XHR, it can be useful to rerun the initialization, or initialize a specific addon.

#### Examples

```javascript
// To manually initialize all addons
app.initialize()
```

```javascript
// To manually initialize a specific addon
app.addons.bsTooltips.initialize()
```

### onTurboFrameMissing

Handle server-side errors without a turbo-frame..
Default behaviour since turbo 7.2 is to display a full page with the error content.
For example, if nginx throws a 504 error because the flask controller did not respond in time,
the whole page will be replaced by a generic 504 error message, which is not great in terms of UX.

#### Parameters

*   `event` **[Event][71]**&#x20;

#### Examples

```javascript
addEventListener("turbo:frame-missing", app.onTurboFrameMissing)
```

### unbindEvents

This method is not called automatically.
It run each addon's unbindEvents method.
When using XHR, it can be useful to run the unbindEvents method prior XHR request to edit the DOM.

#### Examples

```javascript
// To manually unbind all addons
app.unbindEvents()
```

```javascript
// To manually unbind a specific addon
app.addons.bsTooltips.unbindEvents()
```

### LOCALSTORAGE\_KEY

This static string is used as the localStorage key for the application.

## Core features

Those are the core features

## PcUtils

**Extends NonConstructableUtils**

This class is used to store transversal application utilities.

### addLoadEvent

Push a callback function to window.onload

#### Parameters

*   `callback` **[function][72]** the function to be called on `window.onload`

### debounce

Debounce a function (prevents function to be called until a certain delay. Can be useful for autocompletion)

#### Parameters

*   `callback` **[function][72]** the function to debounce
*   `ms` **[number][73]** the debounce delay in milliseconds

Returns **[function][72]** the debounced function

## KeyboardKeyCode

**Extends NonConstructableUtils**

Store some useful JavaScript Keyboard events keycode statically

### Examples

```javascript
// return 13
KeyboardKeyCode.ENTER
```

## NonConstructableUtils

This abstract class is used to create new utilities.
It uses a protection to prevent using anything but static methods.

### Examples

```javascript
// To create a new utility:
class PcNewToolBox extends NonConstructableUtils {
  static doSomething() {
    return "do"
  }
}
```

```javascript
// usage
PcNewToolBox.doSomething()
// fail
new PcNewToolBox()
```

## PcEventHandler

This singleton utility class can be used to bind/unbind event in the style of `jQuery.on`/`jQuery.off`.

It is heavily inspired from Bootstrap (v5.3.0-alpha1): `dom/event-handler.js`

Original source: [https://github.com/twbs/bootstrap/blob/cf9454caa00872899215603e5e036d9a824b1b11/js/src/dom/event-handler.js][74]

As the original source, this addon is licensed as MIT.

The event will have:

*   `event.target`: the target DOM element.
*   `event.delegateTarget`: the parent DOM element that hold the bind.

Each addon must have a `bindEvents` and `unbindEvent` method,
and can have an `initialize` method which will be called on document load.

### Examples

```javascript
// We must add DOM events using PcAddOn class.
class PcLoggingOnImage extend PcAddOn {
  bindEvents() {
    // bind events
    EventHandler.on(document.body, 'click', 'img', this.#onClick)
  }

  unbindEvents() {
    // unbind events (revert)
    EventHandler.off(document.body, 'click', 'img', this.#onClick)
  }

  #onClick() {
    console.log('Image as been clicked!')
  }
}
```

### off

Read more: [https://api.jquery.com/off/#off-events-selector-data][75]

#### Parameters

*   `element` **[element][76]** the parent element to unbind from
*   `originalTypeEvent` **[string][77]** the event name to unbind
*   `handler` **[string][77]** the selector for element bind apply
*   `delegationFunction` **[function][72]** the event method to unbind

#### Examples

```javascript
EventHandler.off(document.body, 'click', '.nav-link', onNavLinkClick)
```

### on

Read more: [https://api.jquery.com/on/#on-events-selector-data][78]

#### Parameters

*   `element` **[element][76]** the parent element to apply bind
*   `event` **[string][77]** the event name to bind
*   `handler` **[string][77]** the selector for elements bind apply
*   `delegationFunction` **[function][72]** the event method to bind

#### Examples

```javascript
EventHandler.on(document.body, 'click', '.nav-link', onNavLinkClick)
```

### one

Read more: [https://api.jquery.com/one/#one-events-selector-data][79]

#### Parameters

*   `element` **[element][76]** the parent element to apply bind
*   `event` **[string][77]** the event name to bind
*   `handler` **[string][77]** the selector for element bind apply
*   `delegationFunction` **[function][72]** the event method to bind

#### Examples

```javascript
EventHandler.one(document.body, 'click', '.nav-link#something', onNavLinkClick)
```

### trigger

Read more: [https://api.jquery.com/trigger/#trigger-events-selector-data][80]

#### Parameters

*   `element` **[element][76]** DOM element to trigger event on
*   `event` **[string][77]** The event to trigger
*   `args` **any** Arguments to be passed to the event

#### Examples

```javascript
EventHandler.trigger(document.querySelectorAll('.nav-link')[2], 'click')
```

Returns **(null | [Event][71])** null if element is undefined or event is not a string, the triggered event otherwise

## PcAddOn

This abstract class can be extended to create new addon for new JavaScript features.

**It is mandatory to use it each time one needs to add JavaScript features!**

### Parameters

*   `config` **{name: [string][77], app: [PcBackofficeApp][1], addOnState: any}** the addon configuration

    *   `config.name` &#x20;
    *   `config.app` &#x20;
    *   `config.addOnState` &#x20;

### Examples

```javascript
class ExampleAddOn extend PcAddOn {
  initialize() {
    // prepare the DOM if necessary
  }
  bindEvents() {
    // bind events
    EventHandler.on(document.body, 'click', this.#onClick)
  }

  unbindEvents() {
    // unbind events (revert)
    EventHandler.off(document.body, 'click', this.#onClick)
  }
}
```

```javascript
// Add it to your app addons:
const app = new PcBackofficeApp({
  addOns: [
    ExampleAddOn, // <-- This is how you mount a new addon into the application.
  ]
})
```

### \_preventDefault

This method is just a repetitive utility that prevents default event.
Can be useful to prevent code duplication between addons when you only need to prevent default event.

#### Parameters

*   `event` **[event][71]** the event

### bindEvents

This method binds addon events.
Initialization is already called on document load through instance of `PcBackofficeApp`.
It is called when event `turbo:frame-render` is emitted, prior an XHR call.

#### Examples

```javascript
app.addons.bsTooltips.bindEvents()
```

### initialize

This method initializes the addon.
Initialization is already called on document load through instance of `PcBackofficeApp`

### saveState

This method saves the addon's new state in localStorage

#### Parameters

*   `state` **any** the addon new state to be persisted

#### Examples

```javascript
// within the addon
this.saveState(this.state)
```

```javascript
// outside the addon
app.addons[name].saveState(newState)
```

### unbindEvents

This method unbinds addon events.
It is called when event `turbo:before-frame-render` is emitted, after an XHR call.

#### Examples

```javascript
app.addons.bsTooltips.unbindEvents()
```

## Add Ons features

Below addons are created using PcAddOn class.

## BsTooltips

**Extends PcAddOn**

This adds PcAddOn support for bootstrap 5 tooltips.
It works using bootstrap 5 html markup.
Read documentation: [https://getbootstrap.com/docs/5.0/components/tooltips/#examples][81]

## PcBatchActionForm

**Extends PcAddOn**

Add batch submit form to selection done using one `selectedRowsIds` within [PcTableMultiSelect][65].

Form is renderer through a turbo frame which must be loaded with `loading="true"`.

> Current integration does not yet support modal rendered with turbo `loading="lazy"`.

To work, each `.btn-group` must set the following attributes:

*   `[data-toggle="pc-batch-confirm-btn-group"]`: this value is fixed,
*   `[data-toggle-id]`: this value must be a unique identifier,
*   `[data-pc-table-multi-select-id]`: this value must be a valid pc table multi select identifier,
*   `[data-input-ids-name]`: this value is used as the input name for storing `selectedIds`.

Within the `.btn-group` container, you can add as many buttons as needed, and you must set some attributes too:

*   `[data-use-confirmation-modal]`: `true` to open a modal to add a comment or `false` to submit directly, (required)
*   \`\[data-modal-selector]: this value must be the modal selector that contain the form. (optional)

### Examples

```javascript
<div
  class="btn-group btn-group-sm"
  data-toggle="pc-batch-confirm-btn-group"
  data-toggle-id="table-container-user-offerer-validation-btn-group"
  data-pc-table-multi-select-id="table-container-user-offerer-validation"
  data-input-ids-name="object_ids"
>
  <button
    disabled
    type="button"
    class="btn btn-outline-primary"
    data-user-confirmation-modal="false"
  >
    Valider
  </button>
  <button
    disabled
    type="button"
    class="btn btn-outline-primary"
    data-use-confirmation-modal="true"
    data-modal-selector="#batch-pending-modal"
  >
    Mettre en attente
  </button>
  <button
    disabled
    type="button"
    class="btn btn-outline-primary"
    data-use-confirmation-modal="true"
    data-modal-selector="#batch-reject-modal"
  >
    Rejeter
  </button>
</div>

 {{ build_lazy_modal(url_for("backoffice_v3_web.validation.get_batch_user_offerer_pending_form"), "batch-pending-modal", "true") }}
 {{ build_lazy_modal(url_for("backoffice_v3_web.validation.get_batch_reject_user_offerer_form"), "batch-reject-modal", "true") }}
```

## PcFormsCheckValidity

**Extends PcAddOn**

This edits the  default `submit` event on forms.
It internally runs `form.checkValidity()` first and aborts in case of invalid form.

> There is no markup necessary as this selects all `<form />`

## PcOverrideCustomTextareaEnter

**Extends PcAddOn**

This class tricks the default event of a `<textarea />` by submitting the form on <kbd>ENTER</kbd>,
and goes to the next line on <kbd>CTRL</kbd>+<kbd>ENTER</kbd> or <kbd>SHIFT</kbd>+<kbd>ENTER</kbd>.

### Examples

```javascript
<textarea class="pc-override-custom-textarea-enter"></textarea>
```

## PcPostalAddressAutocomplete

**Extends PcAddOn**

Renders a postal address autocomplete that fills values in hidden inputs.

It can be used when declaring form fields in the backend using `fields.PcPostalAddressAutocomplete`.

> There is no HTML markup example as it uses a wtforms fields: `postal_address_autocomplete.html`

### Examples

```javascript
// We declare a field mapping to tell what field the autocomplete must set.
// None of them are mandatory, however, you must choose one so your autocomplete can submit something to the backend.

postal_address_autocomplete = fields.PcPostalAddressAutocomplete(
  "Adresse",
  address="address", // the name of your address field within your form, for its autocomplete to work
  city="city", // the name of your city field within your form, for its autocomplete to work
  postalCode="postalCode", // the name of your postalCode field within your form, for its autocomplete to work
  latitude="latitude", // the name of your latitude field within your form, for its autocomplete to work
  longitude="longitude", // the name of your longitude field within your form, for its autocomplete to work
  required=True, // if True, it will add the required attribute to autocomplete the input (default: false)
  hasReset=True, // if True, it will add a reset-to-initial-values button (default: false)
  hasManualEditing=True, // if True, it will propose manual edition (default: false)
  limit=10, // limit of autocomplete choices (default: 10)
)
// Below are the hidden fields, you can decide to add form validators to them.
address = fields.PCOptHiddenField("address") // if selected in the autocomplete, it will be filled in the form
city = fields.PCOptHiddenField("Ville") // if selected in the autocomplete, it will be filled in the form
postalCode = fields.PCOptPostalCodeHiddenField("Code postal") // if selected in the autocomplete, it will be filled in the form
latitude = fields.PCOptHiddenField("Latitude") // if selected in the autocomplete, it will be filled in the form
longitude = fields.PCOptHiddenField("Longitude") // if selected in the autocomplete, it will be filled in the form
```

## PcSelectMultipleField

**Extends PcAddOn**

Configure TomSelect on a `<select multiple />`.

In the front-end business, we note two types of tom select instances:

1.  select multiple field.
2.  select multiple field with xhr autocomplete.

### Examples

```javascript
// select multiple field
<select multiple class="pc-select-multiple-field">
  <option value="1">item #1</option>
  <option value="2">item #2</option>
</select>
```

```javascript
// select multiple field with xhr autocomplete.
// In this example, our backend automatically sets data attributes, this allows the initial render to have the initialValues
<select
  multiple
  class="pc-select-multiple-field pc-select-multiple-autocomplete-field"
  data-tomselect-autocomplete-url="/backofficev3/autocomplete/offerers"
  data-tomselect-options="[{\"id\": \"84\", \"text\": \"Cin\u00e9ma - CGR (00000003800058)\"}]"
  data-tomselect-items="[\"84\"]"
></select>
```

## PcTableMultiSelect

**Extends PcAddOn**

Adds select all rows features to a table.

When rows selection change, it emit a `CustomEvent` named `pcTableMultiSelect:change` with:

*   `detail.tableMultiSelectId`: the unique identifier of the table multi select,
*   `detail.rowsIds`: the list of table entities identifier,
*   `detail.selectedRowsIds`: the list of selected identifier.

### Examples

```javascript
// create a new table multi select using HTML markup
<table data-table-multi-select-id="my-unique-id">
  <tr>
    <th><input type="checkbox" name="pc-table-multi-select-check-all"></th>
    <th>Description</th>
  </tr>
  <tr>
    <td><input type="checkbox" name="pc-table-multi-select-check-example1"></td>
    <td>Example 1</td>
    <td><input type="checkbox" name="pc-table-multi-select-check-example2"></td>
    <td>Example 2</td>
  </tr>
</table>
```

```javascript
// Example of addon which listen for selection change of any pc table multi select
class PcExample extends PcAddOn {
  bindEvents() {
    addEventListener('pcTableMultiSelect:change', this.#onUpdate)
  }

  unbindEvents() {
    removeEventListener('pcTableMultiSelect:change', this.#onUpdate)
  }

  #onUpdate(event) {
    console.log(event.detail)
  }
}
```

## PcValidationFilters

**Extends PcAddOn**

Addon to add filters toggling using a button and make their state persistent.

### Examples

```javascript
<div class="table-example" data-toggle="filters" data-toggle-id="something-unique">
  <button type="button" class="filters-toggle-button" disabled>Chargement...</button>
  <div class="filters-container">
     <!-- add your filters here -->
  </div>
</div>
```

[1]: #pcbackofficeapp

[2]: #parameters

[3]: #examples

[4]: #addons

[5]: #appstate

[6]: #bindevents

[7]: #examples-1

[8]: #bindturboframeevents

[9]: #initialize

[10]: #examples-2

[11]: #onturboframemissing

[12]: #parameters-1

[13]: #examples-3

[14]: #unbindevents

[15]: #examples-4

[16]: #localstorage_key

[17]: #core-features

[18]: #pcutils

[19]: #addloadevent

[20]: #parameters-2

[21]: #debounce

[22]: #parameters-3

[23]: #keyboardkeycode

[24]: #examples-5

[25]: #nonconstructableutils

[26]: #examples-6

[27]: #pceventhandler

[28]: #examples-7

[29]: #off

[30]: #parameters-4

[31]: #examples-8

[32]: #on

[33]: #parameters-5

[34]: #examples-9

[35]: #one

[36]: #parameters-6

[37]: #examples-10

[38]: #trigger

[39]: #parameters-7

[40]: #examples-11

[41]: #pcaddon

[42]: #parameters-8

[43]: #examples-12

[44]: #_preventdefault

[45]: #parameters-9

[46]: #bindevents-1

[47]: #examples-13

[48]: #initialize-1

[49]: #savestate

[50]: #parameters-10

[51]: #examples-14

[52]: #unbindevents-1

[53]: #examples-15

[54]: #add-ons-features

[55]: #bstooltips

[56]: #pcbatchactionform

[57]: #examples-16

[58]: #pcformscheckvalidity

[59]: #pcoverridecustomtextareaenter

[60]: #examples-17

[61]: #pcpostaladdressautocomplete

[62]: #examples-18

[63]: #pcselectmultiplefield

[64]: #examples-19

[65]: #pctablemultiselect

[66]: #examples-20

[67]: #pcvalidationfilters

[68]: #examples-21

[69]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Array

[70]: https://turbo.hotwired.dev/reference/events

[71]: https://developer.mozilla.org/docs/Web/API/Event

[72]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Statements/function

[73]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number

[74]: https://github.com/twbs/bootstrap/blob/cf9454caa00872899215603e5e036d9a824b1b11/js/src/dom/event-handler.js

[75]: https://api.jquery.com/off/#off-events-selector-data

[76]: https://developer.mozilla.org/docs/Web/API/Element

[77]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String

[78]: https://api.jquery.com/on/#on-events-selector-data

[79]: https://api.jquery.com/one/#one-events-selector-data

[80]: https://api.jquery.com/trigger/#trigger-events-selector-data

[81]: https://getbootstrap.com/docs/5.0/components/tooltips/#examples
