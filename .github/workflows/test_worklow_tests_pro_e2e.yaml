name: "Test tests pro"

on:
  push:
    branches:
        - safe-chain-testing


permissions: write-all

jobs:

    build-pcapi-tests:
        name: "[pcapi-tests] build docker image."
        uses: ./.github/workflows/dev_on_workflow_build_docker_image.yml
        with:
          image: pcapi-tests
          tag: ${{ github.sha }}

    test-pro-e2e-parallel:
        name: "Pro E2E Tests (Parallel)"
        needs: [pcapi-init-job, build-pcapi-tests]
        uses: ./.github/workflows/dev_on_workflow_tests_pro_e2e.yml
        with:
            ENV: "development"
            tag: 'latest'
            CACHE_BUCKET_NAME: "passculture-infra-prod-github-runner-cache"
        secrets:
            GCP_EHP_WORKLOAD_IDENTITY_PROVIDER: ${{ secrets.GCP_EHP_WORKLOAD_IDENTITY_PROVIDER }}
            GCP_EHP_SERVICE_ACCOUNT: ${{ secrets.GCP_EHP_SERVICE_ACCOUNT }}