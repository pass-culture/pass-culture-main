name: Deploy
on:
  workflow_call:
    inputs:
      environment:
        type: string
        required: true
      app_version:
        type: string
        required: true
      teleport_version:
        type: string
        required: true
      teleport_proxy:
        type: string
        required: true
      teleport_kubernetes_cluster:
        type: string
        required: true
      deploy_adage:
        type: boolean
        required: false
        default: false
      deploy_api:
        type: boolean
        required: false
        default: false
      deploy_pro:
        type: boolean
        required: false
        default: false

env:
  REGION: europe-west1

jobs:
  deploy-image-resizing:
    name: "Deploy image-resizing"
    permissions:
      contents: 'read'
      id-token: 'write'
    uses: ./.github/workflows/deploy-app-engine-image-resizing.yaml
    with:
      environment: ${{ inputs.environment == 'production' && 'production' || 'testing' }}
      google_project: ${{ inputs.environment == 'production' && 'passculture-metier-prod' || 'passculture-metier-ehp' }}
      base_ref: ${{ github.ref }}
    secrets: inherit
