on: 
  workflow_call:

jobs:
  check-resizing-image-folder-changes:
    name: "Check if folder changed"
    uses: ./.github/workflows/check-folder-changes.yml
    with:
      folder: app-engine/image-resizing

  deploy-change:
    name: "Deploy image-resizing"
    needs: check-resizing-image-folder-changes
    if: needs.check-resizing-image-folder-changes.outputs.folder_changed == 'true'
    uses: ./.github/workflows/deploy-app-engine-image-resizing.yaml
    with:
      environment: testing
      google_project: passculture-metier-ehp
      base_ref: ${{ github.ref }}
    secrets:
      workload_identity_provider: ${{ secrets.GCP_EHP_WORKLOAD_IDENTITY_PROVIDER }}
      service_account: ${{ secrets.APP_ENGINE_IMAGE_RESIZING_EHP_SERVICE_ACCOUNT }}
