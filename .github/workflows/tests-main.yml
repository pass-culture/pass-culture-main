name: Test main
run-name: Test main${{ github.ref == 'refs/heads/master' && ' and deploy to testing' || '' }}
on:
  push:
    branches:
      - master
      - "maint/**"
  pull_request:
    branches-ignore:
      - docs

concurrency:
  # cancel previous workflow of the same branch except on master
  group: ${{ github.ref }}
  cancel-in-progress: ${{ github.ref == 'refs/heads/master' && false || true }}

jobs:
  run_ruff_and_show_differences:
    runs-on: linux

    steps:
    - uses: actions/checkout@v3
    - name: Set up Python
      uses: actions/setup-python@v2
      with:
        python-version: "3.10"
    - name: Install dependencies
      run: |
        pip install -U pip ruff
        pip freeze
    - name: Run ruff
      run: |
        ruff format .
    - name: Show diff
      run: |
        git diff
