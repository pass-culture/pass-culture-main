version: 2

updates:
  # Frontend Pro
  - package-ecosystem: 'npm'
    directory: '/pro'
    schedule:
      interval: 'daily'
      time: '09:00'
    open-pull-requests-limit: 15
    cooldown:
      default-days: 7
    groups:
      # React updates
      react:
        patterns:
          - "react*"
          - "@types/react*"
      # Build tools
      build-tools:
        patterns:
          - "@storybook*"
          - "storybook*"
          - "typescript*"
          - "vite*"
      # Other tools
      tools:
        patterns:
          - "@sentry*"
          - "sentry*"
      # Testing frameworks
      testing:
        patterns:
          - "allure*"
          - "cypress*"
          - "playwright*"
          - "vitest*"
      # Linting and formatting
      linting:
        patterns:
          - "@biomejs*"
          - "eslint*"
          - "@eslint/*"
          - "prettier*"
          - "stylelint*"
          - "typescript-eslint*"

  # Public API doc
  - package-ecosystem: 'npm'
    directory: '/api/documentation'
    schedule:
      interval: 'daily'
      time: '09:00'
    cooldown:
      default-days: 7
    ignore:
      - dependency-name: '*'
        update-types: ['version-update:semver-major']
    groups:
      # Docusaurus updates
      docusaurus:
        patterns:
          - "docusaurus*"
          - "@docusaurus*"

  # Backend Python
  - package-ecosystem: 'pip' # pip even if we use poetry
    directory: '/api'
    schedule:
      interval: 'daily'
      time: '03:00'
    open-pull-requests-limit: 15
    cooldown:
      default-days: 7
    ignore:
      # Exclude packages that have very frequent updates. They have a
      # specific configuration, see block below.
      - dependency-name: boto3
      # Except for critical ones where we only allow patches update
      - dependency-name: 'flask'
        update-types:
          ['version-update:semver-major', 'version-update:semver-minor']
      - dependency-name: 'sqlalchemy'
        update-types:
          ['version-update:semver-major', 'version-update:semver-minor']
      - dependency-name: 'pydantic'
        update-types:
          ['version-update:semver-major', 'version-update:semver-minor']
      # We are not ready to handle upper version of spectree, even for patches
      - dependency-name: 'spectree'
    # Disable automatic rebasing for poetry pull requests
    rebase-strategy: 'disabled'
    groups:
      # Core Python frameworks
      python-frameworks:
        patterns:
          - "flask*"
          - "pydantic*"
          - "sqlalchemy*"
        update-types:
          - "patch"
      # Python development tools
      python-dev-tools:
        patterns:
          - "commitizen*"
          - "mypy*"
          - "pytest*"
          - "ruff*"
          - "types*"

  # Special configuration for Python packages that have very frequent updates.
  # We don't want to get a pull request every day for insignificant changes.
  - package-ecosystem: 'pip'
    directory: '/api'
    # Specify a branch here (but _not_ in the block above), to work
    # around uniqueness requirement on the directory.
    # https://github.com/dependabot/dependabot-core/issues/1778#issuecomment-1988140291
    target-branch: master
    schedule:
      interval: 'weekly'
      day: 'wednesday'
      time: '03:00'
    open-pull-requests-limit: 15
    cooldown:
      default-days: 7
    allow:
      - dependency-name: boto3
    rebase-strategy: 'disabled'

  # GitHub Actions
  - package-ecosystem: 'github-actions'
    directory: '.github/workflows'
    schedule:
      interval: 'daily'
      time: '06:00'
    open-pull-requests-limit: 10
    cooldown:
      default-days: 7
