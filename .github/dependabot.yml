# Please see the documentation for all configuration options:
# https://docs.github.com/code-security/dependabot/dependabot-version-updates/configuration-options-for-the-dependabot.yml-file
# https://docs.github.com/en/code-security/dependabot/dependabot-version-updates/optimizing-pr-creation-version-updates

version: 2

updates:
  # Pro - Frontend
  - package-ecosystem: 'npm'
    directory: '/pro'
    schedule:
      # Sync with a new sherif week, starting on Thursday morning after tag
      interval: 'weekly'
      day: "thursday"
      time: '10:00'
      timezone: "Europe/Paris"
    open-pull-requests-limit: 15
    cooldown:
      default-days: 7
      semver-major-days: 14

    groups:
      # React updates
      # Open PRs for each major or minor version
      # Open an aggregate PR for all patch version updates
      react:
        patterns:
          - "react*"
          - "@types/react*"
        update-types:
          - "patch"
      # Build tools
      # Open PRs for each major or minor version
      # Open an aggregate PR for all patch version updates
      build-tools:
        patterns:
          - "@storybook*"
          - "storybook*"
          - "typescript*"
          - "vite*"
        update-types:
          - "patch"
      # Other tools
      # Open PRs for each major version
      # Open an aggregate PR for all minor and patch version updates
      tools:
        patterns:
          - "@sentry*"
          - "sentry*"
        update-types:
          - "minor"
          - "patch"
      # Testing tools
      # Open PRs for each major or minor version
      # Open an aggregate PR for all patch version updates
      testing-tols:
        patterns:
          - "allure*"
          - "cypress*"
          - "playwright*"
          - "vitest*"
        update-types:
          - "patch"
      # Linting and formatting
      # Open PRs for each major or minor version
      # Open an aggregate PR for all patch version updates
      linting:
        patterns:
          - "@biomejs*"
          - "eslint*"
          - "@eslint/*"
          - "prettier*"
          - "stylelint*"
          - "typescript-eslint*"
        update-types:
          - "patch"

  # Public API doc
  - package-ecosystem: 'npm'
    directory: '/api/documentation'
    schedule:
      interval: 'weekly'
      day: "thursday"
      time: '08:00'
      timezone: "Europe/Paris"
    open-pull-requests-limit: 10
    cooldown:
      default-days: 7
      semver-major-days: 14
    groups:
      # Docusaurus updates
      docusaurus:
        patterns:
          - "docusaurus*"
          - "@docusaurus*"

  # API - Backend
  - package-ecosystem: 'pip' # pip even if we use poetry
    directory: '/api'
    schedule:
      # Sync with a new sherif week, starting on Thursday morning
      interval: 'weekly'
      day: "thursday"
      time: '07:00'
      timezone: "Europe/Paris"
    open-pull-requests-limit: 15
    cooldown:
      default-days: 7
      semver-major-days: 14

    ignore:
      - dependency-name: 'flask'
        update-types:
          "major"
      - dependency-name: 'sqlalchemy'
        update-types:
          "major"
      - dependency-name: 'pydantic'
        update-types:
          "major"
      # boto3 updates very frequently
      - dependency-name: 'boto3'
        update-types:
          "patch"

    # Disable automatic PR rebasing
    rebase-strategy: 'disabled'

    groups:
      # Core Python frameworks
      # Open PRs for each major and minor versions
      # Open an aggregate PR for all patch version updates
      python-frameworks:
        patterns:
          - "flask*"
          - "pydantic*"
          - "sqlalchemy*"
        update-types:
          - "patch"
      # Python development tools
      # Open PRs for each major and minor versions
      # Open an aggregate PR for all patch version updates
      python-dev-tools:
        patterns:
          - "commitizen*"
          - "mypy*"
          - "pytest*"
          - "ruff*"
          - "types*"
        update-types:
          - "patch"

  # GitHub Actions
  - package-ecosystem: 'github-actions'
    directory: '.github/workflows'
    schedule:
      interval: 'weekly'
      day: "thursday"
      time: '07:00'
      timezone: "Europe/Paris"
    open-pull-requests-limit: 10
    cooldown:
      default-days: 7
      semver-major-days: 14
    ignore:
      - dependency-name: 'flask'
        update-types:
          "major"
    groups:
      not-ours:
        # Open PRs for each major and minor versions
        # Open an aggregate PR for all patch version updates, except our own actions
        patterns:
          - "*"
        update-types:
          - "patch"
        exclude-patterns:
          - "pass-culture/common-workflows*"

