import{j as a}from"./jsx-runtime-CfatFE5O.js";import{a as Le,u as ee,F as Fe}from"./formik.esm-DyanDbCL.js";import{c as B}from"./index-DeARc5FM.js";import{r as d}from"./index-ClcD9ViR.js";import{f as je}from"./full-close-5Oxr7nnd.js";import{S as de}from"./SvgIcon-B6esR8Vf.js";import{B as Se}from"./BaseInput-CQqD6LQv.js";import{F as Ie}from"./FieldLayout-hOWU3bse.js";import{B as ke}from"./BaseCheckbox-C8RX0ig6.js";import{s as Te}from"./stroke-down-Co3p5GaP.js";import"./_commonjsHelpers-Cpj98o6Y.js";import"./full-clear-Q4kCtSRL.js";import"./Button-B0q_wITZ.js";import"./stroke-pass-CALgybTM.js";import"./Tooltip-CPMX2zM9.js";import"./useTooltipProps-C5TDwaI9.js";import"./Button.module-Dtkn584L.js";import"./types-DjX_gQD6.js";import"./FieldError-Bb6I73np.js";import"./stroke-error-DSZD431a.js";const te=t=>t.trim().toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,""),$e=(t,c,r)=>{const e=[];for(let u=0;u<t.length&&!(r&&e.length>=r);u++){const h=t[u].normalizedLabel??te(t[u].label);te(c||"").split(" ").every(V=>h.includes(V))&&e.push(t[u])}return e},C={"selected-tags":"_selected-tags_wgvf8_1","tag-extra-count":"_tag-extra-count_wgvf8_11","tag-button":"_tag-button_wgvf8_18","tag-button-icon":"_tag-button-icon_wgvf8_29"},H=({disabled:t,fieldName:c,optionsLabelById:r,selectedOptions:e,removeOption:u,className:h})=>{const _=d.useRef(null);function V(i,o){var x;const f=(x=_.current)==null?void 0:x.getElementsByTagName("button"),y=(f==null?void 0:f[o+1])||(f==null?void 0:f[o-1]);y==null||y.focus(),u(i)}const O=e.slice(0,5),b=e.length-O.length;return a.jsxs("ul",{className:B(C["selected-tags"],h),ref:_,children:[O.map((i,o)=>a.jsx("li",{children:a.jsxs("button",{"aria-label":`Supprimer ${r[i]}`,className:C["tag-button"],onClick:()=>V(i,o),type:"button",disabled:t,children:[r[i],a.jsx(de,{src:je,alt:"Fermer",className:C["tag-button-icon"]})]})},`tag-${c}-${i}`)),b>0&&a.jsxs("li",{className:C["tag-extra-count"],children:["+",b,"..."]})]})};try{H.displayName="SelectedValuesTags",H.__docgenInfo={description:"",displayName:"SelectedValuesTags",props:{disabled:{defaultValue:null,description:"",name:"disabled",required:!0,type:{name:"boolean"}},fieldName:{defaultValue:null,description:"",name:"fieldName",required:!0,type:{name:"string"}},optionsLabelById:{defaultValue:null,description:"",name:"optionsLabelById",required:!0,type:{name:"Record<string, string>"}},selectedOptions:{defaultValue:null,description:"",name:"selectedOptions",required:!0,type:{name:"string[]"}},removeOption:{defaultValue:null,description:"",name:"removeOption",required:!0,type:{name:"(value: string) => void"}},className:{defaultValue:null,description:"",name:"className",required:!1,type:{name:"string"}}}}}catch{}const Ce=(t,c,r="s")=>{let e,u;const h=t.slice(-1)[0];return h==="s"||h==="x"?(u=t.slice(0,-1),e=t):(u=t,e=`${t}${r}`),c>1?e:u},Re=(t,c,r)=>t.split(" ").map(e=>Ce(e,c,r)).join(" "),Ee=(t,c,r)=>`${new Intl.NumberFormat("fr-FR").format(t)} ${Re(c,t,r)}`,Me="_menu_1o8o9_1",Be="_label_1o8o9_23",De="_input_1o8o9_30",F={menu:Me,"menu--no-results":"_menu--no-results_1o8o9_15","options-item":"_options-item_1o8o9_18","too-many-options":"_too-many-options_1o8o9_19",label:Be,input:De,"option-hovered":"_option-hovered_1o8o9_33"},W=({className:t,fieldName:c,selectedValues:r,filteredOptions:e,setHoveredOptionIndex:u,listRef:h,hoveredOptionIndex:_,selectOption:V,multi:O,maxDisplayedOptions:b})=>{const i=b?e.slice(0,b):e;return a.jsxs("div",{className:B(F.menu,t),role:"listbox",children:[e.length===0&&a.jsx("span",{className:F["menu--no-results"],children:"Aucun résultat"}),a.jsx("ul",{"data-testid":"list",id:`list-${c}`,ref:h,role:"listbox",children:i.map(({value:o,label:f},y)=>{const x=(r||[]).includes(String(o));return a.jsx("li",{"aria-selected":x,"aria-posinset":y+1,"aria-setsize":i.length,className:_===y?F["option-hovered"]:"","data-value":o,"data-selected":x,id:`option-display-${o}`,onMouseEnter:()=>u(y),onFocus:()=>u(y),role:"option",tabIndex:-1,children:O?a.jsx(ke,{label:f,checked:x,onChange:()=>{V(String(o))},labelClassName:F.label,inputClassName:F.input}):a.jsx("span",{onClick:()=>{V(String(o))},className:B(F["options-item"]),children:f})},`option-display-${o}`)})}),a.jsx("div",{role:"status",children:b&&i.length<e.length&&a.jsxs("div",{className:F["too-many-options"],children:[Ee(b,"résultat")," maximum. Veuillez affiner votre recherche"]})})]})};try{W.displayName="OptionsList",W.__docgenInfo={description:"",displayName:"OptionsList",props:{className:{defaultValue:null,description:"",name:"className",required:!1,type:{name:"string"}},fieldName:{defaultValue:null,description:"",name:"fieldName",required:!0,type:{name:"string"}},selectedValues:{defaultValue:null,description:"",name:"selectedValues",required:!0,type:{name:"string | string[] | null"}},filteredOptions:{defaultValue:null,description:"",name:"filteredOptions",required:!0,type:{name:"SelectOption[]"}},setHoveredOptionIndex:{defaultValue:null,description:"",name:"setHoveredOptionIndex",required:!0,type:{name:"(value: number | null) => void"}},listRef:{defaultValue:null,description:"",name:"listRef",required:!0,type:{name:"Ref<HTMLUListElement>"}},hoveredOptionIndex:{defaultValue:null,description:"",name:"hoveredOptionIndex",required:!0,type:{name:"number | null"}},selectOption:{defaultValue:null,description:"",name:"selectOption",required:!0,type:{name:"(value: string) => void"}},multi:{defaultValue:null,description:"",name:"multi",required:!0,type:{name:"boolean"}},maxDisplayedOptions:{defaultValue:null,description:"",name:"maxDisplayedOptions",required:!1,type:{name:"number"}}}}}catch{}const Pe="_pellet_1jeev_15",I={"multi-select-autocomplete-container":"_multi-select-autocomplete-container_1jeev_1","multi-select-autocomplete-placeholder-input":"_multi-select-autocomplete-placeholder-input_1jeev_7","field-overlay":"_field-overlay_1jeev_11",pellet:Pe,"visually-hidden":"_visually-hidden_1jeev_34"},ze={"dropdown-indicator":"_dropdown-indicator_hafu1_1"},K=({disabled:t,isOpen:c,toggleField:r})=>a.jsx("button",{onClick:r,className:ze["dropdown-indicator"],type:"button",disabled:t,children:a.jsx(de,{src:Te,alt:`${c?"Masquer":"Afficher"} les options`,width:"20"})});try{K.displayName="Toggle",K.__docgenInfo={description:"",displayName:"Toggle",props:{disabled:{defaultValue:null,description:"",name:"disabled",required:!0,type:{name:"boolean"}},isOpen:{defaultValue:null,description:"",name:"isOpen",required:!0,type:{name:"boolean"}},toggleField:{defaultValue:null,description:"",name:"toggleField",required:!0,type:{name:"() => void"}}}}}catch{}const U=({className:t,selectedValuesTagsClassName:c,disabled:r=!1,name:e,hideArrow:u,hideFooter:h=!1,hideTags:_=!1,inline:V,isOptional:O=!1,label:b,multi:i=!1,options:o,placeholder:f,smallLabel:y=!1,resetOnOpen:x=!0,description:pe,onSearch:me=()=>{},searchInOptions:fe=(j,w)=>j.filter(l=>l.label.toLowerCase().includes(w.trim().toLowerCase())),onReset:he=()=>{},type:ye="text",leftIcon:J,maxDisplayedOptions:ge,isLabelHidden:be,shouldFocusOnMount:ve,preventOpenOnFirstFocus:_e})=>{var Y;const{setFieldTouched:j,setFieldValue:w}=Le(),[l,k]=ee(e),[N,Q]=ee(`search-${e}`),[m,v]=d.useState(null),[T,Ve]=d.useState({}),$=d.useRef(null),D=d.useRef(null),P=d.useRef(null),[p,g]=d.useState(!1),[q,xe]=d.useState(o);d.useEffect(()=>{(async()=>{var s;ve&&((s=P.current)==null||s.focus(),await j(`search-${e}`,!0))})()},[]),d.useEffect(()=>{const n=async()=>{await w(`search-${e}`,"",!1),await w(e,i?[]:"",!1),he()};p&&x&&N.value!==""&&n()},[p]),d.useEffect(()=>{Ve(o.reduce((n,s)=>(n[s.value]=s.label,n),{}))},[o]),d.useEffect(()=>{const n=s=>{var A;(A=$.current)!=null&&A.contains(s.target)||g(!1)};return $.current&&document.addEventListener("mousedown",n),()=>{document.removeEventListener("mousedown",n)}},[$]),d.useEffect(()=>{me(N.value.trim()),v(null)},[N.value]),d.useEffect(()=>{xe(fe(o,N.value))},[N.value,o]);const qe=async n=>{var s,A,Z;switch(n.key){case"ArrowUp":if(m!==null)if(m<=0)v(null);else{const S=m-1;v(S);const L=(s=D.current)==null?void 0:s.getElementsByTagName("li")[S];L==null||L.scrollIntoView({block:"nearest"})}p||g(!0);break;case"ArrowDown":if(m===null)q.length>0&&v(0);else{const S=Math.min(q.length-1,m+1);v(S);const L=(A=D.current)==null?void 0:A.getElementsByTagName("li")[S];L==null||L.scrollIntoView({block:"nearest"})}p||g(!0);break;case" ":case"Enter":p&&m!==null&&q[m]&&(n.preventDefault(),q[m]&&await z(String(q[m].value)));break;case"Escape":(Z=P.current)==null||Z.focus(),v(null),g(!1);break;case"Tab":v(null),g(!1);break}},z=async n=>{let s;i?l.value.includes(n)&&Array.isArray(l.value)?s=l.value.filter(A=>A!==n):s=[...l.value,n]:(s=n,g(!1),v(null),await w(`search-${e}`,T[s],!1)),await w(e,s)},Oe=async()=>{const n=k.touched;(_e?n&&!p:!p)&&g(!0),await j(e,!0)},we=async()=>{p||g(!0),await j(e,!0)},X=async()=>{p?(g(!1),await w(`search-${e}`,"",!1)):g(!0),await j(e,!0)},Ne=Array.isArray(l.value)?"":T[l.value],Ae=f||Ne;return a.jsxs(Ie,{className:t,error:k.error,hideFooter:!_&&h,isOptional:O,label:b,name:`search-${e}`,showError:Q.touched&&!!k.error,smallLabel:y,inline:V,description:pe,isLabelHidden:be,children:[a.jsxs("div",{className:B(I["multi-select-autocomplete-container"],t),onKeyDown:qe,ref:$,children:[a.jsx(Se,{...m!==null&&{"aria-activedescendant":`option-display-${(Y=q[m])==null?void 0:Y.value}`},onClick:we,onFocus:Oe,placeholder:Ae,style:{paddingLeft:i&&l.value.length>0||J?"2.2rem":"1rem"},className:I["multi-select-autocomplete-placeholder-input"],hasError:Q.touched&&!!k.error,type:ye,disabled:r,...N,"aria-autocomplete":"list","aria-controls":`list-${e}`,"aria-describedby":`help-${e}`,"aria-expanded":p,"aria-haspopup":"listbox","aria-required":!O,role:"combobox",leftIcon:J,ref:P}),a.jsxs("div",{"aria-live":"polite","aria-relevant":"text",className:I["visually-hidden"],id:`help-${e}`,children:[i&&`${l.value.length} options sélectionnées`,!i&&!Array.isArray(l.value)&&l.value!==""&&`Option sélectionnée : ${T[l.value]}`,p?`${q.length} options ${N.value===""?"disponibles":"correspondant au texte saisi"}`:"saisissez du texte pour afficher et filtrer les options"]}),a.jsx("select",{hidden:!0,...i&&{multiple:!0},...l,value:l.value||"","data-testid":"select",children:o.map(({label:n,value:s})=>a.jsx("option",{value:s,children:n},`option-${s}`))}),a.jsxs("div",{className:I["field-overlay"],children:[!u&&a.jsx(K,{disabled:r,isOpen:p,toggleField:X}),i&&l.value.length>0&&a.jsx("div",{onClick:X,className:I.pellet,children:l.value.length}),p&&a.jsx(W,{className:t,fieldName:e,selectedValues:l.value,filteredOptions:q,setHoveredOptionIndex:v,listRef:D,hoveredOptionIndex:m,selectOption:z,multi:i,maxDisplayedOptions:ge})]})]}),Array.isArray(l.value)&&!_&&l.value.length>0&&a.jsx(H,{className:c,disabled:r,fieldName:e,optionsLabelById:T,selectedOptions:l.value,removeOption:z})]})};try{U.displayName="SelectAutocomplete",U.__docgenInfo={description:"",displayName:"SelectAutocomplete",props:{label:{defaultValue:null,description:"",name:"label",required:!0,type:{name:"string | Element"}},name:{defaultValue:null,description:"",name:"name",required:!0,type:{name:"string"}},description:{defaultValue:null,description:"",name:"description",required:!1,type:{name:"string"}},maxLength:{defaultValue:null,description:"",name:"maxLength",required:!1,type:{name:"number"}},isLabelHidden:{defaultValue:null,description:`A flag to hide the label.
To be used with caution, as it can affect accessibility.
Do not use it if the label is mandatory, placeholder is not
a substitute for a label.`,name:"isLabelHidden",required:!1,type:{name:"boolean"}},hasLabelLineBreak:{defaultValue:null,description:"",name:"hasLabelLineBreak",required:!1,type:{name:"boolean"}},isOptional:{defaultValue:{value:"false"},description:`A flag to indicate that the field is optional.
It will display an asterisk next to the label.`,name:"isOptional",required:!1,type:{name:"boolean"}},showMandatoryAsterisk:{defaultValue:null,description:"",name:"showMandatoryAsterisk",required:!1,type:{name:"boolean"}},className:{defaultValue:null,description:`A custom class for the field layout,
where label, description, input, and footer are displayed.`,name:"className",required:!1,type:{name:"string"}},classNameLabel:{defaultValue:null,description:"",name:"classNameLabel",required:!1,type:{name:"string"}},classNameFooter:{defaultValue:null,description:`A custom class for the footer,
where errors and character count are displayed.`,name:"classNameFooter",required:!1,type:{name:"string"}},classNameInput:{defaultValue:null,description:"",name:"classNameInput",required:!1,type:{name:"string"}},filterVariant:{defaultValue:null,description:"",name:"filterVariant",required:!1,type:{name:"boolean"}},smallLabel:{defaultValue:{value:"false"},description:"A flag to display a smaller label.",name:"smallLabel",required:!1,type:{name:"boolean"}},hideFooter:{defaultValue:{value:"false"},description:`A flag to hide the footer.
To be used with caution, as it can affect accessibility.`,name:"hideFooter",required:!1,type:{name:"boolean"}},inline:{defaultValue:null,description:"",name:"inline",required:!1,type:{name:"boolean"}},clearButtonProps:{defaultValue:null,description:"",name:"clearButtonProps",required:!1,type:{name:'(ButtonHTMLAttributes<HTMLButtonElement> & { tooltip: string; display?: "clear" | "close"; })'}},ErrorDetails:{defaultValue:null,description:"",name:"ErrorDetails",required:!1,type:{name:"ReactNode"}},disabled:{defaultValue:{value:"false"},description:"",name:"disabled",required:!1,type:{name:"boolean"}},hideArrow:{defaultValue:null,description:"",name:"hideArrow",required:!1,type:{name:"boolean"}},hideTags:{defaultValue:{value:"false"},description:"",name:"hideTags",required:!1,type:{name:"boolean"}},maxHeight:{defaultValue:null,description:"",name:"maxHeight",required:!1,type:{name:"number"}},multi:{defaultValue:{value:"false"},description:"",name:"multi",required:!1,type:{name:"boolean"}},options:{defaultValue:null,description:"",name:"options",required:!0,type:{name:"SelectOption[]"}},placeholder:{defaultValue:null,description:"",name:"placeholder",required:!1,type:{name:"string"}},resetOnOpen:{defaultValue:{value:"true"},description:"",name:"resetOnOpen",required:!1,type:{name:"boolean"}},onSearch:{defaultValue:{value:"() => {}"},description:"",name:"onSearch",required:!1,type:{name:"((pattern: string) => void)"}},searchInOptions:{defaultValue:{value:`(options, pattern) =>
    options.filter((opt) =>
      opt.label.toLowerCase().includes(pattern.trim().toLowerCase())
    )`},description:"",name:"searchInOptions",required:!1,type:{name:"((options: SelectOption[], pattern: string) => SelectOption[])"}},onReset:{defaultValue:{value:"() => {}"},description:"",name:"onReset",required:!1,type:{name:"(() => void)"}},type:{defaultValue:{value:"text"},description:"",name:"type",required:!1,type:{name:"enum",value:[{value:'"search"'},{value:'"text"'}]}},leftIcon:{defaultValue:null,description:"",name:"leftIcon",required:!1,type:{name:"string"}},maxDisplayedOptions:{defaultValue:null,description:"",name:"maxDisplayedOptions",required:!1,type:{name:"number"}},selectedValuesTagsClassName:{defaultValue:null,description:"",name:"selectedValuesTagsClassName",required:!1,type:{name:"string"}},shouldFocusOnMount:{defaultValue:null,description:"A flag to automatically focus the input when the component mounts.",name:"shouldFocusOnMount",required:!1,type:{name:"boolean"}},preventOpenOnFirstFocus:{defaultValue:null,description:`A flag to prevent the dropdown from opening on the first focus.
This is useful when the input is automatically focused. The user
is then expected to open the dropdown by clicking on the input.`,name:"preventOpenOnFirstFocus",required:!1,type:{name:"boolean"}}}}}catch{}const He=t=>a.jsx(Fe,{initialValues:t.initialValues,onSubmit:()=>{},children:a.jsx(U,{...t})}),dt={title:"ui-kit/forms/SelectAutocomplete",component:He},G={name:"departement",options:[{value:"01",label:"Ain"},{value:"02",label:"Aisne"},{value:"03",label:"Allier"},{value:"04",label:"Alpes-de-Haute-Provence test de libellé très long"},{value:"05",label:"Hautes-Alpes"},{value:"06",label:"Alpes-Maritimes"},{value:"07",label:"Ardèche"},{value:"08",label:"Ardennes"},{value:"09",label:"Ariège"},{value:"10",label:"Aube"},{value:"11",label:"Aude"},{value:"12",label:"Aveyron"},{value:"13",label:"Bouches-du-Rhône"},{value:"14",label:"Calvados"},{value:"15",label:"Cantal"}],initialValues:{departement:"01","search-departement":""},label:"Département",hideFooter:!1,hideTags:!1,isOptional:!1,smallLabel:!1,searchInOptions:$e},R={args:{...G}},E={args:{...G,multi:!0,initialValues:{departement:["01","02"],"search-departement":""}}},M={args:{...G,multi:!0,initialValues:{departement:["01","02"],"search-departement":""},hideTags:!0}};var ae,le,ne;R.parameters={...R.parameters,docs:{...(ae=R.parameters)==null?void 0:ae.docs,source:{originalSource:`{
  args: {
    ...defaultProps
  }
}`,...(ne=(le=R.parameters)==null?void 0:le.docs)==null?void 0:ne.source}}};var se,re,ie;E.parameters={...E.parameters,docs:{...(se=E.parameters)==null?void 0:se.docs,source:{originalSource:`{
  args: {
    ...defaultProps,
    multi: true,
    initialValues: {
      departement: ['01', '02'],
      'search-departement': ''
    }
  }
}`,...(ie=(re=E.parameters)==null?void 0:re.docs)==null?void 0:ie.source}}};var oe,ue,ce;M.parameters={...M.parameters,docs:{...(oe=M.parameters)==null?void 0:oe.docs,source:{originalSource:`{
  args: {
    ...defaultProps,
    multi: true,
    initialValues: {
      departement: ['01', '02'],
      'search-departement': ''
    },
    hideTags: true
  }
}`,...(ce=(ue=M.parameters)==null?void 0:ue.docs)==null?void 0:ce.source}}};const pt=["Default","Multi","WithoutTags"];export{R as Default,E as Multi,M as WithoutTags,pt as __namedExportsOrder,dt as default};
