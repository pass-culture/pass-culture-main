import{j as t}from"./jsx-runtime-Nms4Y4qS.js";import{a as we,u as Z,F as Ae}from"./formik.esm-C73rln7k.js";import{c as L}from"./index-BpvXyOxN.js";import{r as p}from"./index-BwDkhjyp.js";import{B as Le}from"./BaseInput-BhJRejd7.js";import{F as Se}from"./FieldLayout-4p-Dtox3.js";import{B as je,b as ee}from"./BaseCheckbox-PLbfLm9b.js";import{s as ke}from"./stroke-close-C6KSko98.js";import{S as de}from"./SvgIcon-DrJfdngP.js";import{s as Ie}from"./stroke-down-DYCZHAeS.js";import"./_commonjsHelpers-BosuxZz1.js";import"./full-clear-CvNWe6Ae.js";import"./full-close-DkqMqJw6.js";import"./Button-BmtSJNQs.js";import"./stroke-pass-C0Oiu4_F.js";import"./Tooltip-BkQgjV3T.js";import"./useTooltipProps-DNYEmy4z.js";import"./Button.module-BTskB8vt.js";import"./types-DjX_gQD6.js";import"./FieldError-joMUrENQ.js";import"./stroke-error-BKdTEWJV.js";const ae=e=>e.trim().toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,""),Fe=(e,c,n)=>{const a=[];for(let i=0;i<e.length&&!(n&&a.length>=n);i++){const b=e[i].normalizedLabel??ae(e[i].label);ae(c||"").split(" ").every(_=>b.includes(_))&&a.push(e[i])}return a},$e=(e,c,n="s")=>{let a,i;const b=e.slice(-1)[0];return b==="s"||b==="x"?(i=e.slice(0,-1),a=e):(i=e,a=`${e}${n}`),c>1?a:i},Te=(e,c,n)=>e.split(" ").map(a=>$e(a,c,n)).join(" "),Ce=(e,c,n)=>`${new Intl.NumberFormat("fr-FR").format(e)} ${Te(c,e,n)}`,Re="_menu_10so7_1",Ee="_label_10so7_18",A={menu:Re,"menu--no-results":"_menu--no-results_10so7_15",label:Ee,"too-many-options":"_too-many-options_10so7_19","option-hovered":"_option-hovered_10so7_27"},z=({className:e,fieldName:c,selectedValues:n,filteredOptions:a,setHoveredOptionIndex:i,listRef:b,hoveredOptionIndex:v,selectOption:_,multi:f,maxDisplayedOptions:d})=>{const l=d?a.slice(0,d):a;return t.jsxs("div",{className:L(A.menu,e),role:"listbox",children:[a.length===0&&t.jsx("span",{className:A["menu--no-results"],children:"Aucun résultat"}),t.jsx("ul",{"data-testid":"list",id:`list-${c}`,ref:b,role:"listbox",children:l.map(({value:o,label:I},w)=>{const S=(n||[]).includes(String(o));return t.jsx("li",{"aria-selected":S,"aria-posinset":w+1,"aria-setsize":l.length,className:v===w?A["option-hovered"]:"","data-value":o,"data-selected":S,id:`option-display-${o}`,onMouseEnter:()=>i(w),onFocus:()=>i(w),role:"option",tabIndex:-1,children:f?t.jsx(je,{label:I,checked:S,onChange:()=>{_(String(o))},className:L(ee["base-checkbox-label"],A.label)}):t.jsx("span",{onClick:()=>{_(String(o))},className:L(ee["base-checkbox-label"],A.label),children:I})},`option-display-${o}`)})}),t.jsx("div",{role:"status",children:d&&l.length<a.length&&t.jsxs("div",{className:A["too-many-options"],children:[Ce(d,"résultat")," maximum. Veuillez affiner votre recherche"]})})]})};try{z.displayName="OptionsList",z.__docgenInfo={description:"",displayName:"OptionsList",props:{className:{defaultValue:null,description:"",name:"className",required:!1,type:{name:"string"}},fieldName:{defaultValue:null,description:"",name:"fieldName",required:!0,type:{name:"string"}},selectedValues:{defaultValue:null,description:"",name:"selectedValues",required:!0,type:{name:"string | string[] | null"}},filteredOptions:{defaultValue:null,description:"",name:"filteredOptions",required:!0,type:{name:"SelectOption[]"}},setHoveredOptionIndex:{defaultValue:null,description:"",name:"setHoveredOptionIndex",required:!0,type:{name:"(value: number | null) => void"}},listRef:{defaultValue:null,description:"",name:"listRef",required:!0,type:{name:"Ref<HTMLUListElement>"}},hoveredOptionIndex:{defaultValue:null,description:"",name:"hoveredOptionIndex",required:!0,type:{name:"number | null"}},selectOption:{defaultValue:null,description:"",name:"selectOption",required:!0,type:{name:"(value: string) => void"}},multi:{defaultValue:null,description:"",name:"multi",required:!0,type:{name:"boolean"}},maxDisplayedOptions:{defaultValue:null,description:"",name:"maxDisplayedOptions",required:!1,type:{name:"number"}}}}}catch{}const Be="_pellet_7c82a_15",R={"multi-select-autocomplete-container":"_multi-select-autocomplete-container_7c82a_1","multi-select-autocomplete-placeholder-input":"_multi-select-autocomplete-placeholder-input_7c82a_7","field-overlay":"_field-overlay_7c82a_11",pellet:Be},Me="_tag_13apa_8",k={"multi-select-autocomplete-tags":"_multi-select-autocomplete-tags_13apa_1",tag:Me,"tag-close-button":"_tag-close-button_13apa_25","tag-close-button--disabled":"_tag-close-button--disabled_13apa_37","tag-close-button-icon":"_tag-close-button-icon_13apa_40"},H=({disabled:e,fieldName:c,optionsLabelById:n,selectedOptions:a,removeOption:i,className:b})=>{const v=p.useRef(null);function _(f,d){var o;const l=(o=v.current)==null?void 0:o.getElementsByTagName("button");l!=null&&l[d+1]?l[d+1].focus():l!=null&&l[d-1]&&l[d-1].focus(),i(f)}return t.jsx("ul",{className:L(k["multi-select-autocomplete-tags"],b),ref:v,children:a.map((f,d)=>t.jsx("li",{className:k.tag,children:t.jsxs("button",{"aria-label":`Supprimer ${n[f]}`,className:L(k["tag-close-button"],{[k["tag-close-button--disabled"]]:e}),onClick:()=>_(f,d),type:"button",disabled:e,children:[n[f],t.jsx(de,{src:ke,alt:"",className:k["tag-close-button-icon"]})]})},`tag-${c}-${f}`))})};try{H.displayName="SelectedValuesTags",H.__docgenInfo={description:"",displayName:"SelectedValuesTags",props:{disabled:{defaultValue:null,description:"",name:"disabled",required:!0,type:{name:"boolean"}},fieldName:{defaultValue:null,description:"",name:"fieldName",required:!0,type:{name:"string"}},optionsLabelById:{defaultValue:null,description:"",name:"optionsLabelById",required:!0,type:{name:"Record<string, string>"}},selectedOptions:{defaultValue:null,description:"",name:"selectedOptions",required:!0,type:{name:"string[]"}},removeOption:{defaultValue:null,description:"",name:"removeOption",required:!0,type:{name:"(value: string) => void"}},className:{defaultValue:null,description:"",name:"className",required:!1,type:{name:"string"}}}}}catch{}const De={"dropdown-indicator":"_dropdown-indicator_2pwsx_1"},W=({disabled:e,isOpen:c,toggleField:n})=>t.jsx("button",{onClick:n,className:De["dropdown-indicator"],type:"button",disabled:e,children:t.jsx(de,{src:Ie,alt:`${c?"Masquer":"Afficher"} les options`,width:"20"})});try{W.displayName="Toggle",W.__docgenInfo={description:"",displayName:"Toggle",props:{disabled:{defaultValue:null,description:"",name:"disabled",required:!0,type:{name:"boolean"}},isOpen:{defaultValue:null,description:"",name:"isOpen",required:!0,type:{name:"boolean"}},toggleField:{defaultValue:null,description:"",name:"toggleField",required:!0,type:{name:"() => void"}}}}}catch{}const K=({className:e,selectedValuesTagsClassName:c,disabled:n=!1,name:a,hideArrow:i,hideFooter:b=!1,hideTags:v=!1,inline:_,isOptional:f=!1,label:d,multi:l=!1,options:o,placeholder:I,smallLabel:w=!1,resetOnOpen:S=!0,description:pe,onSearch:me=()=>{},searchInOptions:fe=(F,x)=>F.filter(s=>s.label.toLowerCase().includes(x.trim().toLowerCase())),onReset:he=()=>{},type:be="text",leftIcon:G,maxDisplayedOptions:ye,isLabelHidden:ge})=>{var X;const{setFieldTouched:F,setFieldValue:x}=we(),[s,$]=Z(a),[q,ve]=Z(`search-${a}`),[m,y]=p.useState(null),[T,_e]=p.useState({}),C=p.useRef(null),D=p.useRef(null),J=p.useRef(null),[h,g]=p.useState(!1),[V,Ve]=p.useState(o);p.useEffect(()=>{const r=async()=>{await x(`search-${a}`,"",!1),await x(a,l?[]:"",!1),he()};h&&S&&q.value!==""&&r()},[h]),p.useEffect(()=>{_e(o.reduce((r,u)=>(r[u.value]=u.label,r),{}))},[o]),p.useEffect(()=>{const r=u=>{var N;(N=C.current)!=null&&N.contains(u.target)||g(!1)};return C.current&&document.addEventListener("mousedown",r),()=>{document.removeEventListener("mousedown",r)}},[C]),p.useEffect(()=>{me(q.value.trim()),y(null)},[q.value]),p.useEffect(()=>{Ve(fe(o,q.value))},[q.value,o]);const xe=async r=>{var u,N,Y;switch(r.key){case"ArrowUp":if(m!==null)if(m<=0)y(null);else{const j=m-1;y(j);const O=(u=D.current)==null?void 0:u.getElementsByTagName("li")[j];O==null||O.scrollIntoView({block:"nearest"})}h||g(!0);break;case"ArrowDown":if(m===null)V.length>0&&y(0);else{const j=Math.min(V.length-1,m+1);y(j);const O=(N=D.current)==null?void 0:N.getElementsByTagName("li")[j];O==null||O.scrollIntoView({block:"nearest"})}h||g(!0);break;case" ":case"Enter":h&&m!==null&&V[m]&&(r.preventDefault(),V[m]&&await P(String(V[m].value)));break;case"Escape":(Y=J.current)==null||Y.focus(),y(null),g(!1);break;case"Tab":y(null),g(!1);break}},P=async r=>{let u;l?s.value.includes(r)&&Array.isArray(s.value)?u=s.value.filter(N=>N!==r):u=[...s.value,r]:(u=r,g(!1),y(null),await x(`search-${a}`,T[u],!1)),await x(a,u)},qe=async()=>{h||g(!0),await F(a,!0)},Q=async()=>{h?(g(!1),await x(`search-${a}`,"",!1)):g(!0),await F(a,!0)},Ne=Array.isArray(s.value)?"":T[s.value],Oe=I||Ne;return t.jsxs(Se,{className:e,error:$.error,hideFooter:!v&&b,isOptional:f,label:d,name:`search-${a}`,showError:$.touched&&!!$.error,smallLabel:w,inline:_,description:pe,isLabelHidden:ge,children:[t.jsxs("div",{className:L(R["multi-select-autocomplete-container"],e),onKeyDown:xe,ref:C,children:[t.jsx(Le,{...m!==null&&{"aria-activedescendant":`option-display-${(X=V[m])==null?void 0:X.value}`},onFocus:qe,placeholder:Oe,style:{paddingLeft:l&&s.value.length>0||G?"2.2rem":"1rem"},className:R["multi-select-autocomplete-placeholder-input"],hasError:ve.touched&&!!$.error,type:be,disabled:n,...q,"aria-autocomplete":"list","aria-controls":`list-${a}`,"aria-describedby":`help-${a}`,"aria-expanded":h,"aria-haspopup":"listbox","aria-required":!f,role:"combobox",leftIcon:G,ref:J}),t.jsxs("div",{"aria-live":"polite","aria-relevant":"text",className:"visually-hidden",id:`help-${a}`,children:[l&&`${s.value.length} options sélectionnées`,!l&&!Array.isArray(s.value)&&s.value!==""&&`Option sélectionnée : ${T[s.value]}`,h?`${V.length} options ${q.value===""?"disponibles":"correspondant au texte saisi"}`:"saisissez du texte pour afficher et filtrer les options"]}),t.jsx("select",{hidden:!0,...l&&{multiple:!0},...s,value:s.value||"","data-testid":"select",children:o.map(({label:r,value:u})=>t.jsx("option",{value:u,children:r},`option-${u}`))}),t.jsxs("div",{className:R["field-overlay"],children:[!i&&t.jsx(W,{disabled:n,isOpen:h,toggleField:Q}),l&&s.value.length>0&&t.jsx("div",{onClick:Q,className:R.pellet,children:s.value.length}),h&&t.jsx(z,{className:e,fieldName:a,selectedValues:s.value,filteredOptions:V,setHoveredOptionIndex:y,listRef:D,hoveredOptionIndex:m,selectOption:P,multi:l,maxDisplayedOptions:ye})]})]}),Array.isArray(s.value)&&!v&&s.value.length>0&&t.jsx(H,{className:c,disabled:n,fieldName:a,optionsLabelById:T,selectedOptions:s.value,removeOption:P})]})};try{K.displayName="SelectAutocomplete",K.__docgenInfo={description:"",displayName:"SelectAutocomplete",props:{label:{defaultValue:null,description:"",name:"label",required:!0,type:{name:"string | Element"}},name:{defaultValue:null,description:"",name:"name",required:!0,type:{name:"string"}},description:{defaultValue:null,description:"",name:"description",required:!1,type:{name:"string"}},maxLength:{defaultValue:null,description:"",name:"maxLength",required:!1,type:{name:"number"}},isLabelHidden:{defaultValue:null,description:`A flag to hide the label.
To be used with caution, as it can affect accessibility.
Do not use it if the label is mandatory, placeholder is not
a substitute for a label.`,name:"isLabelHidden",required:!1,type:{name:"boolean"}},hasLabelLineBreak:{defaultValue:null,description:"",name:"hasLabelLineBreak",required:!1,type:{name:"boolean"}},isOptional:{defaultValue:{value:"false"},description:`A flag to indicate that the field is optional.
It will display an asterisk next to the label.`,name:"isOptional",required:!1,type:{name:"boolean"}},showMandatoryAsterisk:{defaultValue:null,description:"",name:"showMandatoryAsterisk",required:!1,type:{name:"boolean"}},className:{defaultValue:null,description:`A custom class for the field layout,
where label, description, input, and footer are displayed.`,name:"className",required:!1,type:{name:"string"}},classNameLabel:{defaultValue:null,description:"",name:"classNameLabel",required:!1,type:{name:"string"}},classNameFooter:{defaultValue:null,description:`A custom class for the footer,
where errors and character count are displayed.`,name:"classNameFooter",required:!1,type:{name:"string"}},classNameInput:{defaultValue:null,description:"",name:"classNameInput",required:!1,type:{name:"string"}},filterVariant:{defaultValue:null,description:"",name:"filterVariant",required:!1,type:{name:"boolean"}},smallLabel:{defaultValue:{value:"false"},description:"A flag to display a smaller label.",name:"smallLabel",required:!1,type:{name:"boolean"}},hideFooter:{defaultValue:{value:"false"},description:`A flag to hide the footer.
To be used with caution, as it can affect accessibility.`,name:"hideFooter",required:!1,type:{name:"boolean"}},inline:{defaultValue:null,description:"",name:"inline",required:!1,type:{name:"boolean"}},clearButtonProps:{defaultValue:null,description:"",name:"clearButtonProps",required:!1,type:{name:'(ButtonHTMLAttributes<HTMLButtonElement> & { tooltip: string; display?: "clear" | "close"; })'}},ErrorDetails:{defaultValue:null,description:"",name:"ErrorDetails",required:!1,type:{name:"ReactNode"}},disabled:{defaultValue:{value:"false"},description:"",name:"disabled",required:!1,type:{name:"boolean"}},hideArrow:{defaultValue:null,description:"",name:"hideArrow",required:!1,type:{name:"boolean"}},hideTags:{defaultValue:{value:"false"},description:"",name:"hideTags",required:!1,type:{name:"boolean"}},maxHeight:{defaultValue:null,description:"",name:"maxHeight",required:!1,type:{name:"number"}},multi:{defaultValue:{value:"false"},description:"",name:"multi",required:!1,type:{name:"boolean"}},options:{defaultValue:null,description:"",name:"options",required:!0,type:{name:"SelectOption[]"}},placeholder:{defaultValue:null,description:"",name:"placeholder",required:!1,type:{name:"string"}},resetOnOpen:{defaultValue:{value:"true"},description:"",name:"resetOnOpen",required:!1,type:{name:"boolean"}},onSearch:{defaultValue:{value:"() => {}"},description:"",name:"onSearch",required:!1,type:{name:"((pattern: string) => void)"}},searchInOptions:{defaultValue:{value:`(options, pattern) =>
    options.filter((opt) =>
      opt.label.toLowerCase().includes(pattern.trim().toLowerCase())
    )`},description:"",name:"searchInOptions",required:!1,type:{name:"((options: SelectOption[], pattern: string) => SelectOption[])"}},onReset:{defaultValue:{value:"() => {}"},description:"",name:"onReset",required:!1,type:{name:"(() => void)"}},type:{defaultValue:{value:"text"},description:"",name:"type",required:!1,type:{name:"enum",value:[{value:'"search"'},{value:'"text"'}]}},leftIcon:{defaultValue:null,description:"",name:"leftIcon",required:!1,type:{name:"string"}},maxDisplayedOptions:{defaultValue:null,description:"",name:"maxDisplayedOptions",required:!1,type:{name:"number"}},selectedValuesTagsClassName:{defaultValue:null,description:"",name:"selectedValuesTagsClassName",required:!1,type:{name:"string"}}}}}catch{}const Pe=e=>t.jsx(Ae,{initialValues:e.initialValues,onSubmit:()=>{},children:t.jsx(K,{...e})}),ca={title:"ui-kit/forms/SelectAutocomplete",component:Pe},U={name:"departement",options:[{value:"01",label:"Ain"},{value:"02",label:"Aisne"},{value:"03",label:"Allier"},{value:"04",label:"Alpes-de-Haute-Provence test de libellé très long"},{value:"05",label:"Hautes-Alpes"},{value:"06",label:"Alpes-Maritimes"},{value:"07",label:"Ardèche"},{value:"08",label:"Ardennes"},{value:"09",label:"Ariège"},{value:"10",label:"Aube"},{value:"11",label:"Aude"},{value:"12",label:"Aveyron"},{value:"13",label:"Bouches-du-Rhône"},{value:"14",label:"Calvados"},{value:"15",label:"Cantal"}],initialValues:{departement:"01","search-departement":""},label:"Département",hideFooter:!1,hideTags:!1,isOptional:!1,smallLabel:!1,searchInOptions:Fe},E={args:{...U}},B={args:{...U,multi:!0,initialValues:{departement:["01","02"],"search-departement":""}}},M={args:{...U,multi:!0,initialValues:{departement:["01","02"],"search-departement":""},hideTags:!0}};var te,le,se;E.parameters={...E.parameters,docs:{...(te=E.parameters)==null?void 0:te.docs,source:{originalSource:`{
  args: {
    ...defaultProps
  }
}`,...(se=(le=E.parameters)==null?void 0:le.docs)==null?void 0:se.source}}};var ne,re,ie;B.parameters={...B.parameters,docs:{...(ne=B.parameters)==null?void 0:ne.docs,source:{originalSource:`{
  args: {
    ...defaultProps,
    multi: true,
    initialValues: {
      departement: ['01', '02'],
      'search-departement': ''
    }
  }
}`,...(ie=(re=B.parameters)==null?void 0:re.docs)==null?void 0:ie.source}}};var oe,ue,ce;M.parameters={...M.parameters,docs:{...(oe=M.parameters)==null?void 0:oe.docs,source:{originalSource:`{
  args: {
    ...defaultProps,
    multi: true,
    initialValues: {
      departement: ['01', '02'],
      'search-departement': ''
    },
    hideTags: true
  }
}`,...(ce=(ue=M.parameters)==null?void 0:ue.docs)==null?void 0:ce.source}}};const da=["Default","Multi","WithoutTags"];export{E as Default,B as Multi,M as WithoutTags,da as __namedExportsOrder,ca as default};
