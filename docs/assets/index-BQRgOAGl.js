import{R as m,r as p}from"./index-ClcD9ViR.js";import{R as U,c as W,a as Y,u as D,b as q,d as z,e as G}from"./index-DOYoWpww.js";const{makeDecorator:F,addons:P}=__STORYBOOK_MODULE_PREVIEW_API__;var g="storybook/react-router-v6",B="reactRouter",s={NAVIGATION:`${g}/navigation`,STORY_LOADED:`${g}/story-loaded`,ROUTE_MATCHES:`${g}/route-matches`,ACTION_INVOKED:`${g}/action_invoked`,ACTION_SETTLED:`${g}/action_settled`,LOADER_INVOKED:`${g}/loader_invoked`,LOADER_SETTLED:`${g}/loader_settled`},C=m.createContext([]),b=m.createContext(void 0);function J(){let[t,r]=p.useState([]),e=U;return e.Provider._context=new Proxy(e.Provider._context??{},{set(a,n,o){return n==="_currentValue"&&o!==void 0&&r(i=>o.matches.length>i.length?o.matches:i),Reflect.set(a,n,o)}}),t}function Q(t){let r={};return t.forEach((e,a)=>{if(e instanceof File){r[a]={filename:e.name,filesize:e.size,filetype:e.type};return}r[a]=e}),r}async function _(t){let r=t.clone(),e=r.headers.get("content-type")||"",a;switch(!0){case e.startsWith("text"):a=await r.text();break;case e.startsWith("application/json"):a=await r.json();break;case e.startsWith("multipart/form-data"):case e.startsWith("application/x-www-form-urlencoded"):{a=Q(await r.formData());break}}return a}var x=()=>{let t=p.useRef(0);return p.useCallback(async(r,e)=>{t.current++;let a=`${r}_${t.current}`;switch(r){case s.ACTION_INVOKED:{let{request:n,params:o,context:i}=e,c={url:n.url,method:n.method,body:await _(n)};return{key:a,type:r,data:{params:o,request:c,context:i}}}case s.ACTION_SETTLED:return{key:a,type:r,data:e};case s.LOADER_INVOKED:{let{request:n,params:o,context:i}=e,c={url:n.url,method:n.method,body:await _(n)};return{key:a,type:r,data:{params:o,request:c,context:i}}}case s.LOADER_SETTLED:return{key:a,type:r,data:e}}},[])};function X(){let t=P.getChannel(),r=x();return p.useCallback(e=>async function(a){if(e===void 0)return;t.emit(s.ACTION_INVOKED,await r(s.ACTION_INVOKED,a));let n=await e(a);return t.emit(s.ACTION_SETTLED,await r(s.ACTION_SETTLED,n)),n},[t,r])}function Z(){let t=P.getChannel(),r=x();return p.useCallback(e=>async function(a){if(e===void 0)return;t.emit(s.LOADER_INVOKED,await r(s.LOADER_INVOKED,a));let n=await e(a);return t.emit(s.LOADER_SETTLED,await r(s.LOADER_SETTLED,n)),n},[t,r])}function tt(){let t=X(),r=Z(),e=p.useCallback(a=>a.map(n=>{let{action:o,loader:i,children:c,lazy:d}=n,u={...n};return d&&(u.lazy=async function(){let l=await d(),h={...l};return l.action&&(h.action=t(l.action)),l.loader&&(h.loader=r(l.loader)),h}),o&&(u.action=t(o)),i&&(u.loader=r(i)),c&&(u.children=e(c)),u}),[t,r]);return e}var k=()=>{let t=m.useContext(b);if(t===void 0)throw new Error("useStory should be used inside <StoryContext>");return t};function L(t,r){return t.length===1&&(t[0].children===void 0||t[0].children.length===0)?[{...t[0],element:r}]:t.findIndex(e=>e.useStoryElement)!==-1?t.map(e=>e.useStoryElement?{...e,element:r}:e):t.map(e=>e.children?{...e,children:L(e.children,r)}:e)}var R;(function(t){t.Pop="POP",t.Push="PUSH",t.Replace="REPLACE"})(R||(R={}));function et(t,r){if(t===!1||t===null||typeof t>"u")throw new Error(r)}function rt(t,r){{typeof console<"u"&&console.warn(r);try{throw new Error(r)}catch{}}}var A;(function(t){t.data="data",t.deferred="deferred",t.redirect="redirect",t.error="error"})(A||(A={}));function I(t,r){r===void 0&&(r={});let e=t;e.endsWith("*")&&e!=="*"&&!e.endsWith("/*")&&(rt(!1,'Route path "'+e+'" will be treated as if it were '+('"'+e.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+e.replace(/\*$/,"/*")+'".')),e=e.replace(/\*$/,"/*"));let a=e.startsWith("/")?"/":"",n=i=>i==null?"":typeof i=="string"?i:String(i),o=e.split(/\/+/).map((i,c,d)=>{if(c===d.length-1&&i==="*")return n(r["*"]);let u=i.match(/^:([\w-]+)(\??)$/);if(u){let[,l,h]=u,y=r[l];return et(h==="?"||y!=null,'Missing ":'+l+'" param'),n(y)}return i.replace(/\?$/g,"")}).filter(i=>!!i);return a+o.join("/")}var N=["post","put","patch","delete"];new Set(N);var at=["get",...N];new Set(at);function nt({navigationHistory:t,location:r,routes:e}){if(t!==void 0){let l=[],h,y=Object.values(t);for(let E=0;E<y.length;E++){let{path:O,pathParams:v,searchParams:w,hash:H,state:j,isInitialLocation:K}=y[E];K&&(h=E);let S=T(e),M=(typeof O=="function"?O(S,v??{}):O)??S;l.push({pathname:I(M??"/",v),search:new URLSearchParams(w).toString(),hash:H,state:j})}return h??(h=l.length-1),{initialEntries:l,initialIndex:h}}let{path:a,pathParams:n,searchParams:o,hash:i,state:c}=r??{},d=T(e),u=(typeof a=="function"?a(d,n??{}):a)??d;return{initialEntries:[{pathname:I(u,n),search:new URLSearchParams(o).toString(),hash:i,state:c}],initialIndex:0}}function T(t=[],r="/"){if(t.length!==1)return r;let e=t[0],a=ot(r,e.path);return e.children===void 0||e.children.length===0?a:T(e.children,a)}function ot(t,r=""){let e=["","/"],a=t.split("/").filter(o=>!e.includes(o)),n=r.split("/").filter(o=>!e.includes(o));return"/"+[...a,...n].join("/")}function f(t,r){return Object.prototype.hasOwnProperty.call(t,r)}function it(t){return arguments.length===0?[]:Array.isArray(t)?t:[t]}function lt(t){var r;return t===void 0?[{path:"/"}]:typeof t=="string"?[{path:t}]:(t=it(t),t.length===1&&((r=t[0]).path??(r.path="/")),t)}var V=()=>m.useContext(C);function ut(t){let r={};return t.forEach((e,a)=>{let n=r[a];if(typeof n=="string"){r[a]=[n,e];return}if(Array.isArray(n)){r[a]=[...n,e];return}r[a]=e}),r}var st=()=>{let t=D(),r=t.pathname;return t.search.length>0&&(r+=`?${t.search}`),t.hash.length>0&&(r+=`#${t.hash}`),r},ct=()=>{let t=p.useRef(0),r=D(),e=q(),[a]=z(),n=G(),o=V(),i=ut(a),c=st(),d=o.map(l=>{let h={path:l.route.path};return Object.keys(l.params).length>0&&(h.params=l.params),h}),u={url:c,path:r.pathname,routeParams:e,searchParams:i,hash:r.hash,routeState:r.state,routeMatches:d};return l=>{t.current++;let h=`${l}_${t.current}`;switch(l){case s.STORY_LOADED:return{key:h,type:l,data:u};case s.NAVIGATION:return{key:h,type:l,data:{...u,navigationType:n}};case s.ROUTE_MATCHES:return{key:h,type:l,data:{matches:d}}}}};function $(){let{renderStory:t,storyContext:r}=k(),e=P.getChannel(),a=D(),n=V(),o=ct(),i=p.useRef(),c=p.useRef(),d=p.useRef(),u=i.current!==void 0,l=u&&a.key!==i.current;return l&&c.current!==a.key&&(e.emit(s.NAVIGATION,o(s.NAVIGATION)),c.current=a.key),l&&n.length>0&&n!==d.current&&e.emit(s.ROUTE_MATCHES,o(s.ROUTE_MATCHES)),!u&&n.length>0&&(e.emit(s.STORY_LOADED,o(s.STORY_LOADED)),i.current=a.key,d.current=n),d.current=n,m.createElement(m.Fragment,null,t(r))}$.displayName="RouterLogger";function ht(){let{addonParameters:t={}}=k(),{hydrationData:r,routing:e,navigationHistory:a,location:n,future:o,fallback:i}=t,c=tt(),d=p.useMemo(()=>{let h=lt(e),y=c(h),E=L(y,m.createElement($,null)),{initialEntries:O,initialIndex:v}=nt({navigationHistory:a,location:n,routes:E}),w={initialEntries:O,initialIndex:v,hydrationData:r};return o&&(w.future=o),W(E,w)},[c,r,n,a,e,o]),u={},l=i??m.createElement(dt,null);return o&&(u.future=o),(o==null?void 0:o.v7_partialHydration)===!0&&(u.HydrateFallback=l),(o==null?void 0:o.v7_partialHydration)===!1&&(u.fallbackElement=l),m.createElement(Y,{router:d,...u})}function dt(){return m.createElement("p",null,"Performing initial data load")}var mt=({renderStory:t,storyContext:r,addonParameters:e})=>{let a=J();return m.createElement(b.Provider,{value:{renderStory:t,storyContext:r,addonParameters:e}},m.createElement(C.Provider,{value:a},m.createElement(ht,null)))};function ft(t){if(m.isValidElement(t))return!0;switch(!0){case m.isValidElement(t):case typeof t=="string":case typeof t=="number":case typeof t=="boolean":case t===null:case t===void 0:case(t instanceof Object&&f(t,Symbol.iterator)):return!0}return!1}function pt(t){return ft(t)?{element:t}:t}function yt(t={}){let r=["location","navigationHistory","routing","future"];if(Object.keys(t??{}).some(a=>r.includes(a)))return t;let e={routing:{},location:{},hydrationData:void 0};if(f(t,"routePath")&&(e.location.path=t.routePath,e.routing.path=t.routePath),f(t,"routeParams")&&(e.location.pathParams=t.routeParams),f(t,"routeState")&&(e.location.state=t.routeState),f(t,"routeHandle")&&(e.routing.handle=t.routeHandle),f(t,"searchParams")&&(e.location.searchParams=t.searchParams),f(t,"browserPath")&&(e.location.path=t.browserPath),f(t,"loader")&&(e.routing.loader=t.loader),f(t,"action")&&(e.routing.action=t.action),f(t,"errorElement")&&(e.routing.errorElement=t.errorElement),f(t,"hydrationData")&&(e.hydrationData=t.hydrationData),f(t,"shouldRevalidate")&&(e.routing.shouldRevalidate=t.shouldRevalidate),f(t,"routeId")&&(e.routing.id=t.routeId),f(t,"outlet")){let a=pt(t.outlet);a.path??(a.path=""),e.routing.children=[a]}return e.routing.useStoryElement=!0,e}var Ot=F({name:"withRouter",parameterName:B,wrapper:(t,r,{parameters:e})=>{let a=yt(e);return m.createElement(mt,{renderStory:t,storyContext:r,addonParameters:a})}});export{Ot as V};
