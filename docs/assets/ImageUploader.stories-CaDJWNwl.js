import{j as e}from"./jsx-runtime-BYYWji4R.js";import{P as Ne}from"./reducer-Crbp5051.js";import{V as Oe}from"./index-BQRgOAGl.js";import{c as Re}from"./testUtils-DY3eMo7d.js";import{c as b}from"./index-DeARc5FM.js";import{r as m}from"./index-ClcD9ViR.js";import{f as pe}from"./full-trash-CEfIUI4M.js";import{B as E}from"./Button-Cva4CQSi.js";import{B as j}from"./types-yVZEaApa.js";import{S as ue}from"./SvgIcon-CyWUmZpn.js";import{C as Pe}from"./ConfirmDialog-B4ki1yBH.js";import{s as Se}from"./stroke-trash-Cc_5v2lW.js";import{T as De,C as Q,D as ge}from"./DialogBuilder-BNEdQCrq.js";import{g as Le}from"./image-CI1RfRht.js";import{u as qe}from"./useNotification-DrLY4vYB.js";import{I as Be}from"./ImageDragAndDrop-DaJ5uSPy.js";import{f as Me,a as Te}from"./full-more-D-B0T6P8.js";import{C as Ae,a as We}from"./Callout-D6uxp4MO.js";import{T as ke}from"./TextInput-DUFoZnSR.js";import{S as He}from"./Spinner-BHztG-h6.js";import{I as Ye}from"./ImageEditor-BN3_a1ZG.js";import{a as ze,I as Z}from"./ImagePreviewsWrapper-BcCK9m44.js";import{f as Ge}from"./full-edit-CxAaM2Fv.js";import"./index-DOYoWpww.js";import"./index-J01lmiDr.js";import"./_commonjsHelpers-Cpj98o6Y.js";import"./config-BdqymTTq.js";import"./OfferAddressType-Co4gxJoY.js";import"./stroke-pass-CALgybTM.js";import"./Tooltip-BpKRYYrm.js";import"./Button.module-BsO1-3k4.js";import"./stroke-error-DSZD431a.js";import"./Dialog-CVJSILFg.js";import"./index-2_ew_j0S.js";import"./tslib.es6-BUas5LQb.js";import"./stroke-close-DnlFsd1c.js";import"./index-BH3dreXg.js";import"./index-Chjiymov.js";import"./full-validate-CbMNulkZ.js";import"./stroke-picture-VF2OicDu.js";import"./full-info-C4RdBA4U.js";import"./full-warning-LoKhBeYn.js";import"./full-link-CYVo23DH.js";import"./full-next-B_76kGmE.js";import"./ButtonLink-pr6UmZQp.js";import"./BaseInput-BI1b_EYZ.js";import"./FieldError-azuIsM2E.js";import"./FieldLayoutCharacterCount-Bc4HS3VB.js";import"./index.module-DF6qn1Ex.js";import"./Slider-DKKiAQxD.js";var r=(a=>(a.OFFER="offer",a.OFFER_COLLECTIVE="offer_collective",a.VENUE="venue",a))(r||{});const ee=""+new URL("sample-image-landscape-B4GmPBHc.jpg",import.meta.url).href,ae=""+new URL("sample-image-portrait-OorsIixL.jpg",import.meta.url).href,$e={"button-image-delete-icon":"_button-image-delete-icon_ooh4c_1"},W=({isLoading:a,onConfirm:t,onDismiss:i,isDialogOpen:l,trigger:n})=>e.jsx(Pe,{cancelText:"Retour",confirmText:"Supprimer",icon:Se,isLoading:a,onCancel:i,onConfirm:t,title:"Supprimer l’image",open:l,trigger:n,children:"Souhaitez-vous vraiment supprimer cette image ?"});try{W.displayName="ModalImageDelete",W.__docgenInfo={description:"",displayName:"ModalImageDelete",props:{isLoading:{defaultValue:null,description:"",name:"isLoading",required:!0,type:{name:"boolean"}},onConfirm:{defaultValue:null,description:"",name:"onConfirm",required:!0,type:{name:"() => void"}},onDismiss:{defaultValue:null,description:"",name:"onDismiss",required:!0,type:{name:"() => void"}},isDialogOpen:{defaultValue:null,description:"",name:"isDialogOpen",required:!0,type:{name:"boolean"}},trigger:{defaultValue:null,description:"",name:"trigger",required:!0,type:{name:"ReactNode"}}}}}catch{}const k=({onImageDelete:a})=>{const[t,i]=m.useState(!1),[l,n]=m.useState(!1),c=()=>{n(!0),a()};return e.jsx(W,{isLoading:l,onConfirm:c,onDismiss:()=>i(!1),isDialogOpen:t,trigger:e.jsxs(E,{onClick:()=>i(!0),variant:j.TERNARY,children:[e.jsx(ue,{alt:"",className:$e["button-image-delete-icon"],src:pe}),"Supprimer"]})})};try{k.displayName="ButtonImageDelete",k.__docgenInfo={description:"",displayName:"ButtonImageDelete",props:{onImageDelete:{defaultValue:null,description:"",name:"onImageDelete",required:!0,type:{name:"() => void"}}}}}catch{}const Je=async(a,t="image.jpg")=>{const l=await(await fetch(a)).blob();return new File([l],t,{type:l.type})},Xe=a=>{const[t,i]=m.useState(0),[l,n]=m.useState(0);return m.useEffect(()=>{(async()=>{if(a){const o=await Le(a);o&&(i(o.width),n(o.height))}})()},[a]),a?{width:t,height:l}:{width:0,height:0}},F=(a,t)=>a+t/2,Ke=a=>100/(a*100),Qe=""+new URL("offer-home-shell-Ch3YT9j3.png",import.meta.url).href,Ze=""+new URL("offer-shell-coq2oAbe.png",import.meta.url).href,re={"image-preview-shell":"_image-preview-shell_1yqyc_1","image-preview-home-preview":"_image-preview-home-preview_1yqyc_7"},A={"image-preview-shell":"_image-preview-shell_8f82l_1","image-preview-blur-offer-preview":"_image-preview-blur-offer-preview_8f82l_7","image-preview-offer-preview":"_image-preview-offer-preview_8f82l_16"},H=({imageUrl:a})=>e.jsxs(ze,{children:[e.jsxs(Z,{title:"Page d’accueil",children:[e.jsx("img",{alt:"",className:re["image-preview-shell"],src:Qe,role:"presentation"}),e.jsx("img",{"data-testid":"app-preview-offer-img-home",alt:"",className:re["image-preview-home-preview"],src:a,role:"presentation"})]}),e.jsxs(Z,{title:"Détails de l’offre",children:[e.jsx("img",{alt:"",className:A["image-preview-blur-offer-preview"],src:a,role:"presentation"}),e.jsx("img",{alt:"",className:A["image-preview-shell"],src:Ze,role:"presentation"}),e.jsx("img",{"data-testid":"app-preview-offer-img",alt:"",className:A["image-preview-offer-preview"],src:a,role:"presentation"})]})]});try{H.displayName="AppPreviewOffer",H.__docgenInfo={description:"",displayName:"AppPreviewOffer",props:{imageUrl:{defaultValue:null,description:"",name:"imageUrl",required:!0,type:{name:"string"}}}}}catch{}const d={"modal-image-crop":"_modal-image-crop_1b7nb_1","modal-image-crop-content":"_modal-image-crop-content_1b7nb_8","modal-image-crop-subwrapper":"_modal-image-crop-subwrapper_1b7nb_11","modal-image-crop-editor":"_modal-image-crop-editor_1b7nb_22","modal-image-crop-editor-loading":"_modal-image-crop-editor-loading_1b7nb_30","modal-image-crop-callout":"_modal-image-crop-callout_1b7nb_33","modal-image-crop-callout-list":"_modal-image-crop-callout-list_1b7nb_36","modal-image-crop-actions":"_modal-image-crop-actions_1b7nb_40","modal-image-crop-header":"_modal-image-crop-header_1b7nb_47","modal-image-crop-right":"_modal-image-crop-right_1b7nb_53","modal-image-crop-credit":"_modal-image-crop-credit_1b7nb_59","modal-image-crop-credit-loading":"_modal-image-crop-credit-loading_1b7nb_63","modal-image-crop-footer":"_modal-image-crop-footer_1b7nb_66"},ea=({originalDimensions:a,orientation:t})=>t==="landscape"?{width:Math.floor(Math.min(a.width,a.height/2*3)),height:Math.floor(Math.min(a.height,a.width/3*2))}:{width:Math.floor(Math.min(a.width,a.height/3*2)),height:Math.floor(Math.min(a.height,a.width/2*3))},aa=(a,t,i)=>{const l={[r.OFFER]:400,[r.OFFER_COLLECTIVE]:400,[r.VENUE]:600}[i],{width:n}=ea({originalDimensions:{width:a,height:t},orientation:i===r.VENUE?"landscape":"portrait"}),c=Math.min(4,(n-10)/l),o={[r.OFFER]:297,[r.OFFER_COLLECTIVE]:297,[r.VENUE]:138}[i];return{[r.OFFER]:{canvasHeight:o,canvasWidth:o*2/3,cropBorderColor:"#FFF",cropBorderHeight:50,cropBorderWidth:105,maxScale:c},[r.OFFER_COLLECTIVE]:{canvasHeight:o,canvasWidth:o*2/3,cropBorderColor:"#FFF",cropBorderHeight:50,cropBorderWidth:105,maxScale:c},[r.VENUE]:{canvasHeight:o,canvasWidth:o*3/2,cropBorderColor:"#FFF",cropBorderHeight:40,cropBorderWidth:100,maxScale:c}}[i]},Y=({mode:a,onImageUpload:t,onImageDelete:i,initialValues:l={}})=>{const{draftImage:n,...c}=l,o={x:.5,y:.5},{originalImageUrl:_,credit:u,cropParams:v}=c,p=_,{xCropPercent:g,yCropPercent:U,heightCropPercent:V,widthCropPercent:I}=v||{},he=g&&I?F(g,I):o.x,_e=U&&V?F(U,V):o.y,x=m.useRef(null),S=qe(),[D,G]=m.useState(!0),[f,L]=m.useState(n),[$,J]=m.useState(p),[ve,X]=m.useState({x:he,y:_e}),[q,K]=m.useState(u??""),[Ie,xe]=m.useState(I?Ke(I):1),{width:B,height:M}=Xe(f),ye=aa(B,M,a),we=a===r.OFFER&&$,Ee=a===r.OFFER&&(B&&B<400||M&&M<600);m.useEffect(()=>{async function s(y){try{L(await Je(y))}catch{S.error("Erreur lors de la récupération de votre image.")}}p&&s(p)},[p,S]);const Ce=()=>{L(void 0),X({x:o.x,y:o.y}),K(""),xe(1)},je=s=>{G(!0),L(s),T()},be=(s,y,h)=>{f&&t({imageFile:f,imageCroppedDataUrl:y,cropParams:h,credit:s})},Ue=()=>{if(x.current){const s=x.current.getImage();J(s.toDataURL()),G(!1)}},T=s=>{try{if(x.current){const y=x.current.getImage();J(y.toDataURL());const h=x.current.getCroppingRect();X({x:F(h.x,h.width),y:F(h.y,h.height)}),s&&s(q,y.toDataURL(),h)}}catch{S.error("Une erreur est survenue. Merci de réessayer plus tard")}},Ve=()=>T(),Fe=()=>T(be);return e.jsxs("form",{className:d["modal-image-crop"],children:[e.jsxs("div",{className:d["modal-image-crop-content"],children:[e.jsx(De,{asChild:!0,children:e.jsx("h1",{className:d["modal-image-crop-header"],children:"Modifier une image"})}),e.jsx("p",{className:d["modal-image-crop-right"],children:"En utilisant ce contenu, je certifie que je suis propriétaire ou que je dispose des autorisations nécessaires pour l’utilisation de celui-ci."}),f&&e.jsxs(e.Fragment,{children:[D&&e.jsx(He,{}),e.jsxs("div",{className:b(d["modal-image-crop-subwrapper"],D&&d["modal-image-crop-editor-loading"]),children:[e.jsxs("div",{className:d["modal-image-crop-editor"],children:[e.jsx(Ye,{ref:x,...ye,image:f,initialPosition:ve,initialScale:Ie,onChangeDone:Ve,onImagePainted:Ue}),e.jsxs("div",{className:d["modal-image-crop-actions"],children:[e.jsx(E,{icon:Me,onClick:Ce,variant:j.TERNARY,children:"Remplacer l’image"}),e.jsx(Q,{asChild:!0,children:e.jsx(E,{icon:pe,onClick:i,variant:j.TERNARY,children:"Supprimer l’image"})})]})]}),we&&e.jsx(H,{imageUrl:$})]}),Ee&&e.jsx(Ae,{className:d["modal-image-crop-callout"],variant:We.WARNING,children:e.jsxs("div",{children:["La qualité de votre image n’est pas optimale.",e.jsx("br",{}),"Le format recommandé :",e.jsxs("ul",{className:d["modal-image-crop-callout-list"],children:[e.jsx("li",{children:"Largeur minimale de l’image : 400 px"}),e.jsx("li",{children:"Hauteur minimale de l’image : 600 px"})]})]})}),e.jsx(ke,{count:q.length,className:b(d["modal-image-crop-credit"],D&&d["modal-image-crop-credit-loading"]),label:"Crédit de l’image",maxLength:255,value:q,onChange:s=>K(s.target.value),name:"credit",type:"text"})]}),!f&&e.jsx(Be,{onDropOrSelected:je})]}),e.jsx(ge.Footer,{children:e.jsxs("div",{className:d["modal-image-crop-footer"],children:[e.jsx(Q,{asChild:!0,children:e.jsx(E,{variant:j.SECONDARY,children:"Annuler"})}),e.jsx(E,{type:"submit",onClick:s=>{s.preventDefault(),Fe()},disabled:!f,children:"Enregistrer"})]})})]})};try{Y.displayName="ModalImageUpsertOrEdit",Y.__docgenInfo={description:"",displayName:"ModalImageUpsertOrEdit",props:{mode:{defaultValue:null,description:"",name:"mode",required:!0,type:{name:"enum",value:[{value:'"offer"'},{value:'"offer_collective"'},{value:'"venue"'}]}},onImageUpload:{defaultValue:null,description:"",name:"onImageUpload",required:!0,type:{name:"(values: OnImageUploadArgs) => void"}},onImageDelete:{defaultValue:null,description:"",name:"onImageDelete",required:!1,type:{name:"(() => void)"}},initialValues:{defaultValue:{value:"{}"},description:"",name:"initialValues",required:!1,type:{name:"UploadImageValues"}}}}}catch{}const ra="_label_1wm17_22",ta="_icon_1wm17_35",C={"button-image-add":"_button-image-add_1wm17_1","add-image-venue":"_add-image-venue_1wm17_14","add-image-offer":"_add-image-offer_1wm17_18",label:ra,icon:ta},P=({mode:a,initialValues:t={},onImageUpload:i,onImageDelete:l,onClickButtonImage:n,children:c,disableForm:o})=>{const{imageUrl:_,originalImageUrl:u}=t,[v,p]=m.useState(!1),g=()=>{n&&n()},U=()=>{l()};function V(I){i(I),p(!1)}return e.jsx(e.Fragment,{children:e.jsx(ge,{onOpenChange:p,open:v,variant:"drawer",trigger:_||u?e.jsx(E,{onClick:g,variant:j.TERNARY,"aria-label":"Modifier l’image",icon:Ge,children:c??"Modifier"}):e.jsx("button",{className:b(C["button-image-add"],{[C["add-image-venue"]]:a===r.VENUE,[C["add-image-offer"]]:a===r.OFFER||a===r.OFFER_COLLECTIVE}),onClick:g,type:"button",disabled:o,children:e.jsxs(e.Fragment,{children:[e.jsx(ue,{src:Te,alt:"",className:C.icon}),e.jsx("span",{className:C.label,children:"Ajouter une image"})]})}),children:e.jsx(Y,{mode:a,onImageUpload:V,onImageDelete:U,initialValues:t})})})};try{P.displayName="ButtonImageEdit",P.__docgenInfo={description:"",displayName:"ButtonImageEdit",props:{onImageUpload:{defaultValue:null,description:"",name:"onImageUpload",required:!0,type:{name:"(values: OnImageUploadArgs) => void"}},onImageDelete:{defaultValue:null,description:"",name:"onImageDelete",required:!0,type:{name:"() => void"}},initialValues:{defaultValue:{value:"{}"},description:"",name:"initialValues",required:!1,type:{name:"UploadImageValues"}},mode:{defaultValue:null,description:"",name:"mode",required:!0,type:{name:"enum",value:[{value:'"offer"'},{value:'"offer_collective"'},{value:'"venue"'}]}},onClickButtonImage:{defaultValue:null,description:"",name:"onClickButtonImage",required:!1,type:{name:"(() => void)"}},disableForm:{defaultValue:null,description:"",name:"disableForm",required:!1,type:{name:"boolean"}}}}}catch{}const w={"image-uploader-image-container":"_image-uploader-image-container_1gu1i_5","image-uploader-actions-container":"_image-uploader-actions-container_1gu1i_10","actions-wrapper":"_actions-wrapper_1gu1i_17","image-preview":"_image-preview_1gu1i_25","preview-venue":"_preview-venue_1gu1i_31","preview-offer":"_preview-offer_1gu1i_41"},z=({className:a,onImageUpload:t,onImageDelete:i,initialValues:l={},mode:n,onClickButtonImageAdd:c,hideActionButtons:o=!1,disableForm:_=!1})=>{const{imageUrl:u,originalImageUrl:v,credit:p,cropParams:g}=l;return e.jsx("div",{className:b(w["image-uploader-image-container"],a),children:u&&v?e.jsxs(e.Fragment,{children:[e.jsx("img",{alt:"Prévisualisation de l’image","data-testid":"image-preview",className:b(w["image-preview"],{[w["preview-venue"]]:n===r.VENUE,[w["preview-offer"]]:n===r.OFFER||n===r.OFFER_COLLECTIVE}),src:u}),!o&&e.jsx("div",{className:w["image-uploader-actions-container"],children:e.jsxs("div",{className:w["actions-wrapper"],children:[e.jsx(P,{mode:n,initialValues:{originalImageUrl:v,imageUrl:u,credit:p,cropParams:g},onImageUpload:t,onImageDelete:i,onClickButtonImage:c,disableForm:_}),e.jsx(k,{onImageDelete:i})]})})]}):e.jsx(P,{mode:n,onImageUpload:t,onImageDelete:i,onClickButtonImage:c,disableForm:_})})};try{z.displayName="ImageUploader",z.__docgenInfo={description:"",displayName:"ImageUploader",props:{className:{defaultValue:null,description:"",name:"className",required:!1,type:{name:"string"}},onImageUpload:{defaultValue:null,description:"",name:"onImageUpload",required:!0,type:{name:"(values: OnImageUploadArgs) => void"}},onImageDelete:{defaultValue:null,description:"",name:"onImageDelete",required:!0,type:{name:"() => void"}},initialValues:{defaultValue:{value:"{}"},description:"",name:"initialValues",required:!1,type:{name:"UploadImageValues"}},mode:{defaultValue:null,description:"",name:"mode",required:!0,type:{name:"enum",value:[{value:'"offer"'},{value:'"offer_collective"'},{value:'"venue"'}]}},onClickButtonImageAdd:{defaultValue:null,description:"",name:"onClickButtonImageAdd",required:!1,type:{name:"(() => void)"}},hideActionButtons:{defaultValue:{value:"false"},description:"",name:"hideActionButtons",required:!1,type:{name:"boolean"}},disableForm:{defaultValue:{value:"false"},description:"",name:"disableForm",required:!1,type:{name:"boolean"}}}}}catch{}const er={title:"components/ImageUploader/ImageUploader",component:z,decorators:[Oe,a=>e.jsx(Ne,{store:Re({}),children:e.jsx(a,{})})]},fe={initialValues:{originalImageUrl:ae,imageUrl:ae,credit:"John Do",cropParams:{xCropPercent:0,yCropPercent:0,heightCropPercent:1,widthCropPercent:1}},mode:r.OFFER,onImageDelete:()=>{alert("onDelete have been called.")},onImageUpload:()=>{alert("onImageUpload have been called.")}},N={args:{...fe}},O={args:{...fe,initialValues:{imageUrl:ee,originalImageUrl:ee},mode:r.VENUE}},R={args:{mode:r.OFFER}};var te,ie,oe;N.parameters={...N.parameters,docs:{...(te=N.parameters)==null?void 0:te.docs,source:{originalSource:`{
  args: {
    ...props
  }
}`,...(oe=(ie=N.parameters)==null?void 0:ie.docs)==null?void 0:oe.source}}};var ne,le,se;O.parameters={...O.parameters,docs:{...(ne=O.parameters)==null?void 0:ne.docs,source:{originalSource:`{
  args: {
    ...props,
    initialValues: {
      imageUrl: sampleImageLandscape,
      originalImageUrl: sampleImageLandscape
    },
    mode: UploaderModeEnum.VENUE
  }
}`,...(se=(le=O.parameters)==null?void 0:le.docs)==null?void 0:se.source}}};var me,ce,de;R.parameters={...R.parameters,docs:{...(me=R.parameters)==null?void 0:me.docs,source:{originalSource:`{
  args: {
    mode: UploaderModeEnum.OFFER
  }
}`,...(de=(ce=R.parameters)==null?void 0:ce.docs)==null?void 0:de.source}}};const ar=["WithImageOffer","WithImageVenue","WithoutImage"];export{N as WithImageOffer,O as WithImageVenue,R as WithoutImage,ar as __namedExportsOrder,er as default};
