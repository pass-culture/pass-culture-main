import{j as a}from"./jsx-runtime-CfatFE5O.js";import{a as _e,u as X,F as Ve}from"./formik.esm-DyanDbCL.js";import{c as z}from"./index-DeARc5FM.js";import{r as c}from"./index-ClcD9ViR.js";import{S as Oe}from"./SelectedValuesTags-CDx9lmTP.js";import{B as we}from"./BaseInput-zpkrYXWy.js";import{F as xe}from"./FieldLayout-BgRvi_Rb.js";import{B as qe}from"./BaseCheckbox-BbgqOLh4.js";import{s as Ae}from"./stroke-down-Co3p5GaP.js";import{S as Ne}from"./SvgIcon-CUWb-Ez8.js";import"./_commonjsHelpers-Cpj98o6Y.js";import"./full-close-5Oxr7nnd.js";import"./full-clear-Q4kCtSRL.js";import"./full-help-blUMxBcv.js";import"./Button-SeWbfM7k.js";import"./stroke-pass-CALgybTM.js";import"./Tooltip-CPMX2zM9.js";import"./useTooltipProps-C5TDwaI9.js";import"./Button.module-CiMaKVCX.js";import"./types-DjX_gQD6.js";import"./FieldError-DblMbt5C.js";import"./stroke-error-DSZD431a.js";import"./FieldLayoutCharacterCount-DooUcf1c.js";const Y=t=>t.trim().toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,""),Fe=(t,o,r)=>{const e=[];for(let i=0;i<t.length&&!(r&&e.length>=r);i++){const y=t[i].normalizedLabel??Y(t[i].label);Y(o||"").split(" ").every(w=>y.includes(w))&&e.push(t[i])}return e},Le=(t,o,r="s")=>{let e,i;const y=t.slice(-1)[0];return y==="s"||y==="x"?(i=t.slice(0,-1),e=t):(i=t,e=`${t}${r}`),o>1?e:i},Se=(t,o,r)=>t.split(" ").map(e=>Le(e,o,r)).join(" "),je=(t,o,r)=>`${new Intl.NumberFormat("fr-FR").format(t)} ${Se(o,t,r)}`,ke="_menu_1o8o9_1",Ie="_label_1o8o9_23",$e="_input_1o8o9_30",O={menu:ke,"menu--no-results":"_menu--no-results_1o8o9_15","options-item":"_options-item_1o8o9_18","too-many-options":"_too-many-options_1o8o9_19",label:Ie,input:$e,"option-hovered":"_option-hovered_1o8o9_33"},P=({className:t,fieldName:o,selectedValues:r,filteredOptions:e,setHoveredOptionIndex:i,listRef:y,hoveredOptionIndex:N,selectOption:w,multi:j,maxDisplayedOptions:x})=>{const m=x?e.slice(0,x):e;return a.jsxs("div",{className:z(O.menu,t),role:"listbox",children:[e.length===0&&a.jsx("span",{className:O["menu--no-results"],children:"Aucun résultat"}),a.jsx("ul",{"data-testid":"list",id:`list-${o}`,ref:y,role:"listbox",children:m.map(({value:u,label:k},q)=>{const F=(r||[]).includes(String(u));return a.jsx("li",{"aria-selected":F,"aria-posinset":q+1,"aria-setsize":m.length,className:N===q?O["option-hovered"]:"","data-value":u,"data-selected":F,id:`option-display-${u}`,onMouseEnter:()=>i(q),onFocus:()=>i(q),role:"option",tabIndex:-1,children:j?a.jsx(qe,{label:k,checked:F,onChange:()=>{w(String(u))},labelClassName:O.label,inputClassName:O.input}):a.jsx("span",{onClick:()=>{w(String(u))},className:z(O["options-item"]),children:k})},`option-display-${u}`)})}),a.jsx("div",{role:"status",children:x&&m.length<e.length&&a.jsxs("div",{className:O["too-many-options"],children:[je(x,"résultat")," maximum. Veuillez affiner votre recherche"]})})]})};try{P.displayName="OptionsList",P.__docgenInfo={description:"",displayName:"OptionsList",props:{className:{defaultValue:null,description:"",name:"className",required:!1,type:{name:"string"}},fieldName:{defaultValue:null,description:"",name:"fieldName",required:!0,type:{name:"string"}},selectedValues:{defaultValue:null,description:"",name:"selectedValues",required:!0,type:{name:"string | string[] | null"}},filteredOptions:{defaultValue:null,description:"",name:"filteredOptions",required:!0,type:{name:"SelectOption[]"}},setHoveredOptionIndex:{defaultValue:null,description:"",name:"setHoveredOptionIndex",required:!0,type:{name:"(value: number | null) => void"}},listRef:{defaultValue:null,description:"",name:"listRef",required:!0,type:{name:"Ref<HTMLUListElement>"}},hoveredOptionIndex:{defaultValue:null,description:"",name:"hoveredOptionIndex",required:!0,type:{name:"number | null"}},selectOption:{defaultValue:null,description:"",name:"selectOption",required:!0,type:{name:"(value: string) => void"}},multi:{defaultValue:null,description:"",name:"multi",required:!0,type:{name:"boolean"}},maxDisplayedOptions:{defaultValue:null,description:"",name:"maxDisplayedOptions",required:!1,type:{name:"number"}}}}}catch{}const Te="_pellet_1jeev_15",S={"multi-select-autocomplete-container":"_multi-select-autocomplete-container_1jeev_1","multi-select-autocomplete-placeholder-input":"_multi-select-autocomplete-placeholder-input_1jeev_7","field-overlay":"_field-overlay_1jeev_11",pellet:Te,"visually-hidden":"_visually-hidden_1jeev_34"},Ce={"dropdown-indicator":"_dropdown-indicator_hafu1_1"},H=({disabled:t,isOpen:o,toggleField:r})=>a.jsx("button",{onClick:r,className:Ce["dropdown-indicator"],type:"button",disabled:t,children:a.jsx(Ne,{src:Ae,alt:`${o?"Masquer":"Afficher"} les options`,width:"20"})});try{H.displayName="Toggle",H.__docgenInfo={description:"",displayName:"Toggle",props:{disabled:{defaultValue:null,description:"",name:"disabled",required:!0,type:{name:"boolean"}},isOpen:{defaultValue:null,description:"",name:"isOpen",required:!0,type:{name:"boolean"}},toggleField:{defaultValue:null,description:"",name:"toggleField",required:!0,type:{name:"() => void"}}}}}catch{}const W=({className:t,selectedValuesTagsClassName:o,disabled:r=!1,name:e,hideArrow:i,hideFooter:y=!1,hideTags:N=!1,inline:w,isOptional:j=!1,label:x,multi:m=!1,options:u,smallLabel:k=!1,resetOnOpen:q=!0,description:F,onSearch:oe=()=>{},searchInOptions:ue=(A,g)=>A.filter(s=>s.label.toLowerCase().includes(g.trim().toLowerCase())),onReset:de=()=>{},maxDisplayedOptions:ce,isLabelHidden:pe,shouldFocusOnMount:me,preventOpenOnFirstFocus:fe})=>{var J;const{setFieldTouched:A,setFieldValue:g}=_e(),[s,I]=X(e),[v,U]=X(`search-${e}`),[p,h]=c.useState(null),[M,he]=c.useState({}),$=c.useRef(null),R=c.useRef(null),B=c.useRef(null),[d,f]=c.useState(!1),[b,ye]=c.useState(u);c.useEffect(()=>{(async()=>{var n;me&&((n=B.current)==null||n.focus(),await A(`search-${e}`,!0))})()},[]),c.useEffect(()=>{const l=async()=>{await g(`search-${e}`,"",!1),await g(e,m?[]:"",!1),de()};d&&q&&v.value!==""&&l()},[d]),c.useEffect(()=>{he(u.reduce((l,n)=>(l[n.value]=n.label,l),{}))},[u]),c.useEffect(()=>{const l=n=>{var _;(_=$.current)!=null&&_.contains(n.target)||f(!1)};return $.current&&document.addEventListener("mousedown",l),()=>{document.removeEventListener("mousedown",l)}},[$]),c.useEffect(()=>{oe((v.value??"").trim()),h(null)},[v.value]),c.useEffect(()=>{ye(ue(u,v.value))},[v.value,u]);const be=async l=>{var n,_,Q;switch(l.key){case"ArrowUp":if(p!==null)if(p<=0)h(null);else{const L=p-1;h(L);const V=(n=R.current)==null?void 0:n.getElementsByTagName("li")[L];V==null||V.scrollIntoView({block:"nearest"})}d||f(!0);break;case"ArrowDown":if(p===null)b.length>0&&h(0);else{const L=Math.min(b.length-1,p+1);h(L);const V=(_=R.current)==null?void 0:_.getElementsByTagName("li")[L];V==null||V.scrollIntoView({block:"nearest"})}d||f(!0);break;case" ":case"Enter":d&&p!==null&&b[p]&&(l.preventDefault(),b[p]&&await D(String(b[p].value)));break;case"Escape":(Q=B.current)==null||Q.focus(),h(null),f(!1);break;case"Tab":h(null),f(!1);break}},D=async l=>{let n;m?s.value.includes(l)&&Array.isArray(s.value)?n=s.value.filter(_=>_!==l):n=[...s.value,l]:(n=l,f(!1),h(null),await g(`search-${e}`,M[n],!1)),await g(e,n)},ge=async()=>{const l=I.touched;(fe?l&&!d:!d)&&f(!0),await A(e,!0)},ve=async()=>{d||f(!0),await A(e,!0)},G=async()=>{d?(f(!1),await g(`search-${e}`,"",!1)):f(!0),await A(e,!0)};return a.jsxs(xe,{className:t,error:I.error,hideFooter:!N&&y,isOptional:j,label:x,name:`search-${e}`,showError:U.touched&&!!I.error,smallLabel:k,inline:w,description:F,isLabelHidden:pe,children:[a.jsxs("div",{className:z(S["multi-select-autocomplete-container"],t),onKeyDown:be,ref:$,children:[a.jsx(we,{...p!==null&&{"aria-activedescendant":`option-display-${(J=b[p])==null?void 0:J.value}`},onClick:ve,onFocus:ge,className:S["multi-select-autocomplete-placeholder-input"],hasError:U.touched&&!!I.error,type:"search",disabled:r,...v,"aria-autocomplete":"list","aria-controls":`list-${e}`,"aria-describedby":`help-${e}`,"aria-expanded":d,"aria-haspopup":"listbox","aria-required":!j,role:"combobox",ref:B}),a.jsxs("div",{"aria-live":"polite","aria-relevant":"text",className:S["visually-hidden"],id:`help-${e}`,children:[m&&`${s.value.length} options sélectionnées`,!m&&!Array.isArray(s.value)&&s.value!==""&&`Option sélectionnée : ${M[s.value]}`,d?`${b.length} options ${v.value===""?"disponibles":"correspondant au texte saisi"}`:"saisissez du texte pour afficher et filtrer les options"]}),a.jsx("select",{hidden:!0,...m&&{multiple:!0},...s,value:s.value||"","data-testid":"select",children:u.map(({label:l,value:n})=>a.jsx("option",{value:n,children:l},`option-${n}`))}),a.jsxs("div",{className:S["field-overlay"],children:[!i&&a.jsx(H,{disabled:r,isOpen:d,toggleField:G}),m&&s.value.length>0&&a.jsx("div",{onClick:G,className:S.pellet,children:s.value.length}),d&&a.jsx(P,{className:t,fieldName:e,selectedValues:s.value,filteredOptions:b,setHoveredOptionIndex:h,listRef:R,hoveredOptionIndex:p,selectOption:D,multi:m,maxDisplayedOptions:ce})]})]}),Array.isArray(s.value)&&!N&&s.value.length>0&&a.jsx(Oe,{className:o,disabled:r,fieldName:e,optionsLabelById:M,selectedOptions:s.value,removeOption:D})]})};try{W.displayName="SelectAutocomplete",W.__docgenInfo={description:"",displayName:"SelectAutocomplete",props:{label:{defaultValue:null,description:"",name:"label",required:!0,type:{name:"string | Element"}},name:{defaultValue:null,description:"",name:"name",required:!0,type:{name:"string"}},description:{defaultValue:null,description:"",name:"description",required:!1,type:{name:"string"}},maxLength:{defaultValue:null,description:"",name:"maxLength",required:!1,type:{name:"number"}},isLabelHidden:{defaultValue:null,description:`A flag to hide the label.
To be used with caution, as it can affect accessibility.
Do not use it if the label is mandatory, placeholder is not
a substitute for a label.`,name:"isLabelHidden",required:!1,type:{name:"boolean"}},hasLabelLineBreak:{defaultValue:null,description:"",name:"hasLabelLineBreak",required:!1,type:{name:"boolean"}},isOptional:{defaultValue:{value:"false"},description:`A flag to indicate that the field is optional.
It will display an asterisk next to the label.`,name:"isOptional",required:!1,type:{name:"boolean"}},showMandatoryAsterisk:{defaultValue:null,description:`Can be false only when it's the only field in a form and it's mandatory,
or when all fields are mandatory and the form indicates that all fields are mandatory`,name:"showMandatoryAsterisk",required:!1,type:{name:"boolean"}},className:{defaultValue:null,description:`A custom class for the field layout,
where label, description, input, and footer are displayed.`,name:"className",required:!1,type:{name:"string"}},classNameLabel:{defaultValue:null,description:"",name:"classNameLabel",required:!1,type:{name:"string"}},classNameFooter:{defaultValue:null,description:`A custom class for the footer,
where errors and character count are displayed.`,name:"classNameFooter",required:!1,type:{name:"string"}},classNameInput:{defaultValue:null,description:"",name:"classNameInput",required:!1,type:{name:"string"}},filterVariant:{defaultValue:null,description:"",name:"filterVariant",required:!1,type:{name:"boolean"}},smallLabel:{defaultValue:{value:"false"},description:"A flag to display a smaller label.",name:"smallLabel",required:!1,type:{name:"boolean"}},hideFooter:{defaultValue:{value:"false"},description:`A flag to hide the footer.
To be used with caution, as it can affect accessibility.`,name:"hideFooter",required:!1,type:{name:"boolean"}},inline:{defaultValue:null,description:"",name:"inline",required:!1,type:{name:"boolean"}},clearButtonProps:{defaultValue:null,description:"",name:"clearButtonProps",required:!1,type:{name:'(ButtonHTMLAttributes<HTMLButtonElement> & { tooltip: string; display?: "clear" | "close"; })'}},ErrorDetails:{defaultValue:null,description:"",name:"ErrorDetails",required:!1,type:{name:"ReactNode"}},disabled:{defaultValue:{value:"false"},description:"",name:"disabled",required:!1,type:{name:"boolean"}},hideArrow:{defaultValue:null,description:"",name:"hideArrow",required:!1,type:{name:"boolean"}},hideTags:{defaultValue:{value:"false"},description:"",name:"hideTags",required:!1,type:{name:"boolean"}},maxHeight:{defaultValue:null,description:"",name:"maxHeight",required:!1,type:{name:"number"}},multi:{defaultValue:{value:"false"},description:"",name:"multi",required:!1,type:{name:"boolean"}},options:{defaultValue:null,description:"",name:"options",required:!0,type:{name:"SelectOption[]"}},resetOnOpen:{defaultValue:{value:"true"},description:"",name:"resetOnOpen",required:!1,type:{name:"boolean"}},onSearch:{defaultValue:{value:"() => {}"},description:"",name:"onSearch",required:!1,type:{name:"((pattern: string) => void)"}},searchInOptions:{defaultValue:{value:`(options, pattern) =>
    options.filter((opt) =>
      opt.label.toLowerCase().includes(pattern.trim().toLowerCase())
    )`},description:"",name:"searchInOptions",required:!1,type:{name:"((options: SelectOption[], pattern: string) => SelectOption[])"}},onReset:{defaultValue:{value:"() => {}"},description:"",name:"onReset",required:!1,type:{name:"(() => void)"}},maxDisplayedOptions:{defaultValue:null,description:"",name:"maxDisplayedOptions",required:!1,type:{name:"number"}},selectedValuesTagsClassName:{defaultValue:null,description:"",name:"selectedValuesTagsClassName",required:!1,type:{name:"string"}},shouldFocusOnMount:{defaultValue:null,description:"A flag to automatically focus the input when the component mounts.",name:"shouldFocusOnMount",required:!1,type:{name:"boolean"}},preventOpenOnFirstFocus:{defaultValue:null,description:`A flag to prevent the dropdown from opening on the first focus.
This is useful when the input is automatically focused. The user
is then expected to open the dropdown by clicking on the input.`,name:"preventOpenOnFirstFocus",required:!1,type:{name:"boolean"}}}}}catch{}const Ee=t=>a.jsx(Ve,{initialValues:t.initialValues,onSubmit:()=>{},children:a.jsx(W,{...t})}),it={title:"ui-kit/forms/SelectAutocomplete",component:Ee},K={name:"departement",options:[{value:"01",label:"Ain"},{value:"02",label:"Aisne"},{value:"03",label:"Allier"},{value:"04",label:"Alpes-de-Haute-Provence test de libellé très long"},{value:"05",label:"Hautes-Alpes"},{value:"06",label:"Alpes-Maritimes"},{value:"07",label:"Ardèche"},{value:"08",label:"Ardennes"},{value:"09",label:"Ariège"},{value:"10",label:"Aube"},{value:"11",label:"Aude"},{value:"12",label:"Aveyron"},{value:"13",label:"Bouches-du-Rhône"},{value:"14",label:"Calvados"},{value:"15",label:"Cantal"}],initialValues:{departement:"01","search-departement":""},label:"Département",hideFooter:!1,hideTags:!1,isOptional:!1,smallLabel:!1,searchInOptions:Fe},T={args:{...K}},C={args:{...K,multi:!0,initialValues:{departement:["01","02"],"search-departement":""}}},E={args:{...K,multi:!0,initialValues:{departement:["01","02"],"search-departement":""},hideTags:!0}};var Z,ee,te;T.parameters={...T.parameters,docs:{...(Z=T.parameters)==null?void 0:Z.docs,source:{originalSource:`{
  args: {
    ...defaultProps
  }
}`,...(te=(ee=T.parameters)==null?void 0:ee.docs)==null?void 0:te.source}}};var ae,le,ne;C.parameters={...C.parameters,docs:{...(ae=C.parameters)==null?void 0:ae.docs,source:{originalSource:`{
  args: {
    ...defaultProps,
    multi: true,
    initialValues: {
      departement: ['01', '02'],
      'search-departement': ''
    }
  }
}`,...(ne=(le=C.parameters)==null?void 0:le.docs)==null?void 0:ne.source}}};var se,re,ie;E.parameters={...E.parameters,docs:{...(se=E.parameters)==null?void 0:se.docs,source:{originalSource:`{
  args: {
    ...defaultProps,
    multi: true,
    initialValues: {
      departement: ['01', '02'],
      'search-departement': ''
    },
    hideTags: true
  }
}`,...(ie=(re=E.parameters)==null?void 0:re.docs)==null?void 0:ie.source}}};const ot=["Default","Multi","WithoutTags"];export{T as Default,C as Multi,E as WithoutTags,ot as __namedExportsOrder,it as default};
