import{j as C}from"./jsx-runtime-ffb262ed.js";import{c as Q}from"./formik.esm-49513253.js";import{r as D}from"./index-76fb7be0.js";import{c as ee,g as te}from"./_commonjsHelpers-de833af9.js";import{p as oe}from"./index-9d475cdf.js";import{S as ne}from"./Slider-a595c847.js";var Z={exports:{}};(function(b,g){(function(I,_){b.exports=_(oe,D)})(ee,function(c,O){function j(n){return n&&typeof n=="object"&&"default"in n?n:{default:n}}var c=j(c),T=j(O);function R(n,i){var r,s=Object.keys(n);return Object.getOwnPropertySymbols&&(r=Object.getOwnPropertySymbols(n),i&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable})),s.push.apply(s,r)),s}function x(n){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?R(Object(r),!0).forEach(function(s){m(n,s,r[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(r)):R(Object(r)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(r,s))})}return n}function B(n,i){for(var r=0;r<i.length;r++){var s=i[r];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(n,$(s.key),s)}}function m(n,i,r){(i=$(i))in n?Object.defineProperty(n,i,{value:r,enumerable:!0,configurable:!0,writable:!0}):n[i]=r}function L(){return(L=Object.assign?Object.assign.bind():function(n){for(var i=1;i<arguments.length;i++){var r,s=arguments[i];for(r in s)Object.prototype.hasOwnProperty.call(s,r)&&(n[r]=s[r])}return n}).apply(this,arguments)}function M(n){return(M=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(i){return i.__proto__||Object.getPrototypeOf(i)})(n)}function U(n,i){return(U=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(r,s){return r.__proto__=s,r})(n,i)}function P(n,i){if(n==null)return{};var r,s=function(o,a){if(o==null)return{};for(var u,l={},h=Object.keys(o),d=0;d<h.length;d++)u=h[d],0<=a.indexOf(u)||(l[u]=o[u]);return l}(n,i);if(Object.getOwnPropertySymbols)for(var t=Object.getOwnPropertySymbols(n),e=0;e<t.length;e++)r=t[e],0<=i.indexOf(r)||Object.prototype.propertyIsEnumerable.call(n,r)&&(s[r]=n[r]);return s}function y(n){if(n===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return n}function X(n){var i=function(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}();return function(){var r,s=M(n),s=(r=i?(r=M(this).constructor,Reflect.construct(s,arguments,r)):s.apply(this,arguments),this);if(r&&(typeof r=="object"||typeof r=="function"))return r;if(r!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return y(s)}}function N(n,i){return function(r){if(Array.isArray(r))return r}(n)||function(r,s){var t=r==null?null:typeof Symbol<"u"&&r[Symbol.iterator]||r["@@iterator"];if(t!=null){var e,o,a,u,l=[],h=!0,d=!1;try{if(a=(t=t.call(r)).next,s===0){if(Object(t)!==t)return;h=!1}else for(;!(h=(e=a.call(t)).done)&&(l.push(e.value),l.length!==s);h=!0);}catch(f){d=!0,o=f}finally{try{if(!h&&t.return!=null&&(u=t.return(),Object(u)!==u))return}finally{if(d)throw o}}return l}}(n,i)||Y(n,i)||function(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}()}function Y(n,i){var r;if(n)return typeof n=="string"?q(n,i):(r=(r=Object.prototype.toString.call(n).slice(8,-1))==="Object"&&n.constructor?n.constructor.name:r)==="Map"||r==="Set"?Array.from(n):r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?q(n,i):void 0}function q(n,i){(i==null||i>n.length)&&(i=n.length);for(var r=0,s=new Array(i);r<i;r++)s[r]=n[r];return s}function $(n){return n=function(i,r){if(typeof i!="object"||i===null)return i;var s=i[Symbol.toPrimitive];if(s===void 0)return(r==="string"?String:Number)(i);if(typeof(s=s.call(i,r||"default"))!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}(n,"string"),typeof n=="symbol"?n:String(n)}function W(n,i){return new Promise(function(r,s){var t=new Image;t.onload=function(){return r(t)},t.onerror=s,!((s=n)!==null&&s.match(/^\s*data:([a-z]+\/[a-z]+(;[a-z-]+=[a-z-]+)?)?(;base64)?,[a-z0-9!$&',()*+;=\-._~:@/?%\s]*\s*$/i))&&i&&(t.crossOrigin=i),t.src=n})}var z,J=["scale","rotate","image","border","borderRadius","width","height","position","color","backgroundColor","style","crossOrigin","onLoadFailure","onLoadSuccess","onImageReady","onImageChange","onMouseUp","onMouseMove","onPositionChange","disableBoundaryChecks","disableHiDPIScaling","disableCanvasRotation"],A=!(typeof window>"u"||typeof navigator>"u"||!("ontouchstart"in window||0<navigator.msMaxTouchPoints)),G=typeof File<"u",O={touch:{react:{down:"onTouchStart",mouseDown:"onMouseDown",drag:"onTouchMove",move:"onTouchMove",mouseMove:"onMouseMove",up:"onTouchEnd",mouseUp:"onMouseUp"},native:{down:"touchstart",mouseDown:"mousedown",drag:"touchmove",move:"touchmove",mouseMove:"mousemove",up:"touchend",mouseUp:"mouseup"}},desktop:{react:{down:"onMouseDown",drag:"onDragOver",move:"onMouseMove",up:"onMouseUp"},native:{down:"mousedown",drag:"dragStart",move:"mousemove",up:"mouseup"}}},F=A?O.touch:O.desktop,S=typeof window<"u"&&window.devicePixelRatio?window.devicePixelRatio:1,H={x:.5,y:.5},O=function(n){var i=s;if(typeof n!="function"&&n!==null)throw new TypeError("Super expression must either be null or a function");i.prototype=Object.create(n&&n.prototype,{constructor:{value:i,writable:!0,configurable:!0}}),Object.defineProperty(i,"prototype",{writable:!1}),n&&U(i,n);var r=X(s);function s(t){var e;if(this instanceof s)return m(y(e=r.call(this,t)),"state",{drag:!1,my:null,mx:null,image:H}),m(y(e),"handleImageReady",function(o){var a=e.getInitialSize(o.width,o.height);a.resource=o,a.x=.5,a.y=.5,a.backgroundColor=e.props.backgroundColor,e.setState({drag:!1,image:a},e.props.onImageReady),e.props.onLoadSuccess(a)}),m(y(e),"clearImage",function(){e.canvas.getContext("2d").clearRect(0,0,e.canvas.width,e.canvas.height),e.setState({image:H})}),m(y(e),"handleMouseDown",function(o){(o=o||window.event).preventDefault(),e.setState({drag:!0,mx:null,my:null})}),m(y(e),"handleMouseUp",function(){e.state.drag&&(e.setState({drag:!1}),e.props.onMouseUp())}),m(y(e),"handleMouseMove",function(o){var a,u,l,h,d,f,v,p,E,w;o=o||window.event,e.state.drag!==!1&&(o.preventDefault(),a={mx:u=o.targetTouches?o.targetTouches[0].pageX:o.clientX,my:l=o.targetTouches?o.targetTouches[0].pageY:o.clientY},w=e.props.rotate,w=(w%=360)<0?360+w:w,e.state.mx&&e.state.my&&(u=e.state.mx-u,l=e.state.my-l,h=e.state.image.width*e.props.scale,d=e.state.image.height*e.props.scale,f=(p=e.getCroppingRect()).x,p=p.y,f*=h,p*=d,E=function(K){return K*(Math.PI/180)},v=Math.cos(E(w)),E=p+-u*(p=Math.sin(E(w)))+l*v,w={x:(f+u*v+l*p)/h+1/e.props.scale*e.getXScale()/2,y:E/d+1/e.props.scale*e.getYScale()/2},e.props.onPositionChange(w),a.image=x(x({},e.state.image),w)),e.setState(a),e.props.onMouseMove(o))}),m(y(e),"setCanvas",function(o){e.canvas=o}),e.canvas=null,e;throw new TypeError("Cannot call a class as a function")}return i=s,(n=[{key:"componentDidMount",value:function(){this.props.disableHiDPIScaling&&(S=1);var t,e=this.canvas.getContext("2d");this.props.image&&this.loadImage(this.props.image),this.paint(e),document&&(e=!!function(){var o=!1;try{var a=Object.defineProperty({},"passive",{get:function(){o=!0}});window.addEventListener("test",a,a),window.removeEventListener("test",a,a)}catch{o=!1}return o}()&&{passive:!1},t=F.native,document.addEventListener(t.move,this.handleMouseMove,e),document.addEventListener(t.up,this.handleMouseUp,e),A)&&(document.addEventListener(t.mouseMove,this.handleMouseMove,e),document.addEventListener(t.mouseUp,this.handleMouseUp,e))}},{key:"componentDidUpdate",value:function(t,e){this.props.image&&this.props.image!==t.image||this.props.width!==t.width||this.props.height!==t.height||this.props.backgroundColor!==t.backgroundColor?this.loadImage(this.props.image):this.props.image||e.image===H||this.clearImage();var o=this.canvas.getContext("2d");o.clearRect(0,0,this.canvas.width,this.canvas.height),this.paint(o),this.paintImage(o,this.state.image,this.props.border),t.image===this.props.image&&t.width===this.props.width&&t.height===this.props.height&&t.position===this.props.position&&t.scale===this.props.scale&&t.rotate===this.props.rotate&&e.my===this.state.my&&e.mx===this.state.mx&&e.image.x===this.state.image.x&&e.image.y===this.state.image.y&&e.backgroundColor===this.state.backgroundColor||this.props.onImageChange()}},{key:"componentWillUnmount",value:function(){var t;document&&(t=F.native,document.removeEventListener(t.move,this.handleMouseMove,!1),document.removeEventListener(t.up,this.handleMouseUp,!1),A)&&(document.removeEventListener(t.mouseMove,this.handleMouseMove,!1),document.removeEventListener(t.mouseUp,this.handleMouseUp,!1))}},{key:"isVertical",value:function(){return!this.props.disableCanvasRotation&&this.props.rotate%180!=0}},{key:"getBorders",value:function(){var t=0<arguments.length&&arguments[0]!==void 0?arguments[0]:this.props.border;return Array.isArray(t)?t:[t,t]}},{key:"getDimensions",value:function(){var a=this.props,t=a.width,e=a.height,o=a.rotate,a=a.border,u={},h=N(this.getBorders(a),2),l=h[0],h=h[1],d=t,f=e;return this.isVertical()?(u.width=f,u.height=d):(u.width=d,u.height=f),u.width+=2*l,u.height+=2*h,{canvas:u,rotate:o,width:t,height:e,border:a}}},{key:"getImage",value:function(){var t=this.getCroppingRect(),e=this.state.image,o=(t.x*=e.resource.width,t.y*=e.resource.height,t.width*=e.resource.width,t.height*=e.resource.height,document.createElement("canvas")),a=(this.isVertical()?(o.width=t.height,o.height=t.width):(o.width=t.width,o.height=t.height),o.getContext("2d"));return a.translate(o.width/2,o.height/2),a.rotate(this.props.rotate*Math.PI/180),a.translate(-o.width/2,-o.height/2),this.isVertical()&&a.translate((o.width-o.height)/2,(o.height-o.width)/2),e.backgroundColor&&(a.fillStyle=e.backgroundColor,a.fillRect(-t.x,-t.y,e.resource.width,e.resource.height)),a.drawImage(e.resource,-t.x,-t.y),o}},{key:"getImageScaledToCanvas",value:function(){var e=this.getDimensions(),t=e.width,e=e.height,o=document.createElement("canvas");return this.isVertical()?(o.width=e,o.height=t):(o.width=t,o.height=e),this.paintImage(o.getContext("2d"),this.state.image,0,1),o}},{key:"getXScale",value:function(){var t=this.props.width/this.props.height,e=this.state.image.width/this.state.image.height;return Math.min(1,t/e)}},{key:"getYScale",value:function(){var t=this.props.height/this.props.width,e=this.state.image.height/this.state.image.width;return Math.min(1,t/e)}},{key:"getCroppingRect",value:function(){var o=this.props.position||{x:this.state.image.x,y:this.state.image.y},t=1/this.props.scale*this.getXScale(),e=1/this.props.scale*this.getYScale(),o={x:o.x-t/2,y:o.y-e/2,width:t,height:e},a=0,u=1-o.width,l=0,h=1-o.height;return(this.props.disableBoundaryChecks||1<t||1<e)&&(a=-o.width,l=-o.height,h=u=1),x(x({},o),{},{x:Math.max(a,Math.min(o.x,u)),y:Math.max(l,Math.min(o.y,h))})}},{key:"loadImage",value:function(t){var e;G&&t instanceof File?this.loadingImage=(e=t,new Promise(function(o,a){var u=new FileReader;u.onload=function(l){try{var h=W(l.target.result);o(h)}catch(d){a(d)}},u.readAsDataURL(e)}).then(this.handleImageReady).catch(this.props.onLoadFailure)):typeof t=="string"&&(this.loadingImage=W(t,this.props.crossOrigin).then(this.handleImageReady).catch(this.props.onLoadFailure))}},{key:"getInitialSize",value:function(t,e){var o,a,u=this.getDimensions();return e/t<u.height/u.width?a=t*((o=this.getDimensions().height)/e):o=e*((a=this.getDimensions().width)/t),{height:o,width:a}}},{key:"paintImage",value:function(t,e,o){var a=3<arguments.length&&arguments[3]!==void 0?arguments[3]:S;e.resource&&(o=this.calculatePosition(e,o),t.save(),t.translate(t.canvas.width/2,t.canvas.height/2),t.rotate(this.props.rotate*Math.PI/180),t.translate(-t.canvas.width/2,-t.canvas.height/2),this.isVertical()&&t.translate((t.canvas.width-t.canvas.height)/2,(t.canvas.height-t.canvas.width)/2),t.scale(a,a),t.globalCompositeOperation="destination-over",t.drawImage(e.resource,o.x,o.y,o.width,o.height),e.backgroundColor&&(t.fillStyle=e.backgroundColor,t.fillRect(o.x,o.y,o.width,o.height)),t.restore())}},{key:"calculatePosition",value:function(l,a){l=l||this.state.image;var a=N(this.getBorders(a),2),o=a[0],a=a[1],d=this.getCroppingRect(),u=l.width*this.props.scale,l=l.height*this.props.scale,h=-d.x*u,d=-d.y*l;return this.isVertical()?(h+=a,d+=o):(h+=o,d+=a),{x:h,y:d,height:l,width:u}}},{key:"paint",value:function(t){t.save(),t.scale(S,S),t.translate(0,0),t.fillStyle="rgba("+this.props.color.slice(0,4).join(",")+")";var e,o,a,u,l,p=this.props.borderRadius,v=this.getDimensions(),d=N(this.getBorders(v.border),2),h=d[0],d=d[1],f=v.canvas.height,v=v.canvas.width,p=Math.max(p,0);p=Math.min(p,v/2-h,f/2-d),t.beginPath(),e=t,o=v-2*(h=h),a=f-2*(d=d),(p=p)===0?e.rect(h,d,o,a):(u=o-p,l=a-p,e.translate(h,d),e.arc(p,p,p,Math.PI,1.5*Math.PI),e.lineTo(u,0),e.arc(u,p,p,1.5*Math.PI,2*Math.PI),e.lineTo(o,l),e.arc(u,l,p,2*Math.PI,.5*Math.PI),e.lineTo(p,a),e.arc(p,l,p,.5*Math.PI,Math.PI),e.translate(-h,-d)),t.rect(v,0,-v,f),t.fill("evenodd"),t.restore()}},{key:"render",value:function(){var e=this.props,t=(e.scale,e.rotate,e.image,e.border,e.borderRadius,e.width,e.height,e.position,e.color,e.backgroundColor,e.style),e=(e.crossOrigin,e.onLoadFailure,e.onLoadSuccess,e.onImageReady,e.onImageChange,e.onMouseUp,e.onMouseMove,e.onPositionChange,e.disableBoundaryChecks,e.disableHiDPIScaling,e.disableCanvasRotation,P(e,J)),a=this.getDimensions(),o={width:a.canvas.width,height:a.canvas.height,cursor:this.state.drag?"grabbing":"grab",touchAction:"none"},a={width:a.canvas.width*S,height:a.canvas.height*S,style:x(x({},o),t)};return a[F.react.down]=this.handleMouseDown,A&&(a[F.react.mouseDown]=this.handleMouseDown),T.default.createElement("canvas",L({ref:this.setCanvas},a,e))}}])&&B(i.prototype,n),Object.defineProperty(i,"prototype",{writable:!1}),s}(T.default.Component);return m(O,"propTypes",{scale:c.default.number,rotate:c.default.number,image:c.default.oneOfType([c.default.string].concat(function(n){if(Array.isArray(n))return q(n)}(z=G?[c.default.instanceOf(File)]:[])||function(n){if(typeof Symbol<"u"&&n[Symbol.iterator]!=null||n["@@iterator"]!=null)return Array.from(n)}(z)||Y(z)||function(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}())),border:c.default.oneOfType([c.default.number,c.default.arrayOf(c.default.number)]),borderRadius:c.default.number,width:c.default.number,height:c.default.number,position:c.default.shape({x:c.default.number,y:c.default.number}),color:c.default.arrayOf(c.default.number),backgroundColor:c.default.string,crossOrigin:c.default.oneOf(["","anonymous","use-credentials"]),onLoadFailure:c.default.func,onLoadSuccess:c.default.func,onImageReady:c.default.func,onImageChange:c.default.func,onMouseUp:c.default.func,onMouseMove:c.default.func,onPositionChange:c.default.func,disableBoundaryChecks:c.default.bool,disableHiDPIScaling:c.default.bool,disableCanvasRotation:c.default.bool}),m(O,"defaultProps",{scale:1,rotate:0,border:25,borderRadius:0,width:200,height:200,color:[0,0,0,.5],onLoadFailure:function(){},onLoadSuccess:function(){},onImageReady:function(){},onImageChange:function(){},onMouseUp:function(){},onMouseMove:function(){},onPositionChange:function(){},disableBoundaryChecks:!1,disableHiDPIScaling:!1,disableCanvasRotation:!0}),O})})(Z);var ae=Z.exports;const re=te(ae);function ie(b){const g=window.devicePixelRatio;return[g*b[0],g*b[1],g*b[2],g*b[3]]}class se{constructor(g){this.context=g}drawArea(g){const I=ie(g.coordinates);return this.context.lineWidth=g.width+2,this.context.strokeStyle="white",this.context.strokeRect(...I),this.context.lineWidth=g.width,this.context.strokeStyle=g.color,this.context.strokeRect(...I),this}}const k={"image-editor":"_image-editor_18nnw_2","image-editor-label":"_image-editor-label_18nnw_12","image-editor-scale":"_image-editor-scale_18nnw_18","image-editor-scale-label":"_image-editor-scale-label_18nnw_25","image-editor-scale-input":"_image-editor-scale-input_18nnw_34"},V=D.forwardRef(({image:b,canvasHeight:g,canvasWidth:I,cropBorderColor:_,cropBorderHeight:j,cropBorderWidth:c,initialPosition:T={x:.5,y:.5},maxScale:R=4},x)=>{const[B,m]=D.useState(T),L=Q(),M=D.useCallback(()=>{const P=document.querySelector("canvas"),y=P==null?void 0:P.getContext("2d");if(!y)return;new se(y).drawArea({width:0,color:_,coordinates:[c,j,I,g]})},[_,c,j,I,g]),U=D.useCallback(P=>{m(P)},[]);return C.jsxs("div",{className:k["image-editor"],children:[C.jsx(re,{border:[c,j],color:[0,0,0,.4],crossOrigin:"anonymous",height:g,image:b,onImageChange:M,onImageReady:M,onMouseMove:M,onMouseUp:M,onPositionChange:U,position:B,ref:x,scale:Number(L.values.scale),width:I}),C.jsx("label",{className:k["image-editor-label"],htmlFor:"scale",children:"Zoom"}),C.jsxs("label",{className:k["image-editor-scale"],htmlFor:"scale",children:[C.jsx("span",{className:k["image-editor-scale-label"],children:"min"}),C.jsx("span",{className:k["image-editor-scale-input"],children:C.jsx(ne,{fieldName:"scale",step:.01,max:R>1?R.toFixed(2):1,min:1,displayMinMaxValues:!1})}),C.jsx("span",{className:k["image-editor-scale-label"],children:"max"})]})]})});V.displayName="ImageEditor";const ge=V;try{V.displayName="ImageEditor",V.__docgenInfo={description:"",displayName:"ImageEditor",props:{image:{defaultValue:null,description:"",name:"image",required:!0,type:{name:"File"}},initialPosition:{defaultValue:{value:"{ x: 0.5, y: 0.5 }"},description:"",name:"initialPosition",required:!1,type:{name:"Position"}},canvasHeight:{defaultValue:null,description:"",name:"canvasHeight",required:!0,type:{name:"number"}},canvasWidth:{defaultValue:null,description:"",name:"canvasWidth",required:!0,type:{name:"number"}},cropBorderColor:{defaultValue:null,description:"",name:"cropBorderColor",required:!0,type:{name:"string"}},cropBorderHeight:{defaultValue:null,description:"",name:"cropBorderHeight",required:!0,type:{name:"number"}},cropBorderWidth:{defaultValue:null,description:"",name:"cropBorderWidth",required:!0,type:{name:"number"}},maxScale:{defaultValue:{value:"4"},description:"",name:"maxScale",required:!1,type:{name:"number"}}}}}catch{}export{ge as I};
