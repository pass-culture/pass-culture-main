import{j as e}from"./jsx-runtime-BYYWji4R.js";import{P as De}from"./reducer-DQPuV9Vk.js";import{V as Le}from"./index-EP-l6Sro.js";import{c as Be}from"./testUtils-BTdZZ4De.js";import{c as V}from"./index-DeARc5FM.js";import{r as s}from"./index-ClcD9ViR.js";import{f as ve}from"./full-trash-CEfIUI4M.js";import{B as C}from"./Button-COUp2H-B.js";import{B as j}from"./types-yVZEaApa.js";import{S as Ie}from"./SvgIcon-CyWUmZpn.js";import{C as Te}from"./ConfirmDialog-Bz4UlCE8.js";import{s as Ae}from"./stroke-trash-Cc_5v2lW.js";import{D as re,C as te}from"./DialogBuilder-6TB7q9tU.js";import{u as Me,E as We}from"./constants-D6QF3AIf.js";import{g as ke}from"./image-CI1RfRht.js";import{u as He}from"./useNotification-Hw1Ms4y_.js";import{I as Ye}from"./ImageDragAndDrop-1zTzVPWQ.js";import{f as $e,a as ze}from"./full-more-D-B0T6P8.js";import{C as Ge,a as Xe}from"./Callout-DlbDzn67.js";import{T as Je}from"./TextInput-Cn-XS-xI.js";import{S as Ke}from"./Spinner-BHztG-h6.js";import{I as Qe}from"./ImageEditor-CCNh8dZM.js";import{a as we,I as q}from"./ImagePreviewsWrapper-G1laXlNt.js";import{f as Ze}from"./full-edit-CxAaM2Fv.js";import"./chunk-D4RADZKF-nWvgSiz2.js";import"./config-BqmKEuqZ.js";import"./OfferAddressType-Co4gxJoY.js";import"./_commonjsHelpers-Cpj98o6Y.js";import"./stroke-pass-CALgybTM.js";import"./Tooltip-BpKRYYrm.js";import"./Button.module-D_4QtxUL.js";import"./stroke-error-DSZD431a.js";import"./Dialog-Baxe7ky2.js";import"./index-BUMxx5F6.js";import"./tslib.es6-BUas5LQb.js";import"./stroke-close-DnlFsd1c.js";import"./index-BH3dreXg.js";import"./index-Chjiymov.js";import"./full-validate-CbMNulkZ.js";import"./stroke-picture-VF2OicDu.js";import"./full-info-C4RdBA4U.js";import"./full-warning-LoKhBeYn.js";import"./full-link-CYVo23DH.js";import"./full-next-B_76kGmE.js";import"./ButtonLink-DpsuGtQB.js";import"./BaseInput-BI1b_EYZ.js";import"./FieldError-azuIsM2E.js";import"./FieldLayoutCharacterCount-CTPArH5Q.js";import"./index.module-DF6qn1Ex.js";import"./Slider-D8sIjjnx.js";var r=(a=>(a.OFFER="offer",a.OFFER_COLLECTIVE="offer_collective",a.VENUE="venue",a))(r||{});const ie=""+new URL("sample-image-landscape-B4GmPBHc.jpg",import.meta.url).href,oe=""+new URL("sample-image-portrait-OorsIixL.jpg",import.meta.url).href,ea={"button-image-delete-icon":"_button-image-delete-icon_ooh4c_1"},H=({isLoading:a,onConfirm:t,onDismiss:i,isDialogOpen:n,trigger:o})=>e.jsx(Te,{cancelText:"Retour",confirmText:"Supprimer",icon:Ae,isLoading:a,onCancel:i,onConfirm:t,title:"Supprimer l’image",open:n,trigger:o,children:"Souhaitez-vous vraiment supprimer cette image ?"});try{H.displayName="ModalImageDelete",H.__docgenInfo={description:"",displayName:"ModalImageDelete",props:{isLoading:{defaultValue:null,description:"",name:"isLoading",required:!0,type:{name:"boolean"}},onConfirm:{defaultValue:null,description:"",name:"onConfirm",required:!0,type:{name:"() => void"}},onDismiss:{defaultValue:null,description:"",name:"onDismiss",required:!0,type:{name:"() => void"}},isDialogOpen:{defaultValue:null,description:"",name:"isDialogOpen",required:!0,type:{name:"boolean"}},trigger:{defaultValue:null,description:"",name:"trigger",required:!0,type:{name:"ReactNode"}}}}}catch{}const Y=({onImageDelete:a})=>{const[t,i]=s.useState(!1),[n,o]=s.useState(!1),c=()=>{o(!0),a()};return e.jsx(H,{isLoading:n,onConfirm:c,onDismiss:()=>i(!1),isDialogOpen:t,trigger:e.jsxs(C,{onClick:()=>i(!0),variant:j.TERNARY,children:[e.jsx(Ie,{alt:"",className:ea["button-image-delete-icon"],src:ve}),"Supprimer"]})})};try{Y.displayName="ButtonImageDelete",Y.__docgenInfo={description:"",displayName:"ButtonImageDelete",props:{onImageDelete:{defaultValue:null,description:"",name:"onImageDelete",required:!0,type:{name:"() => void"}}}}}catch{}const aa=async(a,t="image.jpg")=>{const n=await(await fetch(a)).blob();return new File([n],t,{type:n.type})},ra=a=>{const[t,i]=s.useState(0),[n,o]=s.useState(0);return s.useEffect(()=>{(async()=>{if(a){const l=await ke(a);l&&(i(l.width),o(l.height))}})()},[a]),a?{width:t,height:n}:{width:0,height:0}},R=(a,t)=>a+t/2,ta=a=>100/(a*100),ia=""+new URL("offer-home-shell-Ch3YT9j3.png",import.meta.url).href,oa=""+new URL("offer-shell-coq2oAbe.png",import.meta.url).href,le={"image-preview-shell":"_image-preview-shell_1yqyc_1","image-preview-home-preview":"_image-preview-home-preview_1yqyc_7"},k={"image-preview-shell":"_image-preview-shell_8f82l_1","image-preview-blur-offer-preview":"_image-preview-blur-offer-preview_8f82l_7","image-preview-offer-preview":"_image-preview-offer-preview_8f82l_16"},$=({imageUrl:a})=>e.jsxs(we,{children:[e.jsxs(q,{title:"Page d’accueil",children:[e.jsx("img",{alt:"",className:le["image-preview-shell"],src:ia,role:"presentation"}),e.jsx("img",{"data-testid":"app-preview-offer-img-home",alt:"",className:le["image-preview-home-preview"],src:a,role:"presentation"})]}),e.jsxs(q,{title:"Détails de l’offre",children:[e.jsx("img",{alt:"",className:k["image-preview-blur-offer-preview"],src:a,role:"presentation"}),e.jsx("img",{alt:"",className:k["image-preview-shell"],src:oa,role:"presentation"}),e.jsx("img",{"data-testid":"app-preview-offer-img",alt:"",className:k["image-preview-offer-preview"],src:a,role:"presentation"})]})]});try{$.displayName="AppPreviewOffer",$.__docgenInfo={description:"",displayName:"AppPreviewOffer",props:{imageUrl:{defaultValue:null,description:"",name:"imageUrl",required:!0,type:{name:"string"}}}}}catch{}const la=""+new URL("partner-home-shell-QX5a1P1s.png",import.meta.url).href,na=""+new URL("partner-shell-D59I5gaY.png",import.meta.url).href,ne={"image-preview-shell":"_image-preview-shell_nl6jv_1","image-preview-home-preview":"_image-preview-home-preview_nl6jv_7"},se={"image-preview-shell":"_image-preview-shell_19ta7_1","image-preview-offer-preview":"_image-preview-offer-preview_19ta7_7"},z=({imageUrl:a})=>e.jsxs(we,{children:[e.jsxs(q,{title:"Page d’accueil",children:[e.jsx("img",{alt:"",className:ne["image-preview-shell"],src:la,role:"presentation"}),e.jsx("img",{"data-testid":"app-preview-offer-img-home",alt:"",className:ne["image-preview-home-preview"],src:a,role:"presentation"})]}),e.jsxs(q,{title:"Détails de l’offre",children:[e.jsx("img",{alt:"",className:se["image-preview-shell"],src:na,role:"presentation"}),e.jsx("img",{"data-testid":"app-preview-offer-img",alt:"",className:se["image-preview-offer-preview"],src:a,role:"presentation"})]})]});try{z.displayName="AppPreviewVenue",z.__docgenInfo={description:"",displayName:"AppPreviewVenue",props:{imageUrl:{defaultValue:null,description:"",name:"imageUrl",required:!0,type:{name:"string"}}}}}catch{}const p={"modal-image-crop":"_modal-image-crop_131l0_1","modal-image-crop-content":"_modal-image-crop-content_131l0_8","modal-image-crop-subwrapper":"_modal-image-crop-subwrapper_131l0_11","modal-image-crop-editor":"_modal-image-crop-editor_131l0_22","modal-image-crop-editor-loading":"_modal-image-crop-editor-loading_131l0_30","modal-image-crop-callout":"_modal-image-crop-callout_131l0_33","modal-image-crop-callout-list":"_modal-image-crop-callout-list_131l0_36","modal-image-crop-actions":"_modal-image-crop-actions_131l0_40","modal-image-crop-right":"_modal-image-crop-right_131l0_47","modal-image-crop-credit":"_modal-image-crop-credit_131l0_53","modal-image-crop-credit-loading":"_modal-image-crop-credit-loading_131l0_57","modal-image-crop-footer":"_modal-image-crop-footer_131l0_60"},sa=({originalDimensions:a,orientation:t})=>t==="landscape"?{width:Math.floor(Math.min(a.width,a.height/2*3)),height:Math.floor(Math.min(a.height,a.width/3*2))}:{width:Math.floor(Math.min(a.width,a.height/3*2)),height:Math.floor(Math.min(a.height,a.width/2*3))},ma=(a,t,i)=>{const n={[r.OFFER]:400,[r.OFFER_COLLECTIVE]:400,[r.VENUE]:600}[i],{width:o}=sa({originalDimensions:{width:a,height:t},orientation:i===r.VENUE?"landscape":"portrait"}),c=Math.min(4,(o-10)/n),l={[r.OFFER]:297,[r.OFFER_COLLECTIVE]:297,[r.VENUE]:138}[i];return{[r.OFFER]:{canvasHeight:l,canvasWidth:l*2/3,cropBorderColor:"#FFF",cropBorderHeight:50,cropBorderWidth:105,maxScale:c},[r.OFFER_COLLECTIVE]:{canvasHeight:l,canvasWidth:l*2/3,cropBorderColor:"#FFF",cropBorderHeight:50,cropBorderWidth:105,maxScale:c},[r.VENUE]:{canvasHeight:l,canvasWidth:l*3/2,cropBorderColor:"#FFF",cropBorderHeight:40,cropBorderWidth:100,maxScale:c}}[i]},G=({mode:a,onImageUpload:t,onImageDelete:i,initialValues:n={},...o})=>{const{logEvent:c}=Me(),{draftImage:l,...f}=n,d={x:.5,y:.5},{originalImageUrl:h,credit:_,cropParams:v}=f,I=h,{xCropPercent:N,yCropPercent:U,heightCropPercent:J,widthCropPercent:F}=v||{},xe=N&&F?R(N,F):d.x,Ce=U&&J?R(U,J):d.y,w=s.useRef(null),L=He(),[B,K]=s.useState(!0),[u,O]=s.useState(l),[Q,Z]=s.useState(I),[Ee,ee]=s.useState({x:xe,y:Ce}),[T,ae]=s.useState(_??""),[je,Ve]=s.useState(F?ta(F):1),{width:A,height:M}=ra(u),Ne=ma(A,M,a),Ue=a===r.OFFER&&(A&&A<400||M&&M<600),Fe={[r.VENUE]:z,[r.OFFER]:$,[r.OFFER_COLLECTIVE]:()=>e.jsx(e.Fragment,{})}[a];s.useEffect(()=>{async function m(y){try{O(await aa(y))}catch{L.error("Erreur lors de la récupération de votre image.")}}I&&m(I)},[I,L]),s.useEffect(()=>{O(l)},[l]);const Oe=()=>{O(void 0),ee({x:d.x,y:d.y}),ae(""),Ve(1)},Re=m=>{K(!0),O(m),W()},Se=(m,y,g)=>{u&&(c(We.CLICKED_SAVE_IMAGE,{imageType:a,imageCreationStage:"save"}),t({imageFile:u,imageCroppedDataUrl:y,cropParams:g,credit:m}))},be=()=>{if(w.current){const m=w.current.getImage();Z(m.toDataURL()),K(!1)}},W=m=>{try{if(w.current){const y=w.current.getImage();Z(y.toDataURL());const g=w.current.getCroppingRect();ee({x:R(g.x,g.width),y:R(g.y,g.height)}),m&&m(T,y.toDataURL(),g)}}catch{L.error("Une erreur est survenue. Merci de réessayer plus tard")}},Pe=()=>W(),qe=()=>W(Se);return e.jsx(re,{...o,title:"Modifier une image",variant:"drawer",children:e.jsxs("form",{className:p["modal-image-crop"],children:[e.jsxs("div",{className:p["modal-image-crop-content"],children:[e.jsx("p",{className:p["modal-image-crop-right"],children:"En utilisant ce contenu, je certifie que je suis propriétaire ou que je dispose des autorisations nécessaires pour l’utilisation de celui-ci."}),u&&e.jsxs(e.Fragment,{children:[B&&e.jsx(Ke,{}),e.jsxs("div",{className:V(p["modal-image-crop-subwrapper"],B&&p["modal-image-crop-editor-loading"]),children:[e.jsxs("div",{className:p["modal-image-crop-editor"],children:[e.jsx(Qe,{ref:w,...Ne,image:u,initialPosition:Ee,initialScale:je,onChangeDone:Pe,onImagePainted:be}),e.jsxs("div",{className:p["modal-image-crop-actions"],children:[e.jsx(C,{icon:$e,onClick:Oe,variant:j.TERNARY,children:"Remplacer l’image"}),e.jsx(te,{asChild:!0,children:e.jsx(C,{icon:ve,onClick:i,variant:j.TERNARY,children:"Supprimer l’image"})})]})]}),Q&&e.jsx(Fe,{imageUrl:Q})]}),Ue&&e.jsx(Ge,{className:p["modal-image-crop-callout"],variant:Xe.WARNING,children:e.jsxs("div",{children:["La qualité de votre image n’est pas optimale.",e.jsx("br",{}),"Le format recommandé :",e.jsxs("ul",{className:p["modal-image-crop-callout-list"],children:[e.jsx("li",{children:"Largeur minimale de l’image : 400 px"}),e.jsx("li",{children:"Hauteur minimale de l’image : 600 px"})]})]})}),e.jsx(Je,{count:T.length,className:V(p["modal-image-crop-credit"],B&&p["modal-image-crop-credit-loading"]),label:"Crédit de l’image",maxLength:255,value:T,onChange:m=>ae(m.target.value),name:"credit",type:"text"})]}),!u&&e.jsx(Ye,{onDropOrSelected:Re,...a!==r.OFFER?{minSizes:{width:600,height:400}}:{}})]}),e.jsx(re.Footer,{children:e.jsxs("div",{className:p["modal-image-crop-footer"],children:[e.jsx(te,{asChild:!0,children:e.jsx(C,{variant:j.SECONDARY,children:"Annuler"})}),e.jsx(C,{type:"submit",onClick:m=>{m.preventDefault(),qe()},disabled:!u,children:"Enregistrer"})]})})]})})};try{G.displayName="ModalImageUpsertOrEdit",G.__docgenInfo={description:"",displayName:"ModalImageUpsertOrEdit",props:{mode:{defaultValue:null,description:"",name:"mode",required:!0,type:{name:"enum",value:[{value:'"offer"'},{value:'"offer_collective"'},{value:'"venue"'}]}},onImageUpload:{defaultValue:null,description:"",name:"onImageUpload",required:!0,type:{name:"(values: OnImageUploadArgs) => void"}},onImageDelete:{defaultValue:null,description:"",name:"onImageDelete",required:!1,type:{name:"(() => void)"}},initialValues:{defaultValue:{value:"{}"},description:"",name:"initialValues",required:!1,type:{name:"UploadImageValues"}},className:{defaultValue:null,description:"Custom CSS class for additional styling of the dialog content.",name:"className",required:!1,type:{name:"string"}},title:{defaultValue:null,description:"The heading title of the dialog.",name:"title",required:!1,type:{name:"string"}},variant:{defaultValue:null,description:"",name:"variant",required:!1,type:{name:"enum",value:[{value:'"default"'},{value:'"drawer"'}]}},trigger:{defaultValue:null,description:"The trigger element that opens the dialog.",name:"trigger",required:!1,type:{name:"ReactNode"}},open:{defaultValue:null,description:"Controls the open state of the dialog.",name:"open",required:!1,type:{name:"boolean"}},closeButtonClassName:{defaultValue:null,description:"Custom CSS class for additional styling of the close button.",name:"closeButtonClassName",required:!1,type:{name:"string"}},defaultOpen:{defaultValue:{value:"false"},description:"Determines if the dialog is open by default.",name:"defaultOpen",required:!1,type:{name:"boolean"}},onOpenChange:{defaultValue:null,description:"Callback function triggered when the open state of the dialog changes.",name:"onOpenChange",required:!1,type:{name:"((open: boolean) => void)"}},refToFocusOnClose:{defaultValue:null,description:`Ref of the element to focus on when the dialog is closed.
If refToFocusOnClose.current is null, the trigger element will be focused as a fallback.`,name:"refToFocusOnClose",required:!1,type:{name:"RefObject<HTMLElement>"}}}}}catch{}const ca="_label_1wm17_22",pa="_icon_1wm17_35",E={"button-image-add":"_button-image-add_1wm17_1","add-image-venue":"_add-image-venue_1wm17_14","add-image-offer":"_add-image-offer_1wm17_18",label:ca,icon:pa},D=({mode:a,initialValues:t={},onImageUpload:i,onImageDelete:n,onClickButtonImage:o,children:c,disableForm:l})=>{const{imageUrl:f,originalImageUrl:d}=t,[h,_]=s.useState(!1),v=()=>{o&&o()},I=()=>{n()};function N(U){i(U),_(!1)}return e.jsx(G,{mode:a,onImageUpload:N,onImageDelete:I,initialValues:t,onOpenChange:_,open:h,trigger:f||d?e.jsx(C,{onClick:v,variant:j.TERNARY,"aria-label":"Modifier l’image",icon:Ze,children:c??"Modifier"}):e.jsx("button",{className:V(E["button-image-add"],{[E["add-image-venue"]]:a===r.VENUE,[E["add-image-offer"]]:a===r.OFFER||a===r.OFFER_COLLECTIVE}),onClick:v,type:"button",disabled:l,children:e.jsxs(e.Fragment,{children:[e.jsx(Ie,{src:ze,alt:"",className:E.icon}),e.jsx("span",{className:E.label,children:"Ajouter une image"})]})})})};try{D.displayName="ButtonImageEdit",D.__docgenInfo={description:"",displayName:"ButtonImageEdit",props:{onImageUpload:{defaultValue:null,description:"",name:"onImageUpload",required:!0,type:{name:"(values: OnImageUploadArgs) => void"}},onImageDelete:{defaultValue:null,description:"",name:"onImageDelete",required:!0,type:{name:"() => void"}},initialValues:{defaultValue:{value:"{}"},description:"",name:"initialValues",required:!1,type:{name:"UploadImageValues"}},mode:{defaultValue:null,description:"",name:"mode",required:!0,type:{name:"enum",value:[{value:'"offer"'},{value:'"offer_collective"'},{value:'"venue"'}]}},onClickButtonImage:{defaultValue:null,description:"",name:"onClickButtonImage",required:!1,type:{name:"(() => void)"}},disableForm:{defaultValue:null,description:"",name:"disableForm",required:!1,type:{name:"boolean"}}}}}catch{}const x={"image-uploader-image-container":"_image-uploader-image-container_1gu1i_5","image-uploader-actions-container":"_image-uploader-actions-container_1gu1i_10","actions-wrapper":"_actions-wrapper_1gu1i_17","image-preview":"_image-preview_1gu1i_25","preview-venue":"_preview-venue_1gu1i_31","preview-offer":"_preview-offer_1gu1i_41"},X=({className:a,onImageUpload:t,onImageDelete:i,initialValues:n={},mode:o,onClickButtonImageAdd:c,hideActionButtons:l=!1,disableForm:f=!1})=>{const{imageUrl:d,originalImageUrl:h,credit:_,cropParams:v}=n;return e.jsx("div",{className:V(x["image-uploader-image-container"],a),children:d&&h?e.jsxs(e.Fragment,{children:[e.jsx("img",{alt:"Prévisualisation de l’image","data-testid":"image-preview",className:V(x["image-preview"],{[x["preview-venue"]]:o===r.VENUE,[x["preview-offer"]]:o===r.OFFER||o===r.OFFER_COLLECTIVE}),src:d}),!l&&e.jsx("div",{className:x["image-uploader-actions-container"],children:e.jsxs("div",{className:x["actions-wrapper"],children:[e.jsx(D,{mode:o,initialValues:{originalImageUrl:h,imageUrl:d,credit:_,cropParams:v},onImageUpload:t,onImageDelete:i,onClickButtonImage:c,disableForm:f}),e.jsx(Y,{onImageDelete:i})]})})]}):e.jsx(D,{mode:o,onImageUpload:t,onImageDelete:i,onClickButtonImage:c,disableForm:f})})};try{X.displayName="ImageUploader",X.__docgenInfo={description:"",displayName:"ImageUploader",props:{className:{defaultValue:null,description:"",name:"className",required:!1,type:{name:"string"}},onImageUpload:{defaultValue:null,description:"",name:"onImageUpload",required:!0,type:{name:"(values: OnImageUploadArgs) => void"}},onImageDelete:{defaultValue:null,description:"",name:"onImageDelete",required:!0,type:{name:"() => void"}},initialValues:{defaultValue:{value:"{}"},description:"",name:"initialValues",required:!1,type:{name:"UploadImageValues"}},mode:{defaultValue:null,description:"",name:"mode",required:!0,type:{name:"enum",value:[{value:'"offer"'},{value:'"offer_collective"'},{value:'"venue"'}]}},onClickButtonImageAdd:{defaultValue:null,description:"",name:"onClickButtonImageAdd",required:!1,type:{name:"(() => void)"}},hideActionButtons:{defaultValue:{value:"false"},description:"",name:"hideActionButtons",required:!1,type:{name:"boolean"}},disableForm:{defaultValue:{value:"false"},description:"",name:"disableForm",required:!1,type:{name:"boolean"}}}}}catch{}const sr={title:"components/ImageUploader/ImageUploader",component:X,decorators:[Le,a=>e.jsx(De,{store:Be({}),children:e.jsx(a,{})})]},ye={initialValues:{originalImageUrl:oe,imageUrl:oe,credit:"John Do",cropParams:{xCropPercent:0,yCropPercent:0,heightCropPercent:1,widthCropPercent:1}},mode:r.OFFER,onImageDelete:()=>{alert("onDelete have been called.")},onImageUpload:()=>{alert("onImageUpload have been called.")}},S={args:{...ye}},b={args:{...ye,initialValues:{imageUrl:ie,originalImageUrl:ie},mode:r.VENUE}},P={args:{mode:r.OFFER}};var me,ce,pe;S.parameters={...S.parameters,docs:{...(me=S.parameters)==null?void 0:me.docs,source:{originalSource:`{
  args: {
    ...props
  }
}`,...(pe=(ce=S.parameters)==null?void 0:ce.docs)==null?void 0:pe.source}}};var de,ue,ge;b.parameters={...b.parameters,docs:{...(de=b.parameters)==null?void 0:de.docs,source:{originalSource:`{
  args: {
    ...props,
    initialValues: {
      imageUrl: sampleImageLandscape,
      originalImageUrl: sampleImageLandscape
    },
    mode: UploaderModeEnum.VENUE
  }
}`,...(ge=(ue=b.parameters)==null?void 0:ue.docs)==null?void 0:ge.source}}};var fe,he,_e;P.parameters={...P.parameters,docs:{...(fe=P.parameters)==null?void 0:fe.docs,source:{originalSource:`{
  args: {
    mode: UploaderModeEnum.OFFER
  }
}`,...(_e=(he=P.parameters)==null?void 0:he.docs)==null?void 0:_e.source}}};const mr=["WithImageOffer","WithImageVenue","WithoutImage"];export{S as WithImageOffer,b as WithImageVenue,P as WithoutImage,mr as __namedExportsOrder,sr as default};
