import{j as l}from"./jsx-runtime-DF2Pcvd1.js";import{c as F}from"./index-DeARc5FM.js";import{r as n}from"./index-B2-qRKKC.js";import{B as Z}from"./BaseInput-JKfrEs2s.js";import{F as ee}from"./FieldLayout-BEXDM75v.js";import{s as te}from"./stroke-down-Co3p5GaP.js";import{S as ne}from"./SvgIcon-DfLnDDE5.js";const O=()=>{},le="_menu_i2qn5_1",R={menu:le,"menu--no-results":"_menu--no-results_i2qn5_14","options-item":"_options-item_i2qn5_17","option-hovered":"_option-hovered_i2qn5_35"},D=({className:i,fieldName:v,selectedValue:a,filteredOptions:b,setHoveredOptionIndex:_,listRef:j,hoveredOptionIndex:c,selectOption:S})=>l.jsxs("div",{className:F(R.menu,i),role:"listbox",children:[b.length===0&&l.jsx("span",{className:R["menu--no-results"],children:"Aucun résultat"}),l.jsx("ul",{"data-testid":"list",id:`list-${v}`,ref:j,role:"listbox",children:b.map(({value:f,label:w},h)=>{const q=a===String(f);return l.jsx("li",{"aria-selected":q,"aria-posinset":h+1,"aria-setsize":b.length,className:c===h?R["option-hovered"]:"","data-value":f,"data-selected":q,id:`option-display-${f}`,onMouseEnter:()=>_(h),onFocus:()=>_(h),role:"option",tabIndex:-1,children:l.jsx("span",{onClick:()=>{S(String(f))},className:F(R["options-item"]),children:w})},`option-display-${f}`)})})]});try{D.displayName="OptionsList",D.__docgenInfo={description:"",displayName:"OptionsList",props:{className:{defaultValue:null,description:"",name:"className",required:!1,type:{name:"string"}},fieldName:{defaultValue:null,description:"",name:"fieldName",required:!0,type:{name:"string"}},selectedValue:{defaultValue:null,description:"",name:"selectedValue",required:!0,type:{name:"string | null"}},filteredOptions:{defaultValue:null,description:"",name:"filteredOptions",required:!0,type:{name:"SelectOption[]"}},setHoveredOptionIndex:{defaultValue:null,description:"",name:"setHoveredOptionIndex",required:!0,type:{name:"(value: number | null) => void"}},listRef:{defaultValue:null,description:"",name:"listRef",required:!0,type:{name:"Ref<HTMLUListElement>"}},hoveredOptionIndex:{defaultValue:null,description:"",name:"hoveredOptionIndex",required:!0,type:{name:"number | null"}},selectOption:{defaultValue:null,description:"",name:"selectOption",required:!0,type:{name:"(value: string) => void"}}}}}catch{}const E={"multi-select-autocomplete-container":"_multi-select-autocomplete-container_1dyyc_2","multi-select-autocomplete-placeholder-input":"_multi-select-autocomplete-placeholder-input_1dyyc_8","field-overlay":"_field-overlay_1dyyc_31","visually-hidden":"_visually-hidden_1dyyc_36"},ae={"dropdown-indicator":"_dropdown-indicator_wtpbe_1"},B=({disabled:i,isOpen:v,toggleField:a})=>l.jsx("button",{onClick:a,className:ae["dropdown-indicator"],type:"button",disabled:i,children:l.jsx(ne,{src:te,alt:`${v?"Masquer":"Afficher"} les options`,width:"20"})});try{B.displayName="Toggle",B.__docgenInfo={description:"",displayName:"Toggle",props:{disabled:{defaultValue:null,description:"",name:"disabled",required:!0,type:{name:"boolean"}},isOpen:{defaultValue:null,description:"",name:"isOpen",required:!0,type:{name:"boolean"}},toggleField:{defaultValue:null,description:"",name:"toggleField",required:!0,type:{name:"() => void"}}}}}catch{}const T=n.forwardRef(({className:i,disabled:v=!1,name:a,hideArrow:b,isOptional:_=!1,label:j,options:c,resetOnOpen:S=!0,description:f,error:w,onChange:h=()=>O,onBlur:q=()=>O,value:N,onSearch:J=()=>O,searchInOptions:P=(y,p)=>y.filter(x=>x.label.toLowerCase().includes(p.trim().toLowerCase())),onReset:Q=()=>O},L)=>{var U,G;const[y,p]=n.useState(""),[x,$]=n.useState(N??""),[r,u]=n.useState(!1),[s,d]=n.useState(null),k=n.useRef(),M=n.useRef(),H=n.useRef(!1),I=n.useRef(null),C=n.useRef(null),A=n.useRef(null),W=n.useRef(null);n.useEffect(()=>{k.current=new Map(c.map(({label:e,value:t})=>[t,e])),M.current=new Map(c.map(({label:e,value:t})=>[e,t]))},[c]),n.useEffect(()=>{S&&r&&($(""),p(""),Q())},[r,S]),n.useEffect(()=>{const e=t=>{var o;(o=I.current)!=null&&o.contains(t.target)||u(!1)};return I.current&&document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[I]),n.useEffect(()=>{if(d(null),!H.current){H.current=!0;return}J(y.trim())},[y]);const m=P(c,y),X=e=>{var t,o;switch(e.key){case"ArrowUp":if(s!==null)if(s<=0)d(null);else{const V=s-1;d(V);const g=(t=A.current)==null?void 0:t.getElementsByTagName("li")[V];g==null||g.scrollIntoView({block:"nearest"})}r||u(!0);break;case"ArrowDown":if(s===null)m.length>0&&d(0);else{const V=Math.min(m.length-1,s+1);d(V);const g=(o=A.current)==null?void 0:o.getElementsByTagName("li")[V];g==null||g.scrollIntoView({block:"nearest"})}r||u(!0);break;case" ":case"Enter":r&&s!==null&&m[s]&&(e.preventDefault(),m[s]&&z(String(m[s].value)));break;case"Escape":d(null),u(!1);break;case"Tab":d(null),u(!1);break}},z=e=>{var t;$(e),p(((t=k.current)==null?void 0:t.get(e))??""),h({type:"change",target:{name:a,value:e}}),q({type:"blur",target:{name:a,value:e}}),u(!1),d(null)},K=()=>{r||u(!0)},Y=()=>{r?(u(!1),p("")):u(!0)};return n.useEffect(()=>{var t,o;const e=(N||L&&((t=C.current)==null?void 0:t.value))??"";p(((o=k.current)==null?void 0:o.get(e))??e),$(e)},[C,N,L]),n.useImperativeHandle(L,()=>C.current),l.jsx(ee,{className:i,error:w,isOptional:_,label:j,name:a,showError:!!w,description:f,children:l.jsxs("div",{className:F(E["multi-select-autocomplete-container"],i),onKeyDown:X,ref:I,children:[l.jsx(Z,{...s!==null&&{"aria-activedescendant":`option-display-${(U=m[s])==null?void 0:U.value}`},onClick:K,onFocus:K,className:E["multi-select-autocomplete-placeholder-input"],hasError:!!w,type:"search",disabled:v,"aria-autocomplete":"list","aria-controls":`list-${a}`,"aria-describedby":`help-${a}`,"aria-expanded":r,"aria-haspopup":"listbox","aria-required":!_,role:"combobox",value:y,autoComplete:"off",ref:C,name:a,onChange:e=>{p(e.target.value),h({type:"change",target:{name:a,value:e.target.value}})},onBlur:e=>{var o;p(e.target.value);const t=((o=M.current)==null?void 0:o.get(e.target.value))??"";q({type:"blur",target:{name:a,value:t}})}}),l.jsxs("div",{"aria-live":"polite","aria-relevant":"text",className:E["visually-hidden"],id:`help-${a}`,children:[x!==""&&`Option sélectionnée : ${((G=c.find(e=>e.value===N))==null?void 0:G.label)??""}. `,r?`${m.length} options ${y===""?"disponibles. ":"correspondant au texte saisi. "}`:"Saisissez du texte pour afficher et filtrer les options."]}),l.jsx("select",{hidden:!0,ref:W,value:x||"",onChange:()=>O,"data-testid":"select",name:a,children:c.map(({label:e,value:t})=>l.jsx("option",{value:t,children:e},`option-${t}`))}),l.jsxs("div",{className:E["field-overlay"],children:[!b&&l.jsx(B,{disabled:v,isOpen:r,toggleField:Y}),r&&l.jsx(D,{className:i,fieldName:a,selectedValue:x,filteredOptions:m,setHoveredOptionIndex:d,listRef:A,hoveredOptionIndex:s,selectOption:z})]})]})})});T.displayName="SelectAutocomplete";try{T.displayName="SelectAutocomplete",T.__docgenInfo={description:"",displayName:"SelectAutocomplete",props:{name:{defaultValue:null,description:"Name of the field, used for form submission and accessibility",name:"name",required:!0,type:{name:"string"}},label:{defaultValue:null,description:"Label displayed above the input",name:"label",required:!0,type:{name:"string | Element"}},options:{defaultValue:null,description:"List of available options",name:"options",required:!0,type:{name:"SelectOption[]"}},description:{defaultValue:null,description:"Helper text displayed below the input",name:"description",required:!1,type:{name:"string"}},disabled:{defaultValue:{value:"false"},description:"Disables the input and prevents interaction",name:"disabled",required:!1,type:{name:"boolean"}},isOptional:{defaultValue:{value:"false"},description:"Indicates if the field is optional",name:"isOptional",required:!1,type:{name:"boolean"}},className:{defaultValue:null,description:"Additional CSS class names",name:"className",required:!1,type:{name:"string"}},error:{defaultValue:null,description:"Error message to display",name:"error",required:!1,type:{name:"string"}},hideArrow:{defaultValue:null,description:"Hides the dropdown arrow",name:"hideArrow",required:!1,type:{name:"boolean"}},onChange:{defaultValue:{value:"() => noop"},description:"Called when the selected value changes",name:"onChange",required:!1,type:{name:'((e: CustomEvent<"change">) => void)'}},onBlur:{defaultValue:{value:"() => noop"},description:"Called when the input loses focus",name:"onBlur",required:!1,type:{name:'((e: CustomEvent<"blur">) => void)'}},value:{defaultValue:null,description:"Value of the input",name:"value",required:!1,type:{name:"string"}},onSearch:{defaultValue:{value:"() => noop"},description:"Called when the search input changes",name:"onSearch",required:!1,type:{name:"((pattern: string) => void)"}},searchInOptions:{defaultValue:{value:`(options, pattern) =>
        options.filter((opt) =>
          opt.label.toLowerCase().includes(pattern.trim().toLowerCase())
        )`},description:"Custom function to filter options based on search pattern",name:"searchInOptions",required:!1,type:{name:"((options: SelectOption[], pattern: string) => SelectOption[])"}},resetOnOpen:{defaultValue:{value:"true"},description:"Resets the input value when dropdown opens.",name:"resetOnOpen",required:!1,type:{name:"boolean"}},onReset:{defaultValue:{value:"() => noop"},description:"Called when the input is reset.\n(cannot be provided when `resetOnOpen` is `false`)",name:"onReset",required:!1,type:{name:"(() => void)"}}}}}catch{}export{T as S};
