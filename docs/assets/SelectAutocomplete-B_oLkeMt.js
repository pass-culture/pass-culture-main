import{j as a}from"./jsx-runtime-BamZ1YLs.js";import{c as I}from"./index-CXqfzRSR.js";import{r as t}from"./iframe-BPRh6fz6.js";import{n as x}from"./noop-BjFrJKj1.js";import{F as Q}from"./FieldLayout-BaiqEGX2.js";import{s as W}from"./stroke-down-Co3p5GaP.js";import{S as X}from"./SvgIcon-CfcMznBC.js";const Y="_menu_1xaag_1",N={menu:Y,"menu--no-results":"_menu--no-results_1xaag_14","options-item":"_options-item_1xaag_17","option-hovered":"_option-hovered_1xaag_35"},$=({className:o,fieldName:y,selectedValue:n,filteredOptions:g,setHoveredOptionIndex:v,listRef:C,hoveredOptionIndex:d,selectOption:V})=>a.jsxs("div",{className:I(N.menu,o),role:"listbox",children:[g.length===0&&a.jsx("span",{className:N["menu--no-results"],children:"Aucun résultat"}),a.jsx("ul",{"data-testid":"list",id:`list-${y}`,ref:C,role:"listbox",children:g.map(({value:m,label:_},f)=>{const b=n===String(m);return a.jsx("li",{"aria-selected":b,"aria-posinset":f+1,"aria-setsize":g.length,className:d===f?N["option-hovered"]:"","data-value":m,"data-selected":b,id:`option-display-${m}`,onMouseEnter:()=>v(f),onFocus:()=>v(f),role:"option",tabIndex:-1,children:a.jsx("span",{onClick:()=>{V(String(m))},className:I(N["options-item"]),children:_})},`option-display-${m}`)})})]});try{$.displayName="OptionsList",$.__docgenInfo={description:"",displayName:"OptionsList",props:{className:{defaultValue:null,description:"",name:"className",required:!1,type:{name:"string"}},fieldName:{defaultValue:null,description:"",name:"fieldName",required:!0,type:{name:"string"}},selectedValue:{defaultValue:null,description:"",name:"selectedValue",required:!0,type:{name:"string | null"}},filteredOptions:{defaultValue:null,description:"",name:"filteredOptions",required:!0,type:{name:"SelectOption[]"}},setHoveredOptionIndex:{defaultValue:null,description:"",name:"setHoveredOptionIndex",required:!0,type:{name:"(value: number | null) => void"}},listRef:{defaultValue:null,description:"",name:"listRef",required:!0,type:{name:"Ref<HTMLUListElement>"}},hoveredOptionIndex:{defaultValue:null,description:"",name:"hoveredOptionIndex",required:!0,type:{name:"number | null"}},selectOption:{defaultValue:null,description:"",name:"selectOption",required:!0,type:{name:"(value: string) => void"}}}}}catch{}const q={"multi-select-autocomplete-container":"_multi-select-autocomplete-container_skpwe_2","multi-select-autocomplete-placeholder-input":"_multi-select-autocomplete-placeholder-input_skpwe_8","has-error":"_has-error_skpwe_49","field-overlay":"_field-overlay_skpwe_76","visually-hidden":"_visually-hidden_skpwe_81"},Z={"dropdown-indicator":"_dropdown-indicator_wtpbe_1"},A=({disabled:o,isOpen:y,toggleField:n})=>a.jsx("button",{onClick:n,className:Z["dropdown-indicator"],type:"button",disabled:o,children:a.jsx(X,{src:W,alt:`${y?"Masquer":"Afficher"} les options`,width:"20"})});try{A.displayName="Toggle",A.__docgenInfo={description:"",displayName:"Toggle",props:{disabled:{defaultValue:null,description:"",name:"disabled",required:!0,type:{name:"boolean"}},isOpen:{defaultValue:null,description:"",name:"isOpen",required:!0,type:{name:"boolean"}},toggleField:{defaultValue:null,description:"",name:"toggleField",required:!0,type:{name:"() => void"}}}}}catch{}const F=t.forwardRef(({className:o,disabled:y=!1,name:n,hideArrow:g,required:v=!0,label:C,options:d,resetOnOpen:V=!0,description:m,error:_,onChange:f=()=>x,onBlur:b=()=>x,value:O,onSearch:M=()=>x,searchInOptions:z=(h,c)=>h.filter(w=>w.label.toLowerCase().includes(c.trim().toLowerCase())),onReset:K=()=>x},R)=>{const[h,c]=t.useState(""),[w,j]=t.useState(O??""),[s,i]=t.useState(!1),[r,u]=t.useState(null),k=t.useRef(),D=t.useRef(),H=t.useRef(!1),S=t.useRef(null),E=t.useRef(null),L=t.useRef(null),U=t.useRef(null);t.useEffect(()=>{k.current=new Map(d.map(({label:e,value:l})=>[l,e])),D.current=new Map(d.map(({label:e,value:l})=>[e,l]))},[d]),t.useEffect(()=>{V&&s&&(j(""),c(""),K())},[s,V]),t.useEffect(()=>{const e=l=>{S.current?.contains(l.target)||i(!1)};return S.current&&document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[S]),t.useEffect(()=>{if(u(null),!H.current){H.current=!0;return}M(h.trim())},[h]);const p=z(d,h),G=e=>{switch(e.key){case"ArrowUp":if(r!==null)if(r<=0)u(null);else{const l=r-1;u(l),L.current?.getElementsByTagName("li")[l]?.scrollIntoView({block:"nearest"})}s||i(!0);break;case"ArrowDown":if(r===null)p.length>0&&u(0);else{const l=Math.min(p.length-1,r+1);u(l),L.current?.getElementsByTagName("li")[l]?.scrollIntoView({block:"nearest"})}s||i(!0);break;case" ":case"Enter":s&&r!==null&&p[r]&&(e.preventDefault(),p[r]&&B(String(p[r].value)));break;case"Escape":u(null),i(!1);break;case"Tab":u(null),i(!1);break}},B=e=>{j(e),c(k.current?.get(e)??""),f({type:"change",target:{name:n,value:e}}),b({type:"blur",target:{name:n,value:e}}),i(!1),u(null)},T=()=>{s||i(!0)},J=()=>{s?(i(!1),c("")):i(!0)};return t.useEffect(()=>{const e=(O||R&&E.current?.value)??"";c(k.current?.get(e)??e),j(e)},[E,O,R]),t.useImperativeHandle(R,()=>E.current),a.jsx(Q,{className:o,error:_,required:v,label:C,name:n,showError:!!_,description:m,children:a.jsxs("div",{className:I(q["multi-select-autocomplete-container"],o),onKeyDown:G,ref:S,children:[a.jsx("input",{...r!==null&&{"aria-activedescendant":`option-display-${p[r]?.value}`},onClick:T,onFocus:T,className:I(q["multi-select-autocomplete-placeholder-input"],{[q["has-error"]]:!!_}),type:"search",disabled:y,"aria-autocomplete":"list","aria-controls":`list-${n}`,"aria-describedby":`help-${n}`,id:n,"aria-expanded":s,"aria-haspopup":"listbox","aria-required":v,role:"combobox",value:h,autoComplete:"off",ref:E,name:n,onChange:e=>{c(e.target.value),f({type:"change",target:{name:n,value:e.target.value}})},onBlur:e=>{c(e.target.value);const l=D.current?.get(e.target.value)??"";b({type:"blur",target:{name:n,value:l}})}}),a.jsxs("div",{"aria-live":"polite","aria-relevant":"text",className:q["visually-hidden"],id:`help-${n}`,children:[w!==""&&`Option sélectionnée : ${d.find(e=>e.value===O)?.label??""}. `,s?`${p.length} options ${h===""?"disponibles. ":"correspondant au texte saisi. "}`:"Saisissez du texte pour afficher et filtrer les options."]}),a.jsx("select",{hidden:!0,ref:U,value:w||"",onChange:()=>x,"data-testid":"select",name:n,children:d.map(({label:e,value:l})=>a.jsx("option",{value:l,children:e},`option-${l}`))}),a.jsxs("div",{className:q["field-overlay"],children:[!g&&a.jsx(A,{disabled:y,isOpen:s,toggleField:J}),s&&a.jsx($,{className:o,fieldName:n,selectedValue:w,filteredOptions:p,setHoveredOptionIndex:u,listRef:L,hoveredOptionIndex:r,selectOption:B})]})]})})});F.displayName="SelectAutocomplete";try{F.displayName="SelectAutocomplete",F.__docgenInfo={description:"",displayName:"SelectAutocomplete",props:{name:{defaultValue:null,description:"Name of the field, used for form submission and accessibility",name:"name",required:!0,type:{name:"string"}},label:{defaultValue:null,description:"Label displayed above the input",name:"label",required:!0,type:{name:"string | Element"}},options:{defaultValue:null,description:"List of available options",name:"options",required:!0,type:{name:"SelectOption[]"}},description:{defaultValue:null,description:"Helper text displayed below the input",name:"description",required:!1,type:{name:"string"}},disabled:{defaultValue:{value:"false"},description:"Disables the input and prevents interaction",name:"disabled",required:!1,type:{name:"boolean"}},required:{defaultValue:{value:"true"},description:"Indicates if the field is required",name:"required",required:!1,type:{name:"boolean"}},className:{defaultValue:null,description:"Additional CSS class names",name:"className",required:!1,type:{name:"string"}},error:{defaultValue:null,description:"Error message to display",name:"error",required:!1,type:{name:"string"}},hideArrow:{defaultValue:null,description:"Hides the dropdown arrow",name:"hideArrow",required:!1,type:{name:"boolean"}},onChange:{defaultValue:{value:"() => noop"},description:"Called when the selected value changes",name:"onChange",required:!1,type:{name:'((e: CustomEvent<"change">) => void)'}},onBlur:{defaultValue:{value:"() => noop"},description:"Called when the input loses focus",name:"onBlur",required:!1,type:{name:'((e: CustomEvent<"blur">) => void)'}},value:{defaultValue:null,description:"Value of the input",name:"value",required:!1,type:{name:"string"}},onSearch:{defaultValue:{value:"() => noop"},description:"Called when the search input changes",name:"onSearch",required:!1,type:{name:"((pattern: string) => void)"}},searchInOptions:{defaultValue:{value:`(options, pattern) =>
        options.filter((opt) =>
          opt.label.toLowerCase().includes(pattern.trim().toLowerCase())
        )`},description:"Custom function to filter options based on search pattern",name:"searchInOptions",required:!1,type:{name:"((options: SelectOption[], pattern: string) => SelectOption[])"}},resetOnOpen:{defaultValue:{value:"true"},description:"Resets the input value when dropdown opens.",name:"resetOnOpen",required:!1,type:{name:"boolean"}},onReset:{defaultValue:{value:"() => noop"},description:"Called when the input is reset.\n(cannot be provided when `resetOnOpen` is `false`)",name:"onReset",required:!1,type:{name:"(() => void)"}}}}}catch{}export{F as S};
