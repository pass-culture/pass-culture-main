import{j as a}from"./jsx-runtime-Nms4Y4qS.js";import{c as qe,d as Z,b as Ne}from"./formik.esm-azLDPAli.js";import{c as z}from"./index-BpvXyOxN.js";import{r as p}from"./index-BwDkhjyp.js";import{B as Oe}from"./BaseInput-BdBSAuUR.js";import{F as we}from"./FieldLayout-DFUhlL9V.js";import{B as Le,b as Se}from"./BaseCheckbox-HTB2_SfB.js";import{s as Ae}from"./stroke-close-C6KSko98.js";import{S as de}from"./SvgIcon-Cibea2Sc.js";import{s as je}from"./stroke-down-DYCZHAeS.js";import"./_commonjsHelpers-BosuxZz1.js";import"./full-clear-CvNWe6Ae.js";import"./full-close-DkqMqJw6.js";import"./Button-D9ATVrwc.js";import"./stroke-pass-C0Oiu4_F.js";import"./Tooltip-BlE0xOXH.js";import"./useTooltipProps-DNYEmy4z.js";import"./Button.module-B0CH5SHY.js";import"./types-DjX_gQD6.js";import"./FieldError-Bi9PL_lG.js";import"./stroke-error-BKdTEWJV.js";const ee=e=>e.trim().toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,""),ke=(e,s,t)=>{const r=[];for(let o=0;o<e.length&&!(t&&r.length>=t);o++){const m=e[o].normalizedLabel??ee(e[o].label);ee(s||"").split(" ").every(d=>m.includes(d))&&r.push(e[o])}return r},Ie=e=>typeof e=="string"?e:"",Fe=(e,s,t="s")=>{let r,o;const m=e.slice(-1)[0];return m==="s"||m==="x"?(o=e.slice(0,-1),r=e):(o=e,r=`${e}${t}`),s>1?r:o},$e=(e,s,t)=>e.split(" ").map(r=>Fe(r,s,t)).join(" "),Te=(e,s,t)=>`${new Intl.NumberFormat("fr-FR").format(e)} ${$e(s,e,t)}`,Re="_menu_wsfns_1",Ee="_label_wsfns_19",j={menu:Re,"menu--no-results":"_menu--no-results_wsfns_15",label:Ee,"too-many-options":"_too-many-options_wsfns_20","option-hovered":"_option-hovered_wsfns_29"},P=({className:e,fieldName:s,selectedValues:t,filteredOptions:r,setHoveredOptionIndex:o,listRef:m,hoveredOptionIndex:O,selectOption:d,multi:f,maxDisplayedOptions:l})=>{const c=l?r.slice(0,l):r;return a.jsxs("div",{className:z(j.menu,e),role:"listbox",children:[r.length===0&&a.jsx("span",{className:j["menu--no-results"],children:"Aucun résultat"}),a.jsx("ul",{"data-testid":"list",id:`list-${s}`,ref:m,role:"listbox",children:c.map(({value:y,label:L},w)=>{const S=(t||[]).includes(String(y));return a.jsx("li",{"aria-selected":S,"aria-posinset":w+1,"aria-setsize":c.length,className:O===w?j["option-hovered"]:"","data-value":y,"data-selected":S,id:`option-display-${y}`,onMouseEnter:()=>o(w),onFocus:()=>o(w),role:"option",tabIndex:-1,children:f?a.jsx(Le,{label:L,checked:S,onChange:()=>{d(String(y))}}):a.jsx("span",{onClick:()=>{d(String(y))},className:z(Se["base-checkbox-label"],j.label),children:L})},`option-display-${y}`)})}),a.jsx("div",{role:"status",children:l&&c.length<r.length&&a.jsxs("div",{className:j["too-many-options"],children:[Te(l,"résultat")," maximum. Veuillez affiner votre recherche"]})})]})};try{P.displayName="OptionsList",P.__docgenInfo={description:"",displayName:"OptionsList",props:{className:{defaultValue:null,description:"",name:"className",required:!1,type:{name:"string"}},fieldName:{defaultValue:null,description:"",name:"fieldName",required:!0,type:{name:"string"}},selectedValues:{defaultValue:null,description:"",name:"selectedValues",required:!0,type:{name:"string | string[] | null"}},filteredOptions:{defaultValue:null,description:"",name:"filteredOptions",required:!0,type:{name:"SelectOption[]"}},setHoveredOptionIndex:{defaultValue:null,description:"",name:"setHoveredOptionIndex",required:!0,type:{name:"(value: number | null) => void"}},listRef:{defaultValue:null,description:"",name:"listRef",required:!0,type:{name:"Ref<HTMLUListElement>"}},hoveredOptionIndex:{defaultValue:null,description:"",name:"hoveredOptionIndex",required:!0,type:{name:"number | null"}},selectOption:{defaultValue:null,description:"",name:"selectOption",required:!0,type:{name:"(value: string) => void"}},multi:{defaultValue:null,description:"",name:"multi",required:!0,type:{name:"boolean"}},maxDisplayedOptions:{defaultValue:null,description:"",name:"maxDisplayedOptions",required:!1,type:{name:"number"}}}}}catch{}const Ce="_pellet_znmfy_15",R={"multi-select-autocomplete-container":"_multi-select-autocomplete-container_znmfy_1","multi-select-autocomplete-placeholder-input":"_multi-select-autocomplete-placeholder-input_znmfy_7","field-overlay":"_field-overlay_znmfy_11",pellet:Ce},Be="_tag_1ug40_8",k={"multi-select-autocomplete-tags":"_multi-select-autocomplete-tags_1ug40_1",tag:Be,"tag-close-button":"_tag-close-button_1ug40_27","tag-close-button--disabled":"_tag-close-button--disabled_1ug40_38","tag-close-button-icon":"_tag-close-button-icon_1ug40_41"},H=({disabled:e,fieldName:s,optionsLabelById:t,selectedOptions:r,removeOption:o})=>{const m=p.useRef(null);function O(d,f){var c;const l=(c=m.current)==null?void 0:c.getElementsByTagName("button");l!=null&&l[f+1]?l[f+1].focus():l!=null&&l[f-1]&&l[f-1].focus(),o(d)}return a.jsx("ul",{className:k["multi-select-autocomplete-tags"],ref:m,children:r.map((d,f)=>a.jsx("li",{className:k.tag,children:a.jsxs("button",{className:z(k["tag-close-button"],{[k["tag-close-button--disabled"]]:e}),onClick:()=>O(d,f),title:"Supprimer "+t[d],type:"button",disabled:e,children:[t[d],a.jsx(de,{src:Ae,alt:"Supprimer "+t[d],className:k["tag-close-button-icon"]})]})},`tag-${s}-${d}`))})};try{H.displayName="SelectedValuesTags",H.__docgenInfo={description:"",displayName:"SelectedValuesTags",props:{disabled:{defaultValue:null,description:"",name:"disabled",required:!0,type:{name:"boolean"}},fieldName:{defaultValue:null,description:"",name:"fieldName",required:!0,type:{name:"string"}},optionsLabelById:{defaultValue:null,description:"",name:"optionsLabelById",required:!0,type:{name:"Record<string, string>"}},selectedOptions:{defaultValue:null,description:"",name:"selectedOptions",required:!0,type:{name:"string[]"}},removeOption:{defaultValue:null,description:"",name:"removeOption",required:!0,type:{name:"(value: string) => void"}}}}}catch{}const ze={"dropdown-indicator":"_dropdown-indicator_2pwsx_1"},W=({disabled:e,isOpen:s,toggleField:t})=>a.jsx("button",{onClick:t,className:ze["dropdown-indicator"],type:"button",disabled:e,children:a.jsx(de,{src:je,alt:`${s?"Masquer":"Afficher"} les options`,width:"20"})});try{W.displayName="Toggle",W.__docgenInfo={description:"",displayName:"Toggle",props:{disabled:{defaultValue:null,description:"",name:"disabled",required:!0,type:{name:"boolean"}},isOpen:{defaultValue:null,description:"",name:"isOpen",required:!0,type:{name:"boolean"}},toggleField:{defaultValue:null,description:"",name:"toggleField",required:!0,type:{name:"() => void"}}}}}catch{}const K=({className:e,disabled:s=!1,name:t,hideArrow:r,hideFooter:o=!1,hideTags:m=!1,inline:O,isOptional:d=!1,label:f,multi:l=!1,options:c,placeholder:y,pluralLabel:L,smallLabel:w=!1,resetOnOpen:S=!0,description:ce,onSearch:pe=()=>{},searchInOptions:me=(I,_)=>I.filter(n=>n.label.toLowerCase().includes(_.trim().toLowerCase())),onReset:fe=()=>{},type:ge="text",leftIcon:G,maxDisplayedOptions:he})=>{var X;const{setFieldTouched:I,setFieldValue:_}=qe(),[n,F]=Z(t),[V,ye]=Z(`search-${t}`),[g,b]=p.useState(null),[$,be]=p.useState({}),T=p.useRef(null),M=p.useRef(null),J=p.useRef(null),[h,v]=p.useState(!1),[x,ve]=p.useState(c);p.useEffect(()=>{const i=async()=>{await _(`search-${t}`,"",!1),await _(t,l?[]:"",!1),fe()};h&&S&&V.value!==""&&i()},[h]),p.useEffect(()=>{be(c.reduce((i,u)=>(i[u.value]=u.label,i),{}))},[c]),p.useEffect(()=>{const i=u=>{var q;(q=T.current)!=null&&q.contains(u.target)||v(!1)};return T.current&&document.addEventListener("mousedown",i),()=>{document.removeEventListener("mousedown",i)}},[T]),p.useEffect(()=>{pe(V.value.trim()),b(null)},[V.value]),p.useEffect(()=>{ve(me(c,V.value))},[V.value,c]);const _e=async i=>{var u,q,Y;switch(i.key){case"ArrowUp":if(g!==null)if(g<=0)b(null);else{const A=g-1;b(A);const N=(u=M.current)==null?void 0:u.getElementsByTagName("li")[A];N==null||N.scrollIntoView({block:"nearest"})}h||v(!0);break;case"ArrowDown":if(g===null)x.length>0&&b(0);else{const A=Math.min(x.length-1,g+1);b(A);const N=(q=M.current)==null?void 0:q.getElementsByTagName("li")[A];N==null||N.scrollIntoView({block:"nearest"})}h||v(!0);break;case" ":case"Enter":h&&g!==null&&x[g]&&(i.preventDefault(),await D(String(x[g].value)));break;case"Escape":(Y=J.current)==null||Y.focus(),b(null),v(!1);break;case"Tab":b(null),v(!1);break}},D=async i=>{let u;l?n.value.includes(i)&&Array.isArray(n.value)?u=n.value.filter(q=>q!==i):u=[...n.value,i]:(u=i,v(!1),b(null),await _(`search-${t}`,$[u],!1)),await _(t,u)},Ve=async()=>{h||v(!0),await I(t,!0)},Q=async()=>{h?(v(!1),await _(`search-${t}`,"",!1)):v(!0),await I(t,!0)},xe=Array.isArray(n.value)?y??(n.value.length>1&&L?L:f):y??$[n.value];return a.jsxs(we,{className:e,error:F.error,hideFooter:!m&&o,isOptional:d,label:f,name:`search-${t}`,showError:F.touched&&!!F.error,smallLabel:w,inline:O,description:ce,children:[a.jsxs("div",{className:z(R["multi-select-autocomplete-container"],e),onKeyDown:_e,ref:T,children:[a.jsx(Oe,{...g!==null&&{"aria-activedescendant":`option-display-${(X=x[g])==null?void 0:X.value}`},onFocus:Ve,placeholder:Ie(xe),style:{paddingLeft:l&&n.value.length>0||G?"2.2rem":"1rem"},className:R["multi-select-autocomplete-placeholder-input"],hasError:ye.touched&&!!F.error,type:ge,disabled:s,...V,"aria-autocomplete":"list","aria-controls":`list-${t}`,"aria-describedby":`help-${t}`,"aria-expanded":h,"aria-haspopup":"listbox","aria-required":!d,role:"combobox",leftIcon:G,ref:J}),a.jsxs("div",{"aria-live":"polite","aria-relevant":"text",className:"visually-hidden",id:`help-${t}`,children:[l&&`${n.value.length} options sélectionnées`,!l&&!Array.isArray(n.value)&&n.value!==""&&`Option sélectionnée : ${$[n.value]}`,h?`${x.length} options ${V.value===""?"disponibles":"correspondant au texte saisi"}`:"saisissez du texte pour afficher et filtrer les options"]}),a.jsx("select",{hidden:!0,...l&&{multiple:!0},...n,value:n.value||"","data-testid":"select",children:c.map(({label:i,value:u})=>a.jsx("option",{value:u,children:i},`option-${u}`))}),a.jsxs("div",{className:R["field-overlay"],children:[!r&&a.jsx(W,{disabled:s,isOpen:h,toggleField:Q}),l&&n.value.length>0&&a.jsx("div",{onClick:Q,className:R.pellet,children:n.value.length}),h&&a.jsx(P,{className:e,fieldName:t,selectedValues:n.value,filteredOptions:x,setHoveredOptionIndex:b,listRef:M,hoveredOptionIndex:g,selectOption:D,multi:l,maxDisplayedOptions:he})]})]}),Array.isArray(n.value)&&!m&&n.value.length>0&&a.jsx(H,{disabled:s,fieldName:t,optionsLabelById:$,selectedOptions:n.value,removeOption:D})]})};try{K.displayName="SelectAutocomplete",K.__docgenInfo={description:"",displayName:"SelectAutocomplete",props:{label:{defaultValue:null,description:"",name:"label",required:!0,type:{name:"string | Element"}},name:{defaultValue:null,description:"",name:"name",required:!0,type:{name:"string"}},description:{defaultValue:null,description:"",name:"description",required:!1,type:{name:"string"}},maxLength:{defaultValue:null,description:"",name:"maxLength",required:!1,type:{name:"number"}},isLabelHidden:{defaultValue:null,description:"",name:"isLabelHidden",required:!1,type:{name:"boolean"}},hasLabelLineBreak:{defaultValue:null,description:"",name:"hasLabelLineBreak",required:!1,type:{name:"boolean"}},isOptional:{defaultValue:{value:"false"},description:"",name:"isOptional",required:!1,type:{name:"boolean"}},showMandatoryAsterisk:{defaultValue:null,description:"",name:"showMandatoryAsterisk",required:!1,type:{name:"boolean"}},className:{defaultValue:null,description:"",name:"className",required:!1,type:{name:"string"}},classNameLabel:{defaultValue:null,description:"",name:"classNameLabel",required:!1,type:{name:"string"}},classNameFooter:{defaultValue:null,description:"",name:"classNameFooter",required:!1,type:{name:"string"}},classNameInput:{defaultValue:null,description:"",name:"classNameInput",required:!1,type:{name:"string"}},filterVariant:{defaultValue:null,description:"",name:"filterVariant",required:!1,type:{name:"boolean"}},smallLabel:{defaultValue:{value:"false"},description:"",name:"smallLabel",required:!1,type:{name:"boolean"}},hideFooter:{defaultValue:{value:"false"},description:"",name:"hideFooter",required:!1,type:{name:"boolean"}},inline:{defaultValue:null,description:"",name:"inline",required:!1,type:{name:"boolean"}},clearButtonProps:{defaultValue:null,description:"",name:"clearButtonProps",required:!1,type:{name:'(ButtonHTMLAttributes<HTMLButtonElement> & { tooltip: string; display?: "clear" | "close"; })'}},ErrorDetails:{defaultValue:null,description:"",name:"ErrorDetails",required:!1,type:{name:"ReactNode"}},disabled:{defaultValue:{value:"false"},description:"",name:"disabled",required:!1,type:{name:"boolean"}},hideArrow:{defaultValue:null,description:"",name:"hideArrow",required:!1,type:{name:"boolean"}},hideTags:{defaultValue:{value:"false"},description:"",name:"hideTags",required:!1,type:{name:"boolean"}},maxHeight:{defaultValue:null,description:"",name:"maxHeight",required:!1,type:{name:"number"}},multi:{defaultValue:{value:"false"},description:"",name:"multi",required:!1,type:{name:"boolean"}},options:{defaultValue:null,description:"",name:"options",required:!0,type:{name:"SelectOption[]"}},placeholder:{defaultValue:null,description:"",name:"placeholder",required:!1,type:{name:"string"}},pluralLabel:{defaultValue:null,description:"",name:"pluralLabel",required:!1,type:{name:"string"}},resetOnOpen:{defaultValue:{value:"true"},description:"",name:"resetOnOpen",required:!1,type:{name:"boolean"}},onSearch:{defaultValue:{value:"() => {}"},description:"",name:"onSearch",required:!1,type:{name:"((pattern: string) => void)"}},searchInOptions:{defaultValue:{value:`(options, pattern) =>
    options.filter((opt) =>
      opt.label.toLowerCase().includes(pattern.trim().toLowerCase())
    )`},description:"",name:"searchInOptions",required:!1,type:{name:"((options: SelectOption[], pattern: string) => SelectOption[])"}},onReset:{defaultValue:{value:"() => {}"},description:"",name:"onReset",required:!1,type:{name:"(() => void)"}},type:{defaultValue:{value:"text"},description:"",name:"type",required:!1,type:{name:"enum",value:[{value:'"search"'},{value:'"text"'}]}},leftIcon:{defaultValue:null,description:"",name:"leftIcon",required:!1,type:{name:"string"}},maxDisplayedOptions:{defaultValue:null,description:"",name:"maxDisplayedOptions",required:!1,type:{name:"number"}}}}}catch{}const Me=e=>a.jsx(Ne,{initialValues:e.initialValues,onSubmit:()=>{},children:a.jsx(K,{...e})}),ut={title:"ui-kit/forms/SelectAutocomplete",component:Me},U={pluralLabel:"Départements",name:"departement",options:[{value:"01",label:"Ain"},{value:"02",label:"Aisne"},{value:"03",label:"Allier"},{value:"04",label:"Alpes-de-Haute-Provence test de libellé très long"},{value:"05",label:"Hautes-Alpes"},{value:"06",label:"Alpes-Maritimes"},{value:"07",label:"Ardèche"},{value:"08",label:"Ardennes"},{value:"09",label:"Ariège"},{value:"10",label:"Aube"},{value:"11",label:"Aude"},{value:"12",label:"Aveyron"},{value:"13",label:"Bouches-du-Rhône"},{value:"14",label:"Calvados"},{value:"15",label:"Cantal"}],initialValues:{departement:"01","search-departement":""},label:"Département",hideFooter:!1,hideTags:!1,isOptional:!1,smallLabel:!1,searchInOptions:ke},E={args:{...U}},C={args:{...U,multi:!0,initialValues:{departement:["01","02"],"search-departement":""}}},B={args:{...U,multi:!0,initialValues:{departement:["01","02"],"search-departement":""},hideTags:!0}};var te,ae,le;E.parameters={...E.parameters,docs:{...(te=E.parameters)==null?void 0:te.docs,source:{originalSource:`{
  args: {
    ...defaultProps
  }
}`,...(le=(ae=E.parameters)==null?void 0:ae.docs)==null?void 0:le.source}}};var ne,re,se;C.parameters={...C.parameters,docs:{...(ne=C.parameters)==null?void 0:ne.docs,source:{originalSource:`{
  args: {
    ...defaultProps,
    multi: true,
    initialValues: {
      departement: ['01', '02'],
      'search-departement': ''
    }
  }
}`,...(se=(re=C.parameters)==null?void 0:re.docs)==null?void 0:se.source}}};var ie,oe,ue;B.parameters={...B.parameters,docs:{...(ie=B.parameters)==null?void 0:ie.docs,source:{originalSource:`{
  args: {
    ...defaultProps,
    multi: true,
    initialValues: {
      departement: ['01', '02'],
      'search-departement': ''
    },
    hideTags: true
  }
}`,...(ue=(oe=B.parameters)==null?void 0:oe.docs)==null?void 0:ue.source}}};const dt=["Default","Multi","WithoutTags"];export{E as Default,C as Multi,B as WithoutTags,dt as __namedExportsOrder,ut as default};
