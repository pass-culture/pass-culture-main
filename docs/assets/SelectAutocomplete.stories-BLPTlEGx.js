import{j as a}from"./jsx-runtime-CfatFE5O.js";import{a as Le,u as ee,F as Fe}from"./formik.esm-DyanDbCL.js";import{c as I}from"./index-DeARc5FM.js";import{r as d}from"./index-ClcD9ViR.js";import{B as je}from"./BaseInput-CQqD6LQv.js";import{F as Se}from"./FieldLayout-hOWU3bse.js";import{B as ke}from"./BaseCheckbox-C8RX0ig6.js";import{s as Ie}from"./stroke-close-DnlFsd1c.js";import{S as de}from"./SvgIcon-B6esR8Vf.js";import{s as $e}from"./stroke-down-Co3p5GaP.js";import"./_commonjsHelpers-Cpj98o6Y.js";import"./full-clear-Q4kCtSRL.js";import"./full-close-5Oxr7nnd.js";import"./Button-B0q_wITZ.js";import"./stroke-pass-CALgybTM.js";import"./Tooltip-CPMX2zM9.js";import"./useTooltipProps-C5TDwaI9.js";import"./Button.module-Dtkn584L.js";import"./types-DjX_gQD6.js";import"./FieldError-Bb6I73np.js";import"./stroke-error-DSZD431a.js";const te=e=>e.trim().toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,""),Te=(e,c,i)=>{const t=[];for(let o=0;o<e.length&&!(i&&t.length>=i);o++){const y=e[o].normalizedLabel??te(e[o].label);te(c||"").split(" ").every(_=>y.includes(_))&&t.push(e[o])}return t},Ce=(e,c,i="s")=>{let t,o;const y=e.slice(-1)[0];return y==="s"||y==="x"?(o=e.slice(0,-1),t=e):(o=e,t=`${e}${i}`),c>1?t:o},Ee=(e,c,i)=>e.split(" ").map(t=>Ce(t,c,i)).join(" "),Re=(e,c,i)=>`${new Intl.NumberFormat("fr-FR").format(e)} ${Ee(c,e,i)}`,Me="_menu_1o8o9_1",Be="_label_1o8o9_23",De="_input_1o8o9_30",w={menu:Me,"menu--no-results":"_menu--no-results_1o8o9_15","options-item":"_options-item_1o8o9_18","too-many-options":"_too-many-options_1o8o9_19",label:Be,input:De,"option-hovered":"_option-hovered_1o8o9_33"},H=({className:e,fieldName:c,selectedValues:i,filteredOptions:t,setHoveredOptionIndex:o,listRef:y,hoveredOptionIndex:v,selectOption:_,multi:h,maxDisplayedOptions:p})=>{const l=p?t.slice(0,p):t;return a.jsxs("div",{className:I(w.menu,e),role:"listbox",children:[t.length===0&&a.jsx("span",{className:w["menu--no-results"],children:"Aucun résultat"}),a.jsx("ul",{"data-testid":"list",id:`list-${c}`,ref:y,role:"listbox",children:l.map(({value:u,label:$},A)=>{const F=(i||[]).includes(String(u));return a.jsx("li",{"aria-selected":F,"aria-posinset":A+1,"aria-setsize":l.length,className:v===A?w["option-hovered"]:"","data-value":u,"data-selected":F,id:`option-display-${u}`,onMouseEnter:()=>o(A),onFocus:()=>o(A),role:"option",tabIndex:-1,children:h?a.jsx(ke,{label:$,checked:F,onChange:()=>{_(String(u))},labelClassName:w.label,inputClassName:w.input}):a.jsx("span",{onClick:()=>{_(String(u))},className:I(w["options-item"]),children:$})},`option-display-${u}`)})}),a.jsx("div",{role:"status",children:p&&l.length<t.length&&a.jsxs("div",{className:w["too-many-options"],children:[Re(p,"résultat")," maximum. Veuillez affiner votre recherche"]})})]})};try{H.displayName="OptionsList",H.__docgenInfo={description:"",displayName:"OptionsList",props:{className:{defaultValue:null,description:"",name:"className",required:!1,type:{name:"string"}},fieldName:{defaultValue:null,description:"",name:"fieldName",required:!0,type:{name:"string"}},selectedValues:{defaultValue:null,description:"",name:"selectedValues",required:!0,type:{name:"string | string[] | null"}},filteredOptions:{defaultValue:null,description:"",name:"filteredOptions",required:!0,type:{name:"SelectOption[]"}},setHoveredOptionIndex:{defaultValue:null,description:"",name:"setHoveredOptionIndex",required:!0,type:{name:"(value: number | null) => void"}},listRef:{defaultValue:null,description:"",name:"listRef",required:!0,type:{name:"Ref<HTMLUListElement>"}},hoveredOptionIndex:{defaultValue:null,description:"",name:"hoveredOptionIndex",required:!0,type:{name:"number | null"}},selectOption:{defaultValue:null,description:"",name:"selectOption",required:!0,type:{name:"(value: string) => void"}},multi:{defaultValue:null,description:"",name:"multi",required:!0,type:{name:"boolean"}},maxDisplayedOptions:{defaultValue:null,description:"",name:"maxDisplayedOptions",required:!1,type:{name:"number"}}}}}catch{}const Pe="_pellet_1jeev_15",S={"multi-select-autocomplete-container":"_multi-select-autocomplete-container_1jeev_1","multi-select-autocomplete-placeholder-input":"_multi-select-autocomplete-placeholder-input_1jeev_7","field-overlay":"_field-overlay_1jeev_11",pellet:Pe,"visually-hidden":"_visually-hidden_1jeev_34"},ze="_tag_1tqr9_8",k={"multi-select-autocomplete-tags":"_multi-select-autocomplete-tags_1tqr9_1",tag:ze,"tag-close-button":"_tag-close-button_1tqr9_24","tag-close-button--disabled":"_tag-close-button--disabled_1tqr9_35","tag-close-button-icon":"_tag-close-button-icon_1tqr9_38"},W=({disabled:e,fieldName:c,optionsLabelById:i,selectedOptions:t,removeOption:o,className:y})=>{const v=d.useRef(null);function _(h,p){var u;const l=(u=v.current)==null?void 0:u.getElementsByTagName("button");l!=null&&l[p+1]?l[p+1].focus():l!=null&&l[p-1]&&l[p-1].focus(),o(h)}return a.jsx("ul",{className:I(k["multi-select-autocomplete-tags"],y),ref:v,children:t.map((h,p)=>a.jsx("li",{className:k.tag,children:a.jsxs("button",{"aria-label":`Supprimer ${i[h]}`,className:I(k["tag-close-button"],{[k["tag-close-button--disabled"]]:e}),onClick:()=>_(h,p),type:"button",disabled:e,children:[i[h],a.jsx(de,{src:Ie,alt:"",className:k["tag-close-button-icon"]})]})},`tag-${c}-${h}`))})};try{W.displayName="SelectedValuesTags",W.__docgenInfo={description:"",displayName:"SelectedValuesTags",props:{disabled:{defaultValue:null,description:"",name:"disabled",required:!0,type:{name:"boolean"}},fieldName:{defaultValue:null,description:"",name:"fieldName",required:!0,type:{name:"string"}},optionsLabelById:{defaultValue:null,description:"",name:"optionsLabelById",required:!0,type:{name:"Record<string, string>"}},selectedOptions:{defaultValue:null,description:"",name:"selectedOptions",required:!0,type:{name:"string[]"}},removeOption:{defaultValue:null,description:"",name:"removeOption",required:!0,type:{name:"(value: string) => void"}},className:{defaultValue:null,description:"",name:"className",required:!1,type:{name:"string"}}}}}catch{}const He={"dropdown-indicator":"_dropdown-indicator_hafu1_1"},K=({disabled:e,isOpen:c,toggleField:i})=>a.jsx("button",{onClick:i,className:He["dropdown-indicator"],type:"button",disabled:e,children:a.jsx(de,{src:$e,alt:`${c?"Masquer":"Afficher"} les options`,width:"20"})});try{K.displayName="Toggle",K.__docgenInfo={description:"",displayName:"Toggle",props:{disabled:{defaultValue:null,description:"",name:"disabled",required:!0,type:{name:"boolean"}},isOpen:{defaultValue:null,description:"",name:"isOpen",required:!0,type:{name:"boolean"}},toggleField:{defaultValue:null,description:"",name:"toggleField",required:!0,type:{name:"() => void"}}}}}catch{}const U=({className:e,selectedValuesTagsClassName:c,disabled:i=!1,name:t,hideArrow:o,hideFooter:y=!1,hideTags:v=!1,inline:_,isOptional:h=!1,label:p,multi:l=!1,options:u,placeholder:$,smallLabel:A=!1,resetOnOpen:F=!0,description:pe,onSearch:me=()=>{},searchInOptions:fe=(L,q)=>L.filter(n=>n.label.toLowerCase().includes(q.trim().toLowerCase())),onReset:he=()=>{},type:ye="text",leftIcon:J,maxDisplayedOptions:ge,isLabelHidden:be,shouldFocusOnMount:ve,preventOpenOnFirstFocus:_e})=>{var Y;const{setFieldTouched:L,setFieldValue:q}=Le(),[n,T]=ee(t),[O,Q]=ee(`search-${t}`),[f,b]=d.useState(null),[C,Ve]=d.useState({}),E=d.useRef(null),D=d.useRef(null),P=d.useRef(null),[m,g]=d.useState(!1),[V,qe]=d.useState(u);d.useEffect(()=>{(async()=>{var r;ve&&((r=P.current)==null||r.focus(),await L(`search-${t}`,!0))})()},[]),d.useEffect(()=>{const s=async()=>{await q(`search-${t}`,"",!1),await q(t,l?[]:"",!1),he()};m&&F&&O.value!==""&&s()},[m]),d.useEffect(()=>{Ve(u.reduce((s,r)=>(s[r.value]=r.label,s),{}))},[u]),d.useEffect(()=>{const s=r=>{var x;(x=E.current)!=null&&x.contains(r.target)||g(!1)};return E.current&&document.addEventListener("mousedown",s),()=>{document.removeEventListener("mousedown",s)}},[E]),d.useEffect(()=>{me(O.value.trim()),b(null)},[O.value]),d.useEffect(()=>{qe(fe(u,O.value))},[O.value,u]);const Oe=async s=>{var r,x,Z;switch(s.key){case"ArrowUp":if(f!==null)if(f<=0)b(null);else{const j=f-1;b(j);const N=(r=D.current)==null?void 0:r.getElementsByTagName("li")[j];N==null||N.scrollIntoView({block:"nearest"})}m||g(!0);break;case"ArrowDown":if(f===null)V.length>0&&b(0);else{const j=Math.min(V.length-1,f+1);b(j);const N=(x=D.current)==null?void 0:x.getElementsByTagName("li")[j];N==null||N.scrollIntoView({block:"nearest"})}m||g(!0);break;case" ":case"Enter":m&&f!==null&&V[f]&&(s.preventDefault(),V[f]&&await z(String(V[f].value)));break;case"Escape":(Z=P.current)==null||Z.focus(),b(null),g(!1);break;case"Tab":b(null),g(!1);break}},z=async s=>{let r;l?n.value.includes(s)&&Array.isArray(n.value)?r=n.value.filter(x=>x!==s):r=[...n.value,s]:(r=s,g(!1),b(null),await q(`search-${t}`,C[r],!1)),await q(t,r)},xe=async()=>{const s=T.touched;(_e?s&&!m:!m)&&g(!0),await L(t,!0)},Ne=async()=>{m||g(!0),await L(t,!0)},X=async()=>{m?(g(!1),await q(`search-${t}`,"",!1)):g(!0),await L(t,!0)},we=Array.isArray(n.value)?"":C[n.value],Ae=$||we;return a.jsxs(Se,{className:e,error:T.error,hideFooter:!v&&y,isOptional:h,label:p,name:`search-${t}`,showError:Q.touched&&!!T.error,smallLabel:A,inline:_,description:pe,isLabelHidden:be,children:[a.jsxs("div",{className:I(S["multi-select-autocomplete-container"],e),onKeyDown:Oe,ref:E,children:[a.jsx(je,{...f!==null&&{"aria-activedescendant":`option-display-${(Y=V[f])==null?void 0:Y.value}`},onClick:Ne,onFocus:xe,placeholder:Ae,style:{paddingLeft:l&&n.value.length>0||J?"2.2rem":"1rem"},className:S["multi-select-autocomplete-placeholder-input"],hasError:Q.touched&&!!T.error,type:ye,disabled:i,...O,"aria-autocomplete":"list","aria-controls":`list-${t}`,"aria-describedby":`help-${t}`,"aria-expanded":m,"aria-haspopup":"listbox","aria-required":!h,role:"combobox",leftIcon:J,ref:P}),a.jsxs("div",{"aria-live":"polite","aria-relevant":"text",className:S["visually-hidden"],id:`help-${t}`,children:[l&&`${n.value.length} options sélectionnées`,!l&&!Array.isArray(n.value)&&n.value!==""&&`Option sélectionnée : ${C[n.value]}`,m?`${V.length} options ${O.value===""?"disponibles":"correspondant au texte saisi"}`:"saisissez du texte pour afficher et filtrer les options"]}),a.jsx("select",{hidden:!0,...l&&{multiple:!0},...n,value:n.value||"","data-testid":"select",children:u.map(({label:s,value:r})=>a.jsx("option",{value:r,children:s},`option-${r}`))}),a.jsxs("div",{className:S["field-overlay"],children:[!o&&a.jsx(K,{disabled:i,isOpen:m,toggleField:X}),l&&n.value.length>0&&a.jsx("div",{onClick:X,className:S.pellet,children:n.value.length}),m&&a.jsx(H,{className:e,fieldName:t,selectedValues:n.value,filteredOptions:V,setHoveredOptionIndex:b,listRef:D,hoveredOptionIndex:f,selectOption:z,multi:l,maxDisplayedOptions:ge})]})]}),Array.isArray(n.value)&&!v&&n.value.length>0&&a.jsx(W,{className:c,disabled:i,fieldName:t,optionsLabelById:C,selectedOptions:n.value,removeOption:z})]})};try{U.displayName="SelectAutocomplete",U.__docgenInfo={description:"",displayName:"SelectAutocomplete",props:{label:{defaultValue:null,description:"",name:"label",required:!0,type:{name:"string | Element"}},name:{defaultValue:null,description:"",name:"name",required:!0,type:{name:"string"}},description:{defaultValue:null,description:"",name:"description",required:!1,type:{name:"string"}},maxLength:{defaultValue:null,description:"",name:"maxLength",required:!1,type:{name:"number"}},isLabelHidden:{defaultValue:null,description:`A flag to hide the label.
To be used with caution, as it can affect accessibility.
Do not use it if the label is mandatory, placeholder is not
a substitute for a label.`,name:"isLabelHidden",required:!1,type:{name:"boolean"}},hasLabelLineBreak:{defaultValue:null,description:"",name:"hasLabelLineBreak",required:!1,type:{name:"boolean"}},isOptional:{defaultValue:{value:"false"},description:`A flag to indicate that the field is optional.
It will display an asterisk next to the label.`,name:"isOptional",required:!1,type:{name:"boolean"}},showMandatoryAsterisk:{defaultValue:null,description:"",name:"showMandatoryAsterisk",required:!1,type:{name:"boolean"}},className:{defaultValue:null,description:`A custom class for the field layout,
where label, description, input, and footer are displayed.`,name:"className",required:!1,type:{name:"string"}},classNameLabel:{defaultValue:null,description:"",name:"classNameLabel",required:!1,type:{name:"string"}},classNameFooter:{defaultValue:null,description:`A custom class for the footer,
where errors and character count are displayed.`,name:"classNameFooter",required:!1,type:{name:"string"}},classNameInput:{defaultValue:null,description:"",name:"classNameInput",required:!1,type:{name:"string"}},filterVariant:{defaultValue:null,description:"",name:"filterVariant",required:!1,type:{name:"boolean"}},smallLabel:{defaultValue:{value:"false"},description:"A flag to display a smaller label.",name:"smallLabel",required:!1,type:{name:"boolean"}},hideFooter:{defaultValue:{value:"false"},description:`A flag to hide the footer.
To be used with caution, as it can affect accessibility.`,name:"hideFooter",required:!1,type:{name:"boolean"}},inline:{defaultValue:null,description:"",name:"inline",required:!1,type:{name:"boolean"}},clearButtonProps:{defaultValue:null,description:"",name:"clearButtonProps",required:!1,type:{name:'(ButtonHTMLAttributes<HTMLButtonElement> & { tooltip: string; display?: "clear" | "close"; })'}},ErrorDetails:{defaultValue:null,description:"",name:"ErrorDetails",required:!1,type:{name:"ReactNode"}},disabled:{defaultValue:{value:"false"},description:"",name:"disabled",required:!1,type:{name:"boolean"}},hideArrow:{defaultValue:null,description:"",name:"hideArrow",required:!1,type:{name:"boolean"}},hideTags:{defaultValue:{value:"false"},description:"",name:"hideTags",required:!1,type:{name:"boolean"}},maxHeight:{defaultValue:null,description:"",name:"maxHeight",required:!1,type:{name:"number"}},multi:{defaultValue:{value:"false"},description:"",name:"multi",required:!1,type:{name:"boolean"}},options:{defaultValue:null,description:"",name:"options",required:!0,type:{name:"SelectOption[]"}},placeholder:{defaultValue:null,description:"",name:"placeholder",required:!1,type:{name:"string"}},resetOnOpen:{defaultValue:{value:"true"},description:"",name:"resetOnOpen",required:!1,type:{name:"boolean"}},onSearch:{defaultValue:{value:"() => {}"},description:"",name:"onSearch",required:!1,type:{name:"((pattern: string) => void)"}},searchInOptions:{defaultValue:{value:`(options, pattern) =>
    options.filter((opt) =>
      opt.label.toLowerCase().includes(pattern.trim().toLowerCase())
    )`},description:"",name:"searchInOptions",required:!1,type:{name:"((options: SelectOption[], pattern: string) => SelectOption[])"}},onReset:{defaultValue:{value:"() => {}"},description:"",name:"onReset",required:!1,type:{name:"(() => void)"}},type:{defaultValue:{value:"text"},description:"",name:"type",required:!1,type:{name:"enum",value:[{value:'"search"'},{value:'"text"'}]}},leftIcon:{defaultValue:null,description:"",name:"leftIcon",required:!1,type:{name:"string"}},maxDisplayedOptions:{defaultValue:null,description:"",name:"maxDisplayedOptions",required:!1,type:{name:"number"}},selectedValuesTagsClassName:{defaultValue:null,description:"",name:"selectedValuesTagsClassName",required:!1,type:{name:"string"}},shouldFocusOnMount:{defaultValue:null,description:"A flag to automatically focus the input when the component mounts.",name:"shouldFocusOnMount",required:!1,type:{name:"boolean"}},preventOpenOnFirstFocus:{defaultValue:null,description:`A flag to prevent the dropdown from opening on the first focus.
This is useful when the input is automatically focused. The user
is then expected to open the dropdown by clicking on the input.`,name:"preventOpenOnFirstFocus",required:!1,type:{name:"boolean"}}}}}catch{}const We=e=>a.jsx(Fe,{initialValues:e.initialValues,onSubmit:()=>{},children:a.jsx(U,{...e})}),mt={title:"ui-kit/forms/SelectAutocomplete",component:We},G={name:"departement",options:[{value:"01",label:"Ain"},{value:"02",label:"Aisne"},{value:"03",label:"Allier"},{value:"04",label:"Alpes-de-Haute-Provence test de libellé très long"},{value:"05",label:"Hautes-Alpes"},{value:"06",label:"Alpes-Maritimes"},{value:"07",label:"Ardèche"},{value:"08",label:"Ardennes"},{value:"09",label:"Ariège"},{value:"10",label:"Aube"},{value:"11",label:"Aude"},{value:"12",label:"Aveyron"},{value:"13",label:"Bouches-du-Rhône"},{value:"14",label:"Calvados"},{value:"15",label:"Cantal"}],initialValues:{departement:"01","search-departement":""},label:"Département",hideFooter:!1,hideTags:!1,isOptional:!1,smallLabel:!1,searchInOptions:Te},R={args:{...G}},M={args:{...G,multi:!0,initialValues:{departement:["01","02"],"search-departement":""}}},B={args:{...G,multi:!0,initialValues:{departement:["01","02"],"search-departement":""},hideTags:!0}};var ae,le,ne;R.parameters={...R.parameters,docs:{...(ae=R.parameters)==null?void 0:ae.docs,source:{originalSource:`{
  args: {
    ...defaultProps
  }
}`,...(ne=(le=R.parameters)==null?void 0:le.docs)==null?void 0:ne.source}}};var se,re,ie;M.parameters={...M.parameters,docs:{...(se=M.parameters)==null?void 0:se.docs,source:{originalSource:`{
  args: {
    ...defaultProps,
    multi: true,
    initialValues: {
      departement: ['01', '02'],
      'search-departement': ''
    }
  }
}`,...(ie=(re=M.parameters)==null?void 0:re.docs)==null?void 0:ie.source}}};var oe,ue,ce;B.parameters={...B.parameters,docs:{...(oe=B.parameters)==null?void 0:oe.docs,source:{originalSource:`{
  args: {
    ...defaultProps,
    multi: true,
    initialValues: {
      departement: ['01', '02'],
      'search-departement': ''
    },
    hideTags: true
  }
}`,...(ce=(ue=B.parameters)==null?void 0:ue.docs)==null?void 0:ce.source}}};const ft=["Default","Multi","WithoutTags"];export{R as Default,M as Multi,B as WithoutTags,ft as __namedExportsOrder,mt as default};
