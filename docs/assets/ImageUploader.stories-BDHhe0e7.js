import{j as e}from"./jsx-runtime-BYYWji4R.js";import{P as Ie}from"./reducer-Crbp5051.js";import{V as ve}from"./index-DbuqM7EE.js";import{c as ye}from"./testUtils-DY3eMo7d.js";import{c as A}from"./index-DeARc5FM.js";import{r as g}from"./index-ClcD9ViR.js";import{f as de}from"./full-trash-CEfIUI4M.js";import{B as j}from"./Button-DXGZYGNf.js";import{B as R}from"./types-DjX_gQD6.js";import{S as me}from"./SvgIcon-CyWUmZpn.js";import{C as Ce}from"./ConfirmDialog-Dnsd1NeT.js";import{s as Ee}from"./stroke-trash-Cc_5v2lW.js";import{f as Ve}from"./full-edit-CxAaM2Fv.js";import{f as xe,a as Fe}from"./full-download-De3yFfyE.js";import{T as ce,C as J,D as pe}from"./DialogBuilder-DFliHV67.js";import{u as ue}from"./useNotification-CD_dQXuX.js";import{u as ge}from"./firebase-D-_hhcZo.js";import{E as fe}from"./constants-FfH2lUbm.js";import{g as je,i as S,C as Ue}from"./imageConstraints-BuzLOJuz.js";import{I as we}from"./ImageEditor-pWWdBklN.js";import{T as Ne}from"./TextInput-BzTgBDug.js";import{I as Re}from"./ImagePreferredOrientation-BP5ke7oK.js";import{B as be}from"./BaseFileInput-DMclVcsz.js";import{c as Oe,b as Se}from"./index.esm-CIN8MBt5.js";import"./index-DEvWhEAV.js";import"./index-J01lmiDr.js";import"./_commonjsHelpers-Cpj98o6Y.js";import"./index-BwDq52Jj.js";import"./config-BdqymTTq.js";import"./OfferAddressType-Co4gxJoY.js";import"./stroke-pass-CALgybTM.js";import"./Tooltip-BU5AxWXW.js";import"./Button.module-RJ8zZwJi.js";import"./stroke-error-DSZD431a.js";import"./Dialog-SxcPGf2H.js";import"./index-C4HdSTjI.js";import"./tslib.es6-BUas5LQb.js";import"./stroke-close-DnlFsd1c.js";import"./FieldError-azuIsM2E.js";import"./index-Chjiymov.js";import"./Slider-ChPnKmEb.js";import"./BaseInput-BrnVefEj.js";import"./FieldLayoutCharacterCount-WDa3y29M.js";const X=""+new URL("sample-image-landscape-B4GmPBHc.jpg",import.meta.url).href,Q=""+new URL("sample-image-portrait-OorsIixL.jpg",import.meta.url).href,qe={"button-image-delete-icon":"_button-image-delete-icon_ooh4c_1"},W=({isLoading:a,onConfirm:r,onDismiss:t,isDialogOpen:n,trigger:o})=>e.jsx(Ce,{cancelText:"Retour",confirmText:"Supprimer",icon:Ee,isLoading:a,onCancel:t,onConfirm:r,title:"Supprimer l’image",open:n,trigger:o,children:"Souhaitez-vous vraiment supprimer cette image ?"});try{W.displayName="ModalImageDelete",W.__docgenInfo={description:"",displayName:"ModalImageDelete",props:{isLoading:{defaultValue:null,description:"",name:"isLoading",required:!0,type:{name:"boolean"}},onConfirm:{defaultValue:null,description:"",name:"onConfirm",required:!0,type:{name:"() => void"}},onDismiss:{defaultValue:null,description:"",name:"onDismiss",required:!0,type:{name:"() => void"}},isDialogOpen:{defaultValue:null,description:"",name:"isDialogOpen",required:!0,type:{name:"boolean"}},trigger:{defaultValue:null,description:"",name:"trigger",required:!0,type:{name:"ReactNode"}}}}}catch{}const H=({onImageDelete:a})=>{const[r,t]=g.useState(!1),[n,o]=g.useState(!1),c=()=>{o(!0),a()};return e.jsx(W,{isLoading:n,onConfirm:c,onDismiss:()=>t(!1),isDialogOpen:r,trigger:e.jsxs(j,{onClick:()=>t(!0),variant:R.TERNARY,children:[e.jsx(me,{alt:"",className:qe["button-image-delete-icon"],src:de}),"Supprimer"]})})};try{H.displayName="ButtonImageDelete",H.__docgenInfo={description:"",displayName:"ButtonImageDelete",props:{onImageDelete:{defaultValue:null,description:"",name:"onImageDelete",required:!0,type:{name:"() => void"}}}}}catch{}var i=(a=>(a.OFFER="offer",a.OFFER_COLLECTIVE="offer_collective",a.VENUE="venue",a))(i||{});const Be="_label_1rdm1_22",De="_icon_1rdm1_35",N={"button-image-add":"_button-image-add_1rdm1_1","add-image-venue":"_add-image-venue_1rdm1_14","add-image-offer":"_add-image-offer_1rdm1_18",label:Be,icon:De},Pe=async(a,r="image.jpg")=>{const n=await(await fetch(a)).blob();return new File([n],r,{type:n.type})},P=(a,r)=>a+r/2,Me=a=>100/(a*100),Le=a=>{const[r,t]=g.useState(0),[n,o]=g.useState(0);return g.useEffect(()=>{(async()=>{const s=await je(a);s&&(t(s.width),o(s.height))})()},[a]),{width:r,height:n}},he={[i.OFFER]:{maxSize:1e7,minWidth:400,types:["image/png","image/jpeg"],minHeight:600},[i.OFFER_COLLECTIVE]:{maxSize:1e7,minWidth:400,types:["image/png","image/jpeg"],minHeight:600},[i.VENUE]:{maxSize:1e7,minWidth:600,types:["image/png","image/jpeg"],minHeight:400}},Te=({originalDimensions:a,orientation:r})=>r==="landscape"?{width:Math.floor(Math.min(a.width,a.height/2*3)),height:Math.floor(Math.min(a.height,a.width/3*2))}:{width:Math.floor(Math.min(a.width,a.height/3*2)),height:Math.floor(Math.min(a.height,a.width/2*3))},I={"modal-image-crop":"_modal-image-crop_8k7re_1","modal-image-crop-content":"_modal-image-crop-content_8k7re_8","modal-image-crop-wrapper":"_modal-image-crop-wrapper_8k7re_11","modal-image-crop-editor":"_modal-image-crop-editor_8k7re_22","modal-image-crop-actions":"_modal-image-crop-actions_8k7re_30","modal-image-crop-header":"_modal-image-crop-header_8k7re_37","modal-image-crop-right":"_modal-image-crop-right_8k7re_43","modal-image-crop-credit":"_modal-image-crop-credit_8k7re_49","modal-image-crop-footer":"_modal-image-crop-footer_8k7re_53"},z=({image:a,initialCredit:r,onReplaceImage:t,onImageDelete:n,onEditedImageSave:o,saveInitialPosition:c,initialPosition:s,initialScale:p,mode:l})=>{const{logEvent:_}=ge(),{width:f,height:d}=Le(a),u=g.useRef(null),v=ue(),[m,y]=g.useState(r||""),x=he[l].minWidth,{width:C}=Te({originalDimensions:{width:f,height:d},orientation:l===i.VENUE?"landscape":"portrait"}),L={[i.VENUE]:()=>e.jsx(e.Fragment,{}),[i.OFFER]:()=>e.jsx(e.Fragment,{}),[i.OFFER_COLLECTIVE]:()=>e.jsx(e.Fragment,{})}[l],U=Math.min(4,(C-10)/x),E={[i.OFFER]:297,[i.OFFER_COLLECTIVE]:297,[i.VENUE]:138}[l],T={[i.OFFER]:{canvasHeight:E,canvasWidth:E*2/3,cropBorderColor:"#FFF",cropBorderHeight:50,cropBorderWidth:105,maxScale:U},[i.OFFER_COLLECTIVE]:{canvasHeight:E,canvasWidth:E*2/3,cropBorderColor:"#FFF",cropBorderHeight:50,cropBorderWidth:105,maxScale:U},[i.VENUE]:{canvasHeight:E,canvasWidth:E*3/2,cropBorderColor:"#FFF",cropBorderHeight:40,cropBorderWidth:100,maxScale:U}}[l],b=h=>{_(fe.CLICKED_ADD_IMAGE,{imageCreationStage:"reframe image"});try{if(u.current){const O=u.current.getImage(),w=u.current.getCroppingRect();c({x:P(w.x,w.width),y:P(w.y,w.height)}),h&&h(m,O.toDataURL(),w)}}catch{v.error("Une erreur est survenue. Merci de réessayer plus tard")}};function k(){return b(o)}const V=()=>b();return e.jsxs("form",{className:I["modal-image-crop"],children:[e.jsxs("div",{className:I["modal-image-crop-content"],children:[e.jsx(ce,{asChild:!0,children:e.jsx("h1",{className:I["modal-image-crop-header"],children:"Modifier une image"})}),e.jsx("p",{className:I["modal-image-crop-right"],children:"En utilisant ce contenu, je certifie que je suis propriétaire ou que je dispose des autorisations nécessaires pour l’utilisation de celui-ci."}),e.jsxs("div",{className:I["modal-image-crop-wrapper"],children:[e.jsxs("div",{className:I["modal-image-crop-editor"],children:[e.jsx(we,{...T,image:a,initialPosition:s,ref:u,initialScale:p,onChangeDone:V}),e.jsxs("div",{className:I["modal-image-crop-actions"],children:[e.jsx(j,{icon:xe,onClick:t,variant:R.TERNARY,children:"Remplacer l’image"}),e.jsx(J,{asChild:!0,children:e.jsx(j,{icon:de,onClick:n,variant:R.TERNARY,children:"Supprimer l’image"})})]})]}),e.jsx(L,{})]}),e.jsx(Ne,{count:m.length,className:I["modal-image-crop-credit"],label:"Crédit de l’image",maxLength:255,value:m,onChange:h=>y(h.target.value),name:"credit",type:"text"})]}),e.jsx(pe.Footer,{children:e.jsxs("div",{className:I["modal-image-crop-footer"],children:[e.jsx(J,{asChild:!0,children:e.jsx(j,{variant:R.SECONDARY,children:"Annuler"})}),e.jsx(j,{type:"submit",onClick:h=>{h.preventDefault(),k()},children:"Enregistrer"})]})})]})};try{z.displayName="ModalImageCrop",z.__docgenInfo={description:"",displayName:"ModalImageCrop",props:{image:{defaultValue:null,description:"",name:"image",required:!0,type:{name:"File"}},initialCredit:{defaultValue:null,description:"",name:"initialCredit",required:!1,type:{name:"string | null"}},onReplaceImage:{defaultValue:null,description:"",name:"onReplaceImage",required:!0,type:{name:"() => void"}},onImageDelete:{defaultValue:null,description:"",name:"onImageDelete",required:!0,type:{name:"() => void"}},initialPosition:{defaultValue:null,description:"",name:"initialPosition",required:!1,type:{name:"Position"}},initialScale:{defaultValue:null,description:"",name:"initialScale",required:!1,type:{name:"number"}},saveInitialPosition:{defaultValue:null,description:"",name:"saveInitialPosition",required:!0,type:{name:"(position: Position) => void"}},onEditedImageSave:{defaultValue:null,description:"",name:"onEditedImageSave",required:!0,type:{name:"(credit: string | null, dataUrl: string, croppedRect: CroppedRect) => void"}},mode:{defaultValue:null,description:"",name:"mode",required:!0,type:{name:"enum",value:[{value:'"offer"'},{value:'"offer_collective"'},{value:'"venue"'}]}},imageUrl:{defaultValue:null,description:"",name:"imageUrl",required:!1,type:{name:"string"}}}}}catch{}const ke=({constraints:a})=>Oe().shape(a.reduce((r,t)=>({...r,[t.id]:Se().test({message:t.description,test:(n,o)=>t.asyncValidator(o.parent.image)})}),{})),$=({onSubmit:a,mode:r,isReady:t})=>{const{logEvent:n}=ge(),[o,c]=g.useState([]),s=he[r],p="preferred-orientation-caption",l="constraint-check",f={[i.OFFER]:"portrait",[i.OFFER_COLLECTIVE]:"portrait",[i.VENUE]:"landscape"}[r],d=[S.formats(s.types),S.size(s.maxSize),S.width(s.minWidth),S.height(s.minHeight)],u=ke({constraints:d}),v=async m=>{const y=m.currentTarget.files&&m.currentTarget.files.length>0?m.currentTarget.files[0]:null;if(y)try{await u.validate({image:y},{abortEarly:!1}),a({image:y}),n(fe.CLICKED_ADD_IMAGE,{imageCreationStage:"import image"})}catch(x){c(x.inner.map(C=>C.path||"unknown"))}};return e.jsxs("form",{onSubmit:m=>m.preventDefault(),children:[e.jsx(Re,{id:p,orientation:f}),e.jsx(be,{isDisabled:!t,label:"Importer une image depuis l’ordinateur",fileTypes:["image/png","image/jpeg"],isValid:o.length===0,onChange:v,ariaDescribedBy:`${p} ${l}`}),e.jsx(Ue,{id:l,constraints:d,failingConstraints:o})]})};try{$.displayName="ImageUploadBrowserForm",$.__docgenInfo={description:"",displayName:"ImageUploadBrowserForm",props:{onSubmit:{defaultValue:null,description:"",name:"onSubmit",required:!0,type:{name:"(values: ImageUploadBrowserFormValues) => void"}},mode:{defaultValue:null,description:"",name:"mode",required:!0,type:{name:"enum",value:[{value:'"offer"'},{value:'"offer_collective"'},{value:'"venue"'}]}},isReady:{defaultValue:null,description:"",name:"isReady",required:!0,type:{name:"boolean"}}}}}catch{}const Ae="_header_tjlbo_12",Z={"modal-upload-browser":"_modal-upload-browser_tjlbo_1",header:Ae},Y=({onImageClientUpload:a,mode:r,isReady:t})=>e.jsxs("section",{className:Z["modal-upload-browser"],children:[e.jsx(ce,{asChild:!0,children:e.jsx("h1",{className:Z.header,children:"Ajouter une image"})}),e.jsx($,{isReady:t,onSubmit:a,mode:r})]});try{Y.displayName="ModalImageUploadBrowser",Y.__docgenInfo={description:"",displayName:"ModalImageUploadBrowser",props:{onImageClientUpload:{defaultValue:null,description:"",name:"onImageClientUpload",required:!0,type:{name:"(values: ImageUploadBrowserFormValues) => void"}},mode:{defaultValue:null,description:"",name:"mode",required:!0,type:{name:"enum",value:[{value:'"offer"'},{value:'"offer_collective"'},{value:'"venue"'}]}},isReady:{defaultValue:null,description:"",name:"isReady",required:!0,type:{name:"boolean"}}}}}catch{}const G=({mode:a,onImageUpload:r,onImageDelete:t,initialValues:n={}})=>{const o=ue(),[c,s]=g.useState(!1),{imageUrl:p,originalImageUrl:l,credit:_,cropParams:f}=n,[d,u]=g.useState(),v=l||p;g.useEffect(()=>{async function V(h){try{u(await Pe(h))}catch{o.error("Erreur lors de la récupération de votre image.")}}v&&V(v),s(!0)},[]);const{xCropPercent:m,yCropPercent:y,heightCropPercent:x,widthCropPercent:C}=f||{},[L,U]=g.useState({x:m&&C?P(m,C):.5,y:y&&x?P(y,x):.5}),E=V=>{u(V.image||void 0)},T=()=>{u(void 0)},b=()=>{!p&&!l?u(void 0):t==null||t()},k=(V,h,O)=>{O===void 0||d===void 0||r({imageFile:d,imageCroppedDataUrl:h,cropParams:O,credit:V})};return d?e.jsx(z,{initialCredit:_,image:d,initialPosition:L,initialScale:C?Me(C):1,onEditedImageSave:k,onReplaceImage:T,onImageDelete:b,saveInitialPosition:U,mode:a,imageUrl:p}):e.jsx(Y,{onImageClientUpload:E,mode:a,isReady:c})};try{G.displayName="ModalImageEdit",G.__docgenInfo={description:"",displayName:"ModalImageEdit",props:{mode:{defaultValue:null,description:"",name:"mode",required:!0,type:{name:"enum",value:[{value:'"offer"'},{value:'"offer_collective"'},{value:'"venue"'}]}},onImageUpload:{defaultValue:null,description:"",name:"onImageUpload",required:!0,type:{name:"(values: OnImageUploadArgs) => void"}},onImageDelete:{defaultValue:null,description:"",name:"onImageDelete",required:!1,type:{name:"(() => void)"}},initialValues:{defaultValue:{value:"{}"},description:"",name:"initialValues",required:!1,type:{name:"UploadImageValues"}}}}}catch{}const M=({mode:a,initialValues:r={},onImageUpload:t,onImageDelete:n,onClickButtonImage:o,children:c,disableForm:s})=>{const{imageUrl:p,originalImageUrl:l}=r,[_,f]=g.useState(!1),d=()=>{o&&o()},u=()=>{n()};function v(m){t(m),f(!1)}return e.jsx(e.Fragment,{children:e.jsx(pe,{onOpenChange:f,open:_,variant:"drawer",trigger:p||l?e.jsx(j,{onClick:d,variant:R.TERNARY,"aria-label":"Modifier l’image",icon:Ve,children:c??"Modifier"}):e.jsx("button",{className:A(N["button-image-add"],{[N["add-image-venue"]]:a===i.VENUE,[N["add-image-offer"]]:a===i.OFFER||a===i.OFFER_COLLECTIVE}),onClick:d,type:"button",disabled:s,children:e.jsxs(e.Fragment,{children:[e.jsx(me,{src:Fe,alt:"",className:N.icon}),e.jsx("span",{className:N.label,children:"Ajouter une image"})]})}),children:e.jsx(G,{mode:a,onImageUpload:v,onImageDelete:u,initialValues:r})})})};try{M.displayName="ButtonImageEdit",M.__docgenInfo={description:"",displayName:"ButtonImageEdit",props:{onImageUpload:{defaultValue:null,description:"",name:"onImageUpload",required:!0,type:{name:"(values: OnImageUploadArgs) => void"}},onImageDelete:{defaultValue:null,description:"",name:"onImageDelete",required:!0,type:{name:"() => void"}},initialValues:{defaultValue:{value:"{}"},description:"",name:"initialValues",required:!1,type:{name:"UploadImageValues"}},mode:{defaultValue:null,description:"",name:"mode",required:!0,type:{name:"enum",value:[{value:'"offer"'},{value:'"offer_collective"'},{value:'"venue"'}]}},onClickButtonImage:{defaultValue:null,description:"",name:"onClickButtonImage",required:!1,type:{name:"(() => void)"}},disableForm:{defaultValue:null,description:"",name:"disableForm",required:!1,type:{name:"boolean"}}}}}catch{}const F={"image-uploader-image-container":"_image-uploader-image-container_1gu1i_5","image-uploader-actions-container":"_image-uploader-actions-container_1gu1i_10","actions-wrapper":"_actions-wrapper_1gu1i_17","image-preview":"_image-preview_1gu1i_25","preview-venue":"_preview-venue_1gu1i_31","preview-offer":"_preview-offer_1gu1i_41"},K=({className:a,onImageUpload:r,onImageDelete:t,initialValues:n={},mode:o,onClickButtonImageAdd:c,hideActionButtons:s=!1,disableForm:p=!1})=>{const{imageUrl:l,originalImageUrl:_,credit:f,cropParams:d}=n;return e.jsx("div",{className:A(F["image-uploader-image-container"],a),children:l&&_?e.jsxs(e.Fragment,{children:[e.jsx("img",{alt:"Prévisualisation de l’image","data-testid":"image-preview",className:A(F["image-preview"],{[F["preview-venue"]]:o===i.VENUE,[F["preview-offer"]]:o===i.OFFER||o===i.OFFER_COLLECTIVE}),src:l}),!s&&e.jsx("div",{className:F["image-uploader-actions-container"],children:e.jsxs("div",{className:F["actions-wrapper"],children:[e.jsx(M,{mode:o,initialValues:{originalImageUrl:_,imageUrl:l,credit:f,cropParams:d},onImageUpload:r,onImageDelete:t,onClickButtonImage:c,disableForm:p}),e.jsx(H,{onImageDelete:t})]})})]}):e.jsx(M,{mode:o,onImageUpload:r,onImageDelete:t,onClickButtonImage:c,disableForm:p})})};try{K.displayName="ImageUploader",K.__docgenInfo={description:"",displayName:"ImageUploader",props:{className:{defaultValue:null,description:"",name:"className",required:!1,type:{name:"string"}},onImageUpload:{defaultValue:null,description:"",name:"onImageUpload",required:!0,type:{name:"(values: OnImageUploadArgs) => void"}},onImageDelete:{defaultValue:null,description:"",name:"onImageDelete",required:!0,type:{name:"() => void"}},initialValues:{defaultValue:{value:"{}"},description:"",name:"initialValues",required:!1,type:{name:"UploadImageValues"}},mode:{defaultValue:null,description:"",name:"mode",required:!0,type:{name:"enum",value:[{value:'"offer"'},{value:'"offer_collective"'},{value:'"venue"'}]}},onClickButtonImageAdd:{defaultValue:null,description:"",name:"onClickButtonImageAdd",required:!1,type:{name:"(() => void)"}},hideActionButtons:{defaultValue:{value:"false"},description:"",name:"hideActionButtons",required:!1,type:{name:"boolean"}},disableForm:{defaultValue:{value:"false"},description:"",name:"disableForm",required:!1,type:{name:"boolean"}}}}}catch{}const Oa={title:"components/ImageUploader/ImageUploader",component:K,decorators:[ve,a=>e.jsx(Ie,{store:ye({}),children:e.jsx(a,{})})]},_e={initialValues:{originalImageUrl:Q,imageUrl:Q,credit:"John Do",cropParams:{xCropPercent:0,yCropPercent:0,heightCropPercent:1,widthCropPercent:1}},mode:i.OFFER,onImageDelete:()=>{alert("onDelete have been called.")},onImageUpload:()=>{alert("onImageUpload have been called.")}},q={args:{..._e}},B={args:{..._e,initialValues:{imageUrl:X,originalImageUrl:X},mode:i.VENUE}},D={args:{mode:i.OFFER}};var ee,ae,re;q.parameters={...q.parameters,docs:{...(ee=q.parameters)==null?void 0:ee.docs,source:{originalSource:`{
  args: {
    ...props
  }
}`,...(re=(ae=q.parameters)==null?void 0:ae.docs)==null?void 0:re.source}}};var te,ie,oe;B.parameters={...B.parameters,docs:{...(te=B.parameters)==null?void 0:te.docs,source:{originalSource:`{
  args: {
    ...props,
    initialValues: {
      imageUrl: sampleImageLandscape,
      originalImageUrl: sampleImageLandscape
    },
    mode: UploaderModeEnum.VENUE
  }
}`,...(oe=(ie=B.parameters)==null?void 0:ie.docs)==null?void 0:oe.source}}};var ne,le,se;D.parameters={...D.parameters,docs:{...(ne=D.parameters)==null?void 0:ne.docs,source:{originalSource:`{
  args: {
    mode: UploaderModeEnum.OFFER
  }
}`,...(se=(le=D.parameters)==null?void 0:le.docs)==null?void 0:se.source}}};const Sa=["WithImageOffer","WithImageVenue","WithoutImage"];export{q as WithImageOffer,B as WithImageVenue,D as WithoutImage,Sa as __namedExportsOrder,Oa as default};
