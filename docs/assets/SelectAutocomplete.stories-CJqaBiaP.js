import{j as a}from"./jsx-runtime-X2b_N9AH.js";import{c as _e,d as X,b as Ve}from"./formik.esm-CN2zdSWT.js";import{c as R}from"./index-BpvXyOxN.js";import{r as m}from"./index-uCp2LrAq.js";import{B as xe}from"./BaseInput-Bhv-RC4w.js";import{F as qe}from"./FieldLayout-DcdhPZsO.js";import{B as Oe,b as Le}from"./BaseCheckbox-D0cKwc2e.js";import{s as Se}from"./stroke-close-C6KSko98.js";import{S as oe}from"./SvgIcon-DP_815J1.js";import{s as Ne}from"./stroke-down-DYCZHAeS.js";import"./_commonjsHelpers-BosuxZz1.js";import"./full-clear-CvNWe6Ae.js";import"./Button-DnM-aOrW.js";import"./stroke-pass-C0Oiu4_F.js";import"./Tooltip-B_yv2e98.js";import"./useTooltipProps-B8Mr20U1.js";import"./Button.module-DVCdx56u.js";import"./types-DjX_gQD6.js";import"./FieldError-WpDNj5es.js";import"./stroke-error-BKdTEWJV.js";const Y=e=>e.trim().toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,""),Ae=(e,n,t)=>{const r=[];for(let o=0;o<e.length&&!(t&&r.length>=t);o++){const u=e[o].normalizedLabel??Y(e[o].label);Y(n||"").split(" ").every(g=>u.includes(g))&&r.push(e[o])}return r},we=e=>typeof e=="string"?e:"",je=(e,n,t="s")=>{let r,o;const u=e.slice(-1)[0];return u==="s"||u==="x"?(o=e.slice(0,-1),r=e):(o=e,r=`${e}${t}`),n>1?r:o},$e=(e,n,t)=>e.split(" ").map(r=>je(r,n,t)).join(" "),ke=(e,n,t)=>`${new Intl.NumberFormat("fr-FR").format(e)} ${$e(n,e,t)}`,Fe="_menu_1ahi7_2",Ie="_label_1ahi7_20",S={menu:Fe,"menu--no-results":"_menu--no-results_1ahi7_16",label:Ie,"too-many-options":"_too-many-options_1ahi7_21","option-hovered":"_option-hovered_1ahi7_34"},B=({className:e,fieldName:n,selectedValues:t,filteredOptions:r,setHoveredOptionIndex:o,listRef:u,hoveredOptionIndex:A,selectOption:g,multi:w,maxDisplayedOptions:d})=>{const f=d?r.slice(0,d):r;return a.jsxs("div",{className:R(S.menu,e),role:"listbox",children:[r.length===0&&a.jsx("span",{className:S["menu--no-results"],children:"Aucun résultat"}),a.jsx("ul",{"data-testid":"list",id:`list-${n}`,ref:u,role:"listbox",children:f.map(({value:y,label:q},O)=>{const L=(t||[]).includes(String(y));return a.jsx("li",{"aria-selected":L,"aria-posinset":O+1,"aria-setsize":f.length,className:A===O?S["option-hovered"]:"","data-value":y,"data-selected":L,id:`option-display-${y}`,onMouseEnter:()=>o(O),role:"option",tabIndex:-1,children:w?a.jsx(Oe,{label:q,checked:L,onChange:()=>{g(String(y))}}):a.jsx("span",{onClick:()=>{g(String(y))},className:R(Le["base-checkbox-label"],S.label),children:q})},`option-display-${y}`)})}),a.jsx("div",{role:"status",children:d&&f.length<r.length&&a.jsxs("div",{className:S["too-many-options"],children:[ke(d,"résultat")," maximum. Veuillez affiner votre recherche"]})})]})};try{B.displayName="OptionsList",B.__docgenInfo={description:"",displayName:"OptionsList",props:{className:{defaultValue:null,description:"",name:"className",required:!1,type:{name:"string"}},fieldName:{defaultValue:null,description:"",name:"fieldName",required:!0,type:{name:"string"}},selectedValues:{defaultValue:null,description:"",name:"selectedValues",required:!0,type:{name:"string | string[] | null"}},filteredOptions:{defaultValue:null,description:"",name:"filteredOptions",required:!0,type:{name:"SelectOption[]"}},setHoveredOptionIndex:{defaultValue:null,description:"",name:"setHoveredOptionIndex",required:!0,type:{name:"(value: number | null) => void"}},listRef:{defaultValue:null,description:"",name:"listRef",required:!0,type:{name:"Ref<HTMLUListElement>"}},hoveredOptionIndex:{defaultValue:null,description:"",name:"hoveredOptionIndex",required:!0,type:{name:"number | null"}},selectOption:{defaultValue:null,description:"",name:"selectOption",required:!0,type:{name:"(value: string) => void"}},multi:{defaultValue:null,description:"",name:"multi",required:!0,type:{name:"boolean"}},maxDisplayedOptions:{defaultValue:null,description:"",name:"maxDisplayedOptions",required:!1,type:{name:"number"}}}}}catch{}const Ee="_pellet_49yaz_16",E={"multi-select-autocomplete-container":"_multi-select-autocomplete-container_49yaz_2","multi-select-autocomplete-placeholder-input":"_multi-select-autocomplete-placeholder-input_49yaz_8","field-overlay":"_field-overlay_49yaz_12",pellet:Ee},Ce="_tag_3sd19_9",N={"multi-select-autocomplete-tags":"_multi-select-autocomplete-tags_3sd19_2",tag:Ce,"tag-close-button":"_tag-close-button_3sd19_25","tag-close-button--disabled":"_tag-close-button--disabled_3sd19_33","tag-close-button-icon":"_tag-close-button-icon_3sd19_36"},H=({disabled:e,fieldName:n,optionsLabelById:t,selectedOptions:r,removeOption:o})=>a.jsx("div",{className:N["multi-select-autocomplete-tags"],children:r.map(u=>a.jsx("span",{className:N.tag,children:a.jsxs("button",{className:R(N["tag-close-button"],{[N["tag-close-button--disabled"]]:e}),onClick:()=>o(u),title:"Supprimer "+t[u],type:"button",disabled:e,children:[t[u],a.jsx(oe,{src:Se,alt:"Supprimer "+t[u],className:N["tag-close-button-icon"]})]})},`tag-${n}-${u}`))});try{H.displayName="SelectedValuesTags",H.__docgenInfo={description:"",displayName:"SelectedValuesTags",props:{disabled:{defaultValue:null,description:"",name:"disabled",required:!0,type:{name:"boolean"}},fieldName:{defaultValue:null,description:"",name:"fieldName",required:!0,type:{name:"string"}},optionsLabelById:{defaultValue:null,description:"",name:"optionsLabelById",required:!0,type:{name:"Record<string, string>"}},selectedOptions:{defaultValue:null,description:"",name:"selectedOptions",required:!0,type:{name:"string[]"}},removeOption:{defaultValue:null,description:"",name:"removeOption",required:!0,type:{name:"(value: string) => void"}}}}}catch{}const Te={"dropdown-indicator":"_dropdown-indicator_1rk6u_2"},M=({disabled:e,isOpen:n,toggleField:t})=>a.jsx("button",{onClick:t,className:Te["dropdown-indicator"],type:"button",disabled:e,children:a.jsx(oe,{src:Ne,alt:`${n?"Masquer":"Afficher"} les options`,width:"20"})});try{M.displayName="Toggle",M.__docgenInfo={description:"",displayName:"Toggle",props:{disabled:{defaultValue:null,description:"",name:"disabled",required:!0,type:{name:"boolean"}},isOpen:{defaultValue:null,description:"",name:"isOpen",required:!0,type:{name:"boolean"}},toggleField:{defaultValue:null,description:"",name:"toggleField",required:!0,type:{name:"() => void"}}}}}catch{}const P=({className:e,disabled:n=!1,name:t,hideArrow:r,hideFooter:o=!1,hideTags:u=!1,inline:A,isOptional:g=!1,label:w,multi:d=!1,options:f,placeholder:y,pluralLabel:q,smallLabel:O=!1,resetOnOpen:L=!0,description:ue,onSearch:de=()=>{},searchInOptions:ce=(j,v)=>j.filter(l=>l.label.toLowerCase().includes(v.trim().toLowerCase())),onReset:pe=()=>{},type:me="text",leftIcon:K,maxDisplayedOptions:fe})=>{var J;const{setFieldTouched:j,setFieldValue:v}=_e(),[l,$]=X(t),[_,he]=X(`search-${t}`),[c,h]=m.useState(null),[k,ye]=m.useState({}),F=m.useRef(null),I=m.useRef(null),[p,b]=m.useState(!1),[V,be]=m.useState(f);m.useEffect(()=>{const s=async()=>{await v(`search-${t}`,"",!1),await v(t,"",!1),pe()};p&&L&&_.value!==""&&s()},[p]),m.useEffect(()=>{ye(f.reduce((s,i)=>(s[i.value]=i.label,s),{}))},[f]),m.useEffect(()=>{const s=i=>{var x;(x=F.current)!=null&&x.contains(i.target)||b(!1)};return F.current&&document.addEventListener("mousedown",s),()=>{document.removeEventListener("mousedown",s)}},[F]),m.useEffect(()=>{de(_.value.trim()),h(null)},[_.value]),m.useEffect(()=>{be(ce(f,_.value))},[_.value,f]);const ge=async s=>{var i,x,Q;switch(s.key){case"ArrowUp":c!==null&&(c<=0?h(null):h(c-1)),p||b(!0),(i=I.current)==null||i.focus();break;case"ArrowDown":c===null?V.length>0&&h(0):c>=V.length-1?h(V.length-1):h(c+1),p||b(!0),(x=I.current)==null||x.focus();break;case"Space":await U(),(Q=I.current)==null||Q.focus();break;case"Enter":p&&c!==null&&(s.preventDefault(),await D(String(V[c].value)));break;case"Escape":h(null),b(!1);break;case"Tab":h(null),b(!1);break}},D=async s=>{let i;d?l.value.includes(s)&&Array.isArray(l.value)?i=l.value.filter(x=>x!==s):i=[...l.value,s]:(i=s,b(!1),h(null),await v(`search-${t}`,k[i],!1)),await v(t,i)},U=async()=>{p||b(!0),await j(t,!0)},G=async()=>{p?(b(!1),await v(`search-${t}`,"",!1)):b(!0),await j(t,!0)},ve=Array.isArray(l.value)?y??(l.value.length>1&&q?q:w):y??k[l.value];return a.jsxs(qe,{className:e,error:$.error,hideFooter:!u&&o,isOptional:g,label:w,name:`search-${t}`,showError:$.touched&&!!$.error,smallLabel:O,inline:A,description:ue,children:[a.jsxs("div",{className:R(E["multi-select-autocomplete-container"],e),onKeyDown:ge,ref:F,children:[a.jsx(xe,{...c!==null&&{"aria-activedescendant":`option-display-${(J=V[c])==null?void 0:J.value}`},onFocus:U,placeholder:we(ve),style:{paddingLeft:d&&l.value.length>0||K?"2.2rem":"1rem"},className:E["multi-select-autocomplete-placeholder-input"],hasError:he.touched&&!!$.error,type:me,disabled:n,..._,"aria-autocomplete":"list","aria-controls":`list-${t}`,"aria-describedby":`help-${t}`,"aria-expanded":p,"aria-haspopup":"listbox","aria-required":!g,role:"combobox",leftIcon:K}),a.jsxs("div",{"aria-live":"polite","aria-relevant":"text",className:"visually-hidden",id:`help-${t}`,children:[d&&`${l.value.length} options sélectionnées`,!d&&!Array.isArray(l.value)&&l.value!==""&&`Option sélectionnée : ${k[l.value]}`,p?`${V.length} options ${_.value===""?"disponibles":"correspondant au texte saisi"}`:"saisissez du texte pour afficher et filtrer les options"]}),a.jsx("select",{hidden:!0,...d&&{multiple:!0},...l,value:l.value||"","data-testid":"select",children:f.map(({label:s,value:i})=>a.jsx("option",{value:i,children:s},`option-${i}`))}),a.jsxs("div",{className:E["field-overlay"],children:[!r&&a.jsx(M,{disabled:n,isOpen:p,toggleField:G}),d&&l.value.length>0&&a.jsx("div",{onClick:G,className:E.pellet,children:l.value.length}),p&&a.jsx(B,{className:e,fieldName:t,selectedValues:l.value,filteredOptions:V,setHoveredOptionIndex:h,listRef:I,hoveredOptionIndex:c,selectOption:D,multi:d,maxDisplayedOptions:fe})]})]}),Array.isArray(l.value)&&!u&&l.value.length>0&&a.jsx(H,{disabled:n,fieldName:t,optionsLabelById:k,selectedOptions:l.value,removeOption:D})]})};try{P.displayName="SelectAutocomplete",P.__docgenInfo={description:"",displayName:"SelectAutocomplete",props:{label:{defaultValue:null,description:"",name:"label",required:!0,type:{name:"string | Element"}},name:{defaultValue:null,description:"",name:"name",required:!0,type:{name:"string"}},description:{defaultValue:null,description:"",name:"description",required:!1,type:{name:"string"}},maxLength:{defaultValue:null,description:"",name:"maxLength",required:!1,type:{name:"number"}},isLabelHidden:{defaultValue:null,description:"",name:"isLabelHidden",required:!1,type:{name:"boolean"}},hasLabelLineBreak:{defaultValue:null,description:"",name:"hasLabelLineBreak",required:!1,type:{name:"boolean"}},isOptional:{defaultValue:{value:"false"},description:"",name:"isOptional",required:!1,type:{name:"boolean"}},className:{defaultValue:null,description:"",name:"className",required:!1,type:{name:"string"}},classNameLabel:{defaultValue:null,description:"",name:"classNameLabel",required:!1,type:{name:"string"}},classNameFooter:{defaultValue:null,description:"",name:"classNameFooter",required:!1,type:{name:"string"}},filterVariant:{defaultValue:null,description:"",name:"filterVariant",required:!1,type:{name:"boolean"}},smallLabel:{defaultValue:{value:"false"},description:"",name:"smallLabel",required:!1,type:{name:"boolean"}},hideFooter:{defaultValue:{value:"false"},description:"",name:"hideFooter",required:!1,type:{name:"boolean"}},inline:{defaultValue:null,description:"",name:"inline",required:!1,type:{name:"boolean"}},clearButtonProps:{defaultValue:null,description:"",name:"clearButtonProps",required:!1,type:{name:"(ButtonHTMLAttributes<HTMLButtonElement> & { tooltip: string; })"}},ErrorDetails:{defaultValue:null,description:"",name:"ErrorDetails",required:!1,type:{name:"ReactNode"}},disabled:{defaultValue:{value:"false"},description:"",name:"disabled",required:!1,type:{name:"boolean"}},hideArrow:{defaultValue:null,description:"",name:"hideArrow",required:!1,type:{name:"boolean"}},hideTags:{defaultValue:{value:"false"},description:"",name:"hideTags",required:!1,type:{name:"boolean"}},maxHeight:{defaultValue:null,description:"",name:"maxHeight",required:!1,type:{name:"number"}},multi:{defaultValue:{value:"false"},description:"",name:"multi",required:!1,type:{name:"boolean"}},options:{defaultValue:null,description:"",name:"options",required:!0,type:{name:"SelectOption[]"}},placeholder:{defaultValue:null,description:"",name:"placeholder",required:!1,type:{name:"string"}},pluralLabel:{defaultValue:null,description:"",name:"pluralLabel",required:!1,type:{name:"string"}},resetOnOpen:{defaultValue:{value:"true"},description:"",name:"resetOnOpen",required:!1,type:{name:"boolean"}},onSearch:{defaultValue:{value:"() => {}"},description:"",name:"onSearch",required:!1,type:{name:"((pattern: string) => void)"}},searchInOptions:{defaultValue:{value:`(options, pattern) =>
    options.filter((opt) =>
      opt.label.toLowerCase().includes(pattern.trim().toLowerCase())
    )`},description:"",name:"searchInOptions",required:!1,type:{name:"((options: SelectOption[], pattern: string) => SelectOption[])"}},onReset:{defaultValue:{value:"() => {}"},description:"",name:"onReset",required:!1,type:{name:"(() => void)"}},type:{defaultValue:{value:"text"},description:"",name:"type",required:!1,type:{name:"enum",value:[{value:'"search"'},{value:'"text"'}]}},leftIcon:{defaultValue:null,description:"",name:"leftIcon",required:!1,type:{name:"string"}},maxDisplayedOptions:{defaultValue:null,description:"",name:"maxDisplayedOptions",required:!1,type:{name:"number"}}}}}catch{}const ze=e=>a.jsx(Ve,{initialValues:e.initialValues,onSubmit:()=>{},children:a.jsx(P,{...e})}),nt={title:"ui-kit/forms/SelectAutocomplete",component:ze},W={pluralLabel:"Départements",name:"departement",options:[{value:"01",label:"Ain"},{value:"02",label:"Aisne"},{value:"03",label:"Allier"},{value:"04",label:"Alpes-de-Haute-Provence test de libellé très long"},{value:"05",label:"Hautes-Alpes"},{value:"06",label:"Alpes-Maritimes"},{value:"07",label:"Ardèche"},{value:"08",label:"Ardennes"},{value:"09",label:"Ariège"},{value:"10",label:"Aube"},{value:"11",label:"Aude"},{value:"12",label:"Aveyron"},{value:"13",label:"Bouches-du-Rhône"},{value:"14",label:"Calvados"},{value:"15",label:"Cantal"}],initialValues:{departement:"01","search-departement":""},label:"Département",hideFooter:!1,hideTags:!1,isOptional:!1,smallLabel:!1,searchInOptions:Ae},C={args:{...W}},T={args:{...W,multi:!0,initialValues:{departement:["01","02"],"search-departement":""}}},z={args:{...W,multi:!0,initialValues:{departement:["01","02"],"search-departement":""},hideTags:!0}};var Z,ee,te;C.parameters={...C.parameters,docs:{...(Z=C.parameters)==null?void 0:Z.docs,source:{originalSource:`{
  args: {
    ...defaultProps
  }
}`,...(te=(ee=C.parameters)==null?void 0:ee.docs)==null?void 0:te.source}}};var ae,le,re;T.parameters={...T.parameters,docs:{...(ae=T.parameters)==null?void 0:ae.docs,source:{originalSource:`{
  args: {
    ...defaultProps,
    multi: true,
    initialValues: {
      departement: ['01', '02'],
      'search-departement': ''
    }
  }
}`,...(re=(le=T.parameters)==null?void 0:le.docs)==null?void 0:re.source}}};var ne,se,ie;z.parameters={...z.parameters,docs:{...(ne=z.parameters)==null?void 0:ne.docs,source:{originalSource:`{
  args: {
    ...defaultProps,
    multi: true,
    initialValues: {
      departement: ['01', '02'],
      'search-departement': ''
    },
    hideTags: true
  }
}`,...(ie=(se=z.parameters)==null?void 0:se.docs)==null?void 0:ie.source}}};const st=["Default","Multi","WithoutTags"];export{C as Default,T as Multi,z as WithoutTags,st as __namedExportsOrder,nt as default};
