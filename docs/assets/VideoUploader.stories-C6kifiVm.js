import{j as e}from"./jsx-runtime-Ctlt9gRn.js";import{a as E,P as D}from"./reducer-A0Vn4gKj.js";import{V as I}from"./index-AhyiRZnw.js";import{c as S}from"./testUtils-ClBjeN4C.js";import{r as s}from"./iframe-RWcxeC9S.js";import{f as q}from"./full-edit-CxAaM2Fv.js";import{f as L}from"./full-more-DLJb58kc.js";import{f as A}from"./full-trash-CEfIUI4M.js";import{s as F}from"./stroke-video-Cd5kQZzx.js";import{a as U}from"./api-CJVqaNVC.js";import{a as M,S as P,I as Y,u as B,E as k}from"./constants-BPrPvDpG.js";import{n as x}from"./noop-BjFrJKj1.js";import{B as c}from"./Button-Crb9M7eR.js";import{B as v}from"./types-yVZEaApa.js";import{S as H}from"./SvgIcon-yZrLqVAg.js";import{T as z}from"./Tag-BmIhooSP.js";import{D as j,C as G}from"./DialogBuilder-bjAxIEAR.js";import{T as $}from"./TextInput-DFh1ucN_.js";import"./chunk-UIGDSWPH-B4pim_xz.js";import"./config-BqmKEuqZ.js";import"./preload-helper-PPVm8Dsz.js";import"./index-CxUHQqt2.js";import"./stroke-pass-CALgybTM.js";import"./Tooltip-jt11E3Ko.js";import"./Button.module-CY1ZDZvt.js";import"./full-thumb-up-Bb4kpRpM.js";import"./index-C_gyfimD.js";import"./index-BnodU22y.js";import"./index-wcGV1rkf.js";import"./tslib.es6-BUas5LQb.js";import"./stroke-close-DnlFsd1c.js";import"./FieldFooter-BCpqRn_a.js";import"./full-error-BFAmjN4t.js";import"./index.module-DEm4k2Wu.js";import"./FieldHeader-BvheJdsa.js";const W=o=>o.user.currentUser,R=s.createContext({setVideoUrl:x,videoData:void 0,handleVideoOnSubmit:async()=>{throw new Error("VideoUploaderContext not provided")},onVideoUpload:x,onVideoDelete:x,offerId:void 0}),N=()=>s.useContext(R);function C({children:o,initialVideoData:i,offerId:t}){const[a,r]=s.useState(i?.videoUrl),[l,n]=s.useState(i),h=async({onSuccess:d,onError:O})=>{if(a)try{const V=await U.getOfferVideoMetadata(a);n(V),d()}catch(V){const T=M(V);O(T)}},_=()=>{r(void 0),n(void 0)},u=s.useCallback(async()=>await U.patchDraftOffer(t,{videoUrl:a??""}),[a,t]);return e.jsx(R.Provider,{value:{videoUrl:a,videoData:l,handleVideoOnSubmit:u,setVideoUrl:r,onVideoUpload:h,onVideoDelete:_,offerId:t},children:o})}try{C.displayName="VideoUploaderContextProvider",C.__docgenInfo={description:"",displayName:"VideoUploaderContextProvider",props:{offerId:{defaultValue:null,description:"",name:"offerId",required:!0,type:{name:"number"}},initialVideoData:{defaultValue:null,description:"",name:"initialVideoData",required:!1,type:{name:"VideoData"}}}}}catch{}const m={"video-preview":"_video-preview_ma276_1","video-duration":"_video-duration_ma276_15","video-image":"_video-image_ma276_21","video-title":"_video-title_ma276_27"};function Z(o){return Math.round(o/60).toLocaleString("fr-FR",{minimumFractionDigits:0,maximumFractionDigits:1})}const w=({videoDuration:o,videoTitle:i,videoThumbnailUrl:t})=>e.jsxs("div",{className:m["video-preview"],children:[e.jsx(P,{alt:"Prévisualisation de l’image",className:m["video-image"],src:t,placeholder:e.jsx(Y,{})}),e.jsx("span",{className:m["video-duration"],children:e.jsx(z,{label:`${Z(o??0)} min`})}),e.jsx("p",{className:m["video-title"],children:i})]});try{w.displayName="VideoPreview",w.__docgenInfo={description:"",displayName:"VideoPreview",props:{videoDuration:{defaultValue:null,description:"",name:"videoDuration",required:!1,type:{name:"number | null"}},videoTitle:{defaultValue:null,description:"",name:"videoTitle",required:!1,type:{name:"string | null"}},videoThumbnailUrl:{defaultValue:null,description:"",name:"videoThumbnailUrl",required:!0,type:{name:"string"}}}}}catch{}const J=new RegExp(/^(https?:\/\/)(www\.)?(m\.)?(youtube\.com\b|youtu\.be\b)(\/watch\?v=|\/embed\/|\/v\/|\/e\/|\/)([\w-]{11}\b)/),y=o=>{const i="Veuillez renseigner une URL valide. Ex : https://exemple.com",t="Veuillez renseigner une URL provenant de la plateforme Youtube. Les shorts et les chaînes ne sont pas acceptées.";if(!o||o.trim()==="")return t;try{const r=new URL(o).hostname.toLowerCase();return(r==="youtu.be"||r==="www.youtu.be"||r==="youtube.com"||r==="www.youtube.com"||r==="www.m.youtube.com"||r==="m.youtube.com")&&J.test(o)?void 0:t}catch{return i}},K=""+new URL("youtube-logo-DoyiBwVG.png",import.meta.url).href,b={"modal-video":"_modal-video_1esiw_1","modal-video-content":"_modal-video-content_1esiw_7","modal-video-footer":"_modal-video-footer_1esiw_12"},g=({...o})=>{const[i,t]=s.useState(),{videoUrl:a,onVideoUpload:r,setVideoUrl:l,offerId:n}=N(),h=E(W),{logEvent:_}=B();return e.jsx(j,{...o,title:"Ajouter une vidéo",imageTitle:e.jsx("img",{alt:"",src:K}),variant:"drawer",children:e.jsxs("div",{className:b["modal-video"],children:[e.jsx("div",{className:b["modal-video-content"],children:e.jsx($,{name:"videoUrl",label:"Lien URL Youtube",description:"Format : https://www.youtube.com/watch?v=0R5PZxOgoz8",error:i,value:a??"",onBlur:u=>{const d=u.target.value;t(y(d)),d&&y(d)&&_(k.OFFER_FORM_VIDEO_URL_ERROR,{offerId:n,userId:h?.id,videoUrl:d})},onChange:u=>{l(u.target.value)}})}),e.jsx(j.Footer,{children:e.jsxs("div",{className:b["modal-video-footer"],children:[e.jsx(G,{asChild:!0,children:e.jsx(c,{variant:v.SECONDARY,children:"Annuler"})}),e.jsx(c,{onClick:async()=>{a&&!y(a)&&await r({onSuccess:()=>{o.onOpenChange?.(!1)},onError:t})},children:"Ajouter"})]})})]})})};try{g.displayName="ModalVideo",g.__docgenInfo={description:"",displayName:"ModalVideo",props:{className:{defaultValue:null,description:"Custom CSS class for additional styling of the dialog content.",name:"className",required:!1,type:{name:"string"}},title:{defaultValue:null,description:"The heading title of the dialog.",name:"title",required:!1,type:{name:"string"}},variant:{defaultValue:null,description:"",name:"variant",required:!1,type:{name:"enum",value:[{value:'"default"'},{value:'"drawer"'}]}},trigger:{defaultValue:null,description:"The trigger element that opens the dialog.",name:"trigger",required:!1,type:{name:"ReactNode"}},open:{defaultValue:null,description:"Controls the open state of the dialog.",name:"open",required:!1,type:{name:"boolean"}},refToFocusOnClose:{defaultValue:null,description:`Ref of the element to focus on when the dialog is closed.
If refToFocusOnClose.current is null, the trigger element will be focused as a fallback.`,name:"refToFocusOnClose",required:!1,type:{name:"RefObject<HTMLElement>"}},imageTitle:{defaultValue:null,description:"An image for the title.",name:"imageTitle",required:!1,type:{name:"ReactNode"}},defaultOpen:{defaultValue:{value:"false"},description:"Determines if the dialog is open by default.",name:"defaultOpen",required:!1,type:{name:"boolean"}},onOpenChange:{defaultValue:null,description:"Callback function triggered when the open state of the dialog changes.",name:"onOpenChange",required:!1,type:{name:"((open: boolean) => void)"}},closeButtonClassName:{defaultValue:null,description:"Custom CSS class for additional styling of the close button.",name:"closeButtonClassName",required:!1,type:{name:"string"}}}}}catch{}const p={"video-uploader-container":"_video-uploader-container_6b2er_1","video-uploader-no-video":"_video-uploader-no-video_6b2er_5","action-wrapper":"_action-wrapper_6b2er_21","video-uploader-text-subtle":"_video-uploader-text-subtle_6b2er_30"},Q=()=>{const[o,i]=s.useState(!1),{videoData:t,onVideoDelete:a}=N(),{videoDuration:r,videoTitle:l,videoThumbnailUrl:n}=t??{};return e.jsx("div",{className:p["video-uploader-container"],children:n?e.jsxs(e.Fragment,{children:[e.jsx(w,{videoDuration:r,videoTitle:l,videoThumbnailUrl:n}),e.jsxs("div",{className:p["action-wrapper"],children:[e.jsx(g,{onOpenChange:i,open:o,trigger:e.jsx(c,{variant:v.TERNARY,icon:q,children:"Modifier"})}),e.jsx(c,{variant:v.TERNARY,icon:A,onClick:a,children:"Supprimer"})]})]}):e.jsxs("div",{className:p["video-uploader-no-video"],children:[e.jsx(H,{src:F,alt:"",width:"44"}),e.jsx(g,{onOpenChange:i,open:o,trigger:e.jsx(c,{variant:v.TERNARY,icon:L,children:"Ajouter une URL Youtube"})}),e.jsx("p",{className:p["video-uploader-text-subtle"],children:"Affichage de la prévisualisation ici"})]})})},Se={title:"@/components/VideoUploader/VideoUploader",component:Q,decorators:[I,o=>e.jsx(D,{store:S({}),children:e.jsx(o,{})})]},f={args:{}};f.parameters={...f.parameters,docs:{...f.parameters?.docs,source:{originalSource:`{
  args: {}
}`,...f.parameters?.docs?.source}}};const qe=["WithoutImage"];export{f as WithoutImage,qe as __namedExportsOrder,Se as default};
