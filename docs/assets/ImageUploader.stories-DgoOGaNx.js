import{j as e}from"./jsx-runtime-DbeYx_Dw.js";import{P as qe}from"./useAppDispatch-COIVvKMj.js";import{V as Pe}from"./index-Bpy6Nwhb.js";import{c as Fe}from"./testUtils-DelJUT6R.js";import{c as j}from"./index-CjwQtLEB.js";import{g as Le,S as De,I as Be}from"./helpers-D_kRhd29.js";import{r as m}from"./iframe-BwQU0pJA.js";import{f as he}from"./full-trash-CEfIUI4M.js";import{B as y}from"./Button-BdXeYC63.js";import{B as E}from"./types-yVZEaApa.js";import{S as _e}from"./SvgIcon-BPxEhyy7.js";import{C as Te}from"./ConfirmDialog-CYxImPLC.js";import{s as Ae}from"./stroke-trash-Cc_5v2lW.js";import{D as se,C as me}from"./DialogBuilder-C5Pg7UCP.js";import{u as Me,E as We}from"./constants-CMgVrKA0.js";import{u as ze}from"./useNotification-BDHmdtLi.js";import{I as ke}from"./ImageDragAndDrop-CMgmk_g9.js";import{T as He}from"./TextInput-CBrVfiCb.js";import{f as Ye}from"./full-download-XQM5pv74.js";import{C as $e,a as Ge}from"./Callout-TEBbitCb.js";import{S as ce}from"./Spinner-Cn8oMbo0.js";import{I as Xe}from"./ImageEditor-C7popE2C.js";import{I as ve,a as L}from"./ImagePreviewsWrapper-DDN2EuuP.js";import{f as Je}from"./full-edit-CxAaM2Fv.js";import{f as Ke}from"./full-more-DLJb58kc.js";import"./chunk-WWGJGFF6-Du42MpZf.js";import"./store-DhqxJv79.js";import"./preload-helper-PPVm8Dsz.js";import"./stroke-pass-CALgybTM.js";import"./Tooltip-CKVb5IPO.js";import"./Button.module-CY1ZDZvt.js";import"./stroke-error-DSZD431a.js";import"./Dialog-EORY7qUr.js";import"./index-D_Yj74_D.js";import"./index-CvS5y3HM.js";import"./index-CD4J9A66.js";import"./tslib.es6-BUas5LQb.js";import"./stroke-close-DnlFsd1c.js";import"./config-BqmKEuqZ.js";import"./index-Dzua7qeE.js";import"./index-Chjiymov.js";import"./full-validate-CbMNulkZ.js";import"./stroke-picture-VF2OicDu.js";import"./FieldFooter-B1P9nUi3.js";import"./full-error-BFAmjN4t.js";import"./index.module-DoTMqiF9.js";import"./FieldHeader-CtnklYpy.js";import"./full-info-D24AtBVt.js";import"./full-warning-LoKhBeYn.js";import"./full-link-CYVo23DH.js";import"./full-next-B_76kGmE.js";import"./ButtonLink-WnyttYIU.js";import"./Slider-B5oUw0GO.js";const de=""+new URL("sample-image-landscape-B4GmPBHc.jpg",import.meta.url).href,pe=""+new URL("sample-image-portrait-OorsIixL.jpg",import.meta.url).href;var i=(a=>(a.OFFER="offer",a.OFFER_COLLECTIVE="offer_collective",a.VENUE="venue",a))(i||{});const Qe={"button-image-delete-icon":"_button-image-delete-icon_19z4s_1"},$=({isLoading:a,onConfirm:t,onDismiss:r,isDialogOpen:s,trigger:n})=>e.jsx(Te,{cancelText:"Retour",confirmText:"Supprimer",icon:Ae,isLoading:a,onCancel:r,onConfirm:t,title:"Supprimer l’image",open:s,trigger:n,children:"Souhaitez-vous vraiment supprimer cette image ?"});try{$.displayName="ModalImageDelete",$.__docgenInfo={description:"",displayName:"ModalImageDelete",props:{isLoading:{defaultValue:null,description:"",name:"isLoading",required:!0,type:{name:"boolean"}},onConfirm:{defaultValue:null,description:"",name:"onConfirm",required:!0,type:{name:"() => void"}},onDismiss:{defaultValue:null,description:"",name:"onDismiss",required:!0,type:{name:"() => void"}},isDialogOpen:{defaultValue:null,description:"",name:"isDialogOpen",required:!0,type:{name:"boolean"}},trigger:{defaultValue:null,description:"",name:"trigger",required:!0,type:{name:"ReactNode"}}}}}catch{}const G=({onImageDelete:a})=>{const[t,r]=m.useState(!1),[s,n]=m.useState(!1),c=()=>{n(!0),a()};return e.jsx($,{isLoading:s,onConfirm:c,onDismiss:()=>r(!1),isDialogOpen:t,trigger:e.jsxs(y,{onClick:()=>r(!0),variant:E.TERNARY,children:[e.jsx(_e,{alt:"",className:Qe["button-image-delete-icon"],src:he}),"Supprimer"]})})};try{G.displayName="ButtonImageDelete",G.__docgenInfo={description:"",displayName:"ButtonImageDelete",props:{onImageDelete:{defaultValue:null,description:"",name:"onImageDelete",required:!0,type:{name:"() => void"}}}}}catch{}const Ze=async a=>(window.createImageBitmap||(window.createImageBitmap=t=>new Promise(r=>{const s=document.createElement("img");s.addEventListener("load",function(){r(this)}),s.src=URL.createObjectURL(t)})),await createImageBitmap(a).catch(()=>null)),ea=a=>{const[t,r]=m.useState(0),[s,n]=m.useState(0);return m.useEffect(()=>{(async()=>{if(a){const o=await Ze(a);o&&(r(o.width),n(o.height))}})()},[a]),a?{width:t,height:s}:{width:0,height:0}},q=(a,t)=>a+t/2,aa=a=>100/(a*100),ta=""+new URL("offer-home-shell-Ch3YT9j3.png",import.meta.url).href,ra=""+new URL("offer-shell-coq2oAbe.png",import.meta.url).href,ge={"image-preview-shell":"_image-preview-shell_98ykx_1","image-preview-home-preview":"_image-preview-home-preview_98ykx_7"},Y={"image-preview-shell":"_image-preview-shell_4wqwh_1","image-preview-blur-offer-preview":"_image-preview-blur-offer-preview_4wqwh_7","image-preview-offer-preview":"_image-preview-offer-preview_4wqwh_16"},X=({imageUrl:a})=>e.jsxs(ve,{children:[e.jsxs(L,{title:"Page d’accueil",children:[e.jsx("img",{alt:"",className:ge["image-preview-shell"],src:ta}),e.jsx("img",{"data-testid":"app-preview-offer-img-home",alt:"",className:ge["image-preview-home-preview"],src:a})]}),e.jsxs(L,{title:"Détails de l’offre",children:[e.jsx("img",{alt:"",className:Y["image-preview-blur-offer-preview"],src:a}),e.jsx("img",{alt:"",className:Y["image-preview-shell"],src:ra}),e.jsx("img",{"data-testid":"app-preview-offer-img",alt:"",className:Y["image-preview-offer-preview"],src:a})]})]});try{X.displayName="AppPreviewOffer",X.__docgenInfo={description:"",displayName:"AppPreviewOffer",props:{imageUrl:{defaultValue:null,description:"",name:"imageUrl",required:!0,type:{name:"string"}}}}}catch{}const ia=""+new URL("partner-home-shell-QX5a1P1s.png",import.meta.url).href,oa=""+new URL("partner-shell-D59I5gaY.png",import.meta.url).href,ue={"image-preview-shell":"_image-preview-shell_1isbc_1","image-preview-home-preview":"_image-preview-home-preview_1isbc_7"},fe={"image-preview-shell":"_image-preview-shell_1dg34_1","image-preview-offer-preview":"_image-preview-offer-preview_1dg34_7"},J=({imageUrl:a})=>e.jsxs(ve,{children:[e.jsxs(L,{title:"Page d’accueil",children:[e.jsx("img",{alt:"",className:ue["image-preview-shell"],src:ia}),e.jsx("img",{"data-testid":"app-preview-offer-img-home",alt:"",className:ue["image-preview-home-preview"],src:a})]}),e.jsxs(L,{title:"Détails de l’offre",children:[e.jsx("img",{alt:"",className:fe["image-preview-shell"],src:oa}),e.jsx("img",{"data-testid":"app-preview-offer-img",alt:"",className:fe["image-preview-offer-preview"],src:a})]})]});try{J.displayName="AppPreviewVenue",J.__docgenInfo={description:"",displayName:"AppPreviewVenue",props:{imageUrl:{defaultValue:null,description:"",name:"imageUrl",required:!0,type:{name:"string"}}}}}catch{}const d={"modal-image-crop":"_modal-image-crop_1s1z0_1","modal-image-crop-content":"_modal-image-crop-content_1s1z0_8","modal-image-crop-subwrapper":"_modal-image-crop-subwrapper_1s1z0_11","modal-image-crop-editor":"_modal-image-crop-editor_1s1z0_22","modal-image-crop-editor-loading":"_modal-image-crop-editor-loading_1s1z0_30","modal-image-crop-callout":"_modal-image-crop-callout_1s1z0_33","modal-image-crop-callout-list":"_modal-image-crop-callout-list_1s1z0_36","modal-image-crop-actions":"_modal-image-crop-actions_1s1z0_40","modal-image-crop-right":"_modal-image-crop-right_1s1z0_47","modal-image-crop-credit":"_modal-image-crop-credit_1s1z0_53","modal-image-crop-credit-loading":"_modal-image-crop-credit-loading_1s1z0_57","modal-image-crop-footer":"_modal-image-crop-footer_1s1z0_60"},na=({originalDimensions:a,orientation:t})=>t==="landscape"?{width:Math.floor(Math.min(a.width,a.height/2*3)),height:Math.floor(Math.min(a.height,a.width/3*2))}:{width:Math.floor(Math.min(a.width,a.height/3*2)),height:Math.floor(Math.min(a.height,a.width/2*3))},la=(a,t,r)=>{const s={[i.OFFER]:400,[i.OFFER_COLLECTIVE]:400,[i.VENUE]:600}[r],{width:n}=na({originalDimensions:{width:a,height:t},orientation:r===i.VENUE?"landscape":"portrait"}),c=Math.min(4,(n-10)/s),o={[i.OFFER]:297,[i.OFFER_COLLECTIVE]:297,[i.VENUE]:138}[r];return{[i.OFFER]:{canvasHeight:o,canvasWidth:o*2/3,cropBorderHeight:50,cropBorderWidth:105,maxScale:c},[i.OFFER_COLLECTIVE]:{canvasHeight:o,canvasWidth:o*2/3,cropBorderHeight:50,cropBorderWidth:105,maxScale:c},[i.VENUE]:{canvasHeight:o,canvasWidth:o*3/2,cropBorderHeight:40,cropBorderWidth:100,maxScale:c}}[r]},K=({mode:a,onImageUpload:t,onImageDelete:r,initialValues:s={},...n})=>{const{logEvent:c}=Me(),{draftImage:o,...x}=s,p={x:.5,y:.5},{croppedImageUrl:_,originalImageUrl:B,credit:g,cropParams:V}=x,u=B||_,{xCropPercent:U,yCropPercent:N,heightCropPercent:Z,widthCropPercent:O}=V||{},ee=U&&O?q(U,O):p.x,ae=N&&Z?q(N,Z):p.y,v=m.useRef(null),S=ze(),[T,te]=m.useState(!!u),[A,M]=m.useState(!0),[f,R]=m.useState(o),[re,ie]=m.useState(u),[Ie,W]=m.useState({x:ee,y:ae}),[oe,b]=m.useState(g??""),ne=O?aa(O):1,[we,le]=m.useState(ne),{width:z,height:k}=ea(f),ye=la(z,k,a),xe=a===i.OFFER&&(z&&z<400||k&&k<600),Ce={[i.VENUE]:J,[i.OFFER]:X,[i.OFFER_COLLECTIVE]:()=>e.jsx(e.Fragment,{})}[a];m.useEffect(()=>{async function l(I){try{R(await Le(I))}catch{S.error("Erreur lors de la récupération de votre image.")}te(!1)}n.open&&u&&l(u)},[n.open,u,S]),m.useEffect(()=>{R(o),o&&te(!1)},[o]),m.useEffect(()=>{b(g??"")},[g]);const Ee=()=>{R(void 0),W({x:p.x,y:p.y}),b(""),le(1)},je=()=>{W({x:ee,y:ae}),b(g??""),le(ne)},Ve=()=>Ee(),Ue=l=>{M(!0),R(l),H()},Ne=(l,I,h)=>{f&&(c(We.CLICKED_SAVE_IMAGE,{imageType:a,imageCreationStage:"save"}),t({imageFile:f,imageCroppedDataUrl:I,cropParams:h,credit:l},l===g?"Votre image a bien été importée":"Vos modifications ont bien été prises en compte"))},Oe=()=>{if(v.current){const l=v.current.getImage();ie(l.toDataURL()),M(!1)}},Se=()=>{M(!1),S.error("Erreur lors de la récupération de votre image.")},H=l=>{try{if(v.current){const I=v.current.getImage();ie(I.toDataURL());const h=v.current.getCroppingRect();W({x:q(h.x,h.width),y:q(h.y,h.height)}),l&&l(oe,I.toDataURL(),h)}}catch{S.error("Une erreur est survenue. Merci de réessayer plus tard")}},Re=()=>H(),be=()=>H(Ne);return e.jsx(se,{...n,onOpenChange:l=>{l||je(),n.onOpenChange?.(l)},title:"Modifier une image",variant:"drawer",children:e.jsxs("form",{className:d["modal-image-crop"],children:[e.jsxs("div",{className:d["modal-image-crop-content"],children:[e.jsx("p",{className:d["modal-image-crop-right"],children:"En utilisant ce contenu, je certifie que je suis propriétaire ou que je dispose des autorisations nécessaires pour l’utilisation de celui-ci."}),T&&e.jsx(ce,{testId:"spinner-img-load"}),!T&&f&&e.jsxs(e.Fragment,{children:[A&&e.jsx(ce,{testId:"spinner-img-paint"}),e.jsxs("div",{className:j(d["modal-image-crop-subwrapper"],A&&d["modal-image-crop-editor-loading"]),children:[e.jsxs("div",{className:d["modal-image-crop-editor"],children:[e.jsx(Xe,{ref:v,...ye,image:f,initialPosition:Ie,initialScale:we,onChangeDone:Re,onImagePainted:Oe,onImageError:Se}),e.jsxs("div",{className:d["modal-image-crop-actions"],children:[e.jsx(y,{icon:Ye,onClick:Ve,variant:E.TERNARY,children:"Remplacer l’image"}),e.jsx(me,{asChild:!0,children:e.jsx(y,{icon:he,onClick:r,variant:E.TERNARY,children:"Supprimer l’image"})})]})]}),re&&e.jsx(Ce,{imageUrl:re})]}),xe&&e.jsx($e,{className:d["modal-image-crop-callout"],variant:Ge.WARNING,children:e.jsxs("div",{children:["La qualité de votre image n’est pas optimale.",e.jsx("br",{}),"Le format recommandé :",e.jsxs("ul",{className:d["modal-image-crop-callout-list"],children:[e.jsx("li",{children:"Largeur minimale de l’image : 400 px"}),e.jsx("li",{children:"Hauteur minimale de l’image : 600 px"})]})]})}),e.jsx("div",{className:j(d["modal-image-crop-credit"],A&&d["modal-image-crop-credit-loading"]),children:e.jsx(He,{label:"Crédit de l’image",name:"credit",maxCharactersCount:255,value:oe,onChange:l=>b(l.target.value)})})]}),!T&&!f&&e.jsx(ke,{onDropOrSelected:Ue,...a!==i.OFFER?{minSizes:{width:600,height:400}}:{}})]}),e.jsx(se.Footer,{children:e.jsxs("div",{className:d["modal-image-crop-footer"],children:[e.jsx(me,{asChild:!0,children:e.jsx(y,{variant:E.SECONDARY,children:"Annuler"})}),e.jsx(y,{type:"submit",onClick:l=>{l.preventDefault(),be()},disabled:!f,children:"Importer"})]})})]})})};try{K.displayName="ModalImageUpsertOrEdit",K.__docgenInfo={description:"",displayName:"ModalImageUpsertOrEdit",props:{mode:{defaultValue:null,description:"",name:"mode",required:!0,type:{name:"enum",value:[{value:'"offer"'},{value:'"offer_collective"'},{value:'"venue"'}]}},onImageUpload:{defaultValue:null,description:"",name:"onImageUpload",required:!0,type:{name:"(values: OnImageUploadArgs, successMessage: string) => void"}},onImageDelete:{defaultValue:null,description:"",name:"onImageDelete",required:!1,type:{name:"(() => void)"}},initialValues:{defaultValue:{value:"{}"},description:"",name:"initialValues",required:!1,type:{name:"UploadImageValues"}},className:{defaultValue:null,description:"Custom CSS class for additional styling of the dialog content.",name:"className",required:!1,type:{name:"string"}},title:{defaultValue:null,description:"The heading title of the dialog.",name:"title",required:!1,type:{name:"string"}},trigger:{defaultValue:null,description:"The trigger element that opens the dialog.",name:"trigger",required:!1,type:{name:"ReactNode"}},open:{defaultValue:null,description:"Controls the open state of the dialog.",name:"open",required:!1,type:{name:"boolean"}},refToFocusOnClose:{defaultValue:null,description:`Ref of the element to focus on when the dialog is closed.
If refToFocusOnClose.current is null, the trigger element will be focused as a fallback.`,name:"refToFocusOnClose",required:!1,type:{name:"RefObject<HTMLElement>"}},variant:{defaultValue:null,description:"",name:"variant",required:!1,type:{name:"enum",value:[{value:'"default"'},{value:'"drawer"'}]}},closeButtonClassName:{defaultValue:null,description:"Custom CSS class for additional styling of the close button.",name:"closeButtonClassName",required:!1,type:{name:"string"}},imageTitle:{defaultValue:null,description:"An image for the title.",name:"imageTitle",required:!1,type:{name:"ReactNode"}},defaultOpen:{defaultValue:{value:"false"},description:"Determines if the dialog is open by default.",name:"defaultOpen",required:!1,type:{name:"boolean"}},onOpenChange:{defaultValue:null,description:"Callback function triggered when the open state of the dialog changes.",name:"onOpenChange",required:!1,type:{name:"((open: boolean) => void)"}}}}}catch{}const sa="_label_11uqh_22",ma="_icon_11uqh_32",C={"button-image-add":"_button-image-add_11uqh_1","add-image-venue":"_add-image-venue_11uqh_14","add-image-offer":"_add-image-offer_11uqh_18",label:sa,icon:ma},D=({mode:a,initialValues:t={},onImageUpload:r,onImageDelete:s,onClickButtonImage:n,children:c,disableForm:o})=>{const{croppedImageUrl:x,originalImageUrl:p}=t,_=x||p,[B,g]=m.useState(!1),V=()=>{n&&n()},u=()=>{s()};function U(N){r(N),g(!1)}return e.jsx(K,{mode:a,onImageUpload:U,onImageDelete:u,initialValues:t,onOpenChange:g,open:B,trigger:_?e.jsx(y,{onClick:V,variant:E.TERNARY,"aria-label":"Modifier l’image",icon:Je,children:c??"Modifier"}):e.jsxs("button",{className:j(C["button-image-add"],{[C["add-image-venue"]]:a===i.VENUE,[C["add-image-offer"]]:a===i.OFFER||a===i.OFFER_COLLECTIVE}),onClick:V,type:"button",disabled:o,children:[e.jsx(_e,{src:Ke,alt:"",className:C.icon}),e.jsx("span",{className:C.label,children:"Ajouter une image"})]})})};try{D.displayName="ButtonImageEdit",D.__docgenInfo={description:"",displayName:"ButtonImageEdit",props:{onImageUpload:{defaultValue:null,description:"",name:"onImageUpload",required:!0,type:{name:"(values: OnImageUploadArgs) => void"}},onImageDelete:{defaultValue:null,description:"",name:"onImageDelete",required:!0,type:{name:"() => void"}},initialValues:{defaultValue:{value:"{}"},description:"",name:"initialValues",required:!1,type:{name:"UploadImageValues"}},mode:{defaultValue:null,description:"",name:"mode",required:!0,type:{name:"enum",value:[{value:'"offer"'},{value:'"offer_collective"'},{value:'"venue"'}]}},onClickButtonImage:{defaultValue:null,description:"",name:"onClickButtonImage",required:!1,type:{name:"(() => void)"}},disableForm:{defaultValue:null,description:"",name:"disableForm",required:!1,type:{name:"boolean"}}}}}catch{}const w={"image-uploader-image-container":"_image-uploader-image-container_3cdfp_5","image-uploader-actions-container":"_image-uploader-actions-container_3cdfp_10","actions-wrapper":"_actions-wrapper_3cdfp_17","image-preview":"_image-preview_3cdfp_25","preview-venue":"_preview-venue_3cdfp_31","placeholder-venue":"_placeholder-venue_3cdfp_42"},Q=({className:a,onImageUpload:t,onImageDelete:r,initialValues:s={},onClickButtonImageAdd:n,hideActionButtons:c=!1,disableForm:o=!1})=>{const{croppedImageUrl:x,originalImageUrl:p}=s,_=x||p;return e.jsx("div",{className:j(w["image-uploader-image-container"],a),children:_?e.jsxs(e.Fragment,{children:[e.jsx(De,{alt:"Prévisualisation de l’image","data-testid":"image-preview",className:j(w["image-preview"],w["preview-venue"]),src:_,placeholder:e.jsx(Be,{className:w["placeholder-venue"]})}),!c&&e.jsx("div",{className:w["image-uploader-actions-container"],children:e.jsxs("div",{className:w["actions-wrapper"],children:[e.jsx(D,{mode:i.VENUE,initialValues:s,onImageUpload:t,onImageDelete:r,onClickButtonImage:n,disableForm:o}),e.jsx(G,{onImageDelete:r})]})})]}):e.jsx(D,{mode:i.VENUE,onImageUpload:t,onImageDelete:r,onClickButtonImage:n,disableForm:o})})};try{Q.displayName="ImageUploader",Q.__docgenInfo={description:"",displayName:"ImageUploader",props:{className:{defaultValue:null,description:"",name:"className",required:!1,type:{name:"string"}},onImageUpload:{defaultValue:null,description:"",name:"onImageUpload",required:!0,type:{name:"(values: OnImageUploadArgs) => void"}},onImageDelete:{defaultValue:null,description:"",name:"onImageDelete",required:!0,type:{name:"() => void"}},initialValues:{defaultValue:{value:"{}"},description:"",name:"initialValues",required:!1,type:{name:"UploadImageValues"}},onClickButtonImageAdd:{defaultValue:null,description:"",name:"onClickButtonImageAdd",required:!1,type:{name:"(() => void)"}},hideActionButtons:{defaultValue:{value:"false"},description:"",name:"hideActionButtons",required:!1,type:{name:"boolean"}},disableForm:{defaultValue:{value:"false"},description:"",name:"disableForm",required:!1,type:{name:"boolean"}}}}}catch{}const dt={title:"@/components/ImageUploader/ImageUploader",component:Q,decorators:[Pe,a=>e.jsx(qe,{store:Fe({}),children:e.jsx(a,{})})]},ca={initialValues:{originalImageUrl:pe,croppedImageUrl:pe,credit:"John Do",cropParams:{xCropPercent:0,yCropPercent:0,heightCropPercent:1,widthCropPercent:1}},onImageDelete:()=>{alert("onDelete have been called.")},onImageUpload:()=>{alert("onImageUpload have been called.")}},P={args:{...ca,initialValues:{croppedImageUrl:de,originalImageUrl:de}}},F={args:{}};P.parameters={...P.parameters,docs:{...P.parameters?.docs,source:{originalSource:`{
  args: {
    ...props,
    initialValues: {
      croppedImageUrl: sampleImageLandscape,
      originalImageUrl: sampleImageLandscape
    }
  }
}`,...P.parameters?.docs?.source}}};F.parameters={...F.parameters,docs:{...F.parameters?.docs,source:{originalSource:`{
  args: {}
}`,...F.parameters?.docs?.source}}};const pt=["WithImageVenue","WithoutImage"];export{P as WithImageVenue,F as WithoutImage,pt as __namedExportsOrder,dt as default};
