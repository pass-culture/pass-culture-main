import{j as e}from"./jsx-runtime-ffb262ed.js";import{c as fe,b as Q,a as ge}from"./formik.esm-96bdd02b.js";import{c as E}from"./index-a587463d.js";import{r as d}from"./index-76fb7be0.js";import{g as ye}from"./getLabelString-a0462018.js";import{B as be,b as he}from"./BaseCheckbox-2cbf2f9d.js";import"./BaseFileInput-5547a44b.js";import{s as ve}from"./stroke-down-fe50db78.js";import{F as _e}from"./AutocompleteList-a5544a8b.js";import"./FieldError-0089fdbc.js";import"./FieldSuccess-31bdacb0.js";import{T as Ve}from"./Tag-2c2f8155.js";import{S as qe}from"./SvgIcon-c0bf369c.js";import{B as xe}from"./BaseInput-fad17e7a.js";import"./_commonjsHelpers-de833af9.js";import"./hoist-non-react-statics.cjs-3f8ebaa8.js";import"./BaseRadio-d0e61859.js";import"./full-clear-9268779e.js";import"./Tooltip-383b3df2.js";import"./stroke-error-ed5fe82d.js";import"./stroke-valid-9c345a33.js";import"./stroke-close-3a7bfe9e.js";const Oe="_menu_qqt91_2",Ne="_label_qqt91_21",T={menu:Oe,"menu--no-results":"_menu--no-results_qqt91_17",label:Ne,"option-hovered":"_option-hovered_qqt91_34"},H=({className:r,fieldName:p,selectedValues:l,filteredOptions:y,setHoveredOptionIndex:_,listRef:m,hoveredOptionIndex:I,selectOption:L,multi:A})=>e.jsxs("div",{className:E(T.menu,r),role:"listbox",children:[y.length===0&&e.jsx("span",{className:E({[T["menu--no-results"]]:y.length===0}),children:"Aucun résultat"}),e.jsx("ul",{"data-testid":"list",id:`list-${p}`,ref:m,role:"listbox",children:y.map(({value:i,label:s},b)=>{const h=(l||[]).includes(String(i));return e.jsx("li",{"aria-selected":h,"aria-posinset":b+1,"aria-setsize":y.length,className:I===b?T["option-hovered"]:"","data-value":i,"data-selected":h,id:`option-display-${i}`,onMouseEnter:()=>_(b),role:"option",tabIndex:-1,children:A?e.jsx(be,{label:s,checked:h,onChange:()=>{L(String(i))}}):e.jsx("span",{onClick:()=>{L(String(i))},className:E(he["base-checkbox-label"],T.label),children:s})},`option-display-${i}`)})})]});try{H.displayName="OptionsList",H.__docgenInfo={description:"",displayName:"OptionsList",props:{className:{defaultValue:null,description:"",name:"className",required:!1,type:{name:"string"}},fieldName:{defaultValue:null,description:"",name:"fieldName",required:!0,type:{name:"string"}},selectedValues:{defaultValue:null,description:"",name:"selectedValues",required:!0,type:{name:"string | string[] | null"}},filteredOptions:{defaultValue:null,description:"",name:"filteredOptions",required:!0,type:{name:"SelectOption[]"}},setHoveredOptionIndex:{defaultValue:null,description:"",name:"setHoveredOptionIndex",required:!0,type:{name:"(value: number | null) => void"}},listRef:{defaultValue:null,description:"",name:"listRef",required:!0,type:{name:"Ref<HTMLUListElement>"}},hoveredOptionIndex:{defaultValue:null,description:"",name:"hoveredOptionIndex",required:!0,type:{name:"number | null"}},selectOption:{defaultValue:null,description:"",name:"selectOption",required:!0,type:{name:"(value: string) => void"}},multi:{defaultValue:null,description:"",name:"multi",required:!0,type:{name:"boolean"}}}}}catch{}try{OptionsList.displayName="OptionsList",OptionsList.__docgenInfo={description:"",displayName:"OptionsList",props:{className:{defaultValue:null,description:"",name:"className",required:!1,type:{name:"string"}},fieldName:{defaultValue:null,description:"",name:"fieldName",required:!0,type:{name:"string"}},selectedValues:{defaultValue:null,description:"",name:"selectedValues",required:!0,type:{name:"string | string[] | null"}},filteredOptions:{defaultValue:null,description:"",name:"filteredOptions",required:!0,type:{name:"SelectOption[]"}},setHoveredOptionIndex:{defaultValue:null,description:"",name:"setHoveredOptionIndex",required:!0,type:{name:"(value: number | null) => void"}},listRef:{defaultValue:null,description:"",name:"listRef",required:!0,type:{name:"Ref<HTMLUListElement>"}},hoveredOptionIndex:{defaultValue:null,description:"",name:"hoveredOptionIndex",required:!0,type:{name:"number | null"}},selectOption:{defaultValue:null,description:"",name:"selectOption",required:!0,type:{name:"(value: string) => void"}},multi:{defaultValue:null,description:"",name:"multi",required:!0,type:{name:"boolean"}}}}}catch{}const Le="_pellet_sn75o_16",q={"multi-select-autocomplete-container":"_multi-select-autocomplete-container_sn75o_2","multi-select-autocomplete-placeholder-input":"_multi-select-autocomplete-placeholder-input_sn75o_8","field-overlay":"_field-overlay_sn75o_12",pellet:Le,"visually-hidden":"_visually-hidden_sn75o_34"},Ae={"multi-select-autocomplete-tags":"_multi-select-autocomplete-tags_1exsd_1"},R=({disabled:r,fieldName:p,optionsLabelById:l,selectedOptions:y,removeOption:_})=>e.jsx("div",{className:Ae["multi-select-autocomplete-tags"],children:y.map(m=>e.jsx(Ve,{label:l[m],closeable:{closeLabel:"Supprimer "+l[m],onClose:()=>{_(m)},disabled:r}},`tag-${p}-${m}`))});try{R.displayName="Tags",R.__docgenInfo={description:"",displayName:"Tags",props:{disabled:{defaultValue:null,description:"",name:"disabled",required:!0,type:{name:"boolean"}},fieldName:{defaultValue:null,description:"",name:"fieldName",required:!0,type:{name:"string"}},optionsLabelById:{defaultValue:null,description:"",name:"optionsLabelById",required:!0,type:{name:"Record<string, string>"}},selectedOptions:{defaultValue:null,description:"",name:"selectedOptions",required:!0,type:{name:"string[]"}},removeOption:{defaultValue:null,description:"",name:"removeOption",required:!0,type:{name:"(value: string) => void"}}}}}catch{}const Se={"dropdown-indicator":"_dropdown-indicator_1fr35_2"},B=({disabled:r,isOpen:p,toggleField:l})=>e.jsx("button",{onClick:l,className:Se["dropdown-indicator"],type:"button",disabled:r,children:e.jsx(qe,{src:ve,alt:`${p?"Masquer":"Afficher"} les options`,width:"20"})});try{B.displayName="Toggle",B.__docgenInfo={description:"",displayName:"Toggle",props:{disabled:{defaultValue:null,description:"",name:"disabled",required:!0,type:{name:"boolean"}},isOpen:{defaultValue:null,description:"",name:"isOpen",required:!0,type:{name:"boolean"}},toggleField:{defaultValue:null,description:"",name:"toggleField",required:!0,type:{name:"() => void"}}}}}catch{}try{Toggle.displayName="Toggle",Toggle.__docgenInfo={description:"",displayName:"Toggle",props:{disabled:{defaultValue:null,description:"",name:"disabled",required:!0,type:{name:"boolean"}},isOpen:{defaultValue:null,description:"",name:"isOpen",required:!0,type:{name:"boolean"}},toggleField:{defaultValue:null,description:"",name:"toggleField",required:!0,type:{name:"() => void"}}}}}catch{}const D=({className:r,disabled:p=!1,name:l,hideArrow:y,hideFooter:_=!1,hideTags:m=!1,inline:I,isOptional:L=!1,label:A,multi:i=!1,options:s,placeholder:b,pluralLabel:h,smallLabel:se=!1,resetOnOpen:oe=!0,description:ue,onSearch:P=()=>{}})=>{var G;const{setFieldTouched:U,setFieldValue:S}=fe(),[t,F]=Q(l),[V,de]=Q(`search-${l}`),[o,c]=d.useState(null),[k,ce]=d.useState({}),$=d.useRef(null),j=d.useRef(null),[u,f]=d.useState(!1),[v,z]=d.useState(s);d.useEffect(()=>{z(s)},[s]),d.useEffect(()=>{u&&oe&&V.value!==""&&S(`search-${l}`,"",!1)},[u]),d.useEffect(()=>{ce(s.reduce((a,n)=>(a[n.value]=n.label,a),{}))},[s]),d.useEffect(()=>{const a=n=>{var g;(g=$.current)!=null&&g.contains(n.target)||f(!1)};return $.current&&document.addEventListener("mousedown",a),()=>{document.removeEventListener("mousedown",a)}},[$]),d.useEffect(()=>{const a=V.value.trim();P&&P(a);const n=new RegExp(a,"i");z(s.filter(g=>a===""||g.label.match(n))),c(null)},[V.value]);const pe=a=>{var n,g,J;switch(a.key){case"ArrowUp":o!==null&&(o<=0?c(null):c(o-1)),u||f(!0),(n=j.current)==null||n.focus();break;case"ArrowDown":o===null?c(0):o>=v.length-1?c(v.length-1):c(o+1),u||f(!0),(g=j.current)==null||g.focus();break;case"Space":K(),(J=j.current)==null||J.focus();break;case"Enter":u&&o!==null&&(a.preventDefault(),w(String(v[o].value)));break;case"Escape":c(null),f(!1);break;case"Tab":c(null),f(!1);break}},w=a=>{let n;i?t.value.includes(a)&&Array.isArray(t.value)?n=t.value.filter(g=>g!==a):n=[...t.value,a]:(n=a,f(!1),c(null),S(`search-${l}`,k[n],!1)),S(l,n)},K=()=>{u||f(!0),U(l,!0)},W=()=>{u?(f(!1),S(`search-${l}`,"",!1)):f(!0),U(l,!0)},me=Array.isArray(t.value)?b??(t.value.length>1&&h?h:A):b??k[t.value];return e.jsxs(_e,{className:r,error:F.error,hideFooter:!m&&_,isOptional:L,label:A,name:`search-${l}`,showError:F.touched&&!!F.error,smallLabel:se,inline:I,description:ue,children:[e.jsxs("div",{className:E(q["multi-select-autocomplete-container"],r),onKeyDown:pe,ref:$,children:[e.jsx(xe,{...o!==null&&{"aria-activedescendant":`option-display-${(G=v[o])==null?void 0:G.value}`},onFocus:K,placeholder:ye(me),style:{paddingLeft:i&&t.value.length>0?"2.2rem":"1rem"},className:q["multi-select-autocomplete-placeholder-input"],hasError:de.touched&&!!F.error,type:"text",disabled:p,...V,"aria-autocomplete":"list","aria-controls":`list-${l}`,"aria-describedby":`help-${l}`,"aria-expanded":u,"aria-haspopup":"listbox",role:"combobox"}),e.jsxs("div",{"aria-live":"polite","aria-relevant":"text",className:q["visually-hidden"],id:`help-${l}`,children:[i&&`${t.value.length} options sélectionnées`,!i&&!Array.isArray(t.value)&&t.value!==""&&`Option sélectionnée : ${k[t.value]}`,u?`${v.length} options ${V.value===""?"disponibles":"correspondant au texte saisi"}`:"saisissez du texte pour afficher et filtrer les options"]}),e.jsx("select",{hidden:!0,...i&&{multiple:!0},...t,value:t.value||"","data-testid":"select",children:s==null?void 0:s.map(({label:a,value:n})=>e.jsx("option",{value:n,children:a},`option-${n}`))}),e.jsxs("div",{className:q["field-overlay"],children:[!y&&e.jsx(B,{disabled:p,isOpen:u,toggleField:W}),i&&t.value.length>0&&e.jsx("div",{onClick:W,className:q.pellet,children:t.value.length}),u&&e.jsx(H,{className:r,fieldName:l,selectedValues:t.value,filteredOptions:v,setHoveredOptionIndex:c,listRef:j,hoveredOptionIndex:o,selectOption:w,multi:i})]})]}),Array.isArray(t.value)&&!m&&t.value.length>0&&e.jsx(R,{disabled:p,fieldName:l,optionsLabelById:k,selectedOptions:t.value,removeOption:w})]})},ie=D;try{D.displayName="SelectAutocomplete",D.__docgenInfo={description:"",displayName:"SelectAutocomplete",props:{label:{defaultValue:null,description:"",name:"label",required:!0,type:{name:"string | Element"}},name:{defaultValue:null,description:"",name:"name",required:!0,type:{name:"string"}},description:{defaultValue:null,description:"",name:"description",required:!1,type:{name:"string"}},maxLength:{defaultValue:null,description:"",name:"maxLength",required:!1,type:{name:"number"}},isLabelHidden:{defaultValue:null,description:"",name:"isLabelHidden",required:!1,type:{name:"boolean"}},hasLabelLineBreak:{defaultValue:null,description:"",name:"hasLabelLineBreak",required:!1,type:{name:"boolean"}},isOptional:{defaultValue:{value:"false"},description:"",name:"isOptional",required:!1,type:{name:"boolean"}},className:{defaultValue:null,description:"",name:"className",required:!1,type:{name:"string"}},classNameLabel:{defaultValue:null,description:"",name:"classNameLabel",required:!1,type:{name:"string"}},classNameFooter:{defaultValue:null,description:"",name:"classNameFooter",required:!1,type:{name:"string"}},filterVariant:{defaultValue:null,description:"",name:"filterVariant",required:!1,type:{name:"boolean"}},smallLabel:{defaultValue:{value:"false"},description:"",name:"smallLabel",required:!1,type:{name:"boolean"}},hideFooter:{defaultValue:{value:"false"},description:"",name:"hideFooter",required:!1,type:{name:"boolean"}},inline:{defaultValue:null,description:"",name:"inline",required:!1,type:{name:"boolean"}},clearButtonProps:{defaultValue:null,description:"",name:"clearButtonProps",required:!1,type:{name:"(ButtonHTMLAttributes<HTMLButtonElement> & { tooltip: string; })"}},ErrorDetails:{defaultValue:null,description:"",name:"ErrorDetails",required:!1,type:{name:"ReactNode"}},disabled:{defaultValue:{value:"false"},description:"",name:"disabled",required:!1,type:{name:"boolean"}},hideArrow:{defaultValue:null,description:"",name:"hideArrow",required:!1,type:{name:"boolean"}},hideTags:{defaultValue:{value:"false"},description:"",name:"hideTags",required:!1,type:{name:"boolean"}},maxHeight:{defaultValue:null,description:"",name:"maxHeight",required:!1,type:{name:"number"}},multi:{defaultValue:{value:"false"},description:"",name:"multi",required:!1,type:{name:"boolean"}},options:{defaultValue:null,description:"",name:"options",required:!0,type:{name:"SelectOption[]"}},placeholder:{defaultValue:null,description:"",name:"placeholder",required:!1,type:{name:"string"}},pluralLabel:{defaultValue:null,description:"",name:"pluralLabel",required:!1,type:{name:"string"}},resetOnOpen:{defaultValue:{value:"true"},description:"",name:"resetOnOpen",required:!1,type:{name:"boolean"}},onSearch:{defaultValue:{value:"() => {}"},description:"",name:"onSearch",required:!1,type:{name:"((pattern: string) => void)"}}}}}catch{}const Xe={title:"ui-kit/forms/SelectAutocomplete",component:ie},C=r=>e.jsx(ge,{initialValues:r.initialValues,onSubmit:()=>{},children:e.jsx(ie,{...r})}),M={pluralLabel:"Départements",name:"departement",options:[{value:"01",label:"Ain"},{value:"02",label:"Aisne"},{value:"03",label:"Allier"},{value:"04",label:"Alpes-de-Haute-Provence test de libellé très long"},{value:"05",label:"Hautes-Alpes"},{value:"06",label:"Alpes-Maritimes"},{value:"07",label:"Ardèche"},{value:"08",label:"Ardennes"},{value:"09",label:"Ariège"},{value:"10",label:"Aube"},{value:"11",label:"Aude"},{value:"12",label:"Aveyron"},{value:"13",label:"Bouches-du-Rhône"},{value:"14",label:"Calvados"},{value:"15",label:"Cantal"}],initialValues:{departement:"01"},label:"Département",hideFooter:!1,hideTags:!1,isOptional:!1,smallLabel:!1},x=C.bind({});x.args=M;const O=C.bind({});O.args={...M,multi:!0,initialValues:{departement:["01","02"]}};const N=C.bind({});N.args={...M,multi:!0,initialValues:{departement:["01","02"]},hideTags:!0};var X,Y,Z;x.parameters={...x.parameters,docs:{...(X=x.parameters)==null?void 0:X.docs,source:{originalSource:`args => <Formik initialValues={args.initialValues} onSubmit={() => {}}>
    <SelectAutocomplete {...args} />
  </Formik>`,...(Z=(Y=x.parameters)==null?void 0:Y.docs)==null?void 0:Z.source}}};var ee,le,te;O.parameters={...O.parameters,docs:{...(ee=O.parameters)==null?void 0:ee.docs,source:{originalSource:`args => <Formik initialValues={args.initialValues} onSubmit={() => {}}>
    <SelectAutocomplete {...args} />
  </Formik>`,...(te=(le=O.parameters)==null?void 0:le.docs)==null?void 0:te.source}}};var ae,re,ne;N.parameters={...N.parameters,docs:{...(ae=N.parameters)==null?void 0:ae.docs,source:{originalSource:`args => <Formik initialValues={args.initialValues} onSubmit={() => {}}>
    <SelectAutocomplete {...args} />
  </Formik>`,...(ne=(re=N.parameters)==null?void 0:re.docs)==null?void 0:ne.source}}};const Ye=["Default","Multi","WithoutTags"];export{x as Default,O as Multi,N as WithoutTags,Ye as __namedExportsOrder,Xe as default};
//# sourceMappingURL=SelectAutocomplete.stories-ada79822.js.map
