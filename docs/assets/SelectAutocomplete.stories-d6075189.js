import{j as t}from"./jsx-runtime-ffb262ed.js";import{c as be,b as X,a as he}from"./formik.esm-96bdd02b.js";import{c as E}from"./index-a587463d.js";import{r as p}from"./index-76fb7be0.js";import{g as ve}from"./getLabelString-a0462018.js";import{B as _e,b as Ve}from"./BaseCheckbox-2cbf2f9d.js";import"./BaseFileInput-5547a44b.js";import{s as qe}from"./stroke-down-fe50db78.js";import{F as Oe}from"./AutocompleteList-8264ed5d.js";import"./FieldError-0089fdbc.js";import"./FieldSuccess-31bdacb0.js";import{T as xe}from"./Tag-2c2f8155.js";import{S as Ne}from"./SvgIcon-c0bf369c.js";import{B as Se}from"./BaseInput-fad17e7a.js";import"./_commonjsHelpers-de833af9.js";import"./hoist-non-react-statics.cjs-3f8ebaa8.js";import"./BaseRadio-dfa7f1ae.js";import"./full-clear-9268779e.js";import"./Tooltip-383b3df2.js";import"./stroke-error-ed5fe82d.js";import"./stroke-valid-9c345a33.js";import"./stroke-close-3a7bfe9e.js";const B=l=>l.trim().toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,""),R=(l,r)=>B(r.label).split(" ").filter(e=>B(l).split(" ").some(s=>e.includes(s))),Le=(l,r)=>{if(!(r!=null&&r.trim()))return l;const e=l.filter(s=>R(r,s).length>0);return B(r).split(" ").length>1&&e.sort((s,y)=>R(r,s).length>R(r,y).length?-1:1),e},Ae="_menu_qqt91_2",Fe="_label_qqt91_21",T={menu:Ae,"menu--no-results":"_menu--no-results_qqt91_17",label:Fe,"option-hovered":"_option-hovered_qqt91_34"},D=({className:l,fieldName:r,selectedValues:e,filteredOptions:s,setHoveredOptionIndex:y,listRef:f,hoveredOptionIndex:w,selectOption:S,multi:L})=>t.jsxs("div",{className:E(T.menu,l),role:"listbox",children:[s.length===0&&t.jsx("span",{className:E({[T["menu--no-results"]]:s.length===0}),children:"Aucun résultat"}),t.jsx("ul",{"data-testid":"list",id:`list-${r}`,ref:f,role:"listbox",children:s.map(({value:o,label:u},v)=>{const _=(e||[]).includes(String(o));return t.jsx("li",{"aria-selected":_,"aria-posinset":v+1,"aria-setsize":s.length,className:w===v?T["option-hovered"]:"","data-value":o,"data-selected":_,id:`option-display-${o}`,onMouseEnter:()=>y(v),role:"option",tabIndex:-1,children:L?t.jsx(_e,{label:u,checked:_,onChange:()=>{S(String(o))}}):t.jsx("span",{onClick:()=>{S(String(o))},className:E(Ve["base-checkbox-label"],T.label),children:u})},`option-display-${o}`)})})]});try{D.displayName="OptionsList",D.__docgenInfo={description:"",displayName:"OptionsList",props:{className:{defaultValue:null,description:"",name:"className",required:!1,type:{name:"string"}},fieldName:{defaultValue:null,description:"",name:"fieldName",required:!0,type:{name:"string"}},selectedValues:{defaultValue:null,description:"",name:"selectedValues",required:!0,type:{name:"string | string[] | null"}},filteredOptions:{defaultValue:null,description:"",name:"filteredOptions",required:!0,type:{name:"SelectOption[]"}},setHoveredOptionIndex:{defaultValue:null,description:"",name:"setHoveredOptionIndex",required:!0,type:{name:"(value: number | null) => void"}},listRef:{defaultValue:null,description:"",name:"listRef",required:!0,type:{name:"Ref<HTMLUListElement>"}},hoveredOptionIndex:{defaultValue:null,description:"",name:"hoveredOptionIndex",required:!0,type:{name:"number | null"}},selectOption:{defaultValue:null,description:"",name:"selectOption",required:!0,type:{name:"(value: string) => void"}},multi:{defaultValue:null,description:"",name:"multi",required:!0,type:{name:"boolean"}}}}}catch{}try{OptionsList.displayName="OptionsList",OptionsList.__docgenInfo={description:"",displayName:"OptionsList",props:{className:{defaultValue:null,description:"",name:"className",required:!1,type:{name:"string"}},fieldName:{defaultValue:null,description:"",name:"fieldName",required:!0,type:{name:"string"}},selectedValues:{defaultValue:null,description:"",name:"selectedValues",required:!0,type:{name:"string | string[] | null"}},filteredOptions:{defaultValue:null,description:"",name:"filteredOptions",required:!0,type:{name:"SelectOption[]"}},setHoveredOptionIndex:{defaultValue:null,description:"",name:"setHoveredOptionIndex",required:!0,type:{name:"(value: number | null) => void"}},listRef:{defaultValue:null,description:"",name:"listRef",required:!0,type:{name:"Ref<HTMLUListElement>"}},hoveredOptionIndex:{defaultValue:null,description:"",name:"hoveredOptionIndex",required:!0,type:{name:"number | null"}},selectOption:{defaultValue:null,description:"",name:"selectOption",required:!0,type:{name:"(value: string) => void"}},multi:{defaultValue:null,description:"",name:"multi",required:!0,type:{name:"boolean"}}}}}catch{}const ke="_pellet_sn75o_16",q={"multi-select-autocomplete-container":"_multi-select-autocomplete-container_sn75o_2","multi-select-autocomplete-placeholder-input":"_multi-select-autocomplete-placeholder-input_sn75o_8","field-overlay":"_field-overlay_sn75o_12",pellet:ke,"visually-hidden":"_visually-hidden_sn75o_34"},Ie={"multi-select-autocomplete-tags":"_multi-select-autocomplete-tags_1exsd_1"},C=({disabled:l,fieldName:r,optionsLabelById:e,selectedOptions:s,removeOption:y})=>t.jsx("div",{className:Ie["multi-select-autocomplete-tags"],children:s.map(f=>t.jsx(xe,{label:e[f],closeable:{closeLabel:"Supprimer "+e[f],onClose:()=>{y(f)},disabled:l}},`tag-${r}-${f}`))});try{C.displayName="Tags",C.__docgenInfo={description:"",displayName:"Tags",props:{disabled:{defaultValue:null,description:"",name:"disabled",required:!0,type:{name:"boolean"}},fieldName:{defaultValue:null,description:"",name:"fieldName",required:!0,type:{name:"string"}},optionsLabelById:{defaultValue:null,description:"",name:"optionsLabelById",required:!0,type:{name:"Record<string, string>"}},selectedOptions:{defaultValue:null,description:"",name:"selectedOptions",required:!0,type:{name:"string[]"}},removeOption:{defaultValue:null,description:"",name:"removeOption",required:!0,type:{name:"(value: string) => void"}}}}}catch{}const $e={"dropdown-indicator":"_dropdown-indicator_1fr35_2"},M=({disabled:l,isOpen:r,toggleField:e})=>t.jsx("button",{onClick:e,className:$e["dropdown-indicator"],type:"button",disabled:l,children:t.jsx(Ne,{src:qe,alt:`${r?"Masquer":"Afficher"} les options`,width:"20"})});try{M.displayName="Toggle",M.__docgenInfo={description:"",displayName:"Toggle",props:{disabled:{defaultValue:null,description:"",name:"disabled",required:!0,type:{name:"boolean"}},isOpen:{defaultValue:null,description:"",name:"isOpen",required:!0,type:{name:"boolean"}},toggleField:{defaultValue:null,description:"",name:"toggleField",required:!0,type:{name:"() => void"}}}}}catch{}try{Toggle.displayName="Toggle",Toggle.__docgenInfo={description:"",displayName:"Toggle",props:{disabled:{defaultValue:null,description:"",name:"disabled",required:!0,type:{name:"boolean"}},isOpen:{defaultValue:null,description:"",name:"isOpen",required:!0,type:{name:"boolean"}},toggleField:{defaultValue:null,description:"",name:"toggleField",required:!0,type:{name:"() => void"}}}}}catch{}const z=({className:l,disabled:r=!1,name:e,hideArrow:s,hideFooter:y=!1,hideTags:f=!1,inline:w,isOptional:S=!1,label:L,multi:o=!1,options:u,placeholder:v,pluralLabel:_,smallLabel:oe=!1,resetOnOpen:ue=!0,description:de,onSearch:K=()=>{},searchInOptions:ce=A=>A})=>{var J;const{setFieldTouched:A,setFieldValue:F}=be(),[a,k]=X(e),[b,pe]=X(`search-${e}`),[d,m]=p.useState(null),[I,me]=p.useState({}),$=p.useRef(null),j=p.useRef(null),[c,g]=p.useState(!1),[V,fe]=p.useState(u);p.useEffect(()=>{c&&ue&&b.value!==""&&F(`search-${e}`,"",!1)},[c]),p.useEffect(()=>{me(u.reduce((i,n)=>(i[n.value]=n.label,i),{}))},[u]),p.useEffect(()=>{const i=n=>{var h;(h=$.current)!=null&&h.contains(n.target)||g(!1)};return $.current&&document.addEventListener("mousedown",i),()=>{document.removeEventListener("mousedown",i)}},[$]),p.useEffect(()=>{K&&K(b.value.trim()),m(null)},[b.value]),p.useEffect(()=>{fe(ce(u,b.value))},[b.value,u]);const ge=i=>{var n,h,Q;switch(i.key){case"ArrowUp":d!==null&&(d<=0?m(null):m(d-1)),c||g(!0),(n=j.current)==null||n.focus();break;case"ArrowDown":d===null?m(0):d>=V.length-1?m(V.length-1):m(d+1),c||g(!0),(h=j.current)==null||h.focus();break;case"Space":W(),(Q=j.current)==null||Q.focus();break;case"Enter":c&&d!==null&&(i.preventDefault(),H(String(V[d].value)));break;case"Escape":m(null),g(!1);break;case"Tab":m(null),g(!1);break}},H=i=>{let n;o?a.value.includes(i)&&Array.isArray(a.value)?n=a.value.filter(h=>h!==i):n=[...a.value,i]:(n=i,g(!1),m(null),F(`search-${e}`,I[n],!1)),F(e,n)},W=()=>{c||g(!0),A(e,!0)},G=()=>{c?(g(!1),F(`search-${e}`,"",!1)):g(!0),A(e,!0)},ye=Array.isArray(a.value)?v??(a.value.length>1&&_?_:L):v??I[a.value];return t.jsxs(Oe,{className:l,error:k.error,hideFooter:!f&&y,isOptional:S,label:L,name:`search-${e}`,showError:k.touched&&!!k.error,smallLabel:oe,inline:w,description:de,children:[t.jsxs("div",{className:E(q["multi-select-autocomplete-container"],l),onKeyDown:ge,ref:$,children:[t.jsx(Se,{...d!==null&&{"aria-activedescendant":`option-display-${(J=V[d])==null?void 0:J.value}`},onFocus:W,placeholder:ve(ye),style:{paddingLeft:o&&a.value.length>0?"2.2rem":"1rem"},className:q["multi-select-autocomplete-placeholder-input"],hasError:pe.touched&&!!k.error,type:"text",disabled:r,...b,"aria-autocomplete":"list","aria-controls":`list-${e}`,"aria-describedby":`help-${e}`,"aria-expanded":c,"aria-haspopup":"listbox",role:"combobox"}),t.jsxs("div",{"aria-live":"polite","aria-relevant":"text",className:q["visually-hidden"],id:`help-${e}`,children:[o&&`${a.value.length} options sélectionnées`,!o&&!Array.isArray(a.value)&&a.value!==""&&`Option sélectionnée : ${I[a.value]}`,c?`${V.length} options ${b.value===""?"disponibles":"correspondant au texte saisi"}`:"saisissez du texte pour afficher et filtrer les options"]}),t.jsx("select",{hidden:!0,...o&&{multiple:!0},...a,value:a.value||"","data-testid":"select",children:u==null?void 0:u.map(({label:i,value:n})=>t.jsx("option",{value:n,children:i},`option-${n}`))}),t.jsxs("div",{className:q["field-overlay"],children:[!s&&t.jsx(M,{disabled:r,isOpen:c,toggleField:G}),o&&a.value.length>0&&t.jsx("div",{onClick:G,className:q.pellet,children:a.value.length}),c&&t.jsx(D,{className:l,fieldName:e,selectedValues:a.value,filteredOptions:V,setHoveredOptionIndex:m,listRef:j,hoveredOptionIndex:d,selectOption:H,multi:o})]})]}),Array.isArray(a.value)&&!f&&a.value.length>0&&t.jsx(C,{disabled:r,fieldName:e,optionsLabelById:I,selectedOptions:a.value,removeOption:H})]})},se=z;try{z.displayName="SelectAutocomplete",z.__docgenInfo={description:"",displayName:"SelectAutocomplete",props:{label:{defaultValue:null,description:"",name:"label",required:!0,type:{name:"string | Element"}},name:{defaultValue:null,description:"",name:"name",required:!0,type:{name:"string"}},description:{defaultValue:null,description:"",name:"description",required:!1,type:{name:"string"}},maxLength:{defaultValue:null,description:"",name:"maxLength",required:!1,type:{name:"number"}},isLabelHidden:{defaultValue:null,description:"",name:"isLabelHidden",required:!1,type:{name:"boolean"}},hasLabelLineBreak:{defaultValue:null,description:"",name:"hasLabelLineBreak",required:!1,type:{name:"boolean"}},isOptional:{defaultValue:{value:"false"},description:"",name:"isOptional",required:!1,type:{name:"boolean"}},className:{defaultValue:null,description:"",name:"className",required:!1,type:{name:"string"}},classNameLabel:{defaultValue:null,description:"",name:"classNameLabel",required:!1,type:{name:"string"}},classNameFooter:{defaultValue:null,description:"",name:"classNameFooter",required:!1,type:{name:"string"}},filterVariant:{defaultValue:null,description:"",name:"filterVariant",required:!1,type:{name:"boolean"}},smallLabel:{defaultValue:{value:"false"},description:"",name:"smallLabel",required:!1,type:{name:"boolean"}},hideFooter:{defaultValue:{value:"false"},description:"",name:"hideFooter",required:!1,type:{name:"boolean"}},inline:{defaultValue:null,description:"",name:"inline",required:!1,type:{name:"boolean"}},clearButtonProps:{defaultValue:null,description:"",name:"clearButtonProps",required:!1,type:{name:"(ButtonHTMLAttributes<HTMLButtonElement> & { tooltip: string; })"}},ErrorDetails:{defaultValue:null,description:"",name:"ErrorDetails",required:!1,type:{name:"ReactNode"}},disabled:{defaultValue:{value:"false"},description:"",name:"disabled",required:!1,type:{name:"boolean"}},hideArrow:{defaultValue:null,description:"",name:"hideArrow",required:!1,type:{name:"boolean"}},hideTags:{defaultValue:{value:"false"},description:"",name:"hideTags",required:!1,type:{name:"boolean"}},maxHeight:{defaultValue:null,description:"",name:"maxHeight",required:!1,type:{name:"number"}},multi:{defaultValue:{value:"false"},description:"",name:"multi",required:!1,type:{name:"boolean"}},options:{defaultValue:null,description:"",name:"options",required:!0,type:{name:"SelectOption[]"}},placeholder:{defaultValue:null,description:"",name:"placeholder",required:!1,type:{name:"string"}},pluralLabel:{defaultValue:null,description:"",name:"pluralLabel",required:!1,type:{name:"string"}},resetOnOpen:{defaultValue:{value:"true"},description:"",name:"resetOnOpen",required:!1,type:{name:"boolean"}},onSearch:{defaultValue:{value:"() => {}"},description:"",name:"onSearch",required:!1,type:{name:"((pattern: string) => void)"}},searchInOptions:{defaultValue:{value:"options => options"},description:"",name:"searchInOptions",required:!1,type:{name:"((options: SelectOption[], pattern: string) => SelectOption[])"}}}}}catch{}const ll={title:"ui-kit/forms/SelectAutocomplete",component:se},P=l=>t.jsx(he,{initialValues:l.initialValues,onSubmit:()=>{},children:t.jsx(se,{...l})}),U={pluralLabel:"Départements",name:"departement",options:[{value:"01",label:"Ain"},{value:"02",label:"Aisne"},{value:"03",label:"Allier"},{value:"04",label:"Alpes-de-Haute-Provence test de libellé très long"},{value:"05",label:"Hautes-Alpes"},{value:"06",label:"Alpes-Maritimes"},{value:"07",label:"Ardèche"},{value:"08",label:"Ardennes"},{value:"09",label:"Ariège"},{value:"10",label:"Aube"},{value:"11",label:"Aude"},{value:"12",label:"Aveyron"},{value:"13",label:"Bouches-du-Rhône"},{value:"14",label:"Calvados"},{value:"15",label:"Cantal"}],initialValues:{departement:"01"},label:"Département",hideFooter:!1,hideTags:!1,isOptional:!1,smallLabel:!1,searchInOptions:Le},O=P.bind({});O.args=U;const x=P.bind({});x.args={...U,multi:!0,initialValues:{departement:["01","02"]}};const N=P.bind({});N.args={...U,multi:!0,initialValues:{departement:["01","02"]},hideTags:!0};var Y,Z,ee;O.parameters={...O.parameters,docs:{...(Y=O.parameters)==null?void 0:Y.docs,source:{originalSource:`args => <Formik initialValues={args.initialValues} onSubmit={() => {}}>
    <SelectAutocomplete {...args} />
  </Formik>`,...(ee=(Z=O.parameters)==null?void 0:Z.docs)==null?void 0:ee.source}}};var le,te,ae;x.parameters={...x.parameters,docs:{...(le=x.parameters)==null?void 0:le.docs,source:{originalSource:`args => <Formik initialValues={args.initialValues} onSubmit={() => {}}>
    <SelectAutocomplete {...args} />
  </Formik>`,...(ae=(te=x.parameters)==null?void 0:te.docs)==null?void 0:ae.source}}};var re,ne,ie;N.parameters={...N.parameters,docs:{...(re=N.parameters)==null?void 0:re.docs,source:{originalSource:`args => <Formik initialValues={args.initialValues} onSubmit={() => {}}>
    <SelectAutocomplete {...args} />
  </Formik>`,...(ie=(ne=N.parameters)==null?void 0:ne.docs)==null?void 0:ie.source}}};const tl=["Default","Multi","WithoutTags"];export{O as Default,x as Multi,N as WithoutTags,tl as __namedExportsOrder,ll as default};
//# sourceMappingURL=SelectAutocomplete.stories-d6075189.js.map
