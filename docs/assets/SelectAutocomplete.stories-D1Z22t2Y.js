import{j as a}from"./jsx-runtime-BYYWji4R.js";import{a as ve,u as X,F as ge}from"./formik.esm-Dmsc_7od.js";import{s as Ve}from"./searchPatternInOptions-C_IM3TnQ.js";import{c as H}from"./index-DeARc5FM.js";import{r as o}from"./index-ClcD9ViR.js";import{S as _e}from"./SelectedValuesTags-C3dkcpDs.js";import{B as qe}from"./BaseInput-BI1b_EYZ.js";import{F as we}from"./FieldLayout-NxMSHKaS.js";import{C as xe}from"./Checkbox-B2CYU_ZX.js";import{s as Oe}from"./stroke-down-Co3p5GaP.js";import{S as Ae}from"./SvgIcon-CyWUmZpn.js";import"./_commonjsHelpers-Cpj98o6Y.js";import"./full-close-5Oxr7nnd.js";import"./full-clear-Q4kCtSRL.js";import"./full-help-blUMxBcv.js";import"./Button-CMQcpNQM.js";import"./stroke-pass-CALgybTM.js";import"./Tooltip-BpKRYYrm.js";import"./Button.module-CpX5ULHU.js";import"./types-yVZEaApa.js";import"./FieldError-ky1_Lcaw.js";import"./stroke-error-DSZD431a.js";import"./FieldLayoutCharacterCount-Cf20ddBy.js";import"./index.module-D0awDY1b.js";import"./Tag-CQO0EYV8.js";import"./full-thumb-up-Bb4kpRpM.js";const Ne=(t,c,r="s")=>{let e,h;const q=t.slice(-1)[0];return q==="s"||q==="x"?(h=t.slice(0,-1),e=t):(h=t,e=`${t}${r}`),c>1?e:h},Se=(t,c,r)=>t.split(" ").map(e=>Ne(e,c,r)).join(" "),Fe=(t,c,r)=>`${new Intl.NumberFormat("fr-FR").format(t)} ${Se(c,t,r)}`,Le="_menu_1h8nw_1",ke="_label_1h8nw_23",O={menu:Le,"menu--no-results":"_menu--no-results_1h8nw_15","options-item":"_options-item_1h8nw_18","too-many-options":"_too-many-options_1h8nw_19",label:ke,"option-hovered":"_option-hovered_1h8nw_33"},z=({className:t,fieldName:c,selectedValues:r,filteredOptions:e,setHoveredOptionIndex:h,listRef:q,hoveredOptionIndex:E,selectOption:A,multi:C,maxDisplayedOptions:u})=>{const p=u?e.slice(0,u):e;return a.jsxs("div",{className:H(O.menu,t),role:"listbox",children:[e.length===0&&a.jsx("span",{className:O["menu--no-results"],children:"Aucun résultat"}),a.jsx("ul",{"data-testid":"list",id:`list-${c}`,ref:q,role:"listbox",children:p.map(({value:y,label:L},w)=>{const N=(r||[]).includes(String(y));return a.jsx("li",{"aria-selected":N,"aria-posinset":w+1,"aria-setsize":p.length,className:E===w?O["option-hovered"]:"","data-value":y,"data-selected":N,id:`option-display-${y}`,onMouseEnter:()=>h(w),onFocus:()=>h(w),role:"option",tabIndex:-1,children:C?a.jsx(xe,{label:L,checked:N,onChange:()=>{A(String(y))},className:O.label,sizing:"fill"}):a.jsx("span",{onClick:()=>{A(String(y))},className:H(O["options-item"]),children:L})},`option-display-${y}`)})}),a.jsx("div",{role:"status",children:u&&p.length<e.length&&a.jsxs("div",{className:O["too-many-options"],children:[Fe(u,"résultat")," maximum. Veuillez affiner votre recherche"]})})]})};try{z.displayName="OptionsList",z.__docgenInfo={description:"",displayName:"OptionsList",props:{className:{defaultValue:null,description:"",name:"className",required:!1,type:{name:"string"}},fieldName:{defaultValue:null,description:"",name:"fieldName",required:!0,type:{name:"string"}},selectedValues:{defaultValue:null,description:"",name:"selectedValues",required:!0,type:{name:"string | string[] | null"}},filteredOptions:{defaultValue:null,description:"",name:"filteredOptions",required:!0,type:{name:"SelectOption[]"}},setHoveredOptionIndex:{defaultValue:null,description:"",name:"setHoveredOptionIndex",required:!0,type:{name:"(value: number | null) => void"}},listRef:{defaultValue:null,description:"",name:"listRef",required:!0,type:{name:"Ref<HTMLUListElement>"}},hoveredOptionIndex:{defaultValue:null,description:"",name:"hoveredOptionIndex",required:!0,type:{name:"number | null"}},selectOption:{defaultValue:null,description:"",name:"selectOption",required:!0,type:{name:"(value: string) => void"}},multi:{defaultValue:null,description:"",name:"multi",required:!0,type:{name:"boolean"}},maxDisplayedOptions:{defaultValue:null,description:"",name:"maxDisplayedOptions",required:!1,type:{name:"number"}}}}}catch{}const je="_pellet_18qvm_15",F={"multi-select-autocomplete-container":"_multi-select-autocomplete-container_18qvm_1","multi-select-autocomplete-placeholder-input":"_multi-select-autocomplete-placeholder-input_18qvm_7","field-overlay":"_field-overlay_18qvm_11",pellet:je,"visually-hidden":"_visually-hidden_18qvm_34"},Ie={"dropdown-indicator":"_dropdown-indicator_czqhq_1"},P=({disabled:t,isOpen:c,toggleField:r})=>a.jsx("button",{onClick:r,className:Ie["dropdown-indicator"],type:"button",disabled:t,children:a.jsx(Ae,{src:Oe,alt:`${c?"Masquer":"Afficher"} les options`,width:"20"})});try{P.displayName="Toggle",P.__docgenInfo={description:"",displayName:"Toggle",props:{disabled:{defaultValue:null,description:"",name:"disabled",required:!0,type:{name:"boolean"}},isOpen:{defaultValue:null,description:"",name:"isOpen",required:!0,type:{name:"boolean"}},toggleField:{defaultValue:null,description:"",name:"toggleField",required:!0,type:{name:"() => void"}}}}}catch{}const W=({className:t,selectedValuesTagsClassName:c,disabled:r=!1,name:e,hideArrow:h,hideTags:q=!1,inline:E,isOptional:A=!1,label:C,multi:u=!1,options:p,smallLabel:y=!1,resetOnOpen:L=!0,description:w,onSearch:N=()=>{},searchInOptions:ie=(x,v)=>x.filter(s=>s.label.toLowerCase().includes(v.trim().toLowerCase())),onReset:oe=()=>{},maxDisplayedOptions:ue,isLabelHidden:de,shouldFocusOnMount:ce,preventOpenOnFirstFocus:pe})=>{var J;const{setFieldTouched:x,setFieldValue:v}=ve(),[s,k]=X(e),[g,U]=X(`search-${e}`),[d,f]=o.useState(null),[R,me]=o.useState({}),j=o.useRef(null),M=o.useRef(null),B=o.useRef(null),[i,m]=o.useState(!1),[b,fe]=o.useState(p);o.useEffect(()=>{(async()=>{var n;ce&&((n=B.current)==null||n.focus(),await x(`search-${e}`,!0))})()},[]),o.useEffect(()=>{const l=async()=>{await v(`search-${e}`,"",!1),await v(e,u?[]:"",!1),oe()};i&&L&&g.value!==""&&l()},[i]),o.useEffect(()=>{me(p.reduce((l,n)=>(l[n.value]=n.label,l),{}))},[p]),o.useEffect(()=>{const l=n=>{var V;(V=j.current)!=null&&V.contains(n.target)||m(!1)};return j.current&&document.addEventListener("mousedown",l),()=>{document.removeEventListener("mousedown",l)}},[j]),o.useEffect(()=>{N((g.value??"").trim()),f(null)},[g.value]),o.useEffect(()=>{fe(ie(p,(g.value??"").trim()))},[g.value,p]);const he=async l=>{var n,V,Q;switch(l.key){case"ArrowUp":if(d!==null)if(d<=0)f(null);else{const S=d-1;f(S);const _=(n=M.current)==null?void 0:n.getElementsByTagName("li")[S];_==null||_.scrollIntoView({block:"nearest"})}i||m(!0);break;case"ArrowDown":if(d===null)b.length>0&&f(0);else{const S=Math.min(b.length-1,d+1);f(S);const _=(V=M.current)==null?void 0:V.getElementsByTagName("li")[S];_==null||_.scrollIntoView({block:"nearest"})}i||m(!0);break;case" ":case"Enter":i&&d!==null&&b[d]&&(l.preventDefault(),b[d]&&await D(String(b[d].value)));break;case"Escape":(Q=B.current)==null||Q.focus(),f(null),m(!1);break;case"Tab":f(null),m(!1);break}},D=async l=>{let n;u?s.value.includes(l)&&Array.isArray(s.value)?n=s.value.filter(V=>V!==l):n=[...s.value,l]:(n=l,m(!1),f(null),await v(`search-${e}`,R[n],!1)),await v(e,n)},ye=async()=>{const l=k.touched;(pe?l&&!i:!i)&&m(!0),await x(e,!0)},be=async()=>{i||m(!0),await x(e,!0)},G=async()=>{i?(m(!1),await v(`search-${e}`,"",!1)):m(!0),await x(e,!0)};return a.jsxs(we,{className:t,error:k.error,isOptional:A,label:C,name:`search-${e}`,showError:U.touched&&!!k.error,smallLabel:y,inline:E,description:w,isLabelHidden:de,children:[a.jsxs("div",{className:H(F["multi-select-autocomplete-container"],t),onKeyDown:he,ref:j,children:[a.jsx(qe,{...d!==null&&{"aria-activedescendant":`option-display-${(J=b[d])==null?void 0:J.value}`},onClick:be,onFocus:ye,className:F["multi-select-autocomplete-placeholder-input"],hasError:U.touched&&!!k.error,type:"search",disabled:r,...g,"aria-autocomplete":"list","aria-controls":`list-${e}`,"aria-describedby":`help-${e}`,"aria-expanded":i,"aria-haspopup":"listbox","aria-required":!A,role:"combobox",ref:B}),a.jsxs("div",{"aria-live":"polite","aria-relevant":"text",className:F["visually-hidden"],id:`help-${e}`,children:[u&&`${s.value.length} options sélectionnées`,!u&&!Array.isArray(s.value)&&s.value!==""&&`Option sélectionnée : ${R[s.value]}`,i?`${b.length} options ${g.value===""?"disponibles":"correspondant au texte saisi"}`:"saisissez du texte pour afficher et filtrer les options"]}),a.jsx("select",{hidden:!0,...u&&{multiple:!0},...s,value:s.value||"","data-testid":"select",children:p.map(({label:l,value:n})=>a.jsx("option",{value:n,children:l},`option-${n}`))}),a.jsxs("div",{className:F["field-overlay"],children:[!h&&a.jsx(P,{disabled:r,isOpen:i,toggleField:G}),u&&s.value.length>0&&a.jsx("div",{onClick:G,className:F.pellet,children:s.value.length}),i&&a.jsx(z,{className:t,fieldName:e,selectedValues:s.value,filteredOptions:b,setHoveredOptionIndex:f,listRef:M,hoveredOptionIndex:d,selectOption:D,multi:u,maxDisplayedOptions:ue})]})]}),Array.isArray(s.value)&&!q&&s.value.length>0&&a.jsx(_e,{className:c,disabled:r,fieldName:e,optionsLabelById:R,selectedOptions:s.value,removeOption:D})]})};try{W.displayName="SelectAutocomplete",W.__docgenInfo={description:"",displayName:"SelectAutocomplete",props:{label:{defaultValue:null,description:"",name:"label",required:!0,type:{name:"string | Element"}},name:{defaultValue:null,description:"",name:"name",required:!0,type:{name:"string"}},description:{defaultValue:null,description:"",name:"description",required:!1,type:{name:"string"}},maxLength:{defaultValue:null,description:"",name:"maxLength",required:!1,type:{name:"number"}},isLabelHidden:{defaultValue:null,description:`A flag to hide the label.
To be used with caution, as it can affect accessibility.
Do not use it if the label is mandatory, placeholder is not
a substitute for a label.`,name:"isLabelHidden",required:!1,type:{name:"boolean"}},hasLabelLineBreak:{defaultValue:null,description:"",name:"hasLabelLineBreak",required:!1,type:{name:"boolean"}},isOptional:{defaultValue:{value:"false"},description:`A flag to indicate that the field is optional.
It will display an asterisk next to the label.`,name:"isOptional",required:!1,type:{name:"boolean"}},hideAsterisk:{defaultValue:null,description:`Can be false only when it's the only field in a form and it's mandatory,
or when all fields are mandatory and the form indicates that all fields are mandatory`,name:"hideAsterisk",required:!1,type:{name:"boolean"}},className:{defaultValue:null,description:`A custom class for the field layout,
where label, description, input, and footer are displayed.`,name:"className",required:!1,type:{name:"string"}},classNameLabel:{defaultValue:null,description:"",name:"classNameLabel",required:!1,type:{name:"string"}},classNameFooter:{defaultValue:null,description:`A custom class for the footer,
where errors and character count are displayed.`,name:"classNameFooter",required:!1,type:{name:"string"}},classNameInput:{defaultValue:null,description:"",name:"classNameInput",required:!1,type:{name:"string"}},filterVariant:{defaultValue:null,description:"",name:"filterVariant",required:!1,type:{name:"boolean"}},smallLabel:{defaultValue:{value:"false"},description:"A flag to display a smaller label.",name:"smallLabel",required:!1,type:{name:"boolean"}},inline:{defaultValue:null,description:"",name:"inline",required:!1,type:{name:"boolean"}},clearButtonProps:{defaultValue:null,description:"",name:"clearButtonProps",required:!1,type:{name:'(ButtonHTMLAttributes<HTMLButtonElement> & { tooltip: string; display?: "clear" | "close"; })'}},ErrorDetails:{defaultValue:null,description:"",name:"ErrorDetails",required:!1,type:{name:"ReactNode"}},disabled:{defaultValue:{value:"false"},description:"",name:"disabled",required:!1,type:{name:"boolean"}},hideArrow:{defaultValue:null,description:"",name:"hideArrow",required:!1,type:{name:"boolean"}},hideTags:{defaultValue:{value:"false"},description:"",name:"hideTags",required:!1,type:{name:"boolean"}},maxHeight:{defaultValue:null,description:"",name:"maxHeight",required:!1,type:{name:"number"}},multi:{defaultValue:{value:"false"},description:"",name:"multi",required:!1,type:{name:"boolean"}},options:{defaultValue:null,description:"",name:"options",required:!0,type:{name:"SelectOption[]"}},resetOnOpen:{defaultValue:{value:"true"},description:"",name:"resetOnOpen",required:!1,type:{name:"boolean"}},onSearch:{defaultValue:{value:"() => {}"},description:"",name:"onSearch",required:!1,type:{name:"((pattern: string) => void)"}},searchInOptions:{defaultValue:{value:`(options, pattern) =>
    options.filter((opt) =>
      opt.label.toLowerCase().includes(pattern.trim().toLowerCase())
    )`},description:"",name:"searchInOptions",required:!1,type:{name:"((options: SelectOption[], pattern: string) => SelectOption[])"}},onReset:{defaultValue:{value:"() => {}"},description:"",name:"onReset",required:!1,type:{name:"(() => void)"}},maxDisplayedOptions:{defaultValue:null,description:"",name:"maxDisplayedOptions",required:!1,type:{name:"number"}},selectedValuesTagsClassName:{defaultValue:null,description:"",name:"selectedValuesTagsClassName",required:!1,type:{name:"string"}},shouldFocusOnMount:{defaultValue:null,description:"A flag to automatically focus the input when the component mounts.",name:"shouldFocusOnMount",required:!1,type:{name:"boolean"}},preventOpenOnFirstFocus:{defaultValue:null,description:`A flag to prevent the dropdown from opening on the first focus.
This is useful when the input is automatically focused. The user
is then expected to open the dropdown by clicking on the input.`,name:"preventOpenOnFirstFocus",required:!1,type:{name:"boolean"}}}}}catch{}const $e=t=>a.jsx(ge,{initialValues:t.initialValues,onSubmit:()=>{},children:a.jsx(W,{...t})}),it={title:"ui-kit/forms/SelectAutocomplete",component:$e},K={name:"departement",options:[{value:"01",label:"Ain"},{value:"02",label:"Aisne"},{value:"03",label:"Allier"},{value:"04",label:"Alpes-de-Haute-Provence test de libellé très long"},{value:"05",label:"Hautes-Alpes"},{value:"06",label:"Alpes-Maritimes"},{value:"07",label:"Ardèche"},{value:"08",label:"Ardennes"},{value:"09",label:"Ariège"},{value:"10",label:"Aube"},{value:"11",label:"Aude"},{value:"12",label:"Aveyron"},{value:"13",label:"Bouches-du-Rhône"},{value:"14",label:"Calvados"},{value:"15",label:"Cantal"}],initialValues:{departement:"01","search-departement":""},label:"Département",hideTags:!1,isOptional:!1,smallLabel:!1,searchInOptions:Ve},I={args:{...K}},$={args:{...K,multi:!0,initialValues:{departement:["01","02"],"search-departement":""}}},T={args:{...K,multi:!0,initialValues:{departement:["01","02"],"search-departement":""},hideTags:!0}};var Y,Z,ee;I.parameters={...I.parameters,docs:{...(Y=I.parameters)==null?void 0:Y.docs,source:{originalSource:`{
  args: {
    ...defaultProps
  }
}`,...(ee=(Z=I.parameters)==null?void 0:Z.docs)==null?void 0:ee.source}}};var te,ae,le;$.parameters={...$.parameters,docs:{...(te=$.parameters)==null?void 0:te.docs,source:{originalSource:`{
  args: {
    ...defaultProps,
    multi: true,
    initialValues: {
      departement: ['01', '02'],
      'search-departement': ''
    }
  }
}`,...(le=(ae=$.parameters)==null?void 0:ae.docs)==null?void 0:le.source}}};var ne,se,re;T.parameters={...T.parameters,docs:{...(ne=T.parameters)==null?void 0:ne.docs,source:{originalSource:`{
  args: {
    ...defaultProps,
    multi: true,
    initialValues: {
      departement: ['01', '02'],
      'search-departement': ''
    },
    hideTags: true
  }
}`,...(re=(se=T.parameters)==null?void 0:se.docs)==null?void 0:re.source}}};const ot=["Default","Multi","WithoutTags"];export{I as Default,$ as Multi,T as WithoutTags,ot as __namedExportsOrder,it as default};
