import{j as e}from"./jsx-runtime-ofdiCYXI.js";import{a as O,P as E}from"./reducer-DtCjat40.js";import{V as S}from"./index-DNVGrMOU.js";import{c as I}from"./testUtils-Df4EQTyh.js";import{r as l}from"./iframe-CK9LeSUu.js";import{a as T,S as D,I as L}from"./SafeImage-cgX6UqbB.js";import{T as A}from"./Tag-BRuccnkG.js";import{f as q}from"./full-edit-CxAaM2Fv.js";import{f as F}from"./full-more-DLJb58kc.js";import{f as M}from"./full-trash-CEfIUI4M.js";import{s as Y}from"./stroke-video-Cd5kQZzx.js";import{a as y}from"./api-D_Zc9dKw.js";import{n as x}from"./noop-BjFrJKj1.js";import{B as m}from"./Button-Dymr8h8s.js";import{B as f}from"./types-yVZEaApa.js";import{S as B}from"./SvgIcon-CHot5KN0.js";import{D as j,C as P}from"./DialogBuilder-CWuyVh1r.js";import{u as k,E as H}from"./constants-CfXUywJw.js";import{T as z}from"./TextInput-DY5zb_Wj.js";import"./chunk-NISHYRIK-9SXm3cjy.js";import"./config-BqmKEuqZ.js";import"./preload-helper-PPVm8Dsz.js";import"./index-BfMuJ3vc.js";import"./full-thumb-up-Bb4kpRpM.js";import"./stroke-pass-CALgybTM.js";import"./Tooltip-hkoA44fz.js";import"./Button.module-CY1ZDZvt.js";import"./index-UCY-ur64.js";import"./index-CTneaecd.js";import"./index-CDxaHmmY.js";import"./tslib.es6-BUas5LQb.js";import"./stroke-close-DnlFsd1c.js";import"./FieldFooter-DeobykX8.js";import"./full-error-BFAmjN4t.js";import"./index.module-CFpsg7g6.js";import"./FieldHeader-CzRM7UmZ.js";const G=o=>o.user.currentUser,U=l.createContext({setVideoUrl:x,videoData:void 0,handleVideoOnSubmit:async()=>{throw new Error("VideoUploaderContext not provided")},onVideoUpload:x,onVideoDelete:x,offerId:void 0}),C=()=>l.useContext(U);function b({children:o,initialVideoData:i,offerId:r}){const[a,t]=l.useState(i?.videoUrl),[d,s]=l.useState(i),h=async({onSuccess:u,onError:R})=>{if(a)try{const _=await y.getOfferVideoMetadata(a);s(_),u()}catch(_){const N=T(_);R(N)}},g=()=>{t(void 0),s(void 0)},c=l.useCallback(async()=>await y.patchDraftOffer(r,{videoUrl:a??""}),[a,r]);return e.jsx(U.Provider,{value:{videoUrl:a,videoData:d,handleVideoOnSubmit:c,setVideoUrl:t,onVideoUpload:h,onVideoDelete:g,offerId:r},children:o})}try{b.displayName="VideoUploaderContextProvider",b.__docgenInfo={description:"",displayName:"VideoUploaderContextProvider",props:{offerId:{defaultValue:null,description:"",name:"offerId",required:!0,type:{name:"number"}},initialVideoData:{defaultValue:null,description:"",name:"initialVideoData",required:!1,type:{name:"VideoData"}}}}}catch{}const W=new RegExp(/^(https?:\/\/)?(www\.)?(m\.)?(youtube\.com|youtu\.be)(\/watch\?v=|\/embed\/|\/v\/|\/e\/|\/)([^"&?\s]{11}\b)/),V=o=>{const i="Veuillez renseigner une URL valide. Ex : https://exemple.com",r="Veuillez renseigner une URL provenant de la plateforme Youtube";if(!o||o.trim()==="")return r;try{const t=new URL(o).hostname.toLowerCase();return(t==="youtu.be"||t==="www.youtu.be"||t==="youtube.com"||t==="www.youtube.com"||t==="www.m.youtube.com"||t==="m.youtube.com")&&W.test(o)?void 0:r}catch{return i}},$=""+new URL("youtube-logo-DoyiBwVG.png",import.meta.url).href,w={"modal-video":"_modal-video_1esiw_1","modal-video-content":"_modal-video-content_1esiw_7","modal-video-footer":"_modal-video-footer_1esiw_12"},v=({...o})=>{const[i,r]=l.useState(),{videoUrl:a,onVideoUpload:t,setVideoUrl:d,offerId:s}=C(),h=O(G),{logEvent:g}=k();return e.jsx(j,{...o,title:"Ajouter une vidéo",imageTitle:e.jsx("img",{alt:"",src:$}),variant:"drawer",children:e.jsxs("div",{className:w["modal-video"],children:[e.jsx("div",{className:w["modal-video-content"],children:e.jsx(z,{name:"videoUrl",label:"Lien URL Youtube",description:"Format : https://www.youtube.com/watch?v=0R5PZxOgoz8",error:i,value:a??"",onBlur:c=>{const u=c.target.value;r(V(u)),u&&V(u)&&g(H.OFFER_FORM_VIDEO_URL_ERROR,{offerId:s,userId:h?.id,videoUrl:u})},onChange:c=>{d(c.target.value)}})}),e.jsx(j.Footer,{children:e.jsxs("div",{className:w["modal-video-footer"],children:[e.jsx(P,{asChild:!0,children:e.jsx(m,{variant:f.SECONDARY,children:"Annuler"})}),e.jsx(m,{onClick:async()=>{a&&!V(a)&&await t({onSuccess:()=>{o.onOpenChange?.(!1)},onError:r})},children:"Ajouter"})]})})]})})};try{v.displayName="ModalVideo",v.__docgenInfo={description:"",displayName:"ModalVideo",props:{className:{defaultValue:null,description:"Custom CSS class for additional styling of the dialog content.",name:"className",required:!1,type:{name:"string"}},title:{defaultValue:null,description:"The heading title of the dialog.",name:"title",required:!1,type:{name:"string"}},variant:{defaultValue:null,description:"",name:"variant",required:!1,type:{name:"enum",value:[{value:'"default"'},{value:'"drawer"'}]}},trigger:{defaultValue:null,description:"The trigger element that opens the dialog.",name:"trigger",required:!1,type:{name:"ReactNode"}},open:{defaultValue:null,description:"Controls the open state of the dialog.",name:"open",required:!1,type:{name:"boolean"}},refToFocusOnClose:{defaultValue:null,description:`Ref of the element to focus on when the dialog is closed.
If refToFocusOnClose.current is null, the trigger element will be focused as a fallback.`,name:"refToFocusOnClose",required:!1,type:{name:"RefObject<HTMLElement>"}},closeButtonClassName:{defaultValue:null,description:"Custom CSS class for additional styling of the close button.",name:"closeButtonClassName",required:!1,type:{name:"string"}},imageTitle:{defaultValue:null,description:"An image for the title.",name:"imageTitle",required:!1,type:{name:"ReactNode"}},defaultOpen:{defaultValue:{value:"false"},description:"Determines if the dialog is open by default.",name:"defaultOpen",required:!1,type:{name:"boolean"}},onOpenChange:{defaultValue:null,description:"Callback function triggered when the open state of the dialog changes.",name:"onOpenChange",required:!1,type:{name:"((open: boolean) => void)"}}}}}catch{}const n={"video-uploader-container":"_video-uploader-container_1j794_1","video-uploader-no-video":"_video-uploader-no-video_1j794_5","video-uploader-with-video":"_video-uploader-with-video_1j794_21","video-duration":"_video-duration_1j794_34","video-preview":"_video-preview_1j794_40","video-title":"_video-title_1j794_46","action-wrapper":"_action-wrapper_1j794_59","video-uploader-text-subtle":"_video-uploader-text-subtle_1j794_67"};function Z(o){return Math.round(o/60).toLocaleString("fr-FR",{minimumFractionDigits:0,maximumFractionDigits:1})}const J=()=>{const[o,i]=l.useState(!1),{videoData:r,onVideoDelete:a}=C(),{videoDuration:t,videoTitle:d,videoThumbnailUrl:s}=r??{};return e.jsx("div",{className:n["video-uploader-container"],children:s?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:n["video-uploader-with-video"],children:[e.jsx(D,{alt:"Prévisualisation de l’image",className:n["video-preview"],src:s,placeholder:e.jsx(L,{})}),e.jsx("span",{className:n["video-duration"],children:e.jsx(A,{label:`${Z(t??0)} min`})}),e.jsx("p",{className:n["video-title"],children:d})]}),e.jsxs("div",{className:n["action-wrapper"],children:[e.jsx(v,{onOpenChange:i,open:o,trigger:e.jsx(m,{variant:f.TERNARY,icon:q,children:"Modifier"})}),e.jsx(m,{variant:f.TERNARY,icon:M,onClick:a,children:"Supprimer"})]})]}):e.jsxs("div",{className:n["video-uploader-no-video"],children:[e.jsx(B,{src:Y,alt:"",width:"44"}),e.jsx(v,{onOpenChange:i,open:o,trigger:e.jsx(m,{variant:f.TERNARY,icon:F,children:"Ajouter une URL Youtube"})}),e.jsx("p",{className:n["video-uploader-text-subtle"],children:"Affichage de la prévisualisation ici"})]})})},Te={title:"@/components/VideoUploader/VideoUploader",component:J,decorators:[S,o=>e.jsx(E,{store:I({}),children:e.jsx(o,{})})]},p={args:{}};p.parameters={...p.parameters,docs:{...p.parameters?.docs,source:{originalSource:`{
  args: {}
}`,...p.parameters?.docs?.source}}};const De=["WithoutImage"];export{p as WithoutImage,De as __namedExportsOrder,Te as default};
