import{j as e}from"./jsx-runtime-BYYWji4R.js";import{P as Ie}from"./reducer-Crbp5051.js";import{V as ve}from"./index-BQRgOAGl.js";import{c as ye}from"./testUtils-DY3eMo7d.js";import{c as A}from"./index-DeARc5FM.js";import{r as p}from"./index-ClcD9ViR.js";import{f as de}from"./full-trash-CEfIUI4M.js";import{B as U}from"./Button-CORqFySt.js";import{B as b}from"./types-yVZEaApa.js";import{S as me}from"./SvgIcon-CyWUmZpn.js";import{C as Ce}from"./ConfirmDialog-DupKLuxk.js";import{s as Ee}from"./stroke-trash-Cc_5v2lW.js";import{f as Ve}from"./full-edit-CxAaM2Fv.js";import{f as xe,a as Fe}from"./full-download-De3yFfyE.js";import{T as ce,C as J,D as pe}from"./DialogBuilder-DicE1ZPy.js";import{u as ue}from"./useNotification-DrLY4vYB.js";import{u as ge,E as fe}from"./constants-rfH-AarV.js";import{g as je,i as S,C as Ue}from"./imageConstraints-BuzLOJuz.js";import{T as we}from"./TextInput-CVZu0z03.js";import{I as Ne}from"./ImageEditor-DcO82YWX.js";import{B as Re}from"./BaseFileInput-Cx8kSk8N.js";import{I as be}from"./ImagePreferredOrientation-BP5ke7oK.js";import{c as Oe,b as Se}from"./index.esm-CIN8MBt5.js";import"./index-DOYoWpww.js";import"./index-J01lmiDr.js";import"./_commonjsHelpers-Cpj98o6Y.js";import"./config-BdqymTTq.js";import"./OfferAddressType-Co4gxJoY.js";import"./stroke-pass-CALgybTM.js";import"./Tooltip-BU5AxWXW.js";import"./Button.module-DGodUXbs.js";import"./stroke-error-DSZD431a.js";import"./Dialog-DXX_-0Q3.js";import"./index-2_ew_j0S.js";import"./tslib.es6-BUas5LQb.js";import"./stroke-close-DnlFsd1c.js";import"./FieldError-azuIsM2E.js";import"./BaseInput-BrnVefEj.js";import"./FieldLayoutCharacterCount-Bc4HS3VB.js";import"./index.module-DF6qn1Ex.js";import"./index-D5H1Pu04.js";import"./index-Chjiymov.js";import"./Slider-QPxPk_eb.js";const X=""+new URL("sample-image-landscape-B4GmPBHc.jpg",import.meta.url).href,Q=""+new URL("sample-image-portrait-OorsIixL.jpg",import.meta.url).href,qe={"button-image-delete-icon":"_button-image-delete-icon_ooh4c_1"},W=({isLoading:a,onConfirm:r,onDismiss:t,isDialogOpen:n,trigger:o})=>e.jsx(Ce,{cancelText:"Retour",confirmText:"Supprimer",icon:Ee,isLoading:a,onCancel:t,onConfirm:r,title:"Supprimer l’image",open:n,trigger:o,children:"Souhaitez-vous vraiment supprimer cette image ?"});try{W.displayName="ModalImageDelete",W.__docgenInfo={description:"",displayName:"ModalImageDelete",props:{isLoading:{defaultValue:null,description:"",name:"isLoading",required:!0,type:{name:"boolean"}},onConfirm:{defaultValue:null,description:"",name:"onConfirm",required:!0,type:{name:"() => void"}},onDismiss:{defaultValue:null,description:"",name:"onDismiss",required:!0,type:{name:"() => void"}},isDialogOpen:{defaultValue:null,description:"",name:"isDialogOpen",required:!0,type:{name:"boolean"}},trigger:{defaultValue:null,description:"",name:"trigger",required:!0,type:{name:"ReactNode"}}}}}catch{}const H=({onImageDelete:a})=>{const[r,t]=p.useState(!1),[n,o]=p.useState(!1),m=()=>{o(!0),a()};return e.jsx(W,{isLoading:n,onConfirm:m,onDismiss:()=>t(!1),isDialogOpen:r,trigger:e.jsxs(U,{onClick:()=>t(!0),variant:b.TERNARY,children:[e.jsx(me,{alt:"",className:qe["button-image-delete-icon"],src:de}),"Supprimer"]})})};try{H.displayName="ButtonImageDelete",H.__docgenInfo={description:"",displayName:"ButtonImageDelete",props:{onImageDelete:{defaultValue:null,description:"",name:"onImageDelete",required:!0,type:{name:"() => void"}}}}}catch{}var i=(a=>(a.OFFER="offer",a.OFFER_COLLECTIVE="offer_collective",a.VENUE="venue",a))(i||{});const Be=async(a,r="image.jpg")=>{const n=await(await fetch(a)).blob();return new File([n],r,{type:n.type})},P=(a,r)=>a+r/2,De=a=>100/(a*100),Pe=a=>{const[r,t]=p.useState(0),[n,o]=p.useState(0);return p.useEffect(()=>{(async()=>{if(a){const s=await je(a);s&&(t(s.width),o(s.height))}})()},[a]),a?{width:r,height:n}:{width:0,height:0}},Me=({originalDimensions:a,orientation:r})=>r==="landscape"?{width:Math.floor(Math.min(a.width,a.height/2*3)),height:Math.floor(Math.min(a.height,a.width/3*2))}:{width:Math.floor(Math.min(a.width,a.height/3*2)),height:Math.floor(Math.min(a.height,a.width/2*3))},he={[i.OFFER]:{maxSize:1e7,minWidth:400,types:["image/png","image/jpeg"],minHeight:600},[i.OFFER_COLLECTIVE]:{maxSize:1e7,minWidth:400,types:["image/png","image/jpeg"],minHeight:600},[i.VENUE]:{maxSize:1e7,minWidth:600,types:["image/png","image/jpeg"],minHeight:400}},v={"modal-image-crop":"_modal-image-crop_8k7re_1","modal-image-crop-content":"_modal-image-crop-content_8k7re_8","modal-image-crop-wrapper":"_modal-image-crop-wrapper_8k7re_11","modal-image-crop-editor":"_modal-image-crop-editor_8k7re_22","modal-image-crop-actions":"_modal-image-crop-actions_8k7re_30","modal-image-crop-header":"_modal-image-crop-header_8k7re_37","modal-image-crop-right":"_modal-image-crop-right_8k7re_43","modal-image-crop-credit":"_modal-image-crop-credit_8k7re_49","modal-image-crop-footer":"_modal-image-crop-footer_8k7re_53"},z=({image:a,initialCredit:r,onReplaceImage:t,onImageDelete:n,onEditedImageSave:o,saveInitialPosition:m,initialPosition:s,initialScale:g,mode:l})=>{const{logEvent:f}=ge(),{width:_,height:h}=Pe(a),c=p.useRef(null),I=ue(),[d,y]=p.useState(r||""),V=he[l].minWidth,{width:x}=Me({originalDimensions:{width:_,height:h},orientation:l===i.VENUE?"landscape":"portrait"}),F={[i.VENUE]:()=>e.jsx(e.Fragment,{}),[i.OFFER]:()=>e.jsx(e.Fragment,{}),[i.OFFER_COLLECTIVE]:()=>e.jsx(e.Fragment,{})}[l],w=Math.min(4,(x-10)/V),C={[i.OFFER]:297,[i.OFFER_COLLECTIVE]:297,[i.VENUE]:138}[l],L={[i.OFFER]:{canvasHeight:C,canvasWidth:C*2/3,cropBorderColor:"#FFF",cropBorderHeight:50,cropBorderWidth:105,maxScale:w},[i.OFFER_COLLECTIVE]:{canvasHeight:C,canvasWidth:C*2/3,cropBorderColor:"#FFF",cropBorderHeight:50,cropBorderWidth:105,maxScale:w},[i.VENUE]:{canvasHeight:C,canvasWidth:C*3/2,cropBorderColor:"#FFF",cropBorderHeight:40,cropBorderWidth:100,maxScale:w}}[l],O=u=>{f(fe.CLICKED_ADD_IMAGE,{imageCreationStage:"reframe image"});try{if(c.current){const N=c.current.getImage(),E=c.current.getCroppingRect();m({x:P(E.x,E.width),y:P(E.y,E.height)}),u&&u(d,N.toDataURL(),E)}}catch{I.error("Une erreur est survenue. Merci de réessayer plus tard")}};function T(){return O(o)}const k=()=>O();return e.jsxs("form",{className:v["modal-image-crop"],children:[e.jsxs("div",{className:v["modal-image-crop-content"],children:[e.jsx(ce,{asChild:!0,children:e.jsx("h1",{className:v["modal-image-crop-header"],children:"Modifier une image"})}),e.jsx("p",{className:v["modal-image-crop-right"],children:"En utilisant ce contenu, je certifie que je suis propriétaire ou que je dispose des autorisations nécessaires pour l’utilisation de celui-ci."}),e.jsxs("div",{className:v["modal-image-crop-wrapper"],children:[e.jsxs("div",{className:v["modal-image-crop-editor"],children:[e.jsx(Ne,{...L,image:a,initialPosition:s,ref:c,initialScale:g,onChangeDone:k}),e.jsxs("div",{className:v["modal-image-crop-actions"],children:[e.jsx(U,{icon:xe,onClick:t,variant:b.TERNARY,children:"Remplacer l’image"}),e.jsx(J,{asChild:!0,children:e.jsx(U,{icon:de,onClick:n,variant:b.TERNARY,children:"Supprimer l’image"})})]})]}),e.jsx(F,{})]}),e.jsx(we,{count:d.length,className:v["modal-image-crop-credit"],label:"Crédit de l’image",maxLength:255,value:d,onChange:u=>y(u.target.value),name:"credit",type:"text"})]}),e.jsx(pe.Footer,{children:e.jsxs("div",{className:v["modal-image-crop-footer"],children:[e.jsx(J,{asChild:!0,children:e.jsx(U,{variant:b.SECONDARY,children:"Annuler"})}),e.jsx(U,{type:"submit",onClick:u=>{u.preventDefault(),T()},children:"Enregistrer"})]})})]})};try{z.displayName="ModalImageCrop",z.__docgenInfo={description:"",displayName:"ModalImageCrop",props:{image:{defaultValue:null,description:"",name:"image",required:!0,type:{name:"File"}},initialCredit:{defaultValue:null,description:"",name:"initialCredit",required:!1,type:{name:"string | null"}},onReplaceImage:{defaultValue:null,description:"",name:"onReplaceImage",required:!0,type:{name:"() => void"}},onImageDelete:{defaultValue:null,description:"",name:"onImageDelete",required:!0,type:{name:"() => void"}},initialPosition:{defaultValue:null,description:"",name:"initialPosition",required:!1,type:{name:"Position"}},initialScale:{defaultValue:null,description:"",name:"initialScale",required:!1,type:{name:"number"}},saveInitialPosition:{defaultValue:null,description:"",name:"saveInitialPosition",required:!0,type:{name:"(position: Position) => void"}},onEditedImageSave:{defaultValue:null,description:"",name:"onEditedImageSave",required:!0,type:{name:"(credit: string | null, dataUrl: string, croppedRect: CroppedRect) => void"}},mode:{defaultValue:null,description:"",name:"mode",required:!0,type:{name:"enum",value:[{value:'"offer"'},{value:'"offer_collective"'},{value:'"venue"'}]}},imageUrl:{defaultValue:null,description:"",name:"imageUrl",required:!1,type:{name:"string"}}}}}catch{}const Le=({constraints:a})=>Oe().shape(a.reduce((r,t)=>({...r,[t.id]:Se().test({message:t.description,test:(n,o)=>t.asyncValidator(o.parent.image)})}),{})),$=({onSubmit:a,mode:r,isReady:t})=>{const{logEvent:n}=ge(),[o,m]=p.useState([]),s=he[r],g="preferred-orientation-caption",l="constraint-check",_={[i.OFFER]:"portrait",[i.OFFER_COLLECTIVE]:"portrait",[i.VENUE]:"landscape"}[r],h=[S.formats(s.types),S.size(s.maxSize),S.width(s.minWidth),S.height(s.minHeight)],c=Le({constraints:h}),I=async d=>{const y=d.currentTarget.files&&d.currentTarget.files.length>0?d.currentTarget.files[0]:null;if(y)try{await c.validate({image:y},{abortEarly:!1}),a({image:y}),n(fe.CLICKED_ADD_IMAGE,{imageCreationStage:"import image"})}catch(V){m(V.inner.map(x=>x.path||"unknown"))}};return e.jsxs("form",{onSubmit:d=>d.preventDefault(),children:[e.jsx(be,{id:g,orientation:_}),e.jsx(Re,{isDisabled:!t,label:"Importer une image depuis l’ordinateur",fileTypes:["image/png","image/jpeg"],isValid:o.length===0,onChange:I,ariaDescribedBy:`${g} ${l}`}),e.jsx(Ue,{id:l,constraints:h,failingConstraints:o})]})};try{$.displayName="ImageUploadBrowserForm",$.__docgenInfo={description:"",displayName:"ImageUploadBrowserForm",props:{onSubmit:{defaultValue:null,description:"",name:"onSubmit",required:!0,type:{name:"(values: ImageUploadBrowserFormValues) => void"}},mode:{defaultValue:null,description:"",name:"mode",required:!0,type:{name:"enum",value:[{value:'"offer"'},{value:'"offer_collective"'},{value:'"venue"'}]}},isReady:{defaultValue:null,description:"",name:"isReady",required:!0,type:{name:"boolean"}}}}}catch{}const Te="_header_tjlbo_12",Z={"modal-upload-browser":"_modal-upload-browser_tjlbo_1",header:Te},Y=({onImageClientUpload:a,mode:r,isReady:t})=>e.jsxs("section",{className:Z["modal-upload-browser"],children:[e.jsx(ce,{asChild:!0,children:e.jsx("h1",{className:Z.header,children:"Ajouter une image"})}),e.jsx($,{isReady:t,onSubmit:a,mode:r})]});try{Y.displayName="ModalImageUploadBrowser",Y.__docgenInfo={description:"",displayName:"ModalImageUploadBrowser",props:{onImageClientUpload:{defaultValue:null,description:"",name:"onImageClientUpload",required:!0,type:{name:"(values: ImageUploadBrowserFormValues) => void"}},mode:{defaultValue:null,description:"",name:"mode",required:!0,type:{name:"enum",value:[{value:'"offer"'},{value:'"offer_collective"'},{value:'"venue"'}]}},isReady:{defaultValue:null,description:"",name:"isReady",required:!0,type:{name:"boolean"}}}}}catch{}const G=({mode:a,onImageUpload:r,onImageDelete:t,initialValues:n={}})=>{const o=ue(),[m,s]=p.useState(!1),{draftImage:g,imageUrl:l,originalImageUrl:f,credit:_,cropParams:h}=n,[c,I]=p.useState(g),d=f||l;p.useEffect(()=>{async function u(N){try{I(await Be(N))}catch{o.error("Erreur lors de la récupération de votre image.")}}d&&u(d),s(!0)},[]);const{xCropPercent:y,yCropPercent:V,heightCropPercent:x,widthCropPercent:F}=h||{},[w,C]=p.useState({x:y&&F?P(y,F):.5,y:V&&x?P(V,x):.5}),L=u=>{I(u.image||void 0)},O=()=>{I(void 0)},T=()=>{!l&&!f?I(void 0):t==null||t()},k=(u,N,E)=>{E===void 0||c===void 0||r({imageFile:c,imageCroppedDataUrl:N,cropParams:E,credit:u})};return c?e.jsx(z,{initialCredit:_,image:c,initialPosition:w,initialScale:F?De(F):1,onEditedImageSave:k,onReplaceImage:O,onImageDelete:T,saveInitialPosition:C,mode:a,imageUrl:l}):e.jsx(Y,{onImageClientUpload:L,mode:a,isReady:m})};try{G.displayName="ModalImageEdit",G.__docgenInfo={description:"",displayName:"ModalImageEdit",props:{mode:{defaultValue:null,description:"",name:"mode",required:!0,type:{name:"enum",value:[{value:'"offer"'},{value:'"offer_collective"'},{value:'"venue"'}]}},onImageUpload:{defaultValue:null,description:"",name:"onImageUpload",required:!0,type:{name:"(values: OnImageUploadArgs) => void"}},onImageDelete:{defaultValue:null,description:"",name:"onImageDelete",required:!1,type:{name:"(() => void)"}},initialValues:{defaultValue:{value:"{}"},description:"",name:"initialValues",required:!1,type:{name:"UploadImageValues"}}}}}catch{}const ke="_label_12yra_22",Ae="_icon_12yra_35",R={"button-image-add":"_button-image-add_12yra_1","add-image-venue":"_add-image-venue_12yra_14","add-image-offer":"_add-image-offer_12yra_18",label:ke,icon:Ae},M=({mode:a,initialValues:r={},onImageUpload:t,onImageDelete:n,onClickButtonImage:o,children:m,disableForm:s})=>{const{imageUrl:g,originalImageUrl:l}=r,[f,_]=p.useState(!1),h=()=>{o&&o()},c=()=>{n()};function I(d){t(d),_(!1)}return e.jsx(e.Fragment,{children:e.jsx(pe,{onOpenChange:_,open:f,variant:"drawer",trigger:g||l?e.jsx(U,{onClick:h,variant:b.TERNARY,"aria-label":"Modifier l’image",icon:Ve,children:m??"Modifier"}):e.jsx("button",{className:A(R["button-image-add"],{[R["add-image-venue"]]:a===i.VENUE,[R["add-image-offer"]]:a===i.OFFER||a===i.OFFER_COLLECTIVE}),onClick:h,type:"button",disabled:s,children:e.jsxs(e.Fragment,{children:[e.jsx(me,{src:Fe,alt:"",className:R.icon}),e.jsx("span",{className:R.label,children:"Ajouter une image"})]})}),children:e.jsx(G,{mode:a,onImageUpload:I,onImageDelete:c,initialValues:r})})})};try{M.displayName="ButtonImageEdit",M.__docgenInfo={description:"",displayName:"ButtonImageEdit",props:{onImageUpload:{defaultValue:null,description:"",name:"onImageUpload",required:!0,type:{name:"(values: OnImageUploadArgs) => void"}},onImageDelete:{defaultValue:null,description:"",name:"onImageDelete",required:!0,type:{name:"() => void"}},initialValues:{defaultValue:{value:"{}"},description:"",name:"initialValues",required:!1,type:{name:"UploadImageValues"}},mode:{defaultValue:null,description:"",name:"mode",required:!0,type:{name:"enum",value:[{value:'"offer"'},{value:'"offer_collective"'},{value:'"venue"'}]}},onClickButtonImage:{defaultValue:null,description:"",name:"onClickButtonImage",required:!1,type:{name:"(() => void)"}},disableForm:{defaultValue:null,description:"",name:"disableForm",required:!1,type:{name:"boolean"}}}}}catch{}const j={"image-uploader-image-container":"_image-uploader-image-container_1gu1i_5","image-uploader-actions-container":"_image-uploader-actions-container_1gu1i_10","actions-wrapper":"_actions-wrapper_1gu1i_17","image-preview":"_image-preview_1gu1i_25","preview-venue":"_preview-venue_1gu1i_31","preview-offer":"_preview-offer_1gu1i_41"},K=({className:a,onImageUpload:r,onImageDelete:t,initialValues:n={},mode:o,onClickButtonImageAdd:m,hideActionButtons:s=!1,disableForm:g=!1})=>{const{imageUrl:l,originalImageUrl:f,credit:_,cropParams:h}=n;return e.jsx("div",{className:A(j["image-uploader-image-container"],a),children:l&&f?e.jsxs(e.Fragment,{children:[e.jsx("img",{alt:"Prévisualisation de l’image","data-testid":"image-preview",className:A(j["image-preview"],{[j["preview-venue"]]:o===i.VENUE,[j["preview-offer"]]:o===i.OFFER||o===i.OFFER_COLLECTIVE}),src:l}),!s&&e.jsx("div",{className:j["image-uploader-actions-container"],children:e.jsxs("div",{className:j["actions-wrapper"],children:[e.jsx(M,{mode:o,initialValues:{originalImageUrl:f,imageUrl:l,credit:_,cropParams:h},onImageUpload:r,onImageDelete:t,onClickButtonImage:m,disableForm:g}),e.jsx(H,{onImageDelete:t})]})})]}):e.jsx(M,{mode:o,onImageUpload:r,onImageDelete:t,onClickButtonImage:m,disableForm:g})})};try{K.displayName="ImageUploader",K.__docgenInfo={description:"",displayName:"ImageUploader",props:{className:{defaultValue:null,description:"",name:"className",required:!1,type:{name:"string"}},onImageUpload:{defaultValue:null,description:"",name:"onImageUpload",required:!0,type:{name:"(values: OnImageUploadArgs) => void"}},onImageDelete:{defaultValue:null,description:"",name:"onImageDelete",required:!0,type:{name:"() => void"}},initialValues:{defaultValue:{value:"{}"},description:"",name:"initialValues",required:!1,type:{name:"UploadImageValues"}},mode:{defaultValue:null,description:"",name:"mode",required:!0,type:{name:"enum",value:[{value:'"offer"'},{value:'"offer_collective"'},{value:'"venue"'}]}},onClickButtonImageAdd:{defaultValue:null,description:"",name:"onClickButtonImageAdd",required:!1,type:{name:"(() => void)"}},hideActionButtons:{defaultValue:{value:"false"},description:"",name:"hideActionButtons",required:!1,type:{name:"boolean"}},disableForm:{defaultValue:{value:"false"},description:"",name:"disableForm",required:!1,type:{name:"boolean"}}}}}catch{}const Oa={title:"components/ImageUploader/ImageUploader",component:K,decorators:[ve,a=>e.jsx(Ie,{store:ye({}),children:e.jsx(a,{})})]},_e={initialValues:{originalImageUrl:Q,imageUrl:Q,credit:"John Do",cropParams:{xCropPercent:0,yCropPercent:0,heightCropPercent:1,widthCropPercent:1}},mode:i.OFFER,onImageDelete:()=>{alert("onDelete have been called.")},onImageUpload:()=>{alert("onImageUpload have been called.")}},q={args:{..._e}},B={args:{..._e,initialValues:{imageUrl:X,originalImageUrl:X},mode:i.VENUE}},D={args:{mode:i.OFFER}};var ee,ae,re;q.parameters={...q.parameters,docs:{...(ee=q.parameters)==null?void 0:ee.docs,source:{originalSource:`{
  args: {
    ...props
  }
}`,...(re=(ae=q.parameters)==null?void 0:ae.docs)==null?void 0:re.source}}};var te,ie,oe;B.parameters={...B.parameters,docs:{...(te=B.parameters)==null?void 0:te.docs,source:{originalSource:`{
  args: {
    ...props,
    initialValues: {
      imageUrl: sampleImageLandscape,
      originalImageUrl: sampleImageLandscape
    },
    mode: UploaderModeEnum.VENUE
  }
}`,...(oe=(ie=B.parameters)==null?void 0:ie.docs)==null?void 0:oe.source}}};var ne,le,se;D.parameters={...D.parameters,docs:{...(ne=D.parameters)==null?void 0:ne.docs,source:{originalSource:`{
  args: {
    mode: UploaderModeEnum.OFFER
  }
}`,...(se=(le=D.parameters)==null?void 0:le.docs)==null?void 0:se.source}}};const Sa=["WithImageOffer","WithImageVenue","WithoutImage"];export{q as WithImageOffer,B as WithImageVenue,D as WithoutImage,Sa as __namedExportsOrder,Oa as default};
