import{j as e}from"./jsx-runtime-DF2Pcvd1.js";import{P as Le}from"./reducer-CONbTi63.js";import{V as De}from"./index-QnyK0pSJ.js";import{c as Be}from"./testUtils-DFIxeUvh.js";import{c as E}from"./index-DeARc5FM.js";import{S as Te,I as Ae}from"./SafeImage-DMSnoNVT.js";import{r as s}from"./index-B2-qRKKC.js";import{f as _e}from"./full-trash-CEfIUI4M.js";import{B as w}from"./Button-CJb_rOOr.js";import{B as C}from"./types-yVZEaApa.js";import{S as ve}from"./SvgIcon-DfLnDDE5.js";import{C as Me}from"./ConfirmDialog-CFuGDWKL.js";import{s as We}from"./stroke-trash-Cc_5v2lW.js";import{D as re,C as ie}from"./DialogBuilder-W9o8GbAS.js";import{u as ke,E as He}from"./constants-BEpYVNkg.js";import{u as Ye}from"./useNotification-CS-NvbKA.js";import{I as $e}from"./ImageDragAndDrop-Boxp7u1L.js";import{f as ze}from"./full-download-XQM5pv74.js";import{C as Ge,a as Xe}from"./Callout-RtKFwxB-.js";import{T as Je}from"./TextInput-BXnJurHW.js";import{S as oe}from"./Spinner-LSR2fxZV.js";import{I as Ke}from"./ImageEditor-C0CGVwxt.js";import{a as Ie,I as F}from"./ImagePreviewsWrapper-DfoQPFsY.js";import{f as Qe}from"./full-edit-CxAaM2Fv.js";import{f as Ze}from"./full-more-DLJb58kc.js";import"./chunk-PVWAREVJ-Bt0DAUl0.js";import"./config-BqmKEuqZ.js";import"./OfferAddressType-Co4gxJoY.js";import"./_commonjsHelpers-Cpj98o6Y.js";import"./stroke-pass-CALgybTM.js";import"./Tooltip-C-mHJC8R.js";import"./Button.module-Md2doL54.js";import"./stroke-error-DSZD431a.js";import"./Dialog-Bckl65jA.js";import"./index-BOyNoEXZ.js";import"./index-CFX93qP1.js";import"./tslib.es6-BUas5LQb.js";import"./stroke-close-DnlFsd1c.js";import"./index-BH3dreXg.js";import"./index-Chjiymov.js";import"./full-validate-CbMNulkZ.js";import"./stroke-picture-VF2OicDu.js";import"./full-error-BFAmjN4t.js";import"./full-info-D24AtBVt.js";import"./full-warning-LoKhBeYn.js";import"./full-link-CYVo23DH.js";import"./full-next-B_76kGmE.js";import"./ButtonLink-DBZrmTup.js";import"./BaseInput-JKfrEs2s.js";import"./stroke-search-dgesjRZH.js";import"./FieldError-B3RhE53I.js";import"./FieldLayoutCharacterCount-Cg7wcWeq.js";import"./index.module-BDmDBTbR.js";import"./Slider-BMhcIXDI.js";const ea=async(a,t="image.jpg")=>{const o=await(await fetch(a)).blob();return new File([o],t,{type:o.type})},ne=""+new URL("sample-image-landscape-B4GmPBHc.jpg",import.meta.url).href,le=""+new URL("sample-image-portrait-OorsIixL.jpg",import.meta.url).href;var i=(a=>(a.OFFER="offer",a.OFFER_COLLECTIVE="offer_collective",a.VENUE="venue",a))(i||{});const aa={"button-image-delete-icon":"_button-image-delete-icon_ooh4c_1"},$=({isLoading:a,onConfirm:t,onDismiss:r,isDialogOpen:o,trigger:l})=>e.jsx(Me,{cancelText:"Retour",confirmText:"Supprimer",icon:We,isLoading:a,onCancel:r,onConfirm:t,title:"Supprimer l’image",open:o,trigger:l,children:"Souhaitez-vous vraiment supprimer cette image ?"});try{$.displayName="ModalImageDelete",$.__docgenInfo={description:"",displayName:"ModalImageDelete",props:{isLoading:{defaultValue:null,description:"",name:"isLoading",required:!0,type:{name:"boolean"}},onConfirm:{defaultValue:null,description:"",name:"onConfirm",required:!0,type:{name:"() => void"}},onDismiss:{defaultValue:null,description:"",name:"onDismiss",required:!0,type:{name:"() => void"}},isDialogOpen:{defaultValue:null,description:"",name:"isDialogOpen",required:!0,type:{name:"boolean"}},trigger:{defaultValue:null,description:"",name:"trigger",required:!0,type:{name:"ReactNode"}}}}}catch{}const z=({onImageDelete:a})=>{const[t,r]=s.useState(!1),[o,l]=s.useState(!1),c=()=>{l(!0),a()};return e.jsx($,{isLoading:o,onConfirm:c,onDismiss:()=>r(!1),isDialogOpen:t,trigger:e.jsxs(w,{onClick:()=>r(!0),variant:C.TERNARY,children:[e.jsx(ve,{alt:"",className:aa["button-image-delete-icon"],src:_e}),"Supprimer"]})})};try{z.displayName="ButtonImageDelete",z.__docgenInfo={description:"",displayName:"ButtonImageDelete",props:{onImageDelete:{defaultValue:null,description:"",name:"onImageDelete",required:!0,type:{name:"() => void"}}}}}catch{}const ta=async a=>(window.createImageBitmap||(window.createImageBitmap=t=>new Promise(r=>{const o=document.createElement("img");o.addEventListener("load",function(){r(this)}),o.src=URL.createObjectURL(t)})),await createImageBitmap(a).catch(()=>null)),ra=a=>{const[t,r]=s.useState(0),[o,l]=s.useState(0);return s.useEffect(()=>{(async()=>{if(a){const n=await ta(a);n&&(r(n.width),l(n.height))}})()},[a]),a?{width:t,height:o}:{width:0,height:0}},R=(a,t)=>a+t/2,ia=a=>100/(a*100),oa=""+new URL("offer-home-shell-Ch3YT9j3.png",import.meta.url).href,na=""+new URL("offer-shell-coq2oAbe.png",import.meta.url).href,se={"image-preview-shell":"_image-preview-shell_98ykx_1","image-preview-home-preview":"_image-preview-home-preview_98ykx_7"},Y={"image-preview-shell":"_image-preview-shell_4wqwh_1","image-preview-blur-offer-preview":"_image-preview-blur-offer-preview_4wqwh_7","image-preview-offer-preview":"_image-preview-offer-preview_4wqwh_16"},G=({imageUrl:a})=>e.jsxs(Ie,{children:[e.jsxs(F,{title:"Page d’accueil",children:[e.jsx("img",{alt:"",className:se["image-preview-shell"],src:oa}),e.jsx("img",{"data-testid":"app-preview-offer-img-home",alt:"",className:se["image-preview-home-preview"],src:a})]}),e.jsxs(F,{title:"Détails de l’offre",children:[e.jsx("img",{alt:"",className:Y["image-preview-blur-offer-preview"],src:a}),e.jsx("img",{alt:"",className:Y["image-preview-shell"],src:na}),e.jsx("img",{"data-testid":"app-preview-offer-img",alt:"",className:Y["image-preview-offer-preview"],src:a})]})]});try{G.displayName="AppPreviewOffer",G.__docgenInfo={description:"",displayName:"AppPreviewOffer",props:{imageUrl:{defaultValue:null,description:"",name:"imageUrl",required:!0,type:{name:"string"}}}}}catch{}const la=""+new URL("partner-home-shell-QX5a1P1s.png",import.meta.url).href,sa=""+new URL("partner-shell-D59I5gaY.png",import.meta.url).href,me={"image-preview-shell":"_image-preview-shell_1isbc_1","image-preview-home-preview":"_image-preview-home-preview_1isbc_7"},ce={"image-preview-shell":"_image-preview-shell_1dg34_1","image-preview-offer-preview":"_image-preview-offer-preview_1dg34_7"},X=({imageUrl:a})=>e.jsxs(Ie,{children:[e.jsxs(F,{title:"Page d’accueil",children:[e.jsx("img",{alt:"",className:me["image-preview-shell"],src:la}),e.jsx("img",{"data-testid":"app-preview-offer-img-home",alt:"",className:me["image-preview-home-preview"],src:a})]}),e.jsxs(F,{title:"Détails de l’offre",children:[e.jsx("img",{alt:"",className:ce["image-preview-shell"],src:sa}),e.jsx("img",{"data-testid":"app-preview-offer-img",alt:"",className:ce["image-preview-offer-preview"],src:a})]})]});try{X.displayName="AppPreviewVenue",X.__docgenInfo={description:"",displayName:"AppPreviewVenue",props:{imageUrl:{defaultValue:null,description:"",name:"imageUrl",required:!0,type:{name:"string"}}}}}catch{}const d={"modal-image-crop":"_modal-image-crop_b5hrf_1","modal-image-crop-content":"_modal-image-crop-content_b5hrf_8","modal-image-crop-subwrapper":"_modal-image-crop-subwrapper_b5hrf_11","modal-image-crop-editor":"_modal-image-crop-editor_b5hrf_22","modal-image-crop-editor-loading":"_modal-image-crop-editor-loading_b5hrf_30","modal-image-crop-callout":"_modal-image-crop-callout_b5hrf_33","modal-image-crop-callout-list":"_modal-image-crop-callout-list_b5hrf_36","modal-image-crop-actions":"_modal-image-crop-actions_b5hrf_40","modal-image-crop-right":"_modal-image-crop-right_b5hrf_47","modal-image-crop-credit":"_modal-image-crop-credit_b5hrf_53","modal-image-crop-credit-loading":"_modal-image-crop-credit-loading_b5hrf_57","modal-image-crop-footer":"_modal-image-crop-footer_b5hrf_60"},ma=({originalDimensions:a,orientation:t})=>t==="landscape"?{width:Math.floor(Math.min(a.width,a.height/2*3)),height:Math.floor(Math.min(a.height,a.width/3*2))}:{width:Math.floor(Math.min(a.width,a.height/3*2)),height:Math.floor(Math.min(a.height,a.width/2*3))},ca=(a,t,r)=>{const o={[i.OFFER]:400,[i.OFFER_COLLECTIVE]:400,[i.VENUE]:600}[r],{width:l}=ma({originalDimensions:{width:a,height:t},orientation:r===i.VENUE?"landscape":"portrait"}),c=Math.min(4,(l-10)/o),n={[i.OFFER]:297,[i.OFFER_COLLECTIVE]:297,[i.VENUE]:138}[r];return{[i.OFFER]:{canvasHeight:n,canvasWidth:n*2/3,cropBorderHeight:50,cropBorderWidth:105,maxScale:c},[i.OFFER_COLLECTIVE]:{canvasHeight:n,canvasWidth:n*2/3,cropBorderHeight:50,cropBorderWidth:105,maxScale:c},[i.VENUE]:{canvasHeight:n,canvasWidth:n*3/2,cropBorderHeight:40,cropBorderWidth:100,maxScale:c}}[r]},J=({mode:a,onImageUpload:t,onImageDelete:r,initialValues:o={},...l})=>{const{logEvent:c}=ke(),{draftImage:n,...y}=o,p={x:.5,y:.5},{croppedImageUrl:h,originalImageUrl:D,credit:j,cropParams:V}=y,g=D||h,{xCropPercent:U,yCropPercent:N,heightCropPercent:Q,widthCropPercent:b}=V||{},we=U&&b?R(U,b):p.x,ye=N&&Q?R(N,Q):p.y,_=s.useRef(null),O=Ye(),[B,xe]=s.useState(!!g),[T,A]=s.useState(!0),[u,S]=s.useState(n),[Z,ee]=s.useState(g),[Ce,ae]=s.useState({x:we,y:ye}),[M,te]=s.useState(j??""),[Ee,je]=s.useState(b?ia(b):1),{width:W,height:k}=ra(u),Ve=ca(W,k,a),Ue=a===i.OFFER&&(W&&W<400||k&&k<600),Ne={[i.VENUE]:X,[i.OFFER]:G,[i.OFFER_COLLECTIVE]:()=>e.jsx(e.Fragment,{})}[a];s.useEffect(()=>{async function m(v){try{S(await ea(v))}catch{O.error("Erreur lors de la récupération de votre image.")}xe(!1)}l.open&&g&&m(g)},[l.open,g,O]),s.useEffect(()=>{S(n)},[n]);const be=()=>{S(void 0),ae({x:p.x,y:p.y}),te(""),je(1)},Oe=m=>{A(!0),S(m),H()},Se=(m,v,f)=>{u&&(c(He.CLICKED_SAVE_IMAGE,{imageType:a,imageCreationStage:"save"}),t({imageFile:u,imageCroppedDataUrl:v,cropParams:f,credit:m}))},Re=()=>{if(_.current){const m=_.current.getImage();ee(m.toDataURL()),A(!1)}},qe=()=>{A(!1),O.error("Erreur lors de la récupération de votre image.")},H=m=>{try{if(_.current){const v=_.current.getImage();ee(v.toDataURL());const f=_.current.getCroppingRect();ae({x:R(f.x,f.width),y:R(f.y,f.height)}),m&&m(M,v.toDataURL(),f)}}catch{O.error("Une erreur est survenue. Merci de réessayer plus tard")}},Pe=()=>H(),Fe=()=>H(Se);return e.jsx(re,{...l,title:"Modifier une image",variant:"drawer",children:e.jsxs("form",{className:d["modal-image-crop"],children:[e.jsxs("div",{className:d["modal-image-crop-content"],children:[e.jsx("p",{className:d["modal-image-crop-right"],children:"En utilisant ce contenu, je certifie que je suis propriétaire ou que je dispose des autorisations nécessaires pour l’utilisation de celui-ci."}),B&&e.jsx(oe,{testId:"spinner-img-load"}),!B&&u&&e.jsxs(e.Fragment,{children:[T&&e.jsx(oe,{testId:"spinner-img-paint"}),e.jsxs("div",{className:E(d["modal-image-crop-subwrapper"],T&&d["modal-image-crop-editor-loading"]),children:[e.jsxs("div",{className:d["modal-image-crop-editor"],children:[e.jsx(Ke,{ref:_,...Ve,image:u,initialPosition:Ce,initialScale:Ee,onChangeDone:Pe,onImagePainted:Re,onImageError:qe}),e.jsxs("div",{className:d["modal-image-crop-actions"],children:[e.jsx(w,{icon:ze,onClick:be,variant:C.TERNARY,children:"Remplacer l’image"}),e.jsx(ie,{asChild:!0,children:e.jsx(w,{icon:_e,onClick:r,variant:C.TERNARY,children:"Supprimer l’image"})})]})]}),Z&&e.jsx(Ne,{imageUrl:Z})]}),Ue&&e.jsx(Ge,{className:d["modal-image-crop-callout"],variant:Xe.WARNING,children:e.jsxs("div",{children:["La qualité de votre image n’est pas optimale.",e.jsx("br",{}),"Le format recommandé :",e.jsxs("ul",{className:d["modal-image-crop-callout-list"],children:[e.jsx("li",{children:"Largeur minimale de l’image : 400 px"}),e.jsx("li",{children:"Hauteur minimale de l’image : 600 px"})]})]})}),e.jsx(Je,{count:M.length,className:E(d["modal-image-crop-credit"],T&&d["modal-image-crop-credit-loading"]),label:"Crédit de l’image",maxLength:255,value:M,onChange:m=>te(m.target.value),name:"credit",type:"text"})]}),!B&&!u&&e.jsx($e,{onDropOrSelected:Oe,...a!==i.OFFER?{minSizes:{width:600,height:400}}:{}})]}),e.jsx(re.Footer,{children:e.jsxs("div",{className:d["modal-image-crop-footer"],children:[e.jsx(ie,{asChild:!0,children:e.jsx(w,{variant:C.SECONDARY,children:"Annuler"})}),e.jsx(w,{type:"submit",onClick:m=>{m.preventDefault(),Fe()},disabled:!u,children:"Importer"})]})})]})})};try{J.displayName="ModalImageUpsertOrEdit",J.__docgenInfo={description:"",displayName:"ModalImageUpsertOrEdit",props:{mode:{defaultValue:null,description:"",name:"mode",required:!0,type:{name:"enum",value:[{value:'"offer"'},{value:'"offer_collective"'},{value:'"venue"'}]}},onImageUpload:{defaultValue:null,description:"",name:"onImageUpload",required:!0,type:{name:"(values: OnImageUploadArgs) => void"}},onImageDelete:{defaultValue:null,description:"",name:"onImageDelete",required:!1,type:{name:"(() => void)"}},initialValues:{defaultValue:{value:"{}"},description:"",name:"initialValues",required:!1,type:{name:"UploadImageValues"}},title:{defaultValue:null,description:"The heading title of the dialog.",name:"title",required:!1,type:{name:"string"}},trigger:{defaultValue:null,description:"The trigger element that opens the dialog.",name:"trigger",required:!1,type:{name:"ReactNode"}},open:{defaultValue:null,description:"Controls the open state of the dialog.",name:"open",required:!1,type:{name:"boolean"}},refToFocusOnClose:{defaultValue:null,description:`Ref of the element to focus on when the dialog is closed.
If refToFocusOnClose.current is null, the trigger element will be focused as a fallback.`,name:"refToFocusOnClose",required:!1,type:{name:"RefObject<HTMLElement>"}},className:{defaultValue:null,description:"Custom CSS class for additional styling of the dialog content.",name:"className",required:!1,type:{name:"string"}},variant:{defaultValue:null,description:"",name:"variant",required:!1,type:{name:"enum",value:[{value:'"default"'},{value:'"drawer"'}]}},imageTitle:{defaultValue:null,description:"An image for the title.",name:"imageTitle",required:!1,type:{name:"ReactNode"}},defaultOpen:{defaultValue:{value:"false"},description:"Determines if the dialog is open by default.",name:"defaultOpen",required:!1,type:{name:"boolean"}},onOpenChange:{defaultValue:null,description:"Callback function triggered when the open state of the dialog changes.",name:"onOpenChange",required:!1,type:{name:"((open: boolean) => void)"}},closeButtonClassName:{defaultValue:null,description:"Custom CSS class for additional styling of the close button.",name:"closeButtonClassName",required:!1,type:{name:"string"}}}}}catch{}const da="_label_smqyd_22",pa="_icon_smqyd_32",x={"button-image-add":"_button-image-add_smqyd_1","add-image-venue":"_add-image-venue_smqyd_14","add-image-offer":"_add-image-offer_smqyd_18",label:da,icon:pa},L=({mode:a,initialValues:t={},onImageUpload:r,onImageDelete:o,onClickButtonImage:l,children:c,disableForm:n})=>{const{croppedImageUrl:y,originalImageUrl:p}=t,h=y||p,[D,j]=s.useState(!1),V=()=>{l&&l()},g=()=>{o()};function U(N){r(N),j(!1)}return e.jsx(J,{mode:a,onImageUpload:U,onImageDelete:g,initialValues:t,onOpenChange:j,open:D,trigger:h?e.jsx(w,{onClick:V,variant:C.TERNARY,"aria-label":"Modifier l’image",icon:Qe,children:c??"Modifier"}):e.jsxs("button",{className:E(x["button-image-add"],{[x["add-image-venue"]]:a===i.VENUE,[x["add-image-offer"]]:a===i.OFFER||a===i.OFFER_COLLECTIVE}),onClick:V,type:"button",disabled:n,children:[e.jsx(ve,{src:Ze,alt:"",className:x.icon}),e.jsx("span",{className:x.label,children:"Ajouter une image"})]})})};try{L.displayName="ButtonImageEdit",L.__docgenInfo={description:"",displayName:"ButtonImageEdit",props:{onImageUpload:{defaultValue:null,description:"",name:"onImageUpload",required:!0,type:{name:"(values: OnImageUploadArgs) => void"}},onImageDelete:{defaultValue:null,description:"",name:"onImageDelete",required:!0,type:{name:"() => void"}},initialValues:{defaultValue:{value:"{}"},description:"",name:"initialValues",required:!1,type:{name:"UploadImageValues"}},mode:{defaultValue:null,description:"",name:"mode",required:!0,type:{name:"enum",value:[{value:'"offer"'},{value:'"offer_collective"'},{value:'"venue"'}]}},onClickButtonImage:{defaultValue:null,description:"",name:"onClickButtonImage",required:!1,type:{name:"(() => void)"}},disableForm:{defaultValue:null,description:"",name:"disableForm",required:!1,type:{name:"boolean"}}}}}catch{}const I={"image-uploader-image-container":"_image-uploader-image-container_1c65v_5","image-uploader-actions-container":"_image-uploader-actions-container_1c65v_10","actions-wrapper":"_actions-wrapper_1c65v_17","image-preview":"_image-preview_1c65v_25","preview-venue":"_preview-venue_1c65v_31","placeholder-venue":"_placeholder-venue_1c65v_42"},K=({className:a,onImageUpload:t,onImageDelete:r,initialValues:o={},onClickButtonImageAdd:l,hideActionButtons:c=!1,disableForm:n=!1})=>{const{croppedImageUrl:y,originalImageUrl:p}=o,h=y||p;return e.jsx("div",{className:E(I["image-uploader-image-container"],a),children:h?e.jsxs(e.Fragment,{children:[e.jsx(Te,{alt:"Prévisualisation de l’image","data-testid":"image-preview",className:E(I["image-preview"],I["preview-venue"]),src:h,placeholder:e.jsx(Ae,{className:I["placeholder-venue"]})}),!c&&e.jsx("div",{className:I["image-uploader-actions-container"],children:e.jsxs("div",{className:I["actions-wrapper"],children:[e.jsx(L,{mode:i.VENUE,initialValues:o,onImageUpload:t,onImageDelete:r,onClickButtonImage:l,disableForm:n}),e.jsx(z,{onImageDelete:r})]})})]}):e.jsx(L,{mode:i.VENUE,onImageUpload:t,onImageDelete:r,onClickButtonImage:l,disableForm:n})})};try{K.displayName="ImageUploader",K.__docgenInfo={description:"",displayName:"ImageUploader",props:{className:{defaultValue:null,description:"",name:"className",required:!1,type:{name:"string"}},onImageUpload:{defaultValue:null,description:"",name:"onImageUpload",required:!0,type:{name:"(values: OnImageUploadArgs) => void"}},onImageDelete:{defaultValue:null,description:"",name:"onImageDelete",required:!0,type:{name:"() => void"}},initialValues:{defaultValue:{value:"{}"},description:"",name:"initialValues",required:!1,type:{name:"UploadImageValues"}},onClickButtonImageAdd:{defaultValue:null,description:"",name:"onClickButtonImageAdd",required:!1,type:{name:"(() => void)"}},hideActionButtons:{defaultValue:{value:"false"},description:"",name:"hideActionButtons",required:!1,type:{name:"boolean"}},disableForm:{defaultValue:{value:"false"},description:"",name:"disableForm",required:!1,type:{name:"boolean"}}}}}catch{}const ut={title:"@/components/ImageUploader/ImageUploader",component:K,decorators:[De,a=>e.jsx(Le,{store:Be({}),children:e.jsx(a,{})})]},ga={initialValues:{originalImageUrl:le,croppedImageUrl:le,credit:"John Do",cropParams:{xCropPercent:0,yCropPercent:0,heightCropPercent:1,widthCropPercent:1}},onImageDelete:()=>{alert("onDelete have been called.")},onImageUpload:()=>{alert("onImageUpload have been called.")}},q={args:{...ga,initialValues:{croppedImageUrl:ne,originalImageUrl:ne}}},P={args:{}};var de,pe,ge;q.parameters={...q.parameters,docs:{...(de=q.parameters)==null?void 0:de.docs,source:{originalSource:`{
  args: {
    ...props,
    initialValues: {
      croppedImageUrl: sampleImageLandscape,
      originalImageUrl: sampleImageLandscape
    }
  }
}`,...(ge=(pe=q.parameters)==null?void 0:pe.docs)==null?void 0:ge.source}}};var ue,fe,he;P.parameters={...P.parameters,docs:{...(ue=P.parameters)==null?void 0:ue.docs,source:{originalSource:`{
  args: {}
}`,...(he=(fe=P.parameters)==null?void 0:fe.docs)==null?void 0:he.source}}};const ft=["WithImageVenue","WithoutImage"];export{q as WithImageVenue,P as WithoutImage,ft as __namedExportsOrder,ut as default};
