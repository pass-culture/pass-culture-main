import{j as e}from"./jsx-runtime-BYYWji4R.js";import{P as De}from"./reducer-DQPuV9Vk.js";import{V as Le}from"./index-EP-l6Sro.js";import{c as qe}from"./testUtils-BTdZZ4De.js";import{c as C}from"./index-DeARc5FM.js";import{r as m}from"./index-ClcD9ViR.js";import{f as he}from"./full-trash-CEfIUI4M.js";import{B as y}from"./Button-COUp2H-B.js";import{B as j}from"./types-yVZEaApa.js";import{S as _e}from"./SvgIcon-CyWUmZpn.js";import{C as Be}from"./ConfirmDialog-BQIbiho1.js";import{s as Ae}from"./stroke-trash-Cc_5v2lW.js";import{T as Me,C as ae,D as ve}from"./DialogBuilder-LeprPbGn.js";import{u as Te,E as We}from"./constants-Cfk2u9jZ.js";import{g as ke}from"./image-CI1RfRht.js";import{u as He}from"./useNotification-Hw1Ms4y_.js";import{I as Ye}from"./ImageDragAndDrop-DgEKjJFw.js";import{f as $e,a as ze}from"./full-more-D-B0T6P8.js";import{C as Ge,a as Xe}from"./Callout-DCR_vQBr.js";import{T as Je}from"./TextInput-Cn-XS-xI.js";import{S as Ke}from"./Spinner-BHztG-h6.js";import{I as Qe}from"./ImageEditor-CCNh8dZM.js";import{a as Ie,I as b}from"./ImagePreviewsWrapper-G1laXlNt.js";import{f as Ze}from"./full-edit-CxAaM2Fv.js";import"./chunk-D4RADZKF-nWvgSiz2.js";import"./config-BqmKEuqZ.js";import"./OfferAddressType-Co4gxJoY.js";import"./_commonjsHelpers-Cpj98o6Y.js";import"./stroke-pass-CALgybTM.js";import"./Tooltip-BpKRYYrm.js";import"./Button.module-D_4QtxUL.js";import"./stroke-error-DSZD431a.js";import"./Dialog-BCXTZYHt.js";import"./index-BUMxx5F6.js";import"./tslib.es6-BUas5LQb.js";import"./stroke-close-DnlFsd1c.js";import"./index-BH3dreXg.js";import"./index-Chjiymov.js";import"./full-validate-CbMNulkZ.js";import"./stroke-picture-VF2OicDu.js";import"./full-info-C4RdBA4U.js";import"./full-warning-LoKhBeYn.js";import"./full-link-CYVo23DH.js";import"./full-next-B_76kGmE.js";import"./ButtonLink-B9MvZqDa.js";import"./BaseInput-BI1b_EYZ.js";import"./FieldError-azuIsM2E.js";import"./FieldLayoutCharacterCount-CTPArH5Q.js";import"./index.module-DF6qn1Ex.js";import"./Slider-D8sIjjnx.js";var r=(a=>(a.OFFER="offer",a.OFFER_COLLECTIVE="offer_collective",a.VENUE="venue",a))(r||{});const re=""+new URL("sample-image-landscape-B4GmPBHc.jpg",import.meta.url).href,ie=""+new URL("sample-image-portrait-OorsIixL.jpg",import.meta.url).href,ea={"button-image-delete-icon":"_button-image-delete-icon_ooh4c_1"},H=({isLoading:a,onConfirm:i,onDismiss:t,isDialogOpen:n,trigger:o})=>e.jsx(Be,{cancelText:"Retour",confirmText:"Supprimer",icon:Ae,isLoading:a,onCancel:t,onConfirm:i,title:"Supprimer l’image",open:n,trigger:o,children:"Souhaitez-vous vraiment supprimer cette image ?"});try{H.displayName="ModalImageDelete",H.__docgenInfo={description:"",displayName:"ModalImageDelete",props:{isLoading:{defaultValue:null,description:"",name:"isLoading",required:!0,type:{name:"boolean"}},onConfirm:{defaultValue:null,description:"",name:"onConfirm",required:!0,type:{name:"() => void"}},onDismiss:{defaultValue:null,description:"",name:"onDismiss",required:!0,type:{name:"() => void"}},isDialogOpen:{defaultValue:null,description:"",name:"isDialogOpen",required:!0,type:{name:"boolean"}},trigger:{defaultValue:null,description:"",name:"trigger",required:!0,type:{name:"ReactNode"}}}}}catch{}const Y=({onImageDelete:a})=>{const[i,t]=m.useState(!1),[n,o]=m.useState(!1),c=()=>{o(!0),a()};return e.jsx(H,{isLoading:n,onConfirm:c,onDismiss:()=>t(!1),isDialogOpen:i,trigger:e.jsxs(y,{onClick:()=>t(!0),variant:j.TERNARY,children:[e.jsx(_e,{alt:"",className:ea["button-image-delete-icon"],src:he}),"Supprimer"]})})};try{Y.displayName="ButtonImageDelete",Y.__docgenInfo={description:"",displayName:"ButtonImageDelete",props:{onImageDelete:{defaultValue:null,description:"",name:"onImageDelete",required:!0,type:{name:"() => void"}}}}}catch{}const aa=async(a,i="image.jpg")=>{const n=await(await fetch(a)).blob();return new File([n],i,{type:n.type})},ra=a=>{const[i,t]=m.useState(0),[n,o]=m.useState(0);return m.useEffect(()=>{(async()=>{if(a){const l=await ke(a);l&&(t(l.width),o(l.height))}})()},[a]),a?{width:i,height:n}:{width:0,height:0}},O=(a,i)=>a+i/2,ia=a=>100/(a*100),ta=""+new URL("offer-home-shell-Ch3YT9j3.png",import.meta.url).href,oa=""+new URL("offer-shell-coq2oAbe.png",import.meta.url).href,te={"image-preview-shell":"_image-preview-shell_1yqyc_1","image-preview-home-preview":"_image-preview-home-preview_1yqyc_7"},k={"image-preview-shell":"_image-preview-shell_8f82l_1","image-preview-blur-offer-preview":"_image-preview-blur-offer-preview_8f82l_7","image-preview-offer-preview":"_image-preview-offer-preview_8f82l_16"},$=({imageUrl:a})=>e.jsxs(Ie,{children:[e.jsxs(b,{title:"Page d’accueil",children:[e.jsx("img",{alt:"",className:te["image-preview-shell"],src:ta,role:"presentation"}),e.jsx("img",{"data-testid":"app-preview-offer-img-home",alt:"",className:te["image-preview-home-preview"],src:a,role:"presentation"})]}),e.jsxs(b,{title:"Détails de l’offre",children:[e.jsx("img",{alt:"",className:k["image-preview-blur-offer-preview"],src:a,role:"presentation"}),e.jsx("img",{alt:"",className:k["image-preview-shell"],src:oa,role:"presentation"}),e.jsx("img",{"data-testid":"app-preview-offer-img",alt:"",className:k["image-preview-offer-preview"],src:a,role:"presentation"})]})]});try{$.displayName="AppPreviewOffer",$.__docgenInfo={description:"",displayName:"AppPreviewOffer",props:{imageUrl:{defaultValue:null,description:"",name:"imageUrl",required:!0,type:{name:"string"}}}}}catch{}const na=""+new URL("partner-home-shell-QX5a1P1s.png",import.meta.url).href,la=""+new URL("partner-shell-D59I5gaY.png",import.meta.url).href,oe={"image-preview-shell":"_image-preview-shell_nl6jv_1","image-preview-home-preview":"_image-preview-home-preview_nl6jv_7"},ne={"image-preview-shell":"_image-preview-shell_19ta7_1","image-preview-offer-preview":"_image-preview-offer-preview_19ta7_7"},z=({imageUrl:a})=>e.jsxs(Ie,{children:[e.jsxs(b,{title:"Page d’accueil",children:[e.jsx("img",{alt:"",className:oe["image-preview-shell"],src:na,role:"presentation"}),e.jsx("img",{"data-testid":"app-preview-offer-img-home",alt:"",className:oe["image-preview-home-preview"],src:a,role:"presentation"})]}),e.jsxs(b,{title:"Détails de l’offre",children:[e.jsx("img",{alt:"",className:ne["image-preview-shell"],src:la,role:"presentation"}),e.jsx("img",{"data-testid":"app-preview-offer-img",alt:"",className:ne["image-preview-offer-preview"],src:a,role:"presentation"})]})]});try{z.displayName="AppPreviewVenue",z.__docgenInfo={description:"",displayName:"AppPreviewVenue",props:{imageUrl:{defaultValue:null,description:"",name:"imageUrl",required:!0,type:{name:"string"}}}}}catch{}const p={"modal-image-crop":"_modal-image-crop_1gr3s_1","modal-image-crop-content":"_modal-image-crop-content_1gr3s_8","modal-image-crop-subwrapper":"_modal-image-crop-subwrapper_1gr3s_11","modal-image-crop-editor":"_modal-image-crop-editor_1gr3s_22","modal-image-crop-editor-loading":"_modal-image-crop-editor-loading_1gr3s_30","modal-image-crop-callout":"_modal-image-crop-callout_1gr3s_33","modal-image-crop-callout-list":"_modal-image-crop-callout-list_1gr3s_36","modal-image-crop-actions":"_modal-image-crop-actions_1gr3s_40","modal-image-crop-header":"_modal-image-crop-header_1gr3s_47","modal-image-crop-right":"_modal-image-crop-right_1gr3s_53","modal-image-crop-credit":"_modal-image-crop-credit_1gr3s_59","modal-image-crop-credit-loading":"_modal-image-crop-credit-loading_1gr3s_63","modal-image-crop-footer":"_modal-image-crop-footer_1gr3s_66"},sa=({originalDimensions:a,orientation:i})=>i==="landscape"?{width:Math.floor(Math.min(a.width,a.height/2*3)),height:Math.floor(Math.min(a.height,a.width/3*2))}:{width:Math.floor(Math.min(a.width,a.height/3*2)),height:Math.floor(Math.min(a.height,a.width/2*3))},ma=(a,i,t)=>{const n={[r.OFFER]:400,[r.OFFER_COLLECTIVE]:400,[r.VENUE]:600}[t],{width:o}=sa({originalDimensions:{width:a,height:i},orientation:t===r.VENUE?"landscape":"portrait"}),c=Math.min(4,(o-10)/n),l={[r.OFFER]:297,[r.OFFER_COLLECTIVE]:297,[r.VENUE]:138}[t];return{[r.OFFER]:{canvasHeight:l,canvasWidth:l*2/3,cropBorderColor:"#FFF",cropBorderHeight:50,cropBorderWidth:105,maxScale:c},[r.OFFER_COLLECTIVE]:{canvasHeight:l,canvasWidth:l*2/3,cropBorderColor:"#FFF",cropBorderHeight:50,cropBorderWidth:105,maxScale:c},[r.VENUE]:{canvasHeight:l,canvasWidth:l*3/2,cropBorderColor:"#FFF",cropBorderHeight:40,cropBorderWidth:100,maxScale:c}}[t]},G=({mode:a,onImageUpload:i,onImageDelete:t,initialValues:n={}})=>{const{logEvent:o}=Te(),{draftImage:c,...l}=n,d={x:.5,y:.5},{originalImageUrl:u,credit:_,cropParams:v}=l,g=u,{xCropPercent:U,yCropPercent:V,heightCropPercent:N,widthCropPercent:F}=v||{},xe=U&&F?O(U,F):d.x,ye=V&&N?O(V,N):d.y,I=m.useRef(null),L=He(),[q,J]=m.useState(!0),[f,B]=m.useState(c),[K,Q]=m.useState(g),[Ee,Z]=m.useState({x:xe,y:ye}),[A,ee]=m.useState(_??""),[je,Ce]=m.useState(F?ia(F):1),{width:M,height:T}=ra(f),Ue=ma(M,T,a),Ve=a===r.OFFER&&(M&&M<400||T&&T<600),Ne={[r.VENUE]:z,[r.OFFER]:$,[r.OFFER_COLLECTIVE]:()=>e.jsx(e.Fragment,{})}[a];m.useEffect(()=>{async function s(w){try{B(await aa(w))}catch{L.error("Erreur lors de la récupération de votre image.")}}g&&s(g)},[g,L]);const Fe=()=>{B(void 0),Z({x:d.x,y:d.y}),ee(""),Ce(1)},Oe=s=>{J(!0),B(s),W()},Re=(s,w,h)=>{f&&(o(We.CLICKED_SAVE_IMAGE,{imageType:a,imageCreationStage:"save"}),i({imageFile:f,imageCroppedDataUrl:w,cropParams:h,credit:s}))},Pe=()=>{if(I.current){const s=I.current.getImage();Q(s.toDataURL()),J(!1)}},W=s=>{try{if(I.current){const w=I.current.getImage();Q(w.toDataURL());const h=I.current.getCroppingRect();Z({x:O(h.x,h.width),y:O(h.y,h.height)}),s&&s(A,w.toDataURL(),h)}}catch{L.error("Une erreur est survenue. Merci de réessayer plus tard")}},Se=()=>W(),be=()=>W(Re);return e.jsxs("form",{className:p["modal-image-crop"],children:[e.jsxs("div",{className:p["modal-image-crop-content"],children:[e.jsx(Me,{asChild:!0,children:e.jsx("h1",{className:p["modal-image-crop-header"],children:"Modifier une image"})}),e.jsx("p",{className:p["modal-image-crop-right"],children:"En utilisant ce contenu, je certifie que je suis propriétaire ou que je dispose des autorisations nécessaires pour l’utilisation de celui-ci."}),f&&e.jsxs(e.Fragment,{children:[q&&e.jsx(Ke,{}),e.jsxs("div",{className:C(p["modal-image-crop-subwrapper"],q&&p["modal-image-crop-editor-loading"]),children:[e.jsxs("div",{className:p["modal-image-crop-editor"],children:[e.jsx(Qe,{ref:I,...Ue,image:f,initialPosition:Ee,initialScale:je,onChangeDone:Se,onImagePainted:Pe}),e.jsxs("div",{className:p["modal-image-crop-actions"],children:[e.jsx(y,{icon:$e,onClick:Fe,variant:j.TERNARY,children:"Remplacer l’image"}),e.jsx(ae,{asChild:!0,children:e.jsx(y,{icon:he,onClick:t,variant:j.TERNARY,children:"Supprimer l’image"})})]})]}),K&&e.jsx(Ne,{imageUrl:K})]}),Ve&&e.jsx(Ge,{className:p["modal-image-crop-callout"],variant:Xe.WARNING,children:e.jsxs("div",{children:["La qualité de votre image n’est pas optimale.",e.jsx("br",{}),"Le format recommandé :",e.jsxs("ul",{className:p["modal-image-crop-callout-list"],children:[e.jsx("li",{children:"Largeur minimale de l’image : 400 px"}),e.jsx("li",{children:"Hauteur minimale de l’image : 600 px"})]})]})}),e.jsx(Je,{count:A.length,className:C(p["modal-image-crop-credit"],q&&p["modal-image-crop-credit-loading"]),label:"Crédit de l’image",maxLength:255,value:A,onChange:s=>ee(s.target.value),name:"credit",type:"text"})]}),!f&&e.jsx(Ye,{onDropOrSelected:Oe,...a!==r.OFFER?{minSizes:{width:600,height:400}}:{}})]}),e.jsx(ve.Footer,{children:e.jsxs("div",{className:p["modal-image-crop-footer"],children:[e.jsx(ae,{asChild:!0,children:e.jsx(y,{variant:j.SECONDARY,children:"Annuler"})}),e.jsx(y,{type:"submit",onClick:s=>{s.preventDefault(),be()},disabled:!f,children:"Enregistrer"})]})})]})};try{G.displayName="ModalImageUpsertOrEdit",G.__docgenInfo={description:"",displayName:"ModalImageUpsertOrEdit",props:{mode:{defaultValue:null,description:"",name:"mode",required:!0,type:{name:"enum",value:[{value:'"offer"'},{value:'"offer_collective"'},{value:'"venue"'}]}},onImageUpload:{defaultValue:null,description:"",name:"onImageUpload",required:!0,type:{name:"(values: OnImageUploadArgs) => void"}},onImageDelete:{defaultValue:null,description:"",name:"onImageDelete",required:!1,type:{name:"(() => void)"}},initialValues:{defaultValue:{value:"{}"},description:"",name:"initialValues",required:!1,type:{name:"UploadImageValues"}}}}}catch{}const ca="_label_1wm17_22",pa="_icon_1wm17_35",E={"button-image-add":"_button-image-add_1wm17_1","add-image-venue":"_add-image-venue_1wm17_14","add-image-offer":"_add-image-offer_1wm17_18",label:ca,icon:pa},D=({mode:a,initialValues:i={},onImageUpload:t,onImageDelete:n,onClickButtonImage:o,children:c,disableForm:l})=>{const{imageUrl:d,originalImageUrl:u}=i,[_,v]=m.useState(!1),g=()=>{o&&o()},U=()=>{n()};function V(N){t(N),v(!1)}return e.jsx(e.Fragment,{children:e.jsx(ve,{onOpenChange:v,open:_,variant:"drawer",trigger:d||u?e.jsx(y,{onClick:g,variant:j.TERNARY,"aria-label":"Modifier l’image",icon:Ze,children:c??"Modifier"}):e.jsx("button",{className:C(E["button-image-add"],{[E["add-image-venue"]]:a===r.VENUE,[E["add-image-offer"]]:a===r.OFFER||a===r.OFFER_COLLECTIVE}),onClick:g,type:"button",disabled:l,children:e.jsxs(e.Fragment,{children:[e.jsx(_e,{src:ze,alt:"",className:E.icon}),e.jsx("span",{className:E.label,children:"Ajouter une image"})]})}),children:e.jsx(G,{mode:a,onImageUpload:V,onImageDelete:U,initialValues:i})})})};try{D.displayName="ButtonImageEdit",D.__docgenInfo={description:"",displayName:"ButtonImageEdit",props:{onImageUpload:{defaultValue:null,description:"",name:"onImageUpload",required:!0,type:{name:"(values: OnImageUploadArgs) => void"}},onImageDelete:{defaultValue:null,description:"",name:"onImageDelete",required:!0,type:{name:"() => void"}},initialValues:{defaultValue:{value:"{}"},description:"",name:"initialValues",required:!1,type:{name:"UploadImageValues"}},mode:{defaultValue:null,description:"",name:"mode",required:!0,type:{name:"enum",value:[{value:'"offer"'},{value:'"offer_collective"'},{value:'"venue"'}]}},onClickButtonImage:{defaultValue:null,description:"",name:"onClickButtonImage",required:!1,type:{name:"(() => void)"}},disableForm:{defaultValue:null,description:"",name:"disableForm",required:!1,type:{name:"boolean"}}}}}catch{}const x={"image-uploader-image-container":"_image-uploader-image-container_1gu1i_5","image-uploader-actions-container":"_image-uploader-actions-container_1gu1i_10","actions-wrapper":"_actions-wrapper_1gu1i_17","image-preview":"_image-preview_1gu1i_25","preview-venue":"_preview-venue_1gu1i_31","preview-offer":"_preview-offer_1gu1i_41"},X=({className:a,onImageUpload:i,onImageDelete:t,initialValues:n={},mode:o,onClickButtonImageAdd:c,hideActionButtons:l=!1,disableForm:d=!1})=>{const{imageUrl:u,originalImageUrl:_,credit:v,cropParams:g}=n;return e.jsx("div",{className:C(x["image-uploader-image-container"],a),children:u&&_?e.jsxs(e.Fragment,{children:[e.jsx("img",{alt:"Prévisualisation de l’image","data-testid":"image-preview",className:C(x["image-preview"],{[x["preview-venue"]]:o===r.VENUE,[x["preview-offer"]]:o===r.OFFER||o===r.OFFER_COLLECTIVE}),src:u}),!l&&e.jsx("div",{className:x["image-uploader-actions-container"],children:e.jsxs("div",{className:x["actions-wrapper"],children:[e.jsx(D,{mode:o,initialValues:{originalImageUrl:_,imageUrl:u,credit:v,cropParams:g},onImageUpload:i,onImageDelete:t,onClickButtonImage:c,disableForm:d}),e.jsx(Y,{onImageDelete:t})]})})]}):e.jsx(D,{mode:o,onImageUpload:i,onImageDelete:t,onClickButtonImage:c,disableForm:d})})};try{X.displayName="ImageUploader",X.__docgenInfo={description:"",displayName:"ImageUploader",props:{className:{defaultValue:null,description:"",name:"className",required:!1,type:{name:"string"}},onImageUpload:{defaultValue:null,description:"",name:"onImageUpload",required:!0,type:{name:"(values: OnImageUploadArgs) => void"}},onImageDelete:{defaultValue:null,description:"",name:"onImageDelete",required:!0,type:{name:"() => void"}},initialValues:{defaultValue:{value:"{}"},description:"",name:"initialValues",required:!1,type:{name:"UploadImageValues"}},mode:{defaultValue:null,description:"",name:"mode",required:!0,type:{name:"enum",value:[{value:'"offer"'},{value:'"offer_collective"'},{value:'"venue"'}]}},onClickButtonImageAdd:{defaultValue:null,description:"",name:"onClickButtonImageAdd",required:!1,type:{name:"(() => void)"}},hideActionButtons:{defaultValue:{value:"false"},description:"",name:"hideActionButtons",required:!1,type:{name:"boolean"}},disableForm:{defaultValue:{value:"false"},description:"",name:"disableForm",required:!1,type:{name:"boolean"}}}}}catch{}const sr={title:"components/ImageUploader/ImageUploader",component:X,decorators:[Le,a=>e.jsx(De,{store:qe({}),children:e.jsx(a,{})})]},we={initialValues:{originalImageUrl:ie,imageUrl:ie,credit:"John Do",cropParams:{xCropPercent:0,yCropPercent:0,heightCropPercent:1,widthCropPercent:1}},mode:r.OFFER,onImageDelete:()=>{alert("onDelete have been called.")},onImageUpload:()=>{alert("onImageUpload have been called.")}},R={args:{...we}},P={args:{...we,initialValues:{imageUrl:re,originalImageUrl:re},mode:r.VENUE}},S={args:{mode:r.OFFER}};var le,se,me;R.parameters={...R.parameters,docs:{...(le=R.parameters)==null?void 0:le.docs,source:{originalSource:`{
  args: {
    ...props
  }
}`,...(me=(se=R.parameters)==null?void 0:se.docs)==null?void 0:me.source}}};var ce,pe,de;P.parameters={...P.parameters,docs:{...(ce=P.parameters)==null?void 0:ce.docs,source:{originalSource:`{
  args: {
    ...props,
    initialValues: {
      imageUrl: sampleImageLandscape,
      originalImageUrl: sampleImageLandscape
    },
    mode: UploaderModeEnum.VENUE
  }
}`,...(de=(pe=P.parameters)==null?void 0:pe.docs)==null?void 0:de.source}}};var ge,ue,fe;S.parameters={...S.parameters,docs:{...(ge=S.parameters)==null?void 0:ge.docs,source:{originalSource:`{
  args: {
    mode: UploaderModeEnum.OFFER
  }
}`,...(fe=(ue=S.parameters)==null?void 0:ue.docs)==null?void 0:fe.source}}};const mr=["WithImageOffer","WithImageVenue","WithoutImage"];export{R as WithImageOffer,P as WithImageVenue,S as WithoutImage,mr as __namedExportsOrder,sr as default};
