import{j as a}from"./jsx-runtime-CfatFE5O.js";import{a as we,u as Y,F as Ae}from"./formik.esm-DyanDbCL.js";import{c as P}from"./index-DeARc5FM.js";import{r as c}from"./index-ClcD9ViR.js";import{S as Ne}from"./SelectedValuesTags-BH-8h7vb.js";import{B as Fe}from"./BaseInput-CQqD6LQv.js";import{F as Le}from"./FieldLayout-D_IwLhQQ.js";import{B as Se}from"./BaseCheckbox-BfUFLPp4.js";import{s as je}from"./stroke-down-Co3p5GaP.js";import{S as ke}from"./SvgIcon-B6esR8Vf.js";import"./_commonjsHelpers-Cpj98o6Y.js";import"./full-close-5Oxr7nnd.js";import"./full-clear-Q4kCtSRL.js";import"./full-help-blUMxBcv.js";import"./Button-V7-uMFsX.js";import"./stroke-pass-CALgybTM.js";import"./Tooltip-CPMX2zM9.js";import"./useTooltipProps-C5TDwaI9.js";import"./Button.module-Ck89_nGh.js";import"./types-DjX_gQD6.js";import"./FieldError-Bb6I73np.js";import"./stroke-error-DSZD431a.js";const Z=t=>t.trim().toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,""),Ie=(t,o,r)=>{const e=[];for(let i=0;i<t.length&&!(r&&e.length>=r);i++){const y=t[i].normalizedLabel??Z(t[i].label);Z(o||"").split(" ").every(x=>y.includes(x))&&e.push(t[i])}return e},$e=(t,o,r="s")=>{let e,i;const y=t.slice(-1)[0];return y==="s"||y==="x"?(i=t.slice(0,-1),e=t):(i=t,e=`${t}${r}`),o>1?e:i},Te=(t,o,r)=>t.split(" ").map(e=>$e(e,o,r)).join(" "),Ce=(t,o,r)=>`${new Intl.NumberFormat("fr-FR").format(t)} ${Te(o,t,r)}`,Ee="_menu_1o8o9_1",Me="_label_1o8o9_23",Re="_input_1o8o9_30",O={menu:Ee,"menu--no-results":"_menu--no-results_1o8o9_15","options-item":"_options-item_1o8o9_18","too-many-options":"_too-many-options_1o8o9_19",label:Me,input:Re,"option-hovered":"_option-hovered_1o8o9_33"},z=({className:t,fieldName:o,selectedValues:r,filteredOptions:e,setHoveredOptionIndex:i,listRef:y,hoveredOptionIndex:N,selectOption:x,multi:j,maxDisplayedOptions:q})=>{const p=q?e.slice(0,q):e;return a.jsxs("div",{className:P(O.menu,t),role:"listbox",children:[e.length===0&&a.jsx("span",{className:O["menu--no-results"],children:"Aucun résultat"}),a.jsx("ul",{"data-testid":"list",id:`list-${o}`,ref:y,role:"listbox",children:p.map(({value:u,label:k},w)=>{const F=(r||[]).includes(String(u));return a.jsx("li",{"aria-selected":F,"aria-posinset":w+1,"aria-setsize":p.length,className:N===w?O["option-hovered"]:"","data-value":u,"data-selected":F,id:`option-display-${u}`,onMouseEnter:()=>i(w),onFocus:()=>i(w),role:"option",tabIndex:-1,children:j?a.jsx(Se,{label:k,checked:F,onChange:()=>{x(String(u))},labelClassName:O.label,inputClassName:O.input}):a.jsx("span",{onClick:()=>{x(String(u))},className:P(O["options-item"]),children:k})},`option-display-${u}`)})}),a.jsx("div",{role:"status",children:q&&p.length<e.length&&a.jsxs("div",{className:O["too-many-options"],children:[Ce(q,"résultat")," maximum. Veuillez affiner votre recherche"]})})]})};try{z.displayName="OptionsList",z.__docgenInfo={description:"",displayName:"OptionsList",props:{className:{defaultValue:null,description:"",name:"className",required:!1,type:{name:"string"}},fieldName:{defaultValue:null,description:"",name:"fieldName",required:!0,type:{name:"string"}},selectedValues:{defaultValue:null,description:"",name:"selectedValues",required:!0,type:{name:"string | string[] | null"}},filteredOptions:{defaultValue:null,description:"",name:"filteredOptions",required:!0,type:{name:"SelectOption[]"}},setHoveredOptionIndex:{defaultValue:null,description:"",name:"setHoveredOptionIndex",required:!0,type:{name:"(value: number | null) => void"}},listRef:{defaultValue:null,description:"",name:"listRef",required:!0,type:{name:"Ref<HTMLUListElement>"}},hoveredOptionIndex:{defaultValue:null,description:"",name:"hoveredOptionIndex",required:!0,type:{name:"number | null"}},selectOption:{defaultValue:null,description:"",name:"selectOption",required:!0,type:{name:"(value: string) => void"}},multi:{defaultValue:null,description:"",name:"multi",required:!0,type:{name:"boolean"}},maxDisplayedOptions:{defaultValue:null,description:"",name:"maxDisplayedOptions",required:!1,type:{name:"number"}}}}}catch{}const Be="_pellet_1jeev_15",S={"multi-select-autocomplete-container":"_multi-select-autocomplete-container_1jeev_1","multi-select-autocomplete-placeholder-input":"_multi-select-autocomplete-placeholder-input_1jeev_7","field-overlay":"_field-overlay_1jeev_11",pellet:Be,"visually-hidden":"_visually-hidden_1jeev_34"},De={"dropdown-indicator":"_dropdown-indicator_hafu1_1"},H=({disabled:t,isOpen:o,toggleField:r})=>a.jsx("button",{onClick:r,className:De["dropdown-indicator"],type:"button",disabled:t,children:a.jsx(ke,{src:je,alt:`${o?"Masquer":"Afficher"} les options`,width:"20"})});try{H.displayName="Toggle",H.__docgenInfo={description:"",displayName:"Toggle",props:{disabled:{defaultValue:null,description:"",name:"disabled",required:!0,type:{name:"boolean"}},isOpen:{defaultValue:null,description:"",name:"isOpen",required:!0,type:{name:"boolean"}},toggleField:{defaultValue:null,description:"",name:"toggleField",required:!0,type:{name:"() => void"}}}}}catch{}const W=({className:t,selectedValuesTagsClassName:o,disabled:r=!1,name:e,hideArrow:i,hideFooter:y=!1,hideTags:N=!1,inline:x,isOptional:j=!1,label:q,multi:p=!1,options:u,placeholder:k,smallLabel:w=!1,resetOnOpen:F=!0,description:ue,onSearch:de=()=>{},searchInOptions:ce=(A,v)=>A.filter(l=>l.label.toLowerCase().includes(v.trim().toLowerCase())),onReset:pe=()=>{},type:me="text",leftIcon:U,maxDisplayedOptions:fe,isLabelHidden:he,shouldFocusOnMount:ye,preventOpenOnFirstFocus:be})=>{var Q;const{setFieldTouched:A,setFieldValue:v}=we(),[l,I]=Y(e),[g,G]=Y(`search-${e}`),[m,h]=c.useState(null),[$,ve]=c.useState({}),T=c.useRef(null),R=c.useRef(null),B=c.useRef(null),[d,f]=c.useState(!1),[b,ge]=c.useState(u);c.useEffect(()=>{(async()=>{var s;ye&&((s=B.current)==null||s.focus(),await A(`search-${e}`,!0))})()},[]),c.useEffect(()=>{const n=async()=>{await v(`search-${e}`,"",!1),await v(e,p?[]:"",!1),pe()};d&&F&&g.value!==""&&n()},[d]),c.useEffect(()=>{ve(u.reduce((n,s)=>(n[s.value]=s.label,n),{}))},[u]),c.useEffect(()=>{const n=s=>{var V;(V=T.current)!=null&&V.contains(s.target)||f(!1)};return T.current&&document.addEventListener("mousedown",n),()=>{document.removeEventListener("mousedown",n)}},[T]),c.useEffect(()=>{de(g.value.trim()),h(null)},[g.value]),c.useEffect(()=>{ge(ce(u,g.value))},[g.value,u]);const Ve=async n=>{var s,V,X;switch(n.key){case"ArrowUp":if(m!==null)if(m<=0)h(null);else{const L=m-1;h(L);const _=(s=R.current)==null?void 0:s.getElementsByTagName("li")[L];_==null||_.scrollIntoView({block:"nearest"})}d||f(!0);break;case"ArrowDown":if(m===null)b.length>0&&h(0);else{const L=Math.min(b.length-1,m+1);h(L);const _=(V=R.current)==null?void 0:V.getElementsByTagName("li")[L];_==null||_.scrollIntoView({block:"nearest"})}d||f(!0);break;case" ":case"Enter":d&&m!==null&&b[m]&&(n.preventDefault(),b[m]&&await D(String(b[m].value)));break;case"Escape":(X=B.current)==null||X.focus(),h(null),f(!1);break;case"Tab":h(null),f(!1);break}},D=async n=>{let s;p?l.value.includes(n)&&Array.isArray(l.value)?s=l.value.filter(V=>V!==n):s=[...l.value,n]:(s=n,f(!1),h(null),await v(`search-${e}`,$[s],!1)),await v(e,s)},_e=async()=>{const n=I.touched;(be?n&&!d:!d)&&f(!0),await A(e,!0)},Oe=async()=>{d||f(!0),await A(e,!0)},J=async()=>{d?(f(!1),await v(`search-${e}`,"",!1)):f(!0),await A(e,!0)},xe=Array.isArray(l.value)?"":$[l.value],qe=k||xe;return a.jsxs(Le,{className:t,error:I.error,hideFooter:!N&&y,isOptional:j,label:q,name:`search-${e}`,showError:G.touched&&!!I.error,smallLabel:w,inline:x,description:ue,isLabelHidden:he,children:[a.jsxs("div",{className:P(S["multi-select-autocomplete-container"],t),onKeyDown:Ve,ref:T,children:[a.jsx(Fe,{...m!==null&&{"aria-activedescendant":`option-display-${(Q=b[m])==null?void 0:Q.value}`},onClick:Oe,onFocus:_e,placeholder:qe,style:{paddingLeft:p&&l.value.length>0||U?"2.2rem":"1rem"},className:S["multi-select-autocomplete-placeholder-input"],hasError:G.touched&&!!I.error,type:me,disabled:r,...g,"aria-autocomplete":"list","aria-controls":`list-${e}`,"aria-describedby":`help-${e}`,"aria-expanded":d,"aria-haspopup":"listbox","aria-required":!j,role:"combobox",leftIcon:U,ref:B}),a.jsxs("div",{"aria-live":"polite","aria-relevant":"text",className:S["visually-hidden"],id:`help-${e}`,children:[p&&`${l.value.length} options sélectionnées`,!p&&!Array.isArray(l.value)&&l.value!==""&&`Option sélectionnée : ${$[l.value]}`,d?`${b.length} options ${g.value===""?"disponibles":"correspondant au texte saisi"}`:"saisissez du texte pour afficher et filtrer les options"]}),a.jsx("select",{hidden:!0,...p&&{multiple:!0},...l,value:l.value||"","data-testid":"select",children:u.map(({label:n,value:s})=>a.jsx("option",{value:s,children:n},`option-${s}`))}),a.jsxs("div",{className:S["field-overlay"],children:[!i&&a.jsx(H,{disabled:r,isOpen:d,toggleField:J}),p&&l.value.length>0&&a.jsx("div",{onClick:J,className:S.pellet,children:l.value.length}),d&&a.jsx(z,{className:t,fieldName:e,selectedValues:l.value,filteredOptions:b,setHoveredOptionIndex:h,listRef:R,hoveredOptionIndex:m,selectOption:D,multi:p,maxDisplayedOptions:fe})]})]}),Array.isArray(l.value)&&!N&&l.value.length>0&&a.jsx(Ne,{className:o,disabled:r,fieldName:e,optionsLabelById:$,selectedOptions:l.value,removeOption:D})]})};try{W.displayName="SelectAutocomplete",W.__docgenInfo={description:"",displayName:"SelectAutocomplete",props:{label:{defaultValue:null,description:"",name:"label",required:!0,type:{name:"string | Element"}},name:{defaultValue:null,description:"",name:"name",required:!0,type:{name:"string"}},description:{defaultValue:null,description:"",name:"description",required:!1,type:{name:"string"}},maxLength:{defaultValue:null,description:"",name:"maxLength",required:!1,type:{name:"number"}},isLabelHidden:{defaultValue:null,description:`A flag to hide the label.
To be used with caution, as it can affect accessibility.
Do not use it if the label is mandatory, placeholder is not
a substitute for a label.`,name:"isLabelHidden",required:!1,type:{name:"boolean"}},hasLabelLineBreak:{defaultValue:null,description:"",name:"hasLabelLineBreak",required:!1,type:{name:"boolean"}},isOptional:{defaultValue:{value:"false"},description:`A flag to indicate that the field is optional.
It will display an asterisk next to the label.`,name:"isOptional",required:!1,type:{name:"boolean"}},showMandatoryAsterisk:{defaultValue:null,description:`Can be false only when it's the only field in a form and it's mandatory,
or when all fields are mandatory and the form indicates that all fields are mandatory`,name:"showMandatoryAsterisk",required:!1,type:{name:"boolean"}},className:{defaultValue:null,description:`A custom class for the field layout,
where label, description, input, and footer are displayed.`,name:"className",required:!1,type:{name:"string"}},classNameLabel:{defaultValue:null,description:"",name:"classNameLabel",required:!1,type:{name:"string"}},classNameFooter:{defaultValue:null,description:`A custom class for the footer,
where errors and character count are displayed.`,name:"classNameFooter",required:!1,type:{name:"string"}},classNameInput:{defaultValue:null,description:"",name:"classNameInput",required:!1,type:{name:"string"}},filterVariant:{defaultValue:null,description:"",name:"filterVariant",required:!1,type:{name:"boolean"}},smallLabel:{defaultValue:{value:"false"},description:"A flag to display a smaller label.",name:"smallLabel",required:!1,type:{name:"boolean"}},hideFooter:{defaultValue:{value:"false"},description:`A flag to hide the footer.
To be used with caution, as it can affect accessibility.`,name:"hideFooter",required:!1,type:{name:"boolean"}},inline:{defaultValue:null,description:"",name:"inline",required:!1,type:{name:"boolean"}},clearButtonProps:{defaultValue:null,description:"",name:"clearButtonProps",required:!1,type:{name:'(ButtonHTMLAttributes<HTMLButtonElement> & { tooltip: string; display?: "clear" | "close"; })'}},ErrorDetails:{defaultValue:null,description:"",name:"ErrorDetails",required:!1,type:{name:"ReactNode"}},disabled:{defaultValue:{value:"false"},description:"",name:"disabled",required:!1,type:{name:"boolean"}},hideArrow:{defaultValue:null,description:"",name:"hideArrow",required:!1,type:{name:"boolean"}},hideTags:{defaultValue:{value:"false"},description:"",name:"hideTags",required:!1,type:{name:"boolean"}},maxHeight:{defaultValue:null,description:"",name:"maxHeight",required:!1,type:{name:"number"}},multi:{defaultValue:{value:"false"},description:"",name:"multi",required:!1,type:{name:"boolean"}},options:{defaultValue:null,description:"",name:"options",required:!0,type:{name:"SelectOption[]"}},placeholder:{defaultValue:null,description:"",name:"placeholder",required:!1,type:{name:"string"}},resetOnOpen:{defaultValue:{value:"true"},description:"",name:"resetOnOpen",required:!1,type:{name:"boolean"}},onSearch:{defaultValue:{value:"() => {}"},description:"",name:"onSearch",required:!1,type:{name:"((pattern: string) => void)"}},searchInOptions:{defaultValue:{value:`(options, pattern) =>
    options.filter((opt) =>
      opt.label.toLowerCase().includes(pattern.trim().toLowerCase())
    )`},description:"",name:"searchInOptions",required:!1,type:{name:"((options: SelectOption[], pattern: string) => SelectOption[])"}},onReset:{defaultValue:{value:"() => {}"},description:"",name:"onReset",required:!1,type:{name:"(() => void)"}},type:{defaultValue:{value:"text"},description:"",name:"type",required:!1,type:{name:"enum",value:[{value:'"search"'},{value:'"text"'}]}},leftIcon:{defaultValue:null,description:"",name:"leftIcon",required:!1,type:{name:"string"}},maxDisplayedOptions:{defaultValue:null,description:"",name:"maxDisplayedOptions",required:!1,type:{name:"number"}},selectedValuesTagsClassName:{defaultValue:null,description:"",name:"selectedValuesTagsClassName",required:!1,type:{name:"string"}},shouldFocusOnMount:{defaultValue:null,description:"A flag to automatically focus the input when the component mounts.",name:"shouldFocusOnMount",required:!1,type:{name:"boolean"}},preventOpenOnFirstFocus:{defaultValue:null,description:`A flag to prevent the dropdown from opening on the first focus.
This is useful when the input is automatically focused. The user
is then expected to open the dropdown by clicking on the input.`,name:"preventOpenOnFirstFocus",required:!1,type:{name:"boolean"}}}}}catch{}const Pe=t=>a.jsx(Ae,{initialValues:t.initialValues,onSubmit:()=>{},children:a.jsx(W,{...t})}),ct={title:"ui-kit/forms/SelectAutocomplete",component:Pe},K={name:"departement",options:[{value:"01",label:"Ain"},{value:"02",label:"Aisne"},{value:"03",label:"Allier"},{value:"04",label:"Alpes-de-Haute-Provence test de libellé très long"},{value:"05",label:"Hautes-Alpes"},{value:"06",label:"Alpes-Maritimes"},{value:"07",label:"Ardèche"},{value:"08",label:"Ardennes"},{value:"09",label:"Ariège"},{value:"10",label:"Aube"},{value:"11",label:"Aude"},{value:"12",label:"Aveyron"},{value:"13",label:"Bouches-du-Rhône"},{value:"14",label:"Calvados"},{value:"15",label:"Cantal"}],initialValues:{departement:"01","search-departement":""},label:"Département",hideFooter:!1,hideTags:!1,isOptional:!1,smallLabel:!1,searchInOptions:Ie},C={args:{...K}},E={args:{...K,multi:!0,initialValues:{departement:["01","02"],"search-departement":""}}},M={args:{...K,multi:!0,initialValues:{departement:["01","02"],"search-departement":""},hideTags:!0}};var ee,te,ae;C.parameters={...C.parameters,docs:{...(ee=C.parameters)==null?void 0:ee.docs,source:{originalSource:`{
  args: {
    ...defaultProps
  }
}`,...(ae=(te=C.parameters)==null?void 0:te.docs)==null?void 0:ae.source}}};var le,ne,se;E.parameters={...E.parameters,docs:{...(le=E.parameters)==null?void 0:le.docs,source:{originalSource:`{
  args: {
    ...defaultProps,
    multi: true,
    initialValues: {
      departement: ['01', '02'],
      'search-departement': ''
    }
  }
}`,...(se=(ne=E.parameters)==null?void 0:ne.docs)==null?void 0:se.source}}};var re,ie,oe;M.parameters={...M.parameters,docs:{...(re=M.parameters)==null?void 0:re.docs,source:{originalSource:`{
  args: {
    ...defaultProps,
    multi: true,
    initialValues: {
      departement: ['01', '02'],
      'search-departement': ''
    },
    hideTags: true
  }
}`,...(oe=(ie=M.parameters)==null?void 0:ie.docs)==null?void 0:oe.source}}};const pt=["Default","Multi","WithoutTags"];export{C as Default,E as Multi,M as WithoutTags,pt as __namedExportsOrder,ct as default};
