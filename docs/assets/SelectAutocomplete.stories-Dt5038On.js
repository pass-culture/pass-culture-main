import{j as a}from"./jsx-runtime-CfatFE5O.js";import{a as ve,u as X,F as _e}from"./formik.esm-DyanDbCL.js";import{c as z}from"./index-DeARc5FM.js";import{r as d}from"./index-ClcD9ViR.js";import{S as Ve}from"./SelectedValuesTags-D2E3rwn0.js";import{B as Oe}from"./BaseInput-zpkrYXWy.js";import{F as xe}from"./FieldLayout-Bb7bwNUY.js";import{B as qe}from"./BaseCheckbox-GQyCLflZ.js";import{s as we}from"./stroke-down-Co3p5GaP.js";import{S as Ae}from"./SvgIcon-CUWb-Ez8.js";import"./_commonjsHelpers-Cpj98o6Y.js";import"./full-close-5Oxr7nnd.js";import"./full-clear-Q4kCtSRL.js";import"./full-help-blUMxBcv.js";import"./Button-gdY3XgLr.js";import"./stroke-pass-CALgybTM.js";import"./Tooltip-BtSK6bim.js";import"./Button.module-CvOOzViS.js";import"./types-DjX_gQD6.js";import"./FieldError-DblMbt5C.js";import"./stroke-error-DSZD431a.js";import"./FieldLayoutCharacterCount-DooUcf1c.js";const Y=t=>t.trim().toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,""),Ne=(t,o,r)=>{const e=[];for(let i=0;i<t.length&&!(r&&e.length>=r);i++){const y=t[i].normalizedLabel??Y(t[i].label);Y(o||"").split(" ").every(v=>y.includes(v))&&e.push(t[i])}return e},Le=(t,o,r="s")=>{let e,i;const y=t.slice(-1)[0];return y==="s"||y==="x"?(i=t.slice(0,-1),e=t):(i=t,e=`${t}${r}`),o>1?e:i},Se=(t,o,r)=>t.split(" ").map(e=>Le(e,o,r)).join(" "),Fe=(t,o,r)=>`${new Intl.NumberFormat("fr-FR").format(t)} ${Se(o,t,r)}`,je="_menu_1o8o9_1",ke="_label_1o8o9_23",Ie="_input_1o8o9_30",q={menu:je,"menu--no-results":"_menu--no-results_1o8o9_15","options-item":"_options-item_1o8o9_18","too-many-options":"_too-many-options_1o8o9_19",label:ke,input:Ie,"option-hovered":"_option-hovered_1o8o9_33"},P=({className:t,fieldName:o,selectedValues:r,filteredOptions:e,setHoveredOptionIndex:i,listRef:y,hoveredOptionIndex:F,selectOption:v,multi:E,maxDisplayedOptions:c})=>{const m=c?e.slice(0,c):e;return a.jsxs("div",{className:z(q.menu,t),role:"listbox",children:[e.length===0&&a.jsx("span",{className:q["menu--no-results"],children:"Aucun résultat"}),a.jsx("ul",{"data-testid":"list",id:`list-${o}`,ref:y,role:"listbox",children:m.map(({value:b,label:j},w)=>{const N=(r||[]).includes(String(b));return a.jsx("li",{"aria-selected":N,"aria-posinset":w+1,"aria-setsize":m.length,className:F===w?q["option-hovered"]:"","data-value":b,"data-selected":N,id:`option-display-${b}`,onMouseEnter:()=>i(w),onFocus:()=>i(w),role:"option",tabIndex:-1,children:E?a.jsx(qe,{label:j,checked:N,onChange:()=>{v(String(b))},labelClassName:q.label,inputClassName:q.input}):a.jsx("span",{onClick:()=>{v(String(b))},className:z(q["options-item"]),children:j})},`option-display-${b}`)})}),a.jsx("div",{role:"status",children:c&&m.length<e.length&&a.jsxs("div",{className:q["too-many-options"],children:[Fe(c,"résultat")," maximum. Veuillez affiner votre recherche"]})})]})};try{P.displayName="OptionsList",P.__docgenInfo={description:"",displayName:"OptionsList",props:{className:{defaultValue:null,description:"",name:"className",required:!1,type:{name:"string"}},fieldName:{defaultValue:null,description:"",name:"fieldName",required:!0,type:{name:"string"}},selectedValues:{defaultValue:null,description:"",name:"selectedValues",required:!0,type:{name:"string | string[] | null"}},filteredOptions:{defaultValue:null,description:"",name:"filteredOptions",required:!0,type:{name:"SelectOption[]"}},setHoveredOptionIndex:{defaultValue:null,description:"",name:"setHoveredOptionIndex",required:!0,type:{name:"(value: number | null) => void"}},listRef:{defaultValue:null,description:"",name:"listRef",required:!0,type:{name:"Ref<HTMLUListElement>"}},hoveredOptionIndex:{defaultValue:null,description:"",name:"hoveredOptionIndex",required:!0,type:{name:"number | null"}},selectOption:{defaultValue:null,description:"",name:"selectOption",required:!0,type:{name:"(value: string) => void"}},multi:{defaultValue:null,description:"",name:"multi",required:!0,type:{name:"boolean"}},maxDisplayedOptions:{defaultValue:null,description:"",name:"maxDisplayedOptions",required:!1,type:{name:"number"}}}}}catch{}const $e="_pellet_1jeev_15",S={"multi-select-autocomplete-container":"_multi-select-autocomplete-container_1jeev_1","multi-select-autocomplete-placeholder-input":"_multi-select-autocomplete-placeholder-input_1jeev_7","field-overlay":"_field-overlay_1jeev_11",pellet:$e,"visually-hidden":"_visually-hidden_1jeev_34"},Te={"dropdown-indicator":"_dropdown-indicator_hafu1_1"},H=({disabled:t,isOpen:o,toggleField:r})=>a.jsx("button",{onClick:r,className:Te["dropdown-indicator"],type:"button",disabled:t,children:a.jsx(Ae,{src:we,alt:`${o?"Masquer":"Afficher"} les options`,width:"20"})});try{H.displayName="Toggle",H.__docgenInfo={description:"",displayName:"Toggle",props:{disabled:{defaultValue:null,description:"",name:"disabled",required:!0,type:{name:"boolean"}},isOpen:{defaultValue:null,description:"",name:"isOpen",required:!0,type:{name:"boolean"}},toggleField:{defaultValue:null,description:"",name:"toggleField",required:!0,type:{name:"() => void"}}}}}catch{}const W=({className:t,selectedValuesTagsClassName:o,disabled:r=!1,name:e,hideArrow:i,hideTags:y=!1,inline:F,isOptional:v=!1,label:E,multi:c=!1,options:m,smallLabel:b=!1,resetOnOpen:j=!0,description:w,onSearch:N=()=>{},searchInOptions:oe=(A,_)=>A.filter(s=>s.label.toLowerCase().includes(_.trim().toLowerCase())),onReset:ue=()=>{},maxDisplayedOptions:de,isLabelHidden:ce,shouldFocusOnMount:pe,preventOpenOnFirstFocus:me})=>{var J;const{setFieldTouched:A,setFieldValue:_}=ve(),[s,k]=X(e),[V,U]=X(`search-${e}`),[p,h]=d.useState(null),[M,fe]=d.useState({}),I=d.useRef(null),R=d.useRef(null),B=d.useRef(null),[u,f]=d.useState(!1),[g,he]=d.useState(m);d.useEffect(()=>{(async()=>{var n;pe&&((n=B.current)==null||n.focus(),await A(`search-${e}`,!0))})()},[]),d.useEffect(()=>{const l=async()=>{await _(`search-${e}`,"",!1),await _(e,c?[]:"",!1),ue()};u&&j&&V.value!==""&&l()},[u]),d.useEffect(()=>{fe(m.reduce((l,n)=>(l[n.value]=n.label,l),{}))},[m]),d.useEffect(()=>{const l=n=>{var O;(O=I.current)!=null&&O.contains(n.target)||f(!1)};return I.current&&document.addEventListener("mousedown",l),()=>{document.removeEventListener("mousedown",l)}},[I]),d.useEffect(()=>{N((V.value??"").trim()),h(null)},[V.value]),d.useEffect(()=>{he(oe(m,V.value))},[V.value,m]);const ye=async l=>{var n,O,Q;switch(l.key){case"ArrowUp":if(p!==null)if(p<=0)h(null);else{const L=p-1;h(L);const x=(n=R.current)==null?void 0:n.getElementsByTagName("li")[L];x==null||x.scrollIntoView({block:"nearest"})}u||f(!0);break;case"ArrowDown":if(p===null)g.length>0&&h(0);else{const L=Math.min(g.length-1,p+1);h(L);const x=(O=R.current)==null?void 0:O.getElementsByTagName("li")[L];x==null||x.scrollIntoView({block:"nearest"})}u||f(!0);break;case" ":case"Enter":u&&p!==null&&g[p]&&(l.preventDefault(),g[p]&&await D(String(g[p].value)));break;case"Escape":(Q=B.current)==null||Q.focus(),h(null),f(!1);break;case"Tab":h(null),f(!1);break}},D=async l=>{let n;c?s.value.includes(l)&&Array.isArray(s.value)?n=s.value.filter(O=>O!==l):n=[...s.value,l]:(n=l,f(!1),h(null),await _(`search-${e}`,M[n],!1)),await _(e,n)},be=async()=>{const l=k.touched;(me?l&&!u:!u)&&f(!0),await A(e,!0)},ge=async()=>{u||f(!0),await A(e,!0)},G=async()=>{u?(f(!1),await _(`search-${e}`,"",!1)):f(!0),await A(e,!0)};return a.jsxs(xe,{className:t,error:k.error,isOptional:v,label:E,name:`search-${e}`,showError:U.touched&&!!k.error,smallLabel:b,inline:F,description:w,isLabelHidden:ce,children:[a.jsxs("div",{className:z(S["multi-select-autocomplete-container"],t),onKeyDown:ye,ref:I,children:[a.jsx(Oe,{...p!==null&&{"aria-activedescendant":`option-display-${(J=g[p])==null?void 0:J.value}`},onClick:ge,onFocus:be,className:S["multi-select-autocomplete-placeholder-input"],hasError:U.touched&&!!k.error,type:"search",disabled:r,...V,"aria-autocomplete":"list","aria-controls":`list-${e}`,"aria-describedby":`help-${e}`,"aria-expanded":u,"aria-haspopup":"listbox","aria-required":!v,role:"combobox",ref:B}),a.jsxs("div",{"aria-live":"polite","aria-relevant":"text",className:S["visually-hidden"],id:`help-${e}`,children:[c&&`${s.value.length} options sélectionnées`,!c&&!Array.isArray(s.value)&&s.value!==""&&`Option sélectionnée : ${M[s.value]}`,u?`${g.length} options ${V.value===""?"disponibles":"correspondant au texte saisi"}`:"saisissez du texte pour afficher et filtrer les options"]}),a.jsx("select",{hidden:!0,...c&&{multiple:!0},...s,value:s.value||"","data-testid":"select",children:m.map(({label:l,value:n})=>a.jsx("option",{value:n,children:l},`option-${n}`))}),a.jsxs("div",{className:S["field-overlay"],children:[!i&&a.jsx(H,{disabled:r,isOpen:u,toggleField:G}),c&&s.value.length>0&&a.jsx("div",{onClick:G,className:S.pellet,children:s.value.length}),u&&a.jsx(P,{className:t,fieldName:e,selectedValues:s.value,filteredOptions:g,setHoveredOptionIndex:h,listRef:R,hoveredOptionIndex:p,selectOption:D,multi:c,maxDisplayedOptions:de})]})]}),Array.isArray(s.value)&&!y&&s.value.length>0&&a.jsx(Ve,{className:o,disabled:r,fieldName:e,optionsLabelById:M,selectedOptions:s.value,removeOption:D})]})};try{W.displayName="SelectAutocomplete",W.__docgenInfo={description:"",displayName:"SelectAutocomplete",props:{label:{defaultValue:null,description:"",name:"label",required:!0,type:{name:"string | Element"}},name:{defaultValue:null,description:"",name:"name",required:!0,type:{name:"string"}},description:{defaultValue:null,description:"",name:"description",required:!1,type:{name:"string"}},maxLength:{defaultValue:null,description:"",name:"maxLength",required:!1,type:{name:"number"}},isLabelHidden:{defaultValue:null,description:`A flag to hide the label.
To be used with caution, as it can affect accessibility.
Do not use it if the label is mandatory, placeholder is not
a substitute for a label.`,name:"isLabelHidden",required:!1,type:{name:"boolean"}},hasLabelLineBreak:{defaultValue:null,description:"",name:"hasLabelLineBreak",required:!1,type:{name:"boolean"}},isOptional:{defaultValue:{value:"false"},description:`A flag to indicate that the field is optional.
It will display an asterisk next to the label.`,name:"isOptional",required:!1,type:{name:"boolean"}},hideAsterisk:{defaultValue:null,description:`Can be false only when it's the only field in a form and it's mandatory,
or when all fields are mandatory and the form indicates that all fields are mandatory`,name:"hideAsterisk",required:!1,type:{name:"boolean"}},className:{defaultValue:null,description:`A custom class for the field layout,
where label, description, input, and footer are displayed.`,name:"className",required:!1,type:{name:"string"}},classNameLabel:{defaultValue:null,description:"",name:"classNameLabel",required:!1,type:{name:"string"}},classNameFooter:{defaultValue:null,description:`A custom class for the footer,
where errors and character count are displayed.`,name:"classNameFooter",required:!1,type:{name:"string"}},classNameInput:{defaultValue:null,description:"",name:"classNameInput",required:!1,type:{name:"string"}},filterVariant:{defaultValue:null,description:"",name:"filterVariant",required:!1,type:{name:"boolean"}},smallLabel:{defaultValue:{value:"false"},description:"A flag to display a smaller label.",name:"smallLabel",required:!1,type:{name:"boolean"}},inline:{defaultValue:null,description:"",name:"inline",required:!1,type:{name:"boolean"}},clearButtonProps:{defaultValue:null,description:"",name:"clearButtonProps",required:!1,type:{name:'(ButtonHTMLAttributes<HTMLButtonElement> & { tooltip: string; display?: "clear" | "close"; })'}},ErrorDetails:{defaultValue:null,description:"",name:"ErrorDetails",required:!1,type:{name:"ReactNode"}},disabled:{defaultValue:{value:"false"},description:"",name:"disabled",required:!1,type:{name:"boolean"}},hideArrow:{defaultValue:null,description:"",name:"hideArrow",required:!1,type:{name:"boolean"}},hideTags:{defaultValue:{value:"false"},description:"",name:"hideTags",required:!1,type:{name:"boolean"}},maxHeight:{defaultValue:null,description:"",name:"maxHeight",required:!1,type:{name:"number"}},multi:{defaultValue:{value:"false"},description:"",name:"multi",required:!1,type:{name:"boolean"}},options:{defaultValue:null,description:"",name:"options",required:!0,type:{name:"SelectOption[]"}},resetOnOpen:{defaultValue:{value:"true"},description:"",name:"resetOnOpen",required:!1,type:{name:"boolean"}},onSearch:{defaultValue:{value:"() => {}"},description:"",name:"onSearch",required:!1,type:{name:"((pattern: string) => void)"}},searchInOptions:{defaultValue:{value:`(options, pattern) =>
    options.filter((opt) =>
      opt.label.toLowerCase().includes(pattern.trim().toLowerCase())
    )`},description:"",name:"searchInOptions",required:!1,type:{name:"((options: SelectOption[], pattern: string) => SelectOption[])"}},onReset:{defaultValue:{value:"() => {}"},description:"",name:"onReset",required:!1,type:{name:"(() => void)"}},maxDisplayedOptions:{defaultValue:null,description:"",name:"maxDisplayedOptions",required:!1,type:{name:"number"}},selectedValuesTagsClassName:{defaultValue:null,description:"",name:"selectedValuesTagsClassName",required:!1,type:{name:"string"}},shouldFocusOnMount:{defaultValue:null,description:"A flag to automatically focus the input when the component mounts.",name:"shouldFocusOnMount",required:!1,type:{name:"boolean"}},preventOpenOnFirstFocus:{defaultValue:null,description:`A flag to prevent the dropdown from opening on the first focus.
This is useful when the input is automatically focused. The user
is then expected to open the dropdown by clicking on the input.`,name:"preventOpenOnFirstFocus",required:!1,type:{name:"boolean"}}}}}catch{}const Ce=t=>a.jsx(_e,{initialValues:t.initialValues,onSubmit:()=>{},children:a.jsx(W,{...t})}),st={title:"ui-kit/forms/SelectAutocomplete",component:Ce},K={name:"departement",options:[{value:"01",label:"Ain"},{value:"02",label:"Aisne"},{value:"03",label:"Allier"},{value:"04",label:"Alpes-de-Haute-Provence test de libellé très long"},{value:"05",label:"Hautes-Alpes"},{value:"06",label:"Alpes-Maritimes"},{value:"07",label:"Ardèche"},{value:"08",label:"Ardennes"},{value:"09",label:"Ariège"},{value:"10",label:"Aube"},{value:"11",label:"Aude"},{value:"12",label:"Aveyron"},{value:"13",label:"Bouches-du-Rhône"},{value:"14",label:"Calvados"},{value:"15",label:"Cantal"}],initialValues:{departement:"01","search-departement":""},label:"Département",hideTags:!1,isOptional:!1,smallLabel:!1,searchInOptions:Ne},$={args:{...K}},T={args:{...K,multi:!0,initialValues:{departement:["01","02"],"search-departement":""}}},C={args:{...K,multi:!0,initialValues:{departement:["01","02"],"search-departement":""},hideTags:!0}};var Z,ee,te;$.parameters={...$.parameters,docs:{...(Z=$.parameters)==null?void 0:Z.docs,source:{originalSource:`{
  args: {
    ...defaultProps
  }
}`,...(te=(ee=$.parameters)==null?void 0:ee.docs)==null?void 0:te.source}}};var ae,le,ne;T.parameters={...T.parameters,docs:{...(ae=T.parameters)==null?void 0:ae.docs,source:{originalSource:`{
  args: {
    ...defaultProps,
    multi: true,
    initialValues: {
      departement: ['01', '02'],
      'search-departement': ''
    }
  }
}`,...(ne=(le=T.parameters)==null?void 0:le.docs)==null?void 0:ne.source}}};var se,re,ie;C.parameters={...C.parameters,docs:{...(se=C.parameters)==null?void 0:se.docs,source:{originalSource:`{
  args: {
    ...defaultProps,
    multi: true,
    initialValues: {
      departement: ['01', '02'],
      'search-departement': ''
    },
    hideTags: true
  }
}`,...(ie=(re=C.parameters)==null?void 0:re.docs)==null?void 0:ie.source}}};const rt=["Default","Multi","WithoutTags"];export{$ as Default,T as Multi,C as WithoutTags,rt as __namedExportsOrder,st as default};
