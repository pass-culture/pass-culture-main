import{j as e}from"./jsx-runtime-DKKDLQjB.js";import{P as S,c as I}from"./testUtils-CP2M0thp.js";import{V as D}from"./index-UtnHzNQS.js";import{r as s}from"./iframe-CnfVxGgg.js";import{B as c,b as v,a as g,c as L}from"./Button-CRTTfNRA.js";import{f as A}from"./full-edit-CxAaM2Fv.js";import{f as q}from"./full-more-DLJb58kc.js";import{f as M}from"./full-trash-CEfIUI4M.js";import{s as F}from"./stroke-video-Cd5kQZzx.js";import{a as j}from"./api-CQ7Q_cTT.js";import{a as P,S as Y,I as B}from"./helpers-CDALcef2.js";import{n as x}from"./noop-BjFrJKj1.js";import{S as k}from"./SvgIcon-BgRkYrhG.js";import{T as z}from"./Tag-B-W4ZdR9.js";import{D as C,C as H}from"./DialogBuilder-C6nXqzfT.js";import{a as G,u as $,E as W}from"./constants-7vOM0HJN.js";import"./store-DbzJj_LB.js";import"./SnackBar-CAKiBfH8.js";import{T as Z}from"./TextInput-B7vjq6me.js";import"./chunk-EPOLDU6W-WowPydQ5.js";import"./preload-helper-PPVm8Dsz.js";import"./index-DMt7lw30.js";import"./Tooltip-0Q1hzrna.js";import"./stroke-pass-CALgybTM.js";import"./exports-XRHBct3C.js";import"./full-thumb-up-Bb4kpRpM.js";import"./index-DsMNC56q.js";import"./index-BCQEt-o0.js";import"./index-CeDuhDqc.js";import"./tslib.es6-BUas5LQb.js";import"./stroke-close-DnlFsd1c.js";import"./date-CrU56jqV.js";import"./full-clear-Q4kCtSRL.js";import"./full-close-5Oxr7nnd.js";import"./full-validate-CbMNulkZ.js";import"./useMediaQuery-CJ6Vcual.js";import"./FieldFooter-CBnn5hci.js";import"./full-error-BFAmjN4t.js";import"./index.module-E4YOit4J.js";import"./FieldHeader-sJtqNFmp.js";const J=o=>o.user.currentUser,N=s.createContext({setVideoUrl:x,videoData:void 0,handleVideoOnSubmit:async()=>{throw new Error("VideoUploaderContext not provided")},onVideoUpload:x,onVideoDelete:x,offerId:void 0}),T=()=>s.useContext(N);function R({children:o,initialVideoData:i,offerId:t}){const[r,a]=s.useState(i?.videoUrl),[l,n]=s.useState(i),_=async({onSuccess:d,onError:E})=>{if(r)try{const b=await j.getOfferVideoMetadata(r);n(b),d()}catch(b){const O=P(b);E(O)}},V=()=>{a(void 0),n(void 0)},u=s.useCallback(async()=>await j.patchOffer(t,{videoUrl:r??""}),[r,t]);return e.jsx(N.Provider,{value:{videoUrl:r,videoData:l,handleVideoOnSubmit:u,setVideoUrl:a,onVideoUpload:_,onVideoDelete:V,offerId:t},children:o})}try{R.displayName="VideoUploaderContextProvider",R.__docgenInfo={description:"",displayName:"VideoUploaderContextProvider",props:{offerId:{defaultValue:null,description:"",name:"offerId",required:!0,type:{name:"number"}},initialVideoData:{defaultValue:null,description:"",name:"initialVideoData",required:!1,type:{name:"VideoData"}}}}}catch{}const m={"video-preview":"_video-preview_ma276_1","video-duration":"_video-duration_ma276_15","video-image":"_video-image_ma276_21","video-title":"_video-title_ma276_27"};function K(o){return Math.round(o/60).toLocaleString("fr-FR",{minimumFractionDigits:0,maximumFractionDigits:1})}const U=({videoDuration:o,videoTitle:i,videoThumbnailUrl:t})=>e.jsxs("div",{className:m["video-preview"],children:[e.jsx(Y,{alt:"Prévisualisation de l’image",className:m["video-image"],src:t,placeholder:e.jsx(B,{})}),e.jsx("span",{className:m["video-duration"],children:e.jsx(z,{label:`${K(o??0)} min`})}),e.jsx("p",{className:m["video-title"],children:i})]});try{U.displayName="VideoPreview",U.__docgenInfo={description:"",displayName:"VideoPreview",props:{videoDuration:{defaultValue:null,description:"",name:"videoDuration",required:!1,type:{name:"number | null"}},videoTitle:{defaultValue:null,description:"",name:"videoTitle",required:!1,type:{name:"string | null"}},videoThumbnailUrl:{defaultValue:null,description:"",name:"videoThumbnailUrl",required:!0,type:{name:"string"}}}}}catch{}const Q=new RegExp(/^(https?:\/\/)(www\.)?(m\.)?(youtube\.com\b|youtu\.be\b)(\/watch\?v=|\/embed\/|\/v\/|\/e\/|\/)([\w-]{11}\b)/),y=o=>{const i="Veuillez renseigner une URL valide. Ex : https://exemple.com",t="Veuillez renseigner une URL provenant de la plateforme Youtube. Les shorts et les chaînes ne sont pas acceptées.";if(!o||o.trim()==="")return t;try{const a=new URL(o).hostname.toLowerCase();return(a==="youtu.be"||a==="www.youtu.be"||a==="youtube.com"||a==="www.youtube.com"||a==="www.m.youtube.com"||a==="m.youtube.com")&&Q.test(o)?void 0:t}catch{return i}},X=""+new URL("youtube-logo-DoyiBwVG.png",import.meta.url).href,w={"modal-video":"_modal-video_1esiw_1","modal-video-content":"_modal-video-content_1esiw_7","modal-video-footer":"_modal-video-footer_1esiw_12"},h=({...o})=>{const[i,t]=s.useState(),{videoUrl:r,onVideoUpload:a,setVideoUrl:l,offerId:n}=T(),_=G(J),{logEvent:V}=$();return e.jsx(C,{...o,title:"Ajouter une vidéo",imageTitle:e.jsx("img",{alt:"",src:X}),variant:"drawer",children:e.jsxs("div",{className:w["modal-video"],children:[e.jsx("div",{className:w["modal-video-content"],children:e.jsx(Z,{name:"videoUrl",label:"Lien URL Youtube",description:"Format : https://www.youtube.com/watch?v=0R5PZxOgoz8",error:i,value:r??"",onBlur:u=>{const d=u.target.value;t(y(d)),d&&y(d)&&V(W.OFFER_FORM_VIDEO_URL_ERROR,{offerId:n,userId:_?.id,videoUrl:d})},onChange:u=>{l(u.target.value)}})}),e.jsx(C.Footer,{children:e.jsxs("div",{className:w["modal-video-footer"],children:[e.jsx(H,{asChild:!0,children:e.jsx(c,{variant:g.SECONDARY,color:v.NEUTRAL,label:"Annuler"})}),e.jsx(c,{onClick:async()=>{r&&!y(r)&&await a({onSuccess:()=>{o.onOpenChange?.(!1)},onError:t})},label:"Ajouter"})]})})]})})};try{h.displayName="ModalVideo",h.__docgenInfo={description:"",displayName:"ModalVideo",props:{className:{defaultValue:null,description:"Custom CSS class for additional styling of the dialog content.",name:"className",required:!1,type:{name:"string"}},title:{defaultValue:null,description:"The heading title of the dialog.",name:"title",required:!1,type:{name:"string"}},variant:{defaultValue:null,description:"",name:"variant",required:!1,type:{name:"enum",value:[{value:'"default"'},{value:'"drawer"'}]}},open:{defaultValue:null,description:"Controls the open state of the dialog.",name:"open",required:!1,type:{name:"boolean"}},trigger:{defaultValue:null,description:"The trigger element that opens the dialog.",name:"trigger",required:!1,type:{name:"ReactNode"}},refToFocusOnClose:{defaultValue:null,description:`Ref of the element to focus on when the dialog is closed.
If refToFocusOnClose.current is null, the trigger element will be focused as a fallback.`,name:"refToFocusOnClose",required:!1,type:{name:"RefObject<HTMLElement>"}},closeButtonClassName:{defaultValue:null,description:"Custom CSS class for additional styling of the close button.",name:"closeButtonClassName",required:!1,type:{name:"string"}},imageTitle:{defaultValue:null,description:"An image for the title.",name:"imageTitle",required:!1,type:{name:"ReactNode"}},defaultOpen:{defaultValue:{value:"false"},description:"Determines if the dialog is open by default.",name:"defaultOpen",required:!1,type:{name:"boolean"}},onOpenChange:{defaultValue:null,description:"Callback function triggered when the open state of the dialog changes.",name:"onOpenChange",required:!1,type:{name:"((open: boolean) => void)"}}}}}catch{}const p={"video-uploader-container":"_video-uploader-container_6b2er_1","video-uploader-no-video":"_video-uploader-no-video_6b2er_5","action-wrapper":"_action-wrapper_6b2er_21","video-uploader-text-subtle":"_video-uploader-text-subtle_6b2er_30"},ee=()=>{const[o,i]=s.useState(!1),{videoData:t,onVideoDelete:r}=T(),{videoDuration:a,videoTitle:l,videoThumbnailUrl:n}=t??{};return e.jsx("div",{className:p["video-uploader-container"],children:n?e.jsxs(e.Fragment,{children:[e.jsx(U,{videoDuration:a,videoTitle:l,videoThumbnailUrl:n}),e.jsxs("div",{className:p["action-wrapper"],children:[e.jsx(h,{onOpenChange:i,open:o,trigger:e.jsx(c,{variant:g.SECONDARY,color:v.NEUTRAL,size:L.SMALL,icon:A,label:"Modifier"})}),e.jsx(c,{variant:g.TERTIARY,color:v.NEUTRAL,icon:M,onClick:r,label:"Supprimer"})]})]}):e.jsxs("div",{className:p["video-uploader-no-video"],children:[e.jsx(k,{src:F,alt:"",width:"44"}),e.jsx(h,{onOpenChange:i,open:o,trigger:e.jsx(c,{variant:g.TERTIARY,color:v.NEUTRAL,icon:q,label:"Ajouter une URL Youtube"})}),e.jsx("p",{className:p["video-uploader-text-subtle"],children:"Affichage de la prévisualisation ici"})]})})},Ye={title:"@/components/VideoUploader/VideoUploader",component:ee,decorators:[D,o=>e.jsx(S,{store:I({}),children:e.jsx(o,{})})]},f={args:{}};f.parameters={...f.parameters,docs:{...f.parameters?.docs,source:{originalSource:`{
  args: {}
}`,...f.parameters?.docs?.source}}};const Be=["WithoutImage"];export{f as WithoutImage,Be as __namedExportsOrder,Ye as default};
