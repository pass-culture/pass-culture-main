import{j as e}from"./jsx-runtime-BYYWji4R.js";import{P as Ne}from"./reducer-Crbp5051.js";import{V as Oe}from"./index-BQRgOAGl.js";import{c as Re}from"./testUtils-DY3eMo7d.js";import{c as U}from"./index-DeARc5FM.js";import{r as m}from"./index-ClcD9ViR.js";import{f as ce}from"./full-trash-CEfIUI4M.js";import{B as E}from"./Button-Cva4CQSi.js";import{B as j}from"./types-yVZEaApa.js";import{S as de}from"./SvgIcon-CyWUmZpn.js";import{C as qe}from"./ConfirmDialog-B4ki1yBH.js";import{s as Pe}from"./stroke-trash-Cc_5v2lW.js";import{T as Se,C as X,D as pe}from"./DialogBuilder-BNEdQCrq.js";import{g as be}from"./image-CI1RfRht.js";import{u as De}from"./useNotification-DrLY4vYB.js";import{I as Be}from"./ImageDragAndDrop-D6MWhFpF.js";import{f as Le,a as Me}from"./full-more-D-B0T6P8.js";import{T as Te}from"./TextInput-DUFoZnSR.js";import{S as Ae}from"./Spinner-BHztG-h6.js";import{I as We}from"./ImageEditor-BN3_a1ZG.js";import{a as ke,I as K}from"./ImagePreviewsWrapper-BcCK9m44.js";import{f as He}from"./full-edit-CxAaM2Fv.js";import"./index-DOYoWpww.js";import"./index-J01lmiDr.js";import"./_commonjsHelpers-Cpj98o6Y.js";import"./config-BdqymTTq.js";import"./OfferAddressType-Co4gxJoY.js";import"./stroke-pass-CALgybTM.js";import"./Tooltip-BpKRYYrm.js";import"./Button.module-BsO1-3k4.js";import"./stroke-error-DSZD431a.js";import"./Dialog-CVJSILFg.js";import"./index-2_ew_j0S.js";import"./tslib.es6-BUas5LQb.js";import"./stroke-close-DnlFsd1c.js";import"./index-BH3dreXg.js";import"./index-Chjiymov.js";import"./full-validate-CbMNulkZ.js";import"./stroke-picture-VF2OicDu.js";import"./BaseInput-BI1b_EYZ.js";import"./FieldError-azuIsM2E.js";import"./FieldLayoutCharacterCount-Bc4HS3VB.js";import"./index.module-DF6qn1Ex.js";import"./Slider-DKKiAQxD.js";var t=(a=>(a.OFFER="offer",a.OFFER_COLLECTIVE="offer_collective",a.VENUE="venue",a))(t||{});const Q=""+new URL("sample-image-landscape-B4GmPBHc.jpg",import.meta.url).href,Z=""+new URL("sample-image-portrait-OorsIixL.jpg",import.meta.url).href,Ye={"button-image-delete-icon":"_button-image-delete-icon_ooh4c_1"},T=({isLoading:a,onConfirm:r,onDismiss:i,isDialogOpen:l,trigger:n})=>e.jsx(qe,{cancelText:"Retour",confirmText:"Supprimer",icon:Pe,isLoading:a,onCancel:i,onConfirm:r,title:"Supprimer l’image",open:l,trigger:n,children:"Souhaitez-vous vraiment supprimer cette image ?"});try{T.displayName="ModalImageDelete",T.__docgenInfo={description:"",displayName:"ModalImageDelete",props:{isLoading:{defaultValue:null,description:"",name:"isLoading",required:!0,type:{name:"boolean"}},onConfirm:{defaultValue:null,description:"",name:"onConfirm",required:!0,type:{name:"() => void"}},onDismiss:{defaultValue:null,description:"",name:"onDismiss",required:!0,type:{name:"() => void"}},isDialogOpen:{defaultValue:null,description:"",name:"isDialogOpen",required:!0,type:{name:"boolean"}},trigger:{defaultValue:null,description:"",name:"trigger",required:!0,type:{name:"ReactNode"}}}}}catch{}const A=({onImageDelete:a})=>{const[r,i]=m.useState(!1),[l,n]=m.useState(!1),c=()=>{n(!0),a()};return e.jsx(T,{isLoading:l,onConfirm:c,onDismiss:()=>i(!1),isDialogOpen:r,trigger:e.jsxs(E,{onClick:()=>i(!0),variant:j.TERNARY,children:[e.jsx(de,{alt:"",className:Ye["button-image-delete-icon"],src:ce}),"Supprimer"]})})};try{A.displayName="ButtonImageDelete",A.__docgenInfo={description:"",displayName:"ButtonImageDelete",props:{onImageDelete:{defaultValue:null,description:"",name:"onImageDelete",required:!0,type:{name:"() => void"}}}}}catch{}const ze=async(a,r="image.jpg")=>{const l=await(await fetch(a)).blob();return new File([l],r,{type:l.type})},Ge=a=>{const[r,i]=m.useState(0),[l,n]=m.useState(0);return m.useEffect(()=>{(async()=>{if(a){const o=await be(a);o&&(i(o.width),n(o.height))}})()},[a]),a?{width:r,height:l}:{width:0,height:0}},N=(a,r)=>a+r/2,$e=a=>100/(a*100),Je=""+new URL("offer-home-shell-Ch3YT9j3.png",import.meta.url).href,Xe=""+new URL("offer-shell-coq2oAbe.png",import.meta.url).href,ee={"image-preview-shell":"_image-preview-shell_1yqyc_1","image-preview-home-preview":"_image-preview-home-preview_1yqyc_7"},M={"image-preview-shell":"_image-preview-shell_8f82l_1","image-preview-blur-offer-preview":"_image-preview-blur-offer-preview_8f82l_7","image-preview-offer-preview":"_image-preview-offer-preview_8f82l_16"},W=({imageUrl:a})=>e.jsxs(ke,{children:[e.jsxs(K,{title:"Page d’accueil",children:[e.jsx("img",{alt:"",className:ee["image-preview-shell"],src:Je,role:"presentation"}),e.jsx("img",{"data-testid":"app-preview-offer-img-home",alt:"",className:ee["image-preview-home-preview"],src:a,role:"presentation"})]}),e.jsxs(K,{title:"Détails de l’offre",children:[e.jsx("img",{alt:"",className:M["image-preview-blur-offer-preview"],src:a,role:"presentation"}),e.jsx("img",{alt:"",className:M["image-preview-shell"],src:Xe,role:"presentation"}),e.jsx("img",{"data-testid":"app-preview-offer-img",alt:"",className:M["image-preview-offer-preview"],src:a,role:"presentation"})]})]});try{W.displayName="AppPreviewOffer",W.__docgenInfo={description:"",displayName:"AppPreviewOffer",props:{imageUrl:{defaultValue:null,description:"",name:"imageUrl",required:!0,type:{name:"string"}}}}}catch{}const d={"modal-image-crop":"_modal-image-crop_hqvma_1","modal-image-crop-content":"_modal-image-crop-content_hqvma_8","modal-image-crop-subwrapper":"_modal-image-crop-subwrapper_hqvma_11","modal-image-crop-editor":"_modal-image-crop-editor_hqvma_22","modal-image-crop-editor-loading":"_modal-image-crop-editor-loading_hqvma_30","modal-image-crop-actions":"_modal-image-crop-actions_hqvma_33","modal-image-crop-header":"_modal-image-crop-header_hqvma_40","modal-image-crop-right":"_modal-image-crop-right_hqvma_46","modal-image-crop-credit":"_modal-image-crop-credit_hqvma_52","modal-image-crop-credit-loading":"_modal-image-crop-credit-loading_hqvma_56","modal-image-crop-footer":"_modal-image-crop-footer_hqvma_59"},Ke=({originalDimensions:a,orientation:r})=>r==="landscape"?{width:Math.floor(Math.min(a.width,a.height/2*3)),height:Math.floor(Math.min(a.height,a.width/3*2))}:{width:Math.floor(Math.min(a.width,a.height/3*2)),height:Math.floor(Math.min(a.height,a.width/2*3))},Qe=(a,r,i)=>{const l={[t.OFFER]:400,[t.OFFER_COLLECTIVE]:400,[t.VENUE]:600}[i],{width:n}=Ke({originalDimensions:{width:a,height:r},orientation:i===t.VENUE?"landscape":"portrait"}),c=Math.min(4,(n-10)/l),o={[t.OFFER]:297,[t.OFFER_COLLECTIVE]:297,[t.VENUE]:138}[i];return{[t.OFFER]:{canvasHeight:o,canvasWidth:o*2/3,cropBorderColor:"#FFF",cropBorderHeight:50,cropBorderWidth:105,maxScale:c},[t.OFFER_COLLECTIVE]:{canvasHeight:o,canvasWidth:o*2/3,cropBorderColor:"#FFF",cropBorderHeight:50,cropBorderWidth:105,maxScale:c},[t.VENUE]:{canvasHeight:o,canvasWidth:o*3/2,cropBorderColor:"#FFF",cropBorderHeight:40,cropBorderWidth:100,maxScale:c}}[i]},k=({mode:a,onImageUpload:r,onImageDelete:i,initialValues:l={}})=>{const{draftImage:n,...c}=l,o={x:.5,y:.5},{originalImageUrl:_,credit:g,cropParams:v}=c,p=_,{xCropPercent:u,yCropPercent:V,heightCropPercent:F,widthCropPercent:I}=v||{},ue=u&&I?N(u,I):o.x,fe=V&&F?N(V,F):o.y,y=m.useRef(null),S=De(),[b,Y]=m.useState(!0),[f,D]=m.useState(n),[z,G]=m.useState(p),[he,$]=m.useState({x:ue,y:fe}),[B,J]=m.useState(g??""),[_e,ve]=m.useState(I?$e(I):1),{width:Ie,height:ye}=Ge(f),we=Qe(Ie,ye,a),xe=a===t.OFFER&&z;m.useEffect(()=>{async function s(w){try{D(await ze(w))}catch{S.error("Erreur lors de la récupération de votre image.")}}p&&s(p)},[p,S]);const Ee=()=>{D(void 0),$({x:o.x,y:o.y}),J(""),ve(1)},Ce=s=>{Y(!0),D(s),L()},je=(s,w,h)=>{f&&r({imageFile:f,imageCroppedDataUrl:w,cropParams:h,credit:s})},Ue=()=>{if(y.current){const s=y.current.getImage();G(s.toDataURL()),Y(!1)}},L=s=>{try{if(y.current){const w=y.current.getImage();G(w.toDataURL());const h=y.current.getCroppingRect();$({x:N(h.x,h.width),y:N(h.y,h.height)}),s&&s(B,w.toDataURL(),h)}}catch{S.error("Une erreur est survenue. Merci de réessayer plus tard")}},Ve=()=>L(),Fe=()=>L(je);return e.jsxs("form",{className:d["modal-image-crop"],children:[e.jsxs("div",{className:d["modal-image-crop-content"],children:[e.jsx(Se,{asChild:!0,children:e.jsx("h1",{className:d["modal-image-crop-header"],children:"Modifier une image"})}),e.jsx("p",{className:d["modal-image-crop-right"],children:"En utilisant ce contenu, je certifie que je suis propriétaire ou que je dispose des autorisations nécessaires pour l’utilisation de celui-ci."}),f&&e.jsxs(e.Fragment,{children:[b&&e.jsx(Ae,{}),e.jsxs("div",{className:U(d["modal-image-crop-subwrapper"],b&&d["modal-image-crop-editor-loading"]),children:[e.jsxs("div",{className:d["modal-image-crop-editor"],children:[e.jsx(We,{ref:y,...we,image:f,initialPosition:he,initialScale:_e,onChangeDone:Ve,onImagePainted:Ue}),e.jsxs("div",{className:d["modal-image-crop-actions"],children:[e.jsx(E,{icon:Le,onClick:Ee,variant:j.TERNARY,children:"Remplacer l’image"}),e.jsx(X,{asChild:!0,children:e.jsx(E,{icon:ce,onClick:i,variant:j.TERNARY,children:"Supprimer l’image"})})]})]}),xe&&e.jsx(W,{imageUrl:z})]}),e.jsx(Te,{count:B.length,className:U(d["modal-image-crop-credit"],b&&d["modal-image-crop-credit-loading"]),label:"Crédit de l’image",maxLength:255,value:B,onChange:s=>J(s.target.value),name:"credit",type:"text"})]}),!f&&e.jsx(Be,{onDropOrSelected:Ce})]}),e.jsx(pe.Footer,{children:e.jsxs("div",{className:d["modal-image-crop-footer"],children:[e.jsx(X,{asChild:!0,children:e.jsx(E,{variant:j.SECONDARY,children:"Annuler"})}),e.jsx(E,{type:"submit",onClick:s=>{s.preventDefault(),Fe()},disabled:!f,children:"Enregistrer"})]})})]})};try{k.displayName="ModalImageUpsertOrEdit",k.__docgenInfo={description:"",displayName:"ModalImageUpsertOrEdit",props:{mode:{defaultValue:null,description:"",name:"mode",required:!0,type:{name:"enum",value:[{value:'"offer"'},{value:'"offer_collective"'},{value:'"venue"'}]}},onImageUpload:{defaultValue:null,description:"",name:"onImageUpload",required:!0,type:{name:"(values: OnImageUploadArgs) => void"}},onImageDelete:{defaultValue:null,description:"",name:"onImageDelete",required:!1,type:{name:"(() => void)"}},initialValues:{defaultValue:{value:"{}"},description:"",name:"initialValues",required:!1,type:{name:"UploadImageValues"}}}}}catch{}const Ze="_label_1wm17_22",ea="_icon_1wm17_35",C={"button-image-add":"_button-image-add_1wm17_1","add-image-venue":"_add-image-venue_1wm17_14","add-image-offer":"_add-image-offer_1wm17_18",label:Ze,icon:ea},P=({mode:a,initialValues:r={},onImageUpload:i,onImageDelete:l,onClickButtonImage:n,children:c,disableForm:o})=>{const{imageUrl:_,originalImageUrl:g}=r,[v,p]=m.useState(!1),u=()=>{n&&n()},V=()=>{l()};function F(I){i(I),p(!1)}return e.jsx(e.Fragment,{children:e.jsx(pe,{onOpenChange:p,open:v,variant:"drawer",trigger:_||g?e.jsx(E,{onClick:u,variant:j.TERNARY,"aria-label":"Modifier l’image",icon:He,children:c??"Modifier"}):e.jsx("button",{className:U(C["button-image-add"],{[C["add-image-venue"]]:a===t.VENUE,[C["add-image-offer"]]:a===t.OFFER||a===t.OFFER_COLLECTIVE}),onClick:u,type:"button",disabled:o,children:e.jsxs(e.Fragment,{children:[e.jsx(de,{src:Me,alt:"",className:C.icon}),e.jsx("span",{className:C.label,children:"Ajouter une image"})]})}),children:e.jsx(k,{mode:a,onImageUpload:F,onImageDelete:V,initialValues:r})})})};try{P.displayName="ButtonImageEdit",P.__docgenInfo={description:"",displayName:"ButtonImageEdit",props:{onImageUpload:{defaultValue:null,description:"",name:"onImageUpload",required:!0,type:{name:"(values: OnImageUploadArgs) => void"}},onImageDelete:{defaultValue:null,description:"",name:"onImageDelete",required:!0,type:{name:"() => void"}},initialValues:{defaultValue:{value:"{}"},description:"",name:"initialValues",required:!1,type:{name:"UploadImageValues"}},mode:{defaultValue:null,description:"",name:"mode",required:!0,type:{name:"enum",value:[{value:'"offer"'},{value:'"offer_collective"'},{value:'"venue"'}]}},onClickButtonImage:{defaultValue:null,description:"",name:"onClickButtonImage",required:!1,type:{name:"(() => void)"}},disableForm:{defaultValue:null,description:"",name:"disableForm",required:!1,type:{name:"boolean"}}}}}catch{}const x={"image-uploader-image-container":"_image-uploader-image-container_1gu1i_5","image-uploader-actions-container":"_image-uploader-actions-container_1gu1i_10","actions-wrapper":"_actions-wrapper_1gu1i_17","image-preview":"_image-preview_1gu1i_25","preview-venue":"_preview-venue_1gu1i_31","preview-offer":"_preview-offer_1gu1i_41"},H=({className:a,onImageUpload:r,onImageDelete:i,initialValues:l={},mode:n,onClickButtonImageAdd:c,hideActionButtons:o=!1,disableForm:_=!1})=>{const{imageUrl:g,originalImageUrl:v,credit:p,cropParams:u}=l;return e.jsx("div",{className:U(x["image-uploader-image-container"],a),children:g&&v?e.jsxs(e.Fragment,{children:[e.jsx("img",{alt:"Prévisualisation de l’image","data-testid":"image-preview",className:U(x["image-preview"],{[x["preview-venue"]]:n===t.VENUE,[x["preview-offer"]]:n===t.OFFER||n===t.OFFER_COLLECTIVE}),src:g}),!o&&e.jsx("div",{className:x["image-uploader-actions-container"],children:e.jsxs("div",{className:x["actions-wrapper"],children:[e.jsx(P,{mode:n,initialValues:{originalImageUrl:v,imageUrl:g,credit:p,cropParams:u},onImageUpload:r,onImageDelete:i,onClickButtonImage:c,disableForm:_}),e.jsx(A,{onImageDelete:i})]})})]}):e.jsx(P,{mode:n,onImageUpload:r,onImageDelete:i,onClickButtonImage:c,disableForm:_})})};try{H.displayName="ImageUploader",H.__docgenInfo={description:"",displayName:"ImageUploader",props:{className:{defaultValue:null,description:"",name:"className",required:!1,type:{name:"string"}},onImageUpload:{defaultValue:null,description:"",name:"onImageUpload",required:!0,type:{name:"(values: OnImageUploadArgs) => void"}},onImageDelete:{defaultValue:null,description:"",name:"onImageDelete",required:!0,type:{name:"() => void"}},initialValues:{defaultValue:{value:"{}"},description:"",name:"initialValues",required:!1,type:{name:"UploadImageValues"}},mode:{defaultValue:null,description:"",name:"mode",required:!0,type:{name:"enum",value:[{value:'"offer"'},{value:'"offer_collective"'},{value:'"venue"'}]}},onClickButtonImageAdd:{defaultValue:null,description:"",name:"onClickButtonImageAdd",required:!1,type:{name:"(() => void)"}},hideActionButtons:{defaultValue:{value:"false"},description:"",name:"hideActionButtons",required:!1,type:{name:"boolean"}},disableForm:{defaultValue:{value:"false"},description:"",name:"disableForm",required:!1,type:{name:"boolean"}}}}}catch{}const Ya={title:"components/ImageUploader/ImageUploader",component:H,decorators:[Oe,a=>e.jsx(Ne,{store:Re({}),children:e.jsx(a,{})})]},ge={initialValues:{originalImageUrl:Z,imageUrl:Z,credit:"John Do",cropParams:{xCropPercent:0,yCropPercent:0,heightCropPercent:1,widthCropPercent:1}},mode:t.OFFER,onImageDelete:()=>{alert("onDelete have been called.")},onImageUpload:()=>{alert("onImageUpload have been called.")}},O={args:{...ge}},R={args:{...ge,initialValues:{imageUrl:Q,originalImageUrl:Q},mode:t.VENUE}},q={args:{mode:t.OFFER}};var ae,re,te;O.parameters={...O.parameters,docs:{...(ae=O.parameters)==null?void 0:ae.docs,source:{originalSource:`{
  args: {
    ...props
  }
}`,...(te=(re=O.parameters)==null?void 0:re.docs)==null?void 0:te.source}}};var ie,oe,ne;R.parameters={...R.parameters,docs:{...(ie=R.parameters)==null?void 0:ie.docs,source:{originalSource:`{
  args: {
    ...props,
    initialValues: {
      imageUrl: sampleImageLandscape,
      originalImageUrl: sampleImageLandscape
    },
    mode: UploaderModeEnum.VENUE
  }
}`,...(ne=(oe=R.parameters)==null?void 0:oe.docs)==null?void 0:ne.source}}};var le,se,me;q.parameters={...q.parameters,docs:{...(le=q.parameters)==null?void 0:le.docs,source:{originalSource:`{
  args: {
    mode: UploaderModeEnum.OFFER
  }
}`,...(me=(se=q.parameters)==null?void 0:se.docs)==null?void 0:me.source}}};const za=["WithImageOffer","WithImageVenue","WithoutImage"];export{O as WithImageOffer,R as WithImageVenue,q as WithoutImage,za as __namedExportsOrder,Ya as default};
