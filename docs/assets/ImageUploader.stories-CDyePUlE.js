import{j as e}from"./jsx-runtime-C_uOM0Gm.js";import{P as Pe,c as Fe}from"./testUtils-B_sNBPCn.js";import{V as De}from"./index-vSssAp4U.js";import{c as V}from"./index-TscbDd2H.js";import{g as Le,S as Be,I as Te}from"./helpers-DUbjvcNJ.js";import{r as m}from"./iframe-CTnXOULQ.js";import{u as ee}from"./useSnackBar-BVi7-NBL.js";import{f as _e}from"./full-trash-CEfIUI4M.js";import{B as x}from"./Button-D-MtOkGK.js";import{B as j}from"./types-yVZEaApa.js";import{S as ve}from"./SvgIcon-CJiY4LCz.js";import{C as Ae}from"./ConfirmDialog-w8ShSG4t.js";import{s as Me}from"./stroke-trash-Cc_5v2lW.js";import{D as me,C as ce}from"./DialogBuilder-C6nA5Q93.js";import{u as ke,E as We}from"./constants-B8J2J8NQ.js";import{I as ze}from"./ImageDragAndDrop-BauIuOvL.js";import{B as He,a as Ye}from"./Banner-CND8Om-8.js";import{T as $e}from"./TextInput-DOsfrCQI.js";import{f as Ge}from"./full-download-XQM5pv74.js";import{S as de}from"./Spinner-h9yq8fK4.js";import{I as Xe}from"./ImageEditor-BpopdA3N.js";import{I as Ie,a as B}from"./ImagePreviewsWrapper-BdDZeBXh.js";import{f as Je}from"./full-edit-CxAaM2Fv.js";import{f as Ke}from"./full-more-DLJb58kc.js";import"./store-DbzJj_LB.js";import"./date-CrU56jqV.js";import"./chunk-EPOLDU6W-u6n6pb5J.js";import"./preload-helper-PPVm8Dsz.js";import"./SnackBar-DSFSWWuB.js";import"./full-clear-Q4kCtSRL.js";import"./full-close-5Oxr7nnd.js";import"./full-validate-CbMNulkZ.js";import"./useMediaQuery-DeNVqfPX.js";import"./useAppDispatch-D_a_Ase9.js";import"./stroke-pass-CALgybTM.js";import"./Tooltip-GJ5PEk5n.js";import"./Button.module-BE-jPv6M.js";import"./stroke-error-DSZD431a.js";import"./Dialog-BlHKnZq9.js";import"./index-BEuwmvHz.js";import"./index-DiBs-Z1F.js";import"./index-2FA_ODGf.js";import"./tslib.es6-BUas5LQb.js";import"./stroke-close-DnlFsd1c.js";import"./index-B8LP8_Hv.js";import"./index-Chjiymov.js";import"./stroke-picture-VF2OicDu.js";import"./full-info-D24AtBVt.js";import"./ButtonLink-Dt0aqjLF.js";import"./full-link-CYVo23DH.js";import"./FieldFooter-CL0tzobd.js";import"./full-error-BFAmjN4t.js";import"./index.module-DEHgy3-r.js";import"./FieldHeader-DxZ9joXq.js";import"./Slider-CxZ45NUH.js";const pe=""+new URL("sample-image-landscape-B4GmPBHc.jpg",import.meta.url).href,ue=""+new URL("sample-image-portrait-OorsIixL.jpg",import.meta.url).href;var o=(a=>(a.OFFER="offer",a.OFFER_COLLECTIVE="offer_collective",a.VENUE="venue",a))(o||{});const Qe={"button-image-delete-icon":"_button-image-delete-icon_19z4s_1"},G=({isLoading:a,onConfirm:r,onDismiss:i,isDialogOpen:l,trigger:n})=>e.jsx(Ae,{cancelText:"Retour",confirmText:"Supprimer",icon:Me,isLoading:a,onCancel:i,onConfirm:r,title:"Supprimer l’image",open:l,trigger:n,children:"Souhaitez-vous vraiment supprimer cette image ?"});try{G.displayName="ModalImageDelete",G.__docgenInfo={description:"",displayName:"ModalImageDelete",props:{isLoading:{defaultValue:null,description:"",name:"isLoading",required:!0,type:{name:"boolean"}},onConfirm:{defaultValue:null,description:"",name:"onConfirm",required:!0,type:{name:"() => void"}},onDismiss:{defaultValue:null,description:"",name:"onDismiss",required:!0,type:{name:"() => void"}},isDialogOpen:{defaultValue:null,description:"",name:"isDialogOpen",required:!0,type:{name:"boolean"}},trigger:{defaultValue:null,description:"",name:"trigger",required:!0,type:{name:"ReactNode"}}}}}catch{}const X=({onImageDelete:a})=>{const[r,i]=m.useState(!1),[l,n]=m.useState(!1),c=ee(),t=()=>{n(!0),a(),c.success("Votre image a bien été supprimée")};return e.jsx(G,{isLoading:l,onConfirm:t,onDismiss:()=>i(!1),isDialogOpen:r,trigger:e.jsxs(x,{onClick:()=>i(!0),variant:j.TERNARY,children:[e.jsx(ve,{alt:"",className:Qe["button-image-delete-icon"],src:_e}),"Supprimer"]})})};try{X.displayName="ButtonImageDelete",X.__docgenInfo={description:"",displayName:"ButtonImageDelete",props:{onImageDelete:{defaultValue:null,description:"",name:"onImageDelete",required:!0,type:{name:"() => void"}}}}}catch{}const Ze=async a=>(window.createImageBitmap||(window.createImageBitmap=r=>new Promise(i=>{const l=document.createElement("img");l.addEventListener("load",function(){i(this)}),l.src=URL.createObjectURL(r)})),await createImageBitmap(a).catch(()=>null)),ea=a=>{const[r,i]=m.useState(0),[l,n]=m.useState(0);return m.useEffect(()=>{(async()=>{if(a){const t=await Ze(a);t&&(i(t.width),n(t.height))}})()},[a]),a?{width:r,height:l}:{width:0,height:0}},F=(a,r)=>a+r/2,aa=a=>100/(a*100),ta=""+new URL("offer-home-shell-Ch3YT9j3.png",import.meta.url).href,ra=""+new URL("offer-shell-coq2oAbe.png",import.meta.url).href,ge={"image-preview-shell":"_image-preview-shell_98ykx_1","image-preview-home-preview":"_image-preview-home-preview_98ykx_7"},$={"image-preview-shell":"_image-preview-shell_4wqwh_1","image-preview-blur-offer-preview":"_image-preview-blur-offer-preview_4wqwh_7","image-preview-offer-preview":"_image-preview-offer-preview_4wqwh_16"},J=({imageUrl:a})=>e.jsxs(Ie,{children:[e.jsxs(B,{title:"Page d’accueil",children:[e.jsx("img",{alt:"",className:ge["image-preview-shell"],src:ta}),e.jsx("img",{"data-testid":"app-preview-offer-img-home",alt:"",className:ge["image-preview-home-preview"],src:a})]}),e.jsxs(B,{title:"Détails de l’offre",children:[e.jsx("img",{alt:"",className:$["image-preview-blur-offer-preview"],src:a}),e.jsx("img",{alt:"",className:$["image-preview-shell"],src:ra}),e.jsx("img",{"data-testid":"app-preview-offer-img",alt:"",className:$["image-preview-offer-preview"],src:a})]})]});try{J.displayName="AppPreviewOffer",J.__docgenInfo={description:"",displayName:"AppPreviewOffer",props:{imageUrl:{defaultValue:null,description:"",name:"imageUrl",required:!0,type:{name:"string"}}}}}catch{}const ia=""+new URL("partner-home-shell-QX5a1P1s.png",import.meta.url).href,oa=""+new URL("partner-shell-D59I5gaY.png",import.meta.url).href,fe={"image-preview-shell":"_image-preview-shell_1isbc_1","image-preview-home-preview":"_image-preview-home-preview_1isbc_7"},he={"image-preview-shell":"_image-preview-shell_1dg34_1","image-preview-offer-preview":"_image-preview-offer-preview_1dg34_7"},K=({imageUrl:a})=>e.jsxs(Ie,{children:[e.jsxs(B,{title:"Page d’accueil",children:[e.jsx("img",{alt:"",className:fe["image-preview-shell"],src:ia}),e.jsx("img",{"data-testid":"app-preview-offer-img-home",alt:"",className:fe["image-preview-home-preview"],src:a})]}),e.jsxs(B,{title:"Détails de l’offre",children:[e.jsx("img",{alt:"",className:he["image-preview-shell"],src:oa}),e.jsx("img",{"data-testid":"app-preview-offer-img",alt:"",className:he["image-preview-offer-preview"],src:a})]})]});try{K.displayName="AppPreviewVenue",K.__docgenInfo={description:"",displayName:"AppPreviewVenue",props:{imageUrl:{defaultValue:null,description:"",name:"imageUrl",required:!0,type:{name:"string"}}}}}catch{}const d={"modal-image-crop":"_modal-image-crop_1s1z0_1","modal-image-crop-content":"_modal-image-crop-content_1s1z0_8","modal-image-crop-subwrapper":"_modal-image-crop-subwrapper_1s1z0_11","modal-image-crop-editor":"_modal-image-crop-editor_1s1z0_22","modal-image-crop-editor-loading":"_modal-image-crop-editor-loading_1s1z0_30","modal-image-crop-callout":"_modal-image-crop-callout_1s1z0_33","modal-image-crop-callout-list":"_modal-image-crop-callout-list_1s1z0_36","modal-image-crop-actions":"_modal-image-crop-actions_1s1z0_40","modal-image-crop-right":"_modal-image-crop-right_1s1z0_47","modal-image-crop-credit":"_modal-image-crop-credit_1s1z0_53","modal-image-crop-credit-loading":"_modal-image-crop-credit-loading_1s1z0_57","modal-image-crop-footer":"_modal-image-crop-footer_1s1z0_60"},na=({originalDimensions:a,orientation:r})=>r==="landscape"?{width:Math.floor(Math.min(a.width,a.height/2*3)),height:Math.floor(Math.min(a.height,a.width/3*2))}:{width:Math.floor(Math.min(a.width,a.height/3*2)),height:Math.floor(Math.min(a.height,a.width/2*3))},la=(a,r,i)=>{const l={[o.OFFER]:400,[o.OFFER_COLLECTIVE]:400,[o.VENUE]:600}[i],{width:n}=na({originalDimensions:{width:a,height:r},orientation:i===o.VENUE?"landscape":"portrait"}),c=Math.min(4,(n-10)/l),t={[o.OFFER]:297,[o.OFFER_COLLECTIVE]:297,[o.VENUE]:138}[i];return{[o.OFFER]:{canvasHeight:t,canvasWidth:t*2/3,cropBorderHeight:50,cropBorderWidth:105,maxScale:c},[o.OFFER_COLLECTIVE]:{canvasHeight:t,canvasWidth:t*2/3,cropBorderHeight:50,cropBorderWidth:105,maxScale:c},[o.VENUE]:{canvasHeight:t,canvasWidth:t*3/2,cropBorderHeight:40,cropBorderWidth:100,maxScale:c}}[i]},Q=({mode:a,onImageUpload:r,onImageDelete:i,initialValues:l={},...n})=>{const{logEvent:c}=ke(),{draftImage:t,...C}=l,u={x:.5,y:.5},{croppedImageUrl:h,originalImageUrl:U,credit:_,cropParams:N}=C,p=U||h,{xCropPercent:O,yCropPercent:S,heightCropPercent:R,widthCropPercent:v}=N||{},ae=O&&v?F(O,v):u.x,te=S&&R?F(S,R):u.y,I=m.useRef(null),b=ee(),[A,re]=m.useState(!!p),[M,k]=m.useState(!0),[g,q]=m.useState(t),[ie,oe]=m.useState(p),[we,W]=m.useState({x:ae,y:te}),[ne,P]=m.useState(_??""),le=v?aa(v):1,[ye,se]=m.useState(le),{width:z,height:H}=ea(g),xe=la(z,H,a),Ce=a===o.OFFER&&(z&&z<400||H&&H<600),Ee={[o.VENUE]:K,[o.OFFER]:J,[o.OFFER_COLLECTIVE]:()=>e.jsx(e.Fragment,{})}[a];m.useEffect(()=>{async function s(w){try{q(await Le(w))}catch{b.error("Erreur lors de la récupération de votre image.")}re(!1)}n.open&&p&&s(p)},[n.open,p,b]),m.useEffect(()=>{q(t),t&&re(!1)},[t]),m.useEffect(()=>{P(_??"")},[_]);const je=()=>{q(void 0),W({x:u.x,y:u.y}),P(""),se(1)},Ve=()=>{W({x:ae,y:te}),P(_??""),se(le)},Ue=()=>je(),Ne=s=>{k(!0),q(s),Y()},Oe=(s,w,f)=>{g&&(c(We.CLICKED_SAVE_IMAGE,{imageType:a,imageCreationStage:"save"}),r({imageFile:g,imageCroppedDataUrl:w,cropParams:f,credit:s},p?"Vos modifications ont bien été prises en compte":"Votre image a bien été importée"))},Se=()=>{if(I.current){const s=I.current.getImage();oe(s.toDataURL()),k(!1)}},Re=()=>{k(!1),b.error("Erreur lors de la récupération de votre image.")},Y=s=>{try{if(I.current){const w=I.current.getImage();oe(w.toDataURL());const f=I.current.getCroppingRect();W({x:F(f.x,f.width),y:F(f.y,f.height)}),s&&s(ne,w.toDataURL(),f)}}catch{b.error("Une erreur est survenue. Merci de réessayer plus tard")}},be=()=>Y(),qe=()=>Y(Oe);return e.jsx(me,{...n,onOpenChange:s=>{s||Ve(),n.onOpenChange?.(s)},title:"Modifier une image",variant:"drawer",children:e.jsxs("form",{className:d["modal-image-crop"],children:[e.jsxs("div",{className:d["modal-image-crop-content"],children:[e.jsx("p",{className:d["modal-image-crop-right"],children:"En utilisant ce contenu, je certifie que je suis propriétaire ou que je dispose des autorisations nécessaires pour l’utilisation de celui-ci."}),A&&e.jsx(de,{testId:"spinner-img-load"}),!A&&g&&e.jsxs(e.Fragment,{children:[M&&e.jsx(de,{testId:"spinner-img-paint"}),e.jsxs("div",{className:V(d["modal-image-crop-subwrapper"],M&&d["modal-image-crop-editor-loading"]),children:[e.jsxs("div",{className:d["modal-image-crop-editor"],children:[e.jsx(Xe,{ref:I,...xe,image:g,initialPosition:we,initialScale:ye,onChangeDone:be,onImagePainted:Se,onImageError:Re}),e.jsxs("div",{className:d["modal-image-crop-actions"],children:[e.jsx(x,{icon:Ge,onClick:Ue,variant:j.TERNARY,children:"Remplacer l’image"}),e.jsx(ce,{asChild:!0,children:e.jsx(x,{icon:_e,onClick:i,variant:j.TERNARY,children:"Supprimer l’image"})})]})]}),ie&&e.jsx(Ee,{imageUrl:ie})]}),Ce&&e.jsx("div",{className:d["modal-image-crop-callout"],children:e.jsx(He,{variant:Ye.WARNING,title:"Image non conforme aux recommandations",description:e.jsxs("div",{children:["Le format recommandé :",e.jsxs("ul",{className:d["modal-image-crop-callout-list"],children:[e.jsx("li",{children:"Largeur minimale de l’image : 400 px"}),e.jsx("li",{children:"Hauteur minimale de l’image : 600 px"})]})]})})}),e.jsx("div",{className:V(d["modal-image-crop-credit"],M&&d["modal-image-crop-credit-loading"]),children:e.jsx($e,{label:"Crédit de l’image",name:"credit",maxCharactersCount:255,value:ne,onChange:s=>P(s.target.value)})})]}),!A&&!g&&e.jsx(ze,{onDropOrSelected:Ne,...a!==o.OFFER?{minSizes:{width:600,height:400}}:{}})]}),e.jsx(me.Footer,{children:e.jsxs("div",{className:d["modal-image-crop-footer"],children:[e.jsx(ce,{asChild:!0,children:e.jsx(x,{variant:j.SECONDARY,children:"Annuler"})}),e.jsx(x,{type:"submit",onClick:s=>{s.preventDefault(),qe()},disabled:!g,children:"Importer"})]})})]})})};try{Q.displayName="ModalImageUpsertOrEdit",Q.__docgenInfo={description:"",displayName:"ModalImageUpsertOrEdit",props:{mode:{defaultValue:null,description:"",name:"mode",required:!0,type:{name:"enum",value:[{value:'"offer"'},{value:'"offer_collective"'},{value:'"venue"'}]}},onImageUpload:{defaultValue:null,description:"",name:"onImageUpload",required:!0,type:{name:"(values: OnImageUploadArgs, successMessage: string) => void"}},onImageDelete:{defaultValue:null,description:"",name:"onImageDelete",required:!1,type:{name:"(() => void)"}},initialValues:{defaultValue:{value:"{}"},description:"",name:"initialValues",required:!1,type:{name:"UploadImageValues"}},className:{defaultValue:null,description:"Custom CSS class for additional styling of the dialog content.",name:"className",required:!1,type:{name:"string"}},title:{defaultValue:null,description:"The heading title of the dialog.",name:"title",required:!1,type:{name:"string"}},variant:{defaultValue:null,description:"",name:"variant",required:!1,type:{name:"enum",value:[{value:'"default"'},{value:'"drawer"'}]}},trigger:{defaultValue:null,description:"The trigger element that opens the dialog.",name:"trigger",required:!1,type:{name:"ReactNode"}},open:{defaultValue:null,description:"Controls the open state of the dialog.",name:"open",required:!1,type:{name:"boolean"}},refToFocusOnClose:{defaultValue:null,description:`Ref of the element to focus on when the dialog is closed.
If refToFocusOnClose.current is null, the trigger element will be focused as a fallback.`,name:"refToFocusOnClose",required:!1,type:{name:"RefObject<HTMLElement>"}},imageTitle:{defaultValue:null,description:"An image for the title.",name:"imageTitle",required:!1,type:{name:"ReactNode"}},defaultOpen:{defaultValue:{value:"false"},description:"Determines if the dialog is open by default.",name:"defaultOpen",required:!1,type:{name:"boolean"}},onOpenChange:{defaultValue:null,description:"Callback function triggered when the open state of the dialog changes.",name:"onOpenChange",required:!1,type:{name:"((open: boolean) => void)"}},closeButtonClassName:{defaultValue:null,description:"Custom CSS class for additional styling of the close button.",name:"closeButtonClassName",required:!1,type:{name:"string"}}}}}catch{}const sa="_label_11uqh_22",ma="_icon_11uqh_32",E={"button-image-add":"_button-image-add_11uqh_1","add-image-venue":"_add-image-venue_11uqh_14","add-image-offer":"_add-image-offer_11uqh_18",label:sa,icon:ma},T=({mode:a,initialValues:r={},onImageUpload:i,onImageDelete:l,onClickButtonImage:n,children:c,disableForm:t})=>{const{croppedImageUrl:C,originalImageUrl:u}=r,h=C||u,U=ee(),[_,N]=m.useState(!1),p=()=>{n&&n()},O=()=>{l(),U.success("Votre image a bien été supprimée")};function S(R,v){i(R),N(!1),U.success(v)}return e.jsx(Q,{mode:a,onImageUpload:S,onImageDelete:O,initialValues:r,onOpenChange:N,open:_,trigger:h?e.jsx(x,{onClick:p,variant:j.TERNARY,"aria-label":"Modifier l’image",icon:Je,children:c??"Modifier"}):e.jsxs("button",{className:V(E["button-image-add"],{[E["add-image-venue"]]:a===o.VENUE,[E["add-image-offer"]]:a===o.OFFER||a===o.OFFER_COLLECTIVE}),onClick:p,type:"button",disabled:t,children:[e.jsx(ve,{src:Ke,alt:"",className:E.icon}),e.jsx("span",{className:E.label,children:"Ajouter une image"})]})})};try{T.displayName="ButtonImageEdit",T.__docgenInfo={description:"",displayName:"ButtonImageEdit",props:{onImageUpload:{defaultValue:null,description:"",name:"onImageUpload",required:!0,type:{name:"(values: OnImageUploadArgs) => void"}},onImageDelete:{defaultValue:null,description:"",name:"onImageDelete",required:!0,type:{name:"() => void"}},initialValues:{defaultValue:{value:"{}"},description:"",name:"initialValues",required:!1,type:{name:"UploadImageValues"}},mode:{defaultValue:null,description:"",name:"mode",required:!0,type:{name:"enum",value:[{value:'"offer"'},{value:'"offer_collective"'},{value:'"venue"'}]}},onClickButtonImage:{defaultValue:null,description:"",name:"onClickButtonImage",required:!1,type:{name:"(() => void)"}},disableForm:{defaultValue:null,description:"",name:"disableForm",required:!1,type:{name:"boolean"}}}}}catch{}const y={"image-uploader-image-container":"_image-uploader-image-container_3cdfp_5","image-uploader-actions-container":"_image-uploader-actions-container_3cdfp_10","actions-wrapper":"_actions-wrapper_3cdfp_17","image-preview":"_image-preview_3cdfp_25","preview-venue":"_preview-venue_3cdfp_31","placeholder-venue":"_placeholder-venue_3cdfp_42"},Z=({className:a,onImageUpload:r,onImageDelete:i,initialValues:l={},onClickButtonImageAdd:n,hideActionButtons:c=!1,disableForm:t=!1})=>{const{croppedImageUrl:C,originalImageUrl:u}=l,h=C||u;return e.jsx("div",{className:V(y["image-uploader-image-container"],a),children:h?e.jsxs(e.Fragment,{children:[e.jsx(Be,{alt:"Prévisualisation de l’image","data-testid":"image-preview",className:V(y["image-preview"],y["preview-venue"]),src:h,placeholder:e.jsx(Te,{className:y["placeholder-venue"]})}),!c&&e.jsx("div",{className:y["image-uploader-actions-container"],children:e.jsxs("div",{className:y["actions-wrapper"],children:[e.jsx(T,{mode:o.VENUE,initialValues:l,onImageUpload:r,onImageDelete:i,onClickButtonImage:n,disableForm:t}),e.jsx(X,{onImageDelete:i})]})})]}):e.jsx(T,{mode:o.VENUE,onImageUpload:r,onImageDelete:i,onClickButtonImage:n,disableForm:t})})};try{Z.displayName="ImageUploader",Z.__docgenInfo={description:"",displayName:"ImageUploader",props:{className:{defaultValue:null,description:"",name:"className",required:!1,type:{name:"string"}},onImageUpload:{defaultValue:null,description:"",name:"onImageUpload",required:!0,type:{name:"(values: OnImageUploadArgs) => void"}},onImageDelete:{defaultValue:null,description:"",name:"onImageDelete",required:!0,type:{name:"() => void"}},initialValues:{defaultValue:{value:"{}"},description:"",name:"initialValues",required:!1,type:{name:"UploadImageValues"}},onClickButtonImageAdd:{defaultValue:null,description:"",name:"onClickButtonImageAdd",required:!1,type:{name:"(() => void)"}},hideActionButtons:{defaultValue:{value:"false"},description:"",name:"hideActionButtons",required:!1,type:{name:"boolean"}},disableForm:{defaultValue:{value:"false"},description:"",name:"disableForm",required:!1,type:{name:"boolean"}}}}}catch{}const pt={title:"@/components/ImageUploader/ImageUploader",component:Z,decorators:[De,a=>e.jsx(Pe,{store:Fe({}),children:e.jsx(a,{})})]},ca={initialValues:{originalImageUrl:ue,croppedImageUrl:ue,credit:"John Do",cropParams:{xCropPercent:0,yCropPercent:0,heightCropPercent:1,widthCropPercent:1}},onImageDelete:()=>{alert("onDelete have been called.")},onImageUpload:()=>{alert("onImageUpload have been called.")}},D={args:{...ca,initialValues:{croppedImageUrl:pe,originalImageUrl:pe}}},L={args:{}};D.parameters={...D.parameters,docs:{...D.parameters?.docs,source:{originalSource:`{
  args: {
    ...props,
    initialValues: {
      croppedImageUrl: sampleImageLandscape,
      originalImageUrl: sampleImageLandscape
    }
  }
}`,...D.parameters?.docs?.source}}};L.parameters={...L.parameters,docs:{...L.parameters?.docs,source:{originalSource:`{
  args: {}
}`,...L.parameters?.docs?.source}}};const ut=["WithImageVenue","WithoutImage"];export{D as WithImageVenue,L as WithoutImage,ut as __namedExportsOrder,pt as default};
