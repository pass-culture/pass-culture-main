import{j as e}from"./jsx-runtime-BYYWji4R.js";import{P as Se}from"./reducer-Crbp5051.js";import{V as De}from"./index-BQRgOAGl.js";import{c as Le}from"./testUtils-DY3eMo7d.js";import{c as U}from"./index-DeARc5FM.js";import{r as m}from"./index-ClcD9ViR.js";import{f as fe}from"./full-trash-CEfIUI4M.js";import{B as E}from"./Button-Cva4CQSi.js";import{B as C}from"./types-yVZEaApa.js";import{S as he}from"./SvgIcon-CyWUmZpn.js";import{C as qe}from"./ConfirmDialog-EOH-mt7b.js";import{s as Be}from"./stroke-trash-Cc_5v2lW.js";import{T as Me,C as ee,D as _e}from"./DialogBuilder-DiG-JMht.js";import{g as Ae}from"./image-CI1RfRht.js";import{u as Te}from"./useNotification-DrLY4vYB.js";import{I as We}from"./ImageDragAndDrop-DaJ5uSPy.js";import{f as ke,a as He}from"./full-more-D-B0T6P8.js";import{C as Ye,a as $e}from"./Callout-BGipQzfS.js";import{T as ze}from"./TextInput-DUFoZnSR.js";import{S as Ge}from"./Spinner-BHztG-h6.js";import{I as Xe}from"./ImageEditor-BDpidl5h.js";import{a as ve,I as P}from"./ImagePreviewsWrapper-G1laXlNt.js";import{f as Je}from"./full-edit-CxAaM2Fv.js";import"./index-DOYoWpww.js";import"./index-J01lmiDr.js";import"./_commonjsHelpers-Cpj98o6Y.js";import"./config-BdqymTTq.js";import"./OfferAddressType-Co4gxJoY.js";import"./stroke-pass-CALgybTM.js";import"./Tooltip-BpKRYYrm.js";import"./Button.module-BsO1-3k4.js";import"./stroke-error-DSZD431a.js";import"./Dialog-CTX7PKGB.js";import"./index-Tk16rnJW.js";import"./tslib.es6-BUas5LQb.js";import"./stroke-close-DnlFsd1c.js";import"./index-BH3dreXg.js";import"./index-Chjiymov.js";import"./full-validate-CbMNulkZ.js";import"./stroke-picture-VF2OicDu.js";import"./full-info-C4RdBA4U.js";import"./full-warning-LoKhBeYn.js";import"./full-link-CYVo23DH.js";import"./full-next-B_76kGmE.js";import"./ButtonLink-Dfktyoca.js";import"./BaseInput-BI1b_EYZ.js";import"./FieldError-azuIsM2E.js";import"./FieldLayoutCharacterCount-Bc4HS3VB.js";import"./index.module-DF6qn1Ex.js";import"./Slider-DKKiAQxD.js";var r=(a=>(a.OFFER="offer",a.OFFER_COLLECTIVE="offer_collective",a.VENUE="venue",a))(r||{});const ae=""+new URL("sample-image-landscape-B4GmPBHc.jpg",import.meta.url).href,re=""+new URL("sample-image-portrait-OorsIixL.jpg",import.meta.url).href,Qe={"button-image-delete-icon":"_button-image-delete-icon_ooh4c_1"},k=({isLoading:a,onConfirm:i,onDismiss:t,isDialogOpen:l,trigger:n})=>e.jsx(qe,{cancelText:"Retour",confirmText:"Supprimer",icon:Be,isLoading:a,onCancel:t,onConfirm:i,title:"Supprimer l’image",open:l,trigger:n,children:"Souhaitez-vous vraiment supprimer cette image ?"});try{k.displayName="ModalImageDelete",k.__docgenInfo={description:"",displayName:"ModalImageDelete",props:{isLoading:{defaultValue:null,description:"",name:"isLoading",required:!0,type:{name:"boolean"}},onConfirm:{defaultValue:null,description:"",name:"onConfirm",required:!0,type:{name:"() => void"}},onDismiss:{defaultValue:null,description:"",name:"onDismiss",required:!0,type:{name:"() => void"}},isDialogOpen:{defaultValue:null,description:"",name:"isDialogOpen",required:!0,type:{name:"boolean"}},trigger:{defaultValue:null,description:"",name:"trigger",required:!0,type:{name:"ReactNode"}}}}}catch{}const H=({onImageDelete:a})=>{const[i,t]=m.useState(!1),[l,n]=m.useState(!1),c=()=>{n(!0),a()};return e.jsx(k,{isLoading:l,onConfirm:c,onDismiss:()=>t(!1),isDialogOpen:i,trigger:e.jsxs(E,{onClick:()=>t(!0),variant:C.TERNARY,children:[e.jsx(he,{alt:"",className:Qe["button-image-delete-icon"],src:fe}),"Supprimer"]})})};try{H.displayName="ButtonImageDelete",H.__docgenInfo={description:"",displayName:"ButtonImageDelete",props:{onImageDelete:{defaultValue:null,description:"",name:"onImageDelete",required:!0,type:{name:"() => void"}}}}}catch{}const Ke=async(a,i="image.jpg")=>{const l=await(await fetch(a)).blob();return new File([l],i,{type:l.type})},Ze=a=>{const[i,t]=m.useState(0),[l,n]=m.useState(0);return m.useEffect(()=>{(async()=>{if(a){const o=await Ae(a);o&&(t(o.width),n(o.height))}})()},[a]),a?{width:i,height:l}:{width:0,height:0}},N=(a,i)=>a+i/2,ea=a=>100/(a*100),aa=""+new URL("offer-home-shell-Ch3YT9j3.png",import.meta.url).href,ra=""+new URL("offer-shell-coq2oAbe.png",import.meta.url).href,ie={"image-preview-shell":"_image-preview-shell_1yqyc_1","image-preview-home-preview":"_image-preview-home-preview_1yqyc_7"},W={"image-preview-shell":"_image-preview-shell_8f82l_1","image-preview-blur-offer-preview":"_image-preview-blur-offer-preview_8f82l_7","image-preview-offer-preview":"_image-preview-offer-preview_8f82l_16"},Y=({imageUrl:a})=>e.jsxs(ve,{children:[e.jsxs(P,{title:"Page d’accueil",children:[e.jsx("img",{alt:"",className:ie["image-preview-shell"],src:aa,role:"presentation"}),e.jsx("img",{"data-testid":"app-preview-offer-img-home",alt:"",className:ie["image-preview-home-preview"],src:a,role:"presentation"})]}),e.jsxs(P,{title:"Détails de l’offre",children:[e.jsx("img",{alt:"",className:W["image-preview-blur-offer-preview"],src:a,role:"presentation"}),e.jsx("img",{alt:"",className:W["image-preview-shell"],src:ra,role:"presentation"}),e.jsx("img",{"data-testid":"app-preview-offer-img",alt:"",className:W["image-preview-offer-preview"],src:a,role:"presentation"})]})]});try{Y.displayName="AppPreviewOffer",Y.__docgenInfo={description:"",displayName:"AppPreviewOffer",props:{imageUrl:{defaultValue:null,description:"",name:"imageUrl",required:!0,type:{name:"string"}}}}}catch{}const ia=""+new URL("partner-home-shell-QX5a1P1s.png",import.meta.url).href,ta=""+new URL("partner-shell-D59I5gaY.png",import.meta.url).href,te={"image-preview-shell":"_image-preview-shell_nl6jv_1","image-preview-home-preview":"_image-preview-home-preview_nl6jv_7"},oe={"image-preview-shell":"_image-preview-shell_19ta7_1","image-preview-offer-preview":"_image-preview-offer-preview_19ta7_7"},$=({imageUrl:a})=>e.jsxs(ve,{children:[e.jsxs(P,{title:"Page d’accueil",children:[e.jsx("img",{alt:"",className:te["image-preview-shell"],src:ia,role:"presentation"}),e.jsx("img",{"data-testid":"app-preview-offer-img-home",alt:"",className:te["image-preview-home-preview"],src:a,role:"presentation"})]}),e.jsxs(P,{title:"Détails de l’offre",children:[e.jsx("img",{alt:"",className:oe["image-preview-shell"],src:ta,role:"presentation"}),e.jsx("img",{"data-testid":"app-preview-offer-img",alt:"",className:oe["image-preview-offer-preview"],src:a,role:"presentation"})]})]});try{$.displayName="AppPreviewVenue",$.__docgenInfo={description:"",displayName:"AppPreviewVenue",props:{imageUrl:{defaultValue:null,description:"",name:"imageUrl",required:!0,type:{name:"string"}}}}}catch{}const p={"modal-image-crop":"_modal-image-crop_1b7nb_1","modal-image-crop-content":"_modal-image-crop-content_1b7nb_8","modal-image-crop-subwrapper":"_modal-image-crop-subwrapper_1b7nb_11","modal-image-crop-editor":"_modal-image-crop-editor_1b7nb_22","modal-image-crop-editor-loading":"_modal-image-crop-editor-loading_1b7nb_30","modal-image-crop-callout":"_modal-image-crop-callout_1b7nb_33","modal-image-crop-callout-list":"_modal-image-crop-callout-list_1b7nb_36","modal-image-crop-actions":"_modal-image-crop-actions_1b7nb_40","modal-image-crop-header":"_modal-image-crop-header_1b7nb_47","modal-image-crop-right":"_modal-image-crop-right_1b7nb_53","modal-image-crop-credit":"_modal-image-crop-credit_1b7nb_59","modal-image-crop-credit-loading":"_modal-image-crop-credit-loading_1b7nb_63","modal-image-crop-footer":"_modal-image-crop-footer_1b7nb_66"},oa=({originalDimensions:a,orientation:i})=>i==="landscape"?{width:Math.floor(Math.min(a.width,a.height/2*3)),height:Math.floor(Math.min(a.height,a.width/3*2))}:{width:Math.floor(Math.min(a.width,a.height/3*2)),height:Math.floor(Math.min(a.height,a.width/2*3))},na=(a,i,t)=>{const l={[r.OFFER]:400,[r.OFFER_COLLECTIVE]:400,[r.VENUE]:600}[t],{width:n}=oa({originalDimensions:{width:a,height:i},orientation:t===r.VENUE?"landscape":"portrait"}),c=Math.min(4,(n-10)/l),o={[r.OFFER]:297,[r.OFFER_COLLECTIVE]:297,[r.VENUE]:138}[t];return{[r.OFFER]:{canvasHeight:o,canvasWidth:o*2/3,cropBorderColor:"#FFF",cropBorderHeight:50,cropBorderWidth:105,maxScale:c},[r.OFFER_COLLECTIVE]:{canvasHeight:o,canvasWidth:o*2/3,cropBorderColor:"#FFF",cropBorderHeight:50,cropBorderWidth:105,maxScale:c},[r.VENUE]:{canvasHeight:o,canvasWidth:o*3/2,cropBorderColor:"#FFF",cropBorderHeight:40,cropBorderWidth:100,maxScale:c}}[t]},z=({mode:a,onImageUpload:i,onImageDelete:t,initialValues:l={}})=>{const{draftImage:n,...c}=l,o={x:.5,y:.5},{originalImageUrl:_,credit:g,cropParams:v}=c,d=_,{xCropPercent:u,yCropPercent:b,heightCropPercent:V,widthCropPercent:I}=v||{},we=u&&I?N(u,I):o.x,xe=b&&V?N(b,V):o.y,w=m.useRef(null),D=Te(),[L,X]=m.useState(!0),[f,q]=m.useState(n),[J,Q]=m.useState(d),[ye,K]=m.useState({x:we,y:xe}),[B,Z]=m.useState(g??""),[Ee,je]=m.useState(I?ea(I):1),{width:M,height:A}=Ze(f),Ce=na(M,A,a),Ue=a===r.OFFER&&(M&&M<400||A&&A<600),be={[r.VENUE]:$,[r.OFFER]:Y,[r.OFFER_COLLECTIVE]:()=>e.jsx(e.Fragment,{})}[a];m.useEffect(()=>{async function s(x){try{q(await Ke(x))}catch{D.error("Erreur lors de la récupération de votre image.")}}d&&s(d)},[d,D]);const Ve=()=>{q(void 0),K({x:o.x,y:o.y}),Z(""),je(1)},Ne=s=>{X(!0),q(s),T()},Fe=(s,x,h)=>{f&&i({imageFile:f,imageCroppedDataUrl:x,cropParams:h,credit:s})},Oe=()=>{if(w.current){const s=w.current.getImage();Q(s.toDataURL()),X(!1)}},T=s=>{try{if(w.current){const x=w.current.getImage();Q(x.toDataURL());const h=w.current.getCroppingRect();K({x:N(h.x,h.width),y:N(h.y,h.height)}),s&&s(B,x.toDataURL(),h)}}catch{D.error("Une erreur est survenue. Merci de réessayer plus tard")}},Re=()=>T(),Pe=()=>T(Fe);return e.jsxs("form",{className:p["modal-image-crop"],children:[e.jsxs("div",{className:p["modal-image-crop-content"],children:[e.jsx(Me,{asChild:!0,children:e.jsx("h1",{className:p["modal-image-crop-header"],children:"Modifier une image"})}),e.jsx("p",{className:p["modal-image-crop-right"],children:"En utilisant ce contenu, je certifie que je suis propriétaire ou que je dispose des autorisations nécessaires pour l’utilisation de celui-ci."}),f&&e.jsxs(e.Fragment,{children:[L&&e.jsx(Ge,{}),e.jsxs("div",{className:U(p["modal-image-crop-subwrapper"],L&&p["modal-image-crop-editor-loading"]),children:[e.jsxs("div",{className:p["modal-image-crop-editor"],children:[e.jsx(Xe,{ref:w,...Ce,image:f,initialPosition:ye,initialScale:Ee,onChangeDone:Re,onImagePainted:Oe}),e.jsxs("div",{className:p["modal-image-crop-actions"],children:[e.jsx(E,{icon:ke,onClick:Ve,variant:C.TERNARY,children:"Remplacer l’image"}),e.jsx(ee,{asChild:!0,children:e.jsx(E,{icon:fe,onClick:t,variant:C.TERNARY,children:"Supprimer l’image"})})]})]}),J&&e.jsx(be,{imageUrl:J})]}),Ue&&e.jsx(Ye,{className:p["modal-image-crop-callout"],variant:$e.WARNING,children:e.jsxs("div",{children:["La qualité de votre image n’est pas optimale.",e.jsx("br",{}),"Le format recommandé :",e.jsxs("ul",{className:p["modal-image-crop-callout-list"],children:[e.jsx("li",{children:"Largeur minimale de l’image : 400 px"}),e.jsx("li",{children:"Hauteur minimale de l’image : 600 px"})]})]})}),e.jsx(ze,{count:B.length,className:U(p["modal-image-crop-credit"],L&&p["modal-image-crop-credit-loading"]),label:"Crédit de l’image",maxLength:255,value:B,onChange:s=>Z(s.target.value),name:"credit",type:"text"})]}),!f&&e.jsx(We,{onDropOrSelected:Ne,...a!==r.OFFER?{minSizes:{width:600,height:400}}:{}})]}),e.jsx(_e.Footer,{children:e.jsxs("div",{className:p["modal-image-crop-footer"],children:[e.jsx(ee,{asChild:!0,children:e.jsx(E,{variant:C.SECONDARY,children:"Annuler"})}),e.jsx(E,{type:"submit",onClick:s=>{s.preventDefault(),Pe()},disabled:!f,children:"Enregistrer"})]})})]})};try{z.displayName="ModalImageUpsertOrEdit",z.__docgenInfo={description:"",displayName:"ModalImageUpsertOrEdit",props:{mode:{defaultValue:null,description:"",name:"mode",required:!0,type:{name:"enum",value:[{value:'"offer"'},{value:'"offer_collective"'},{value:'"venue"'}]}},onImageUpload:{defaultValue:null,description:"",name:"onImageUpload",required:!0,type:{name:"(values: OnImageUploadArgs) => void"}},onImageDelete:{defaultValue:null,description:"",name:"onImageDelete",required:!1,type:{name:"(() => void)"}},initialValues:{defaultValue:{value:"{}"},description:"",name:"initialValues",required:!1,type:{name:"UploadImageValues"}}}}}catch{}const la="_label_1wm17_22",sa="_icon_1wm17_35",j={"button-image-add":"_button-image-add_1wm17_1","add-image-venue":"_add-image-venue_1wm17_14","add-image-offer":"_add-image-offer_1wm17_18",label:la,icon:sa},S=({mode:a,initialValues:i={},onImageUpload:t,onImageDelete:l,onClickButtonImage:n,children:c,disableForm:o})=>{const{imageUrl:_,originalImageUrl:g}=i,[v,d]=m.useState(!1),u=()=>{n&&n()},b=()=>{l()};function V(I){t(I),d(!1)}return e.jsx(e.Fragment,{children:e.jsx(_e,{onOpenChange:d,open:v,variant:"drawer",trigger:_||g?e.jsx(E,{onClick:u,variant:C.TERNARY,"aria-label":"Modifier l’image",icon:Je,children:c??"Modifier"}):e.jsx("button",{className:U(j["button-image-add"],{[j["add-image-venue"]]:a===r.VENUE,[j["add-image-offer"]]:a===r.OFFER||a===r.OFFER_COLLECTIVE}),onClick:u,type:"button",disabled:o,children:e.jsxs(e.Fragment,{children:[e.jsx(he,{src:He,alt:"",className:j.icon}),e.jsx("span",{className:j.label,children:"Ajouter une image"})]})}),children:e.jsx(z,{mode:a,onImageUpload:V,onImageDelete:b,initialValues:i})})})};try{S.displayName="ButtonImageEdit",S.__docgenInfo={description:"",displayName:"ButtonImageEdit",props:{onImageUpload:{defaultValue:null,description:"",name:"onImageUpload",required:!0,type:{name:"(values: OnImageUploadArgs) => void"}},onImageDelete:{defaultValue:null,description:"",name:"onImageDelete",required:!0,type:{name:"() => void"}},initialValues:{defaultValue:{value:"{}"},description:"",name:"initialValues",required:!1,type:{name:"UploadImageValues"}},mode:{defaultValue:null,description:"",name:"mode",required:!0,type:{name:"enum",value:[{value:'"offer"'},{value:'"offer_collective"'},{value:'"venue"'}]}},onClickButtonImage:{defaultValue:null,description:"",name:"onClickButtonImage",required:!1,type:{name:"(() => void)"}},disableForm:{defaultValue:null,description:"",name:"disableForm",required:!1,type:{name:"boolean"}}}}}catch{}const y={"image-uploader-image-container":"_image-uploader-image-container_1gu1i_5","image-uploader-actions-container":"_image-uploader-actions-container_1gu1i_10","actions-wrapper":"_actions-wrapper_1gu1i_17","image-preview":"_image-preview_1gu1i_25","preview-venue":"_preview-venue_1gu1i_31","preview-offer":"_preview-offer_1gu1i_41"},G=({className:a,onImageUpload:i,onImageDelete:t,initialValues:l={},mode:n,onClickButtonImageAdd:c,hideActionButtons:o=!1,disableForm:_=!1})=>{const{imageUrl:g,originalImageUrl:v,credit:d,cropParams:u}=l;return e.jsx("div",{className:U(y["image-uploader-image-container"],a),children:g&&v?e.jsxs(e.Fragment,{children:[e.jsx("img",{alt:"Prévisualisation de l’image","data-testid":"image-preview",className:U(y["image-preview"],{[y["preview-venue"]]:n===r.VENUE,[y["preview-offer"]]:n===r.OFFER||n===r.OFFER_COLLECTIVE}),src:g}),!o&&e.jsx("div",{className:y["image-uploader-actions-container"],children:e.jsxs("div",{className:y["actions-wrapper"],children:[e.jsx(S,{mode:n,initialValues:{originalImageUrl:v,imageUrl:g,credit:d,cropParams:u},onImageUpload:i,onImageDelete:t,onClickButtonImage:c,disableForm:_}),e.jsx(H,{onImageDelete:t})]})})]}):e.jsx(S,{mode:n,onImageUpload:i,onImageDelete:t,onClickButtonImage:c,disableForm:_})})};try{G.displayName="ImageUploader",G.__docgenInfo={description:"",displayName:"ImageUploader",props:{className:{defaultValue:null,description:"",name:"className",required:!1,type:{name:"string"}},onImageUpload:{defaultValue:null,description:"",name:"onImageUpload",required:!0,type:{name:"(values: OnImageUploadArgs) => void"}},onImageDelete:{defaultValue:null,description:"",name:"onImageDelete",required:!0,type:{name:"() => void"}},initialValues:{defaultValue:{value:"{}"},description:"",name:"initialValues",required:!1,type:{name:"UploadImageValues"}},mode:{defaultValue:null,description:"",name:"mode",required:!0,type:{name:"enum",value:[{value:'"offer"'},{value:'"offer_collective"'},{value:'"venue"'}]}},onClickButtonImageAdd:{defaultValue:null,description:"",name:"onClickButtonImageAdd",required:!1,type:{name:"(() => void)"}},hideActionButtons:{defaultValue:{value:"false"},description:"",name:"hideActionButtons",required:!1,type:{name:"boolean"}},disableForm:{defaultValue:{value:"false"},description:"",name:"disableForm",required:!1,type:{name:"boolean"}}}}}catch{}const or={title:"components/ImageUploader/ImageUploader",component:G,decorators:[De,a=>e.jsx(Se,{store:Le({}),children:e.jsx(a,{})})]},Ie={initialValues:{originalImageUrl:re,imageUrl:re,credit:"John Do",cropParams:{xCropPercent:0,yCropPercent:0,heightCropPercent:1,widthCropPercent:1}},mode:r.OFFER,onImageDelete:()=>{alert("onDelete have been called.")},onImageUpload:()=>{alert("onImageUpload have been called.")}},F={args:{...Ie}},O={args:{...Ie,initialValues:{imageUrl:ae,originalImageUrl:ae},mode:r.VENUE}},R={args:{mode:r.OFFER}};var ne,le,se;F.parameters={...F.parameters,docs:{...(ne=F.parameters)==null?void 0:ne.docs,source:{originalSource:`{
  args: {
    ...props
  }
}`,...(se=(le=F.parameters)==null?void 0:le.docs)==null?void 0:se.source}}};var me,ce,pe;O.parameters={...O.parameters,docs:{...(me=O.parameters)==null?void 0:me.docs,source:{originalSource:`{
  args: {
    ...props,
    initialValues: {
      imageUrl: sampleImageLandscape,
      originalImageUrl: sampleImageLandscape
    },
    mode: UploaderModeEnum.VENUE
  }
}`,...(pe=(ce=O.parameters)==null?void 0:ce.docs)==null?void 0:pe.source}}};var de,ge,ue;R.parameters={...R.parameters,docs:{...(de=R.parameters)==null?void 0:de.docs,source:{originalSource:`{
  args: {
    mode: UploaderModeEnum.OFFER
  }
}`,...(ue=(ge=R.parameters)==null?void 0:ge.docs)==null?void 0:ue.source}}};const nr=["WithImageOffer","WithImageVenue","WithoutImage"];export{F as WithImageOffer,O as WithImageVenue,R as WithoutImage,nr as __namedExportsOrder,or as default};
