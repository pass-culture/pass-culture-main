#!/bin/bash

counter=0

STAGED_FILES=$(git diff --cached --name-only --diff-filter=ACM -- '*.py' ':!tests')
if [[ "$STAGED_FILES" = "" ]]; then
  exit 0
fi

LINTED_FILES=""

for FILE in $STAGED_FILES; do
  LINTED_FILES+=" /opt/services/flaskapp/src/${FILE}"
done

echo -e "Running mypy for type checking\n"
docker exec pc-flask mypy $LINTED_FILES
if [[ "$?" != 0 ]]; then
  counter=$((counter + 1))
fi

echo -e "\nRunning pylint for code linting\n"
docker exec pc-flask pylint $LINTED_FILES
if [[ "$?" != 0 ]]; then
  counter=$((counter + 1))
fi

if [[ $counter > 0 ]]; then
  echo -e "\033[0;34mIf you want to bypass it, add --no-verify option when committing.\033[0m\n"
  exit 1
fi
